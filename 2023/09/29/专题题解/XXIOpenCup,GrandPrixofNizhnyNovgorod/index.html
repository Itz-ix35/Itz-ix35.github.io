<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css" integrity="sha256-xejo6yLi6vGtAjcMIsY8BHdKsLg7QynVlFMzdQgUuy8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"itz-ix35.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.12.3","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":true,"show_result":true,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="https:&#x2F;&#x2F;codeforces.com&#x2F;gym&#x2F;103260">
<meta property="og:type" content="article">
<meta property="og:title" content="专题题解 - XXI Open Cup, Grand Prix of Nizhny Novgorod">
<meta property="og:url" content="https://itz-ix35.github.io/2023/09/29/%E4%B8%93%E9%A2%98%E9%A2%98%E8%A7%A3/XXIOpenCup,GrandPrixofNizhnyNovgorod/index.html">
<meta property="og:site_name" content="ix35&#39;s Blog">
<meta property="og:description" content="https:&#x2F;&#x2F;codeforces.com&#x2F;gym&#x2F;103260">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.luogu.com.cn/upload/image_hosting/tepkursq.png">
<meta property="article:published_time" content="2023-09-29T12:47:44.104Z">
<meta property="article:modified_time" content="2025-02-21T01:06:07.939Z">
<meta property="article:author" content="ix35">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.luogu.com.cn/upload/image_hosting/tepkursq.png">


<link rel="canonical" href="https://itz-ix35.github.io/2023/09/29/%E4%B8%93%E9%A2%98%E9%A2%98%E8%A7%A3/XXIOpenCup,GrandPrixofNizhnyNovgorod/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://itz-ix35.github.io/2023/09/29/%E4%B8%93%E9%A2%98%E9%A2%98%E8%A7%A3/XXIOpenCup,GrandPrixofNizhnyNovgorod/","path":"2023/09/29/专题题解/XXIOpenCup,GrandPrixofNizhnyNovgorod/","title":"专题题解 - XXI Open Cup, Grand Prix of Nizhny Novgorod"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>专题题解 - XXI Open Cup, Grand Prix of Nizhny Novgorod | ix35's Blog</title>
  






  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">ix35's Blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-essays"><a href="/essay/" rel="section"><i class="fa fa-tags fa-fw"></i>随笔选辑</a></li><li class="menu-item menu-item-game-guide"><a href="/game-guide/" rel="section"><i class="fa fa-tags fa-fw"></i>游戏攻略</a></li><li class="menu-item menu-item-game-review"><a href="/game-review/" rel="section"><i class="fa fa-tags fa-fw"></i>游戏评测</a></li><li class="menu-item menu-item-music"><a href="/music/" rel="section"><i class="fa fa-tags fa-fw"></i>音乐分享</a></li><li class="menu-item menu-item-notes"><a href="/note/" rel="section"><i class="fa fa-tags fa-fw"></i>课程笔记</a></li><li class="menu-item menu-item-solutions"><a href="/solution/" rel="section"><i class="fa fa-tags fa-fw"></i>专题题解</a></li><li class="menu-item menu-item-technology"><a href="/technology/" rel="section"><i class="fa fa-tags fa-fw"></i>科普文章</a></li><li class="menu-item menu-item-travelogue"><a href="/travel/" rel="section"><i class="fa fa-tags fa-fw"></i>远古游记</a></li><li class="menu-item menu-item-gallery"><a href="/gallery/" rel="section"><i class="fa fa-image fa-fw"></i>画廊</a></li><li class="menu-item menu-item-data"><a href="/data/" rel="section"><i class="fa fa-database fa-fw"></i>数据</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#A-Assignment-Problem"><span class="nav-text">A. Assignment Problem</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#B-Lockout-vs-Tourist"><span class="nav-text">B. Lockout vs. Tourist</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#C-Multiple"><span class="nav-text">C. Multiple?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#D-Output-Limit-Exceeded"><span class="nav-text">D. Output Limit Exceeded</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#E-Smol-Vertex-Cover"><span class="nav-text">E. Smol Vertex Cover</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#F-Thanks-to-MikeMirzayanov"><span class="nav-text">F. Thanks to MikeMirzayanov</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#G-Remove-the-Prime"><span class="nav-text">G. Remove the Prime</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#H-Excluded-Min"><span class="nav-text">H. Excluded Min</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#I-Trade"><span class="nav-text">I. Trade</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#J-Increasing-or-Decreasing"><span class="nav-text">J. Increasing or Decreasing</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#K-Rectangle-Painting"><span class="nav-text">K. Rectangle Painting</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#L-Extreme-Wealth"><span class="nav-text">L. Extreme Wealth</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#M-Discrete-Logarithm-is-a-Joke"><span class="nav-text">M. Discrete Logarithm is a Joke</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="ix35"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">ix35</p>
  <div class="site-description" itemprop="description"></div>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/Itz-ix35" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Itz-ix35" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:2757336405@qq.com" title="E-Mail → mailto:2757336405@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.luogu.com.cn/user/113546" title="Luogu → https:&#x2F;&#x2F;www.luogu.com.cn&#x2F;user&#x2F;113546" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>Luogu</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://space.bilibili.com/187505795" title="Bilibili → https:&#x2F;&#x2F;space.bilibili.com&#x2F;187505795" rel="noopener" target="_blank"><i class="fab fa-youtube fa-fw"></i>Bilibili</a>
      </span>
  </div>



        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://itz-ix35.github.io/2023/09/29/%E4%B8%93%E9%A2%98%E9%A2%98%E8%A7%A3/XXIOpenCup,GrandPrixofNizhnyNovgorod/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="ix35">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ix35's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="专题题解 - XXI Open Cup, Grand Prix of Nizhny Novgorod | ix35's Blog">
      <meta itemprop="description" content="https://codeforces.com/gym/103260">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          专题题解 - XXI Open Cup, Grand Prix of Nizhny Novgorod
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-09-29 20:47:44" itemprop="dateCreated datePublished" datetime="2023-09-29T20:47:44+08:00">2023-09-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E4%B8%93%E9%A2%98%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">专题题解</span></a>
        </span>
    </span>

  
</div>

            <div class="post-description">https://codeforces.com/gym/103260</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>难度主要是指思维难度。</p>
<hr>
<h3 id="A-Assignment-Problem"><a href="#A-Assignment-Problem" class="headerlink" title="A. Assignment Problem"></a>A. Assignment Problem</h3><p><strong>难度：</strong>$\bigstar\bigstar$</p>
<p><strong>题目大意：</strong></p>
<p>有 $m$ 个职位和 $n$ 个应聘者（$m\leq n$），每个职位应分配给恰好一个应聘者。</p>
<p>有收益矩阵 $A_{m\times n}$ 表示每个职位分配给每个应聘者的收益，HR 在安排职位时需要保证总收益最高。</p>
<p>现在 $A$ 不是完全给定的，只是对于所有 $1\leq i\leq m$ 给定 $n$ 个人在第 $i$ 个职位上收益从大到小的排序结果，即对于每个 $i$ 给出排列 $p_{i,1},\ldots,p_{i,n}$，表示 $A_{i,p_{i,j}}&gt;A_{i,p_{i,j+1}}$。</p>
<p>你需要指出，对于每个 $1\leq i\leq n$，是否存在一个可行的矩阵 $A$ 使得第 $i$ 个人可以被应聘。</p>
<p>$1\leq m\leq 11,  1\leq n\leq 1000$</p>
<p><strong>题目解法：</strong></p>
<p>首先我们证明：一定存在一个 $i$ 使得第 $i$ 个职位分配给了 $p_{i,1}$。</p>
<p>否则，假设第 $i$ 个职位选了第 $h_i$ 个人，建立一个有向图，从 $h_i$ 连边到 $p_{i,1}$，在图中从任意一个有出度的点出发任意走一条路径，直到终点没有出度或者回到了起点（可以认为是简单路径，否则中途就有环，因此路径是有限的），沿着路径方向进行一轮调整就得到了一组更优解，矛盾。这就证明了原命题。</p>
<p>因此选人的过程可以这样理解：每次选择一个 $i$，将这个职位分配给 $p_{i,1}$，然后将 $p_{i,1}$ 这个人删掉，再在剩下的职位和应聘者之中重复上述过程。</p>
<p>所以，我们枚举一个 $1,\ldots,m$ 的排列，那么每个职位分配给的应聘者就确定了，我们可以 $O(m^2)$ 求出来，这些人就是可能被应聘的人。</p>
<p>时间复杂度为 $O(m!\times m^2+n\times m)$，事实上常数极小，因此可以通过。</p>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        代码
    </div>
    <div class='spoiler-content'>
        <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1010</span>;</span><br><span class="line"><span class="type">int</span> n,m,cnt,ans[MAXN],ch[MAXN],flg[MAXN],p[MAXN][MAXN],ord[<span class="number">12</span>],vis[<span class="number">12</span>];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">chk</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++) &#123;</span><br><span class="line">		<span class="type">int</span> j=<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">while</span> (flg[p[ord[i]][j]]) &#123;j++;&#125;</span><br><span class="line">		ch[i]=p[ord[i]][j];</span><br><span class="line">		flg[ch[i]]=ans[ch[i]]=<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++) &#123;flg[ch[i]]=<span class="number">0</span>;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span> <span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (x==m+<span class="number">1</span>) &#123;<span class="built_in">chk</span>();<span class="keyword">return</span>;&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (!vis[i]) &#123;</span><br><span class="line">			ord[x]=i,vis[i]=<span class="number">1</span>;</span><br><span class="line">			<span class="built_in">dfs</span>(x+<span class="number">1</span>);</span><br><span class="line">			vis[i]=<span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">1</span>;j&lt;=n;j++) &#123;<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;p[i][j]);&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">dfs</span>(<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (ans[i]) &#123;cnt++;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,cnt);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (ans[i]) &#123;<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,i);&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="B-Lockout-vs-Tourist"><a href="#B-Lockout-vs-Tourist" class="headerlink" title="B. Lockout vs. Tourist"></a>B. Lockout vs. Tourist</h3><p><strong>难度：</strong>$\bigstar\bigstar\bigstar\bigstar$</p>
<p><strong>题目大意：</strong></p>
<p>有 $n$ 道题，第 $i$ 道题分数为 $a_i$，你和 Tourist 一起做这些题，规则如下：</p>
<ul>
<li>每一回合，你和 Tourist 分别选出一道题，选择时你们互不了解对方的选项；</li>
<li>如果你选的题和 Tourist 一样，那么就删除这道题，如果 $n$ 道题已经删光那么游戏结束并且你获得零分，否则进入下一回合；</li>
<li>如果你选的题和 Tourist 不一样，那么游戏结束，你的得分是你这回合选的这道题的得分。</li>
</ul>
<p>Tourist 想要最小化你的得分，请问 Tourist 在最优策略下，你期望最多能获得多少分，以浮点数形式输出。</p>
<p>$1\leq n\leq 22$</p>
<p><em>ix35 的注解：Tourist 的决策是基于概率的，也就是可以以一定权重随机选择某道题，而他的目标是使得你在这种情况下任意选择一道题，最大的期望得分最小。</em></p>
<p><strong>题目解法：</strong></p>
<p>状压 DP，设剩余题目集合为 $S$ 时你的最大期望得分为 $f(S)$。</p>
<p>设 $m=|S|$，其中第 $i$ 题分数为 $a_i$，$S$ 除去第 $i$ 题后你的最大期望得分（这是已经算过的 $f$ 值）为 $b_i$，Tourist 有 $p_i$ 的概率选择第 $i$ 题（$1\leq i\leq m$），那么你的最大期望得分就是：</p>
<script type="math/tex; mode=display">
\max(p_i\times b_i+(1-p_i)\times a_i)</script><p>就是说如果你选了第 $i$ 题，那么 Tourist 有 $p_i$ 概率也选第 $i$ 题，此时这道题被删除，而后你的最大期望得分为 $b_i$，否则你直接获得 $a_i$ 分并结束游戏。</p>
<p>考虑二分答案 $C$，我们现在要判断是否存在 $p_1,\ldots,p_m$，使得：</p>
<script type="math/tex; mode=display">
\begin{cases}\sum\limits_{i=1}^mp_i=1 \\ \forall i,\ \ a_i+(b_i-a_i)p_i\leq C \\ p_i\ge 0\end{cases}</script><p>令 $d_i=\dfrac{C-a_i}{b_i-a_i}$，那么第二个条件告诉我们，如果 $b_i&gt;a_i$ 那么 $p_i\leq d_i$，如果 $b_i&lt;a_i$ 那么 $p_i\ge d_i$（而 $b_i=a_i$ 的情况稍后说明）。</p>
<p>有一个容易证明的结论：存在至少一个 $i$，使得 $b_i&lt;a_i$（考虑最大的 $a_i$ 即可），因此判定条件就可以写为：</p>
<script type="math/tex; mode=display">
\begin{cases}\sum\limits_{b_i<a_i} \max(0,d_i)\leq 1 \\ \forall i(b_i\ge a_i),\ C\ge a_i\end{cases}</script><p>第二个条件是因为当 $b_i&gt;a_i$ 时 $0\leq p_i\leq d_i$，所以 $(C-a_i)(b_i-a_i)\ge 0$，而当 $b_i=a_i$ 时由之前的式子直接得到 $a_i\leq C$。</p>
<p>实际上第二个条件只是给了 $C$ 的一个下界，稍为复杂的是第一个条件：注意到 $d_i&gt;0\iff C&lt; a_i$，所以在这里我们只需要考虑所有大于 $C$ 的 $a_i$，这也告诉我们 $\sum \max(0,d_i)$ 是一个关于 $C$ 的分段线性函数，在每一段上都可以求出它取 $1$ 的点，也就是 $C$ 的最小值。</p>
<p>如果真的去二分，时间复杂度为 $O(2^n\times n\times \log \epsilon^{-1})$，难以通过。</p>
<p>但是根据上面的观察，不需要二分 $C$，只需要分段后在每一段上求一个最值就可以了，时间复杂度为 $O(2^n\times n)$。</p>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        代码
    </div>
    <div class='spoiler-content'>
        <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">30</span>;</span><br><span class="line"><span class="type">int</span> n,cnt,w[MAXN];</span><br><span class="line"><span class="type">double</span> dp[<span class="number">1</span>&lt;&lt;<span class="number">22</span>];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">P</span> &#123;</span><br><span class="line">	<span class="type">double</span> a,b;</span><br><span class="line">&#125;p[MAXN];</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span> <span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span> </span>&#123;<span class="keyword">return</span> a&gt;b;&#125;</span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">solve</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="comment">//sort(p+1,p+cnt+1,cmp);</span></span><br><span class="line">	<span class="type">double</span> xj=<span class="number">-1.0</span>,res=p[<span class="number">1</span>].a,k=<span class="number">0.0</span>,b=<span class="number">0.0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=cnt;i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (p[i].b&gt;p[i].a) &#123;xj=<span class="built_in">max</span>(xj,p[i].a);&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	p[cnt+<span class="number">1</span>].a=<span class="number">0.0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=cnt;i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (p[i].b&gt;p[i].a) &#123;<span class="keyword">break</span>;&#125;</span><br><span class="line">		k-=<span class="number">1.0</span>/(p[i].a-p[i].b),b+=p[i].a/(p[i].a-p[i].b);</span><br><span class="line">		<span class="type">double</span> tmp=(<span class="number">1.0</span>-b)/k;</span><br><span class="line">		<span class="keyword">if</span> (tmp&lt;=p[i].a) &#123;res=<span class="built_in">max</span>(p[i+<span class="number">1</span>].a,tmp);&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">max</span>(xj,res);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;w[i]);&#125;</span><br><span class="line">	<span class="built_in">sort</span>(w+<span class="number">1</span>,w+n+<span class="number">1</span>,cmp);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;(<span class="number">1</span>&lt;&lt;n);i++) &#123;</span><br><span class="line">		cnt=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">0</span>;j&lt;n;j++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (i&amp;(<span class="number">1</span>&lt;&lt;j)) &#123;</span><br><span class="line">				cnt++;</span><br><span class="line">				p[cnt].a=w[j+<span class="number">1</span>],p[cnt].b=dp[i^(<span class="number">1</span>&lt;&lt;j)];</span><br><span class="line">				<span class="comment">//cout &lt;&lt; &quot;  &quot; &lt;&lt; cnt &lt;&lt; &quot;  &quot; &lt;&lt; a[cnt] &lt;&lt; &quot;  &quot; &lt;&lt; b[cnt] &lt;&lt; endl;</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		dp[i]=<span class="built_in">solve</span>();</span><br><span class="line">		<span class="comment">//cout &lt;&lt; i &lt;&lt; &quot;  &quot; &lt;&lt; dp[i] &lt;&lt; endl;</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%.9f\n&quot;</span>,dp[(<span class="number">1</span>&lt;&lt;n)<span class="number">-1</span>]);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="C-Multiple"><a href="#C-Multiple" class="headerlink" title="C. Multiple?"></a>C. Multiple?</h3><p><strong>难度：</strong>$\bigstar\bigstar\bigstar$</p>
<p><strong>题目大意：</strong></p>
<p>定义好序列为所有元素都是 $[1,n]$ 中的整数，且任意非空子序列的和不是 $n$ 的倍数的序列。</p>
<p>求长度为 $n-k$ 的好序列数量，对 $998244353$ 取模。</p>
<p>$1\leq k\leq \dfrac{n}{4}&lt;n&lt;998244353$</p>
<p><strong>题目解法：</strong></p>
<p>可以证明：好序列的众数出现次数一定不小于 $\dfrac{n}{2}$，并且这个众数一定与 $n$ 互素（后附证明），设其为 $x$，首先将所有序列中的数乘上 $x^{-1}$，此时众数是 $1$，且至少 $\dfrac{n}{2}$ 个，所以容易证明所有数的和小于 $n$，这其实是一个充要条件（因为大于 $\dfrac{n}{2}$ 个不是 $1$ 的数直接导致和大于等于 $n$），利用隔板法知方案数 $\binom {n-1}{k-1}$，注意还要乘上众数的方案数 $\varphi(n)$。</p>
<p>下面是对关键结论的证明：</p>
<p>设众数为 $x$，除了 $x$ 以外其他所有数的出现次数总和为 $t$，我们现在从 $n-k$ 个数中选出若干对，使得每一对里两个数不同，容易证明可以选出 $S=\min(t,\lfloor\dfrac{n-k}{2}\rfloor)$ 对。</p>
<p>将所有数排成一列，使得同一对数在一起，此时有 $n-k+1$ 个前缀和，同时我们还可以交换任意一对数内部的顺序，就又有了 $S$ 个新的前缀和，总共 $n-k+1+S$ 个前缀和，并且它们模 $n$ 两两不同（否则就找到了一个子序列和为 $n$ 的倍数），所以 $S<k$，由于 $k\leq \dfrac{n}{4}$，所以 $S=t$ 并且 $t<k$，所以众数 $x$ 的出现次数 $n-k-t>\dfrac{n}{2}$，如果 $(x,n)\ne 1$ 那么取 $\dfrac{n}{(x,n)}$ 个 $x$ 就是 $n$ 的倍数，不符合题意，所以 $(x,n)=1$。</p>
<p>时间复杂度为 $O(n)$，由于 $k\leq \dfrac{n}{4}$ 所以常数为 $\dfrac{1}{4}$，可以通过。</p>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        代码
    </div>
    <div class='spoiler-content'>
        <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> P=<span class="number">998244353</span>;</span><br><span class="line"><span class="type">int</span> n,k,ans,tmp;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">qpow</span> <span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> res=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">while</span> (b) &#123;</span><br><span class="line">		<span class="keyword">if</span> (b&amp;<span class="number">1</span>) &#123;res=(<span class="number">1ll</span>*res*a)%P;&#125;</span><br><span class="line">		a=(<span class="number">1ll</span>*a*a)%P,b&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;k);</span><br><span class="line">	ans=tmp=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=k<span class="number">-1</span>;i++) &#123;</span><br><span class="line">		ans=(<span class="number">1ll</span>*ans*(n-i))%P;</span><br><span class="line">		tmp=(<span class="number">1ll</span>*tmp*i)%P;</span><br><span class="line">	&#125;</span><br><span class="line">	ans=(<span class="number">1ll</span>*ans*<span class="built_in">qpow</span>(tmp,P<span class="number">-2</span>))%P;</span><br><span class="line">	ans=(<span class="number">1ll</span>*ans*n)%P;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">2</span>;i*i&lt;=n;i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (n%i==<span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">while</span> (n%i==<span class="number">0</span>) &#123;n/=i;&#125;</span><br><span class="line">			ans=(<span class="number">1ll</span>*ans*(i<span class="number">-1</span>))%P;</span><br><span class="line">			ans=(<span class="number">1ll</span>*ans*<span class="built_in">qpow</span>(i,P<span class="number">-2</span>))%P;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (n&gt;<span class="number">1</span>) &#123;</span><br><span class="line">		ans=(<span class="number">1ll</span>*ans*(n<span class="number">-1</span>))%P;</span><br><span class="line">		ans=(<span class="number">1ll</span>*ans*<span class="built_in">qpow</span>(n,P<span class="number">-2</span>))%P;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="D-Output-Limit-Exceeded"><a href="#D-Output-Limit-Exceeded" class="headerlink" title="D. Output Limit Exceeded"></a>D. Output Limit Exceeded</h3><p><strong>难度：</strong>$\bigstar\bigstar$</p>
<p><strong>题目大意：</strong></p>
<p>对于给定的 $n,k (0\leq k\leq n)$，可以建立一张左右各 $k$ 个点的二分图，其中左边第 $i$ 个点与右边第 $j$ 个点有边当且仅当 $i\mid n-j+1$，如果这张图有完美匹配，就称 $(n,k)$ 是好的。</p>
<p>给定 $n$，请你给出一个长度为 $n+1$ 的 $\texttt{01}$ 串 $s$，$s$ 的第 $i$ 位为 $1$ 当且仅当 $(n,i-1)$ 是好的。</p>
<p>你需要这样给出 $s$：初始令 $s_0=\texttt{0}, s_1=\texttt{1}$，然后对于每个 $s_i (i\ge 2)$，它由若干个编号更小的 $s_j$ 拼接而成，最后 $s_t$ 就是答案字符串，设要用 $q_i$ 个更前面的串拼出 $s_i$，你要确保 $\sum q_i\leq 10^4$。</p>
<p>$0\leq n\leq 10^{18}$</p>
<p><strong>题目解法：</strong></p>
<p>容易发现 $(n,k)$ 是好的当且仅当 $(n,n-k)$ 是好的，于是只需要考虑 $k&lt;\dfrac{n}{2}$。</p>
<p>注意到如果 $n,n-1,\ldots,n-k+1$ 中有两个素数，那么 $(n,k)$ 一定不是好的（素数只能和 $1$ 匹配），所以只需要考虑 $[n-k+1,n]$ 中至多一个素数的情形，可以证明 $k\leq 3000$，实际上这个估计并不是很精确。</p>
<p>对于这些 $k$ 暴力求解最大匹配即可，最后将它们的结果与中间的一长串的 $\texttt{0}$（用倍增构造）拼接即可。</p>
<p>时间复杂度为 $O(k^3\log k)$ 或者 $O(k^{2.5}\log k)$，取决于最大匹配的算法。</p>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        代码
    </div>
    <div class='spoiler-content'>
        <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">3010</span>;</span><br><span class="line">ll n,cnt,nw,a[MAXN];</span><br><span class="line"><span class="type">int</span> mat[MAXN],vis[MAXN];</span><br><span class="line">vector &lt;<span class="type">int</span>&gt; v[MAXN],w;</span><br><span class="line"><span class="function">ll <span class="title">qmul</span> <span class="params">(ll a,ll b,ll p)</span> </span>&#123;<span class="keyword">return</span> (a*b-(ll)((<span class="type">long</span> <span class="type">double</span>)a/p*b)*p+p)%p;&#125;</span><br><span class="line"><span class="function">ll <span class="title">qpow</span> <span class="params">(ll a,ll b,ll p)</span> </span>&#123;</span><br><span class="line">	ll res=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">while</span> (b) &#123;</span><br><span class="line">		<span class="keyword">if</span> (b&amp;<span class="number">1</span>) &#123;res=<span class="built_in">qmul</span>(res,a,p);&#125;</span><br><span class="line">		a=<span class="built_in">qmul</span>(a,a,p),b&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">mr</span> <span class="params">(ll p,ll x)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">qpow</span>(x,p<span class="number">-1</span>,p)!=<span class="number">1</span>) &#123;<span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line">	ll k=p<span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">while</span> (!(k&amp;<span class="number">1</span>)) &#123;</span><br><span class="line">		k&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">		ll tmp=<span class="built_in">qpow</span>(x,p<span class="number">-1</span>,p);</span><br><span class="line">		<span class="keyword">if</span> (tmp==p<span class="number">-1</span>) &#123;<span class="keyword">return</span> <span class="number">1</span>;&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (tmp!=<span class="number">1</span>) &#123;<span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isp</span> <span class="params">(ll p)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (p==<span class="number">46856248255981</span>||p==<span class="number">1</span>) &#123;<span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line">	<span class="keyword">if</span> (p==<span class="number">2</span>||p==<span class="number">3</span>||p==<span class="number">7</span>||p==<span class="number">61</span>||p==<span class="number">24251</span>) &#123;<span class="keyword">return</span> <span class="number">1</span>;&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">mr</span>(p,<span class="number">2</span>)&amp;&amp;<span class="built_in">mr</span>(p,<span class="number">3</span>)&amp;&amp;<span class="built_in">mr</span>(p,<span class="number">7</span>)&amp;&amp;<span class="built_in">mr</span>(p,<span class="number">61</span>)&amp;&amp;<span class="built_in">mr</span>(p,<span class="number">24251</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">dfs</span> <span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> len=v[x].<span class="built_in">size</span>();</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;i++) &#123;</span><br><span class="line">		<span class="type">int</span> y=v[x][i];</span><br><span class="line">		<span class="keyword">if</span> (vis[y]) &#123;<span class="keyword">continue</span>;&#125;</span><br><span class="line">		<span class="keyword">if</span> (!mat[y]) &#123;</span><br><span class="line">			mat[y]=x;</span><br><span class="line">			<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			vis[y]=<span class="number">1</span>;</span><br><span class="line">			w.<span class="built_in">push_back</span>(y);</span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">dfs</span>(mat[y])) &#123;mat[y]=x;<span class="keyword">return</span> <span class="number">1</span>;&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">solve</span> <span class="params">(ll x)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (ll i=<span class="number">1</span>;i&lt;=x;i++) &#123;</span><br><span class="line">		v[i].<span class="built_in">clear</span>();</span><br><span class="line">		<span class="keyword">for</span> (ll j=(n-x+i)/i*i;j&lt;=n;j+=i) &#123;v[i].<span class="built_in">push_back</span>(n-j+<span class="number">1</span>);&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">memset</span>(mat,<span class="number">0</span>,<span class="built_in">sizeof</span>(mat));</span><br><span class="line">	ll ans=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (ll i=<span class="number">1</span>;i&lt;=x;i++) &#123;</span><br><span class="line">		w.<span class="built_in">clear</span>();</span><br><span class="line">		ans+=<span class="built_in">dfs</span>(i);</span><br><span class="line">		<span class="type">int</span> len=w.<span class="built_in">size</span>();</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;i++) &#123;vis[w[i]]=<span class="number">0</span>;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> (ans==x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>,&amp;n);</span><br><span class="line">	<span class="keyword">if</span> (n==<span class="number">0</span>) &#123;<span class="built_in">printf</span>(<span class="string">&quot;2\n1 1\n&quot;</span>);&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (n==<span class="number">1</span>) &#123;<span class="built_in">printf</span>(<span class="string">&quot;2\n2 1 1\n&quot;</span>);&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (n==<span class="number">2</span>) &#123;<span class="built_in">printf</span>(<span class="string">&quot;2\n3 1 1 1\n&quot;</span>);&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (n==<span class="number">3</span>) &#123;<span class="built_in">printf</span>(<span class="string">&quot;2\n4 1 1 1 1\n&quot;</span>);&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		ll tot=<span class="number">0</span>;</span><br><span class="line">		a[++tot]=<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">for</span> (ll i=<span class="number">1</span>;i&lt;=n/<span class="number">2</span>;i++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">isp</span>(n-i+<span class="number">1</span>)) &#123;cnt++;&#125;</span><br><span class="line">			<span class="keyword">if</span> (cnt==<span class="number">2</span>) &#123;<span class="keyword">break</span>;&#125;</span><br><span class="line">			a[++tot]=<span class="built_in">solve</span>(i);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="number">65</span>);</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">60</span>;i++) &#123;<span class="built_in">printf</span>(<span class="string">&quot;2 %d %d\n&quot;</span>,i==<span class="number">1</span>?<span class="number">0</span>:i,i==<span class="number">1</span>?<span class="number">0</span>:i);&#125;</span><br><span class="line">		<span class="keyword">if</span> (<span class="number">2</span>*tot&lt;n+<span class="number">1</span>) &#123;</span><br><span class="line">			ll tmp=n+<span class="number">1</span><span class="number">-2</span>*tot,ncnt=<span class="number">0</span>;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">60</span>;i++) &#123;</span><br><span class="line">				<span class="keyword">if</span> (tmp&amp;(<span class="number">1ll</span>&lt;&lt;i)) &#123;ncnt++;&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,ncnt);</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">60</span>;i++) &#123;</span><br><span class="line">				<span class="keyword">if</span> (tmp&amp;(<span class="number">1ll</span>&lt;&lt;i)) &#123;<span class="built_in">printf</span>(<span class="string">&quot; %d&quot;</span>,(i==<span class="number">0</span>?<span class="number">0</span>:i+<span class="number">1</span>));&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;11 45 14 11 45 14 11 45 14 11 45 14\n&quot;</span>);</span><br><span class="line">			nw++;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,tot);</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=tot;i++) &#123;<span class="built_in">printf</span>(<span class="string">&quot; %d&quot;</span>,a[i]);&#125;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,<span class="number">2</span>*tot&lt;=n+<span class="number">1</span>?tot:tot<span class="number">-1</span>);</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=(<span class="number">2</span>*tot&lt;=n+<span class="number">1</span>?tot:tot<span class="number">-1</span>);i&gt;=<span class="number">1</span>;i--) &#123;<span class="built_in">printf</span>(<span class="string">&quot; %d&quot;</span>,a[i]);&#125;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">		<span class="keyword">if</span> (<span class="number">2</span>*tot&lt;n+<span class="number">1</span>) &#123;<span class="built_in">printf</span>(<span class="string">&quot;3 63 62 64\n&quot;</span>);&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;<span class="built_in">printf</span>(<span class="string">&quot;2 63 64\n&quot;</span>);&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="E-Smol-Vertex-Cover"><a href="#E-Smol-Vertex-Cover" class="headerlink" title="E. Smol Vertex Cover"></a>E. Smol Vertex Cover</h3><p><strong>难度：</strong>$\bigstar$</p>
<p><strong>题目大意：</strong></p>
<p>给定 $n$ 个点的无向图 $G$，设 $G$ 的最大匹配大小为 $M$，最小点覆盖大小为 $C$，求是否有 $C\leq M+1$，如果是，请给出一组最小点覆盖。</p>
<p>$1\leq n\leq 500$</p>
<p><strong>题目解法：</strong></p>
<p>首先求出一个最大匹配。</p>
<p>显然 $C\ge M$，因为最大匹配中每条边的两个端点至少有一个在最小点覆盖中。</p>
<p>如果 $C=M$，这说明恰好从每个最大匹配中选出了一个点，2-SAT 构造即可（2-SAT 无解则 $C&gt;M$）。</p>
<p>如果 $C=M+1$，再额外钦定一个点必选，然后 2-SAT 即可。</p>
<p>时间复杂度为 $O(n^3)$。</p>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        代码
    </div>
    <div class='spoiler-content'>
        <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1010</span>,MAXM=<span class="number">500010</span>;</span><br><span class="line"><span class="type">int</span> t,n,m,eg,cnt,ans,tot,cnts,hd[MAXN],ver[MAXM],nx[MAXM],tg[MAXN],f[MAXN];</span><br><span class="line"><span class="type">int</span> x[MAXM],y[MAXM],pre[MAXN],lk[MAXN],dfn[MAXN],res[MAXN];</span><br><span class="line"><span class="type">int</span> bel[MAXN],col[MAXN],dfnn[MAXN],low[MAXN],ins[MAXN];</span><br><span class="line">vector &lt;<span class="type">int</span>&gt; v[MAXN];</span><br><span class="line">stack &lt;<span class="type">int</span>&gt; st;</span><br><span class="line">queue &lt;<span class="type">int</span>&gt; q;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add_edge</span> <span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">	ver[++eg]=y;</span><br><span class="line">	nx[eg]=hd[x];</span><br><span class="line">	hd[x]=eg;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">findr</span> <span class="params">(<span class="type">int</span> x)</span> </span>&#123;<span class="keyword">return</span> (f[x]==x?x:f[x]=<span class="built_in">findr</span>(f[x]));&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">rev_lk</span> <span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (lk[pre[x]]) &#123;<span class="built_in">rev_lk</span>(lk[pre[x]]);&#125;</span><br><span class="line">	lk[x]=pre[x],lk[pre[x]]=x;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">get_lca</span> <span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">	cnt++;</span><br><span class="line">	<span class="keyword">while</span> (x) &#123;</span><br><span class="line">		x=<span class="built_in">findr</span>(x);</span><br><span class="line">		<span class="keyword">if</span> (dfn[x]==cnt) &#123;<span class="keyword">return</span> x;&#125;</span><br><span class="line">		dfn[x]=cnt;</span><br><span class="line">		x=pre[lk[x]];</span><br><span class="line">		<span class="keyword">if</span> (y) &#123;<span class="built_in">swap</span>(x,y);&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">assert</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">flw</span> <span class="params">(<span class="type">int</span> x,<span class="type">int</span> y,<span class="type">int</span> z)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">while</span> (<span class="built_in">findr</span>(x)!=z) &#123;</span><br><span class="line">		pre[x]=y;</span><br><span class="line">		y=lk[x];</span><br><span class="line">		<span class="keyword">if</span> (tg[y]==<span class="number">2</span>) &#123;tg[y]=<span class="number">1</span>,q.<span class="built_in">push</span>(y);&#125;</span><br><span class="line">		f[x]=f[y]=z;</span><br><span class="line">		x=pre[y];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">blossom</span> <span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">while</span> (!q.<span class="built_in">empty</span>()) &#123;q.<span class="built_in">pop</span>();&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;tg[i]=<span class="number">0</span>,f[i]=i,pre[i]=<span class="number">0</span>;&#125;</span><br><span class="line">	tg[x]=<span class="number">1</span>,q.<span class="built_in">push</span>(x);</span><br><span class="line">	<span class="keyword">while</span> (!q.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">		<span class="type">int</span> a=q.<span class="built_in">front</span>();</span><br><span class="line">		q.<span class="built_in">pop</span>();</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=hd[a];i;i=nx[i]) &#123;</span><br><span class="line">			<span class="type">int</span> b=ver[i];</span><br><span class="line">			<span class="keyword">if</span> (tg[b]==<span class="number">1</span>) &#123;</span><br><span class="line">				<span class="type">int</span> c=<span class="built_in">get_lca</span>(a,b);</span><br><span class="line">				<span class="built_in">flw</span>(a,b,c),<span class="built_in">flw</span>(b,a,c);</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!tg[b]) &#123;</span><br><span class="line">				pre[b]=a,tg[b]=<span class="number">2</span>;</span><br><span class="line">				<span class="keyword">if</span> (!lk[b]) &#123;</span><br><span class="line">					<span class="built_in">rev_lk</span>(b);</span><br><span class="line">					<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					tg[lk[b]]=<span class="number">1</span>;</span><br><span class="line">					q.<span class="built_in">push</span>(lk[b]);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span> <span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">	dfnn[x]=low[x]=++tot;</span><br><span class="line">	ins[x]=<span class="number">1</span>;</span><br><span class="line">	st.<span class="built_in">push</span>(x);</span><br><span class="line">	<span class="type">int</span> len=v[x].<span class="built_in">size</span>();</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;i++) &#123;</span><br><span class="line">		<span class="type">int</span> y=v[x][i];</span><br><span class="line">		<span class="keyword">if</span> (!dfnn[y]) &#123;</span><br><span class="line">			<span class="built_in">dfs</span>(y);</span><br><span class="line">			low[x]=<span class="built_in">min</span>(low[x],low[y]);</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (ins[y]) &#123;</span><br><span class="line">			low[x]=<span class="built_in">min</span>(low[x],dfnn[y]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (low[x]==dfnn[x]) &#123;</span><br><span class="line">		cnts++;</span><br><span class="line">		<span class="type">int</span> z=st.<span class="built_in">top</span>();</span><br><span class="line">		<span class="keyword">while</span> (z!=x) &#123;</span><br><span class="line">			col[z]=cnts,ins[z]=<span class="number">0</span>;</span><br><span class="line">			st.<span class="built_in">pop</span>();</span><br><span class="line">			z=st.<span class="built_in">top</span>();</span><br><span class="line">		&#125;</span><br><span class="line">		col[z]=cnts,ins[z]=<span class="number">0</span>;</span><br><span class="line">		st.<span class="built_in">pop</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">tsat</span> <span class="params">(<span class="type">int</span> ans)</span> </span>&#123;</span><br><span class="line">	tot=cnts=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">2</span>*ans;i++) &#123;col[i]=dfnn[i]=low[i]=ins[i]=res[i]=<span class="number">0</span>;&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">2</span>*ans;i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (!dfnn[i]) &#123;<span class="built_in">dfs</span>(i);&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=ans;i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (col[i]==col[i+ans]) &#123;<span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line">		res[i]=(col[i]&gt;col[i+ans]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;t);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> ii=<span class="number">1</span>;ii&lt;=t;ii++) &#123;</span><br><span class="line">		ans=eg=cnt=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;hd[i]=dfn[i]=lk[i]=bel[i]=<span class="number">0</span>;&#125;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++) &#123;</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;x[i],&amp;y[i]);</span><br><span class="line">			<span class="built_in">add_edge</span>(x[i],y[i]),<span class="built_in">add_edge</span>(y[i],x[i]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (!lk[i]) &#123;ans+=<span class="built_in">blossom</span>(i);&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		ans=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (i&lt;lk[i]) &#123;bel[i]=bel[lk[i]]=++ans;&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">2</span>*ans;i++) &#123;v[i].<span class="built_in">clear</span>();&#125;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (bel[x[i]]==bel[y[i]]) &#123;<span class="keyword">continue</span>;&#125;</span><br><span class="line">			<span class="type">int</span> u=(x[i]&gt;lk[x[i]]),z=(y[i]&gt;lk[y[i]]);</span><br><span class="line">			<span class="keyword">if</span> (bel[x[i]]==<span class="number">0</span>) &#123;v[bel[y[i]]+(z^<span class="number">1</span>)*ans].<span class="built_in">push_back</span>(bel[y[i]]+z*ans);&#125;</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span> (bel[y[i]]==<span class="number">0</span>) &#123;v[bel[x[i]]+(u^<span class="number">1</span>)*ans].<span class="built_in">push_back</span>(bel[x[i]]+u*ans);&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;</span><br><span class="line">				v[bel[x[i]]+(u^<span class="number">1</span>)*ans].<span class="built_in">push_back</span>(bel[y[i]]+z*ans);</span><br><span class="line">				v[bel[y[i]]+(z^<span class="number">1</span>)*ans].<span class="built_in">push_back</span>(bel[x[i]]+u*ans);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">tsat</span>(ans)) &#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">				<span class="keyword">if</span> (bel[i]&amp;&amp;i&lt;lk[i]&amp;&amp;(!res[bel[i]])) &#123;<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,i);&#125;</span><br><span class="line">				<span class="keyword">if</span> (bel[i]&amp;&amp;i&gt;lk[i]&amp;&amp;res[bel[i]]) &#123;<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,i);&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="type">int</span> flg=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> ii=<span class="number">1</span>;ii&lt;=n;ii++) &#123;</span><br><span class="line">			<span class="comment">//cout &lt;&lt; ii &lt;&lt; &quot;  &quot; &lt;&lt; bel[ii] &lt;&lt; endl;</span></span><br><span class="line">			<span class="keyword">if</span> (!bel[ii]) &#123;</span><br><span class="line">				<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">2</span>*ans;i++) &#123;v[i].<span class="built_in">clear</span>();&#125;</span><br><span class="line">				<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++) &#123;</span><br><span class="line">					<span class="comment">//cout &lt;&lt; &quot;  &quot; &lt;&lt; x[i] &lt;&lt; &quot;  &quot; &lt;&lt; y[i] &lt;&lt; endl;</span></span><br><span class="line">					<span class="keyword">if</span> (bel[x[i]]==bel[y[i]]) &#123;<span class="keyword">continue</span>;&#125;</span><br><span class="line">					<span class="type">int</span> u=(x[i]&gt;lk[x[i]]),z=(y[i]&gt;lk[y[i]]);</span><br><span class="line">					<span class="keyword">if</span> (bel[x[i]]==<span class="number">0</span>&amp;&amp;x[i]!=ii) &#123;</span><br><span class="line">						v[bel[y[i]]+(z^<span class="number">1</span>)*ans].<span class="built_in">push_back</span>(bel[y[i]]+z*ans);</span><br><span class="line">						<span class="comment">//cout &lt;&lt; &quot;    &quot; &lt;&lt; bel[y[i]] &lt;&lt; &quot;  &quot; &lt;&lt; z &lt;&lt; endl;</span></span><br><span class="line">					&#125; <span class="keyword">else</span> <span class="keyword">if</span> (bel[y[i]]==<span class="number">0</span>&amp;&amp;y[i]!=ii) &#123;</span><br><span class="line">						v[bel[x[i]]+(u^<span class="number">1</span>)*ans].<span class="built_in">push_back</span>(bel[x[i]]+u*ans);</span><br><span class="line">						<span class="comment">//cout &lt;&lt; &quot;    &quot; &lt;&lt; bel[x[i]] &lt;&lt; &quot;  &quot; &lt;&lt; u &lt;&lt; endl;</span></span><br><span class="line">					&#125; <span class="keyword">else</span> <span class="keyword">if</span> (bel[x[i]]&amp;&amp;bel[y[i]]) &#123;</span><br><span class="line">						v[bel[x[i]]+(u^<span class="number">1</span>)*ans].<span class="built_in">push_back</span>(bel[y[i]]+z*ans);</span><br><span class="line">						v[bel[y[i]]+(z^<span class="number">1</span>)*ans].<span class="built_in">push_back</span>(bel[x[i]]+u*ans);</span><br><span class="line">						<span class="comment">//cout &lt;&lt; &quot;    &quot; &lt;&lt; bel[x[i]] &lt;&lt; &quot;  &quot; &lt;&lt; u &lt;&lt; endl;</span></span><br><span class="line">						<span class="comment">//cout &lt;&lt; &quot;    &quot; &lt;&lt; bel[y[i]] &lt;&lt; &quot;  &quot; &lt;&lt; z &lt;&lt; endl;</span></span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span> (<span class="built_in">tsat</span>(ans)) &#123;</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans+<span class="number">1</span>);</span><br><span class="line">					<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=ii<span class="number">-1</span>;i++) &#123;</span><br><span class="line">						<span class="keyword">if</span> (bel[i]&amp;&amp;i&lt;lk[i]&amp;&amp;(!res[bel[i]])) &#123;<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,i);&#125;</span><br><span class="line">						<span class="keyword">if</span> (bel[i]&amp;&amp;i&gt;lk[i]&amp;&amp;res[bel[i]]) &#123;<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,i);&#125;</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,ii);</span><br><span class="line">					<span class="keyword">for</span> (<span class="type">int</span> i=ii+<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">						<span class="keyword">if</span> (bel[i]&amp;&amp;i&lt;lk[i]&amp;&amp;(!res[bel[i]])) &#123;<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,i);&#125;</span><br><span class="line">						<span class="keyword">if</span> (bel[i]&amp;&amp;i&gt;lk[i]&amp;&amp;res[bel[i]]) &#123;<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,i);&#125;</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">					flg=<span class="number">1</span>;</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (ii&lt;lk[ii]) &#123;</span><br><span class="line">				<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">2</span>*ans;i++) &#123;v[i].<span class="built_in">clear</span>();&#125;</span><br><span class="line">				<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++) &#123;</span><br><span class="line">					<span class="keyword">if</span> (bel[x[i]]==bel[y[i]]) &#123;<span class="keyword">continue</span>;&#125;</span><br><span class="line">					<span class="keyword">if</span> (bel[x[i]]==bel[ii]||bel[y[i]]==bel[ii]) &#123;<span class="keyword">continue</span>;&#125;</span><br><span class="line">					<span class="type">int</span> u=(x[i]&gt;lk[x[i]]),z=(y[i]&gt;lk[y[i]]);</span><br><span class="line">					<span class="keyword">if</span> (bel[x[i]]==<span class="number">0</span>) &#123;</span><br><span class="line">						v[bel[y[i]]+(z^<span class="number">1</span>)*ans].<span class="built_in">push_back</span>(bel[y[i]]+z*ans);</span><br><span class="line">					&#125; <span class="keyword">else</span> <span class="keyword">if</span> (bel[y[i]]==<span class="number">0</span>) &#123;</span><br><span class="line">						v[bel[x[i]]+(u^<span class="number">1</span>)*ans].<span class="built_in">push_back</span>(bel[x[i]]+u*ans);</span><br><span class="line">					&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">						v[bel[x[i]]+(u^<span class="number">1</span>)*ans].<span class="built_in">push_back</span>(bel[y[i]]+z*ans);</span><br><span class="line">						v[bel[y[i]]+(z^<span class="number">1</span>)*ans].<span class="built_in">push_back</span>(bel[x[i]]+u*ans);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span> (<span class="built_in">tsat</span>(ans)) &#123;</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans+<span class="number">1</span>);</span><br><span class="line">					<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=ii<span class="number">-1</span>;i++) &#123;</span><br><span class="line">						<span class="keyword">if</span> (bel[i]&amp;&amp;i&lt;lk[i]&amp;&amp;(!res[bel[i]])) &#123;<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,i);&#125;</span><br><span class="line">						<span class="keyword">if</span> (bel[i]&amp;&amp;i&gt;lk[i]&amp;&amp;res[bel[i]]) &#123;<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,i);&#125;</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,ii);</span><br><span class="line">					<span class="keyword">for</span> (<span class="type">int</span> i=ii+<span class="number">1</span>;i&lt;=lk[ii]<span class="number">-1</span>;i++) &#123;</span><br><span class="line">						<span class="keyword">if</span> (bel[i]&amp;&amp;i&lt;lk[i]&amp;&amp;(!res[bel[i]])) &#123;<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,i);&#125;</span><br><span class="line">						<span class="keyword">if</span> (bel[i]&amp;&amp;i&gt;lk[i]&amp;&amp;res[bel[i]]) &#123;<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,i);&#125;</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,lk[ii]);</span><br><span class="line">					<span class="keyword">for</span> (<span class="type">int</span> i=lk[ii]+<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">						<span class="keyword">if</span> (bel[i]&amp;&amp;i&lt;lk[i]&amp;&amp;(!res[bel[i]])) &#123;<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,i);&#125;</span><br><span class="line">						<span class="keyword">if</span> (bel[i]&amp;&amp;i&gt;lk[i]&amp;&amp;res[bel[i]]) &#123;<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,i);&#125;</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">					flg=<span class="number">1</span>;</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (!flg) &#123;<span class="built_in">printf</span>(<span class="string">&quot;not smol\n&quot;</span>);&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="F-Thanks-to-MikeMirzayanov"><a href="#F-Thanks-to-MikeMirzayanov" class="headerlink" title="F. Thanks to MikeMirzayanov"></a>F. Thanks to MikeMirzayanov</h3><p><strong>难度：</strong>$\bigstar\bigstar\bigstar$</p>
<p><strong>题目大意：</strong></p>
<p>给定 $1,\ldots,n$ 的排列 $a_{1,\ldots,n}$，每次操作可以将 $a$ 划分成 $k$ 个连续段 $D_1,\ldots,D_k$ 依次拼接的形式，然后将 $a$ 变成 $D_k,\ldots,D_1$ 依次拼接的形式（而不改变每个 $D_i$ 内部数的顺序），请在 $q$ 次操作以内将 $a$ 排序。</p>
<p>$1\leq n\leq 20000,  q=120$</p>
<p><strong>题目解法：</strong></p>
<p>这样的排序问题可以首先考虑 $01$ 序列的情形，如果序列只包含 $0,1$，那么首先我们将连续段合并，变成 $1010101010\ldots$（或者 $0101010101\ldots$）这样的形式，然后分段如 $10\mid 1\mid 01\mid 0\mid 10\ldots$（或者 $0\mid 10\mid 1\mid 01\mid 0\ldots$）。注意到一次操作实际上可以看成先将每个 $D_i$ 内部翻转，再将整个序列翻转，整个序列的翻转可以忽略，我们只翻转每段内部，就会变成 $0111000111\ldots$（或者 $0011100011\ldots$）这样的形式，连续段数大致除以了 $3$，因此只需要大约 $\log_3 n$ 次就可以排序长度为 $n$ 的序列。</p>
<p>对于原问题考虑分治，首先把所有二进制最高位为 $0$ 的数放在最高位为 $1$ 的数左边（这相当于一个只有 $0,1$ 的排序），然后分成两个子问题，再考虑次高位，以此类推。由于最高位做完以后最高位为 $0$ 和 $1$ 的数分别在两边互不干扰，所以此后的进程可以在两边同步进行，也就是说每一位都只需要总共 $\log_3 n$ 次左右的操作就可以排好，通过此题绰绰有余。</p>
<p>题解采用的做法需要大约 $\log_2 n$ 次才能排好一个长度为 $n$ 的 $01$ 序列，因此上面叙述的做法比题解做法要优秀许多。</p>
<p>时间复杂度为 $O(nq)$。</p>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        代码
    </div>
    <div class='spoiler-content'>
        <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">20010</span>;</span><br><span class="line"><span class="type">int</span> n,cnt,a[MAXN],b[MAXN],ac[MAXN];</span><br><span class="line">vector &lt;<span class="type">int</span>&gt; ans[MAXN];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">calc</span> <span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> len=ans[x].<span class="built_in">size</span>(),l=<span class="number">0</span>;</span><br><span class="line">	<span class="comment">//cout &lt;&lt; &quot;  &quot; &lt;&lt; x &lt;&lt; endl;</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;i++) &#123;</span><br><span class="line">		<span class="comment">//cout &lt;&lt; &quot;  &quot; &lt;&lt; ans[x][i];</span></span><br><span class="line">		<span class="built_in">reverse</span>(b+l,b+l+ans[x][i]);</span><br><span class="line">		<span class="built_in">reverse</span>(a+l,a+l+ans[x][i]);</span><br><span class="line">		l+=ans[x][i];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//cout &lt;&lt; endl;</span></span><br><span class="line">	<span class="built_in">reverse</span>(b,b+n);</span><br><span class="line">	<span class="built_in">reverse</span>(a,a+n);</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span> <span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> tcnt=<span class="number">0</span>,sy=n%(<span class="number">1</span>&lt;&lt;(x+<span class="number">1</span>));</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i+=(<span class="number">1</span>&lt;&lt;(x+<span class="number">1</span>))) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">0</span>;j&lt;(<span class="number">1</span>&lt;&lt;(x+<span class="number">1</span>));j++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (i+j&gt;=n) &#123;<span class="keyword">break</span>;&#125;</span><br><span class="line">			b[i+j]=(a[i+j]&gt;=i+(<span class="number">1</span>&lt;&lt;x));</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//cout &lt;&lt; x &lt;&lt; endl;</span></span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">		tcnt++,cnt++;</span><br><span class="line">		<span class="keyword">if</span> (tcnt&amp;<span class="number">1</span>) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i+=(<span class="number">1</span>&lt;&lt;(x+<span class="number">1</span>))) &#123;</span><br><span class="line">				<span class="type">int</span> ncnt=<span class="number">0</span>,lst=<span class="number">0</span>,iee=(b[i]==<span class="number">0</span>);</span><br><span class="line">				<span class="keyword">for</span> (<span class="type">int</span> l=<span class="number">0</span>,r;i+l&lt;n&amp;&amp;l&lt;(<span class="number">1</span>&lt;&lt;(x+<span class="number">1</span>));l=r+<span class="number">1</span>) &#123;</span><br><span class="line">					r=l;</span><br><span class="line">					<span class="keyword">while</span> (r&lt;(<span class="number">1</span>&lt;&lt;(x+<span class="number">1</span>))<span class="number">-1</span>&amp;&amp;i+r&lt;n<span class="number">-1</span>&amp;&amp;b[i+r+<span class="number">1</span>]==b[i+l]) &#123;r++;&#125;</span><br><span class="line">					<span class="keyword">if</span> ((ncnt%<span class="number">3</span>)==iee+<span class="number">1</span>) &#123;ans[cnt].<span class="built_in">push_back</span>(lst+r-l+<span class="number">1</span>);&#125;</span><br><span class="line">					<span class="keyword">else</span> <span class="keyword">if</span> ((ncnt%<span class="number">3</span>)!=iee+<span class="number">0</span>) &#123;ans[cnt].<span class="built_in">push_back</span>(r-l+<span class="number">1</span>);&#125;</span><br><span class="line">					<span class="comment">//cout &lt;&lt; &quot;       &quot; &lt;&lt; i &lt;&lt; &quot;  &quot; &lt;&lt; l &lt;&lt; &quot;  &quot; &lt;&lt; r &lt;&lt; &quot;  &quot; &lt;&lt; ncnt &lt;&lt; </span></span><br><span class="line">					<span class="comment">//&quot;  &quot; &lt;&lt; iee &lt;&lt; &quot;  &quot; &lt;&lt; ans[cnt].size() &lt;&lt; endl;</span></span><br><span class="line">					lst=r-l+<span class="number">1</span>,ncnt++;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span> ((ncnt%<span class="number">3</span>)==iee+<span class="number">1</span>) &#123;ans[cnt].<span class="built_in">push_back</span>(lst);&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="built_in">calc</span>(cnt);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>,ii=<span class="number">0</span>;i&lt;n;i+=(ii==<span class="number">0</span>?sy:(<span class="number">1</span>&lt;&lt;(x+<span class="number">1</span>))),ii++) &#123;</span><br><span class="line">				<span class="type">int</span> ncnt=<span class="number">0</span>,lst=<span class="number">0</span>,tmp=(ii==<span class="number">0</span>?sy:(<span class="number">1</span>&lt;&lt;(x+<span class="number">1</span>)));</span><br><span class="line">				<span class="keyword">if</span> (tmp==<span class="number">0</span>) &#123;<span class="keyword">continue</span>;&#125;</span><br><span class="line">				<span class="type">int</span> iee=(b[<span class="built_in">min</span>(n<span class="number">-1</span>,i+tmp<span class="number">-1</span>)]==<span class="number">0</span>);</span><br><span class="line">				vector &lt;<span class="type">int</span>&gt; vtmp;</span><br><span class="line">				<span class="keyword">for</span> (<span class="type">int</span> r=<span class="built_in">min</span>(n-i<span class="number">-1</span>,tmp<span class="number">-1</span>),l;r&gt;=<span class="number">0</span>;r=l<span class="number">-1</span>) &#123;</span><br><span class="line">					l=r;</span><br><span class="line">					<span class="keyword">while</span> (l&gt;<span class="number">0</span>&amp;&amp;b[i+r]==b[i+l<span class="number">-1</span>]) &#123;l--;&#125;</span><br><span class="line">					<span class="keyword">if</span> ((ncnt%<span class="number">3</span>)==iee+<span class="number">1</span>) &#123;vtmp.<span class="built_in">push_back</span>(lst+r-l+<span class="number">1</span>);&#125;</span><br><span class="line">					<span class="keyword">else</span> <span class="keyword">if</span> ((ncnt%<span class="number">3</span>)!=iee+<span class="number">0</span>) &#123;vtmp.<span class="built_in">push_back</span>(r-l+<span class="number">1</span>);&#125;</span><br><span class="line">					<span class="comment">//cout &lt;&lt; &quot;       &quot; &lt;&lt; i &lt;&lt; &quot;  &quot; &lt;&lt; l &lt;&lt; &quot;  &quot; &lt;&lt; r &lt;&lt; &quot;  &quot; &lt;&lt; ncnt &lt;&lt; </span></span><br><span class="line">					<span class="comment">//&quot;  &quot; &lt;&lt; iee &lt;&lt; vtmp.size() &lt;&lt; endl;</span></span><br><span class="line">					lst=r-l+<span class="number">1</span>,ncnt++;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span> ((ncnt%<span class="number">3</span>)==iee+<span class="number">1</span>) &#123;vtmp.<span class="built_in">push_back</span>(lst);&#125;</span><br><span class="line">				<span class="keyword">while</span> (vtmp.<span class="built_in">size</span>()) &#123;</span><br><span class="line">					ans[cnt].<span class="built_in">push_back</span>(vtmp.<span class="built_in">back</span>());</span><br><span class="line">					vtmp.<span class="built_in">pop_back</span>();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="built_in">calc</span>(cnt);</span><br><span class="line">			<span class="type">int</span> flg=<span class="number">1</span>;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i+=(<span class="number">1</span>&lt;&lt;(x+<span class="number">1</span>))) &#123;</span><br><span class="line">				<span class="type">int</span> ncnt=<span class="number">0</span>;</span><br><span class="line">				<span class="keyword">for</span> (<span class="type">int</span> l=<span class="number">0</span>,r;i+l&lt;n&amp;&amp;l&lt;(<span class="number">1</span>&lt;&lt;(x+<span class="number">1</span>));l=r+<span class="number">1</span>) &#123;</span><br><span class="line">					r=l;</span><br><span class="line">					<span class="keyword">while</span> (r&lt;(<span class="number">1</span>&lt;&lt;(x+<span class="number">1</span>))<span class="number">-1</span>&amp;&amp;i+r&lt;n<span class="number">-1</span>&amp;&amp;b[i+r+<span class="number">1</span>]==b[i+l]) &#123;r++;&#125;</span><br><span class="line">					ncnt++;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span> (ncnt&gt;<span class="number">2</span>||b[i]!=<span class="number">0</span>) &#123;flg=<span class="number">0</span>;&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (flg) &#123;<span class="keyword">break</span>;&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++) &#123;<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;a[i]);a[i]--;&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">14</span>;i&gt;=<span class="number">0</span>;i--) &#123;<span class="built_in">solve</span>(i);&#125;</span><br><span class="line">	<span class="type">int</span> rcnt=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=cnt;i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (ans[i].<span class="built_in">size</span>()&gt;<span class="number">1</span>) &#123;rcnt++,ac[i]=<span class="number">1</span>;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,rcnt);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=cnt;i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (!ac[i]) &#123;<span class="keyword">continue</span>;&#125;</span><br><span class="line">		<span class="type">int</span> len=ans[i].<span class="built_in">size</span>();</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,len);</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">0</span>;j&lt;len;j++) &#123;<span class="built_in">printf</span>(<span class="string">&quot; %d&quot;</span>,ans[i][j]);&#125;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="G-Remove-the-Prime"><a href="#G-Remove-the-Prime" class="headerlink" title="G. Remove the Prime"></a>G. Remove the Prime</h3><p><strong>难度：</strong>$\bigstar$</p>
<p><strong>题目大意：</strong></p>
<p>给定长度为 $n$ 的数组 $a_1,\ldots,a_n$，两人轮流操作，每次操作选择非空区间 $[l,r]$ 和素数 $p$，需满足 $p\mid a_i (i\in [l,r])$，然后除去 $a_i (i\in [l,r])$ 中所有的素因子 $p$，无法行动者败，问谁必胜。</p>
<p>$1\leq n\leq 1000,  1\leq a_i\leq 10^{18}$</p>
<p><strong>题目解法：</strong></p>
<p>显然序列关于每个素数是无关的游戏，而且同一个素数的倍数构成的不同连续段是无关的游戏，并且长度为 $l$ 的连续段 SG 值就是 $l$，所以我们将每个 $a_i$ 分解素因数后枚举所有素因数和其倍数构成的连续段，将这些段的长度全部异或起来，等于零则后手胜，否则先手胜。</p>
<p>时间复杂度为 $O(nT(A))$，其中 $T(A)$ 是分解一个 $a_i$ 的时间复杂度，可以用 Pollard‘s Rho 实现。</p>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        代码
    </div>
    <div class='spoiler-content'>
        <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">100010</span>;</span><br><span class="line">ll t,n,ans,cnt,cntt,anss,a[MAXN],aa[MAXN],pri[MAXN],q[MAXN],prii[MAXN];</span><br><span class="line">map &lt;ll,<span class="type">int</span>&gt; mp;</span><br><span class="line"><span class="function">ll <span class="title">brand</span> <span class="params">(ll n)</span> </span>&#123;<span class="keyword">return</span> ((<span class="number">1ll</span>*<span class="built_in">rand</span>())^((<span class="number">1ll</span>*<span class="built_in">rand</span>())&lt;&lt;<span class="number">15</span>)^((<span class="number">1ll</span>*<span class="built_in">rand</span>())&lt;&lt;<span class="number">30</span>)^((<span class="number">1ll</span>*<span class="built_in">rand</span>())&lt;&lt;<span class="number">45</span>))%n+<span class="number">1</span>;&#125;</span><br><span class="line"><span class="function">ll <span class="title">qmul</span> <span class="params">(ll a,ll b,ll p)</span> </span>&#123;<span class="keyword">return</span> (a*b-(ll)((<span class="type">long</span> <span class="type">double</span>)a/p*b)*p+p)%p;&#125;</span><br><span class="line"><span class="function">ll <span class="title">qpow</span> <span class="params">(ll a,ll b,ll p)</span> </span>&#123;</span><br><span class="line">	ll res=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">while</span> (b) &#123;</span><br><span class="line">		<span class="keyword">if</span> (b&amp;<span class="number">1</span>) &#123;res=<span class="built_in">qmul</span>(res,a,p);&#125;</span><br><span class="line">		a=<span class="built_in">qmul</span>(a,a,p),b&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">gcd</span> <span class="params">(ll a,ll b)</span> </span>&#123;<span class="keyword">return</span> (b==<span class="number">0</span>?a:<span class="built_in">gcd</span>(b,a%b));&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">mr</span> <span class="params">(ll p,ll x)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">qpow</span>(x,p<span class="number">-1</span>,p)!=<span class="number">1</span>) &#123;<span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line">	ll k=p<span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">while</span> (!(k&amp;<span class="number">1</span>)) &#123;</span><br><span class="line">		k&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">		ll tmp=<span class="built_in">qpow</span>(x,k,p);</span><br><span class="line">		<span class="keyword">if</span> (tmp==p<span class="number">-1</span>) &#123;<span class="keyword">return</span> <span class="number">1</span>;&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (tmp!=<span class="number">1</span>) &#123;<span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isp</span> <span class="params">(ll p)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (p==<span class="number">46856248255981</span>||p==<span class="number">1</span>) &#123;<span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line">	<span class="keyword">if</span> (p==<span class="number">2</span>||p==<span class="number">3</span>||p==<span class="number">7</span>||p==<span class="number">61</span>||p==<span class="number">24251</span>) &#123;<span class="keyword">return</span> <span class="number">1</span>;&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">mr</span>(p,<span class="number">2</span>)&amp;&amp;<span class="built_in">mr</span>(p,<span class="number">3</span>)&amp;&amp;<span class="built_in">mr</span>(p,<span class="number">7</span>)&amp;&amp;<span class="built_in">mr</span>(p,<span class="number">61</span>)&amp;&amp;<span class="built_in">mr</span>(p,<span class="number">24251</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pr</span> <span class="params">(ll p)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">isp</span>(p)) &#123;</span><br><span class="line">		ans=<span class="built_in">max</span>(ans,p);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	ll c=<span class="built_in">brand</span>(p<span class="number">-1</span>),t1=<span class="built_in">brand</span>(p<span class="number">-1</span>),tmp=<span class="number">1</span>,cnt=<span class="number">0</span>;</span><br><span class="line">	ll t2=t1;</span><br><span class="line">	t1=(<span class="built_in">qmul</span>(t1,t1,p)+c)%p;</span><br><span class="line">	t2=(<span class="built_in">qmul</span>(t2,t2,p)+c)%p;</span><br><span class="line">	t2=(<span class="built_in">qmul</span>(t2,t2,p)+c)%p;</span><br><span class="line">	<span class="keyword">while</span> (t1!=t2) &#123;</span><br><span class="line">		tmp=<span class="built_in">qmul</span>(tmp,<span class="built_in">abs</span>(t2-t1),p),cnt++;</span><br><span class="line">		<span class="keyword">if</span> (tmp==<span class="number">0</span>) &#123;</span><br><span class="line">			ll d=<span class="built_in">gcd</span>(<span class="built_in">abs</span>(t2-t1),p);</span><br><span class="line">			<span class="built_in">pr</span>(d),<span class="built_in">pr</span>(p/d);</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (cnt%<span class="number">127</span>==<span class="number">0</span>) &#123;</span><br><span class="line">			ll d=<span class="built_in">gcd</span>(tmp,p);</span><br><span class="line">			<span class="keyword">if</span> (d&gt;<span class="number">1</span>&amp;&amp;d&lt;p) &#123;</span><br><span class="line">				<span class="built_in">pr</span>(d),<span class="built_in">pr</span>(p/d);</span><br><span class="line">				<span class="keyword">return</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			tmp=<span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		t1=(<span class="built_in">qmul</span>(t1,t1,p)+c)%p;</span><br><span class="line">		t2=(<span class="built_in">qmul</span>(t2,t2,p)+c)%p;</span><br><span class="line">		t2=(<span class="built_in">qmul</span>(t2,t2,p)+c)%p;</span><br><span class="line">	&#125;</span><br><span class="line">	ll d=<span class="built_in">gcd</span>(tmp,p);</span><br><span class="line">	<span class="keyword">if</span> (d&gt;<span class="number">1</span>&amp;&amp;d&lt;p) &#123;<span class="built_in">pr</span>(d),<span class="built_in">pr</span>(p/d);&#125;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">shai</span> <span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">2</span>;i&lt;=x;i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (!q[i]) &#123;prii[++cntt]=i;&#125;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">1</span>;j&lt;=cntt&amp;&amp;prii[j]*i&lt;=x;j++) &#123;</span><br><span class="line">			q[i*prii[j]]=<span class="number">1</span>;</span><br><span class="line">			<span class="keyword">if</span> (i%prii[j]==<span class="number">0</span>) &#123;<span class="keyword">break</span>;&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>,&amp;n);</span><br><span class="line">	<span class="built_in">shai</span>(<span class="number">1000</span>); </span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>,&amp;a[i]);</span><br><span class="line">		aa[i]=a[i];</span><br><span class="line">		<span class="keyword">while</span> (a[i]&gt;<span class="number">1</span>) &#123;</span><br><span class="line">			ans=<span class="number">0</span>;</span><br><span class="line">			<span class="keyword">if</span> (a[i]&lt;<span class="number">1000</span>) &#123;</span><br><span class="line">				<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">1</span>;j&lt;=cntt;j++) &#123;<span class="keyword">if</span> (a[i]%prii[j]==<span class="number">0</span>) &#123;ans=prii[j];<span class="keyword">break</span>;&#125;&#125;</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="keyword">while</span> (!ans) &#123;<span class="built_in">pr</span>(a[i]);&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (mp.<span class="built_in">find</span>(ans)==mp.<span class="built_in">end</span>()) &#123;</span><br><span class="line">				mp[ans]=++cnt;</span><br><span class="line">				pri[cnt]=ans;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">while</span> (a[i]%ans==<span class="number">0</span>) &#123;a[i]/=ans;&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=cnt;i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> l=<span class="number">1</span>,r;l&lt;=n;l=r+<span class="number">1</span>) &#123;</span><br><span class="line">			r=l;</span><br><span class="line">			<span class="keyword">if</span> (aa[l]%pri[i]) &#123;<span class="keyword">continue</span>;&#125;</span><br><span class="line">			<span class="keyword">while</span> (r&lt;n&amp;&amp;aa[r+<span class="number">1</span>]%pri[i]==<span class="number">0</span>) &#123;r++;&#125;</span><br><span class="line">			anss^=(r-l+<span class="number">1</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (anss==<span class="number">0</span>) &#123;<span class="built_in">printf</span>(<span class="string">&quot;Second\n&quot;</span>);&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;<span class="built_in">printf</span>(<span class="string">&quot;First\n&quot;</span>);&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="H-Excluded-Min"><a href="#H-Excluded-Min" class="headerlink" title="H. Excluded Min"></a>H. Excluded Min</h3><p><strong>难度：</strong>$\bigstar\bigstar\bigstar\bigstar$</p>
<p><strong>题目大意：</strong></p>
<p>对于非负数可重集 $S$，一次操作可以选择一个在 $S$ 中至少出现两次的 $x$，删掉一个 $x$ 并添加一个 $x-1$ 或 $x+1$，并保证 $S$ 仍然是非负数可重集。</p>
<p>可重集 $S$ 的价值定义为其经过任意多次操作后 $\operatorname{mex}$ 的最大值。</p>
<p>给定序列 $a_1,\ldots,a_n$，有 $q$ 次询问，每次给定 $[l,r]$，求 $a_l,\ldots,a_r$ 构成的可重集的价值。</p>
<p>$1\leq n,q,a_i\leq 5\times 10^5$</p>
<p><strong>题目解法：</strong></p>
<p>可以发现，如果区间中 $&lt;x$ 的数的个数（记为 $f(l,r,x)$）不少于 $x$，那么可以通过调整使得 $\operatorname{mex}$ 为 $x$，否则仅通过 $&lt;x$ 的数无法使得 $\operatorname{mex}$ 变为 $x$。</p>
<p>所以答案就是使得 $f(l,r,x)\ge x$ 的最大的 $x$。</p>
<p>那么就有一个十分简单的莫队做法，时间复杂度为 $O(n\sqrt n\log n)$，但这不是 intended solution，难以通过。</p>
<p>考虑离线后按照 $x$​ 从大到小扫描，对每个区间维护 $f(l,r,x)-x$​，每当有某个区间的这个值非负时就找到了这个区间的答案（为 $x$），然后将它删除即可。</p>
<p>所以我们要支持矩形加，全局最值，删除元素，但这太困难了，我们考虑进一步简化。</p>
<p>如果 $[l_1,r_1]\subset [l,r]$，那么显然 $f(l_1,r_1,x)\leq f(l,r,x)$，所以一开始求最大值时可以不考虑 $[l_1,r_1]$，只有等 $[l,r]$ 被删除后才需要考虑这条更短的线段。</p>
<p>所以现在我们可以认为所有线段没有包含关系，那么原本的二维问题就退化成了一维（排序后左右端点都是单调的），只需要支持区间加以及查询最值即可，用线段树可以维护。</p>
<p>不过此时就会有增删线段的问题，我们可以用另一棵线段树记录当前被另一个区间包含的区间，称为候选区间，每当有一个区间被删除时就要考虑它包含的候选区间是否要加到前一棵线段树上，由于前一棵线段树上的线段都是有序的，所以找出这些要加入的候选线段可以直接取右端点最大的看能不能加。</p>
<p>为了计算候选区间此时的 $f(l,r,x)$，还要用树状数组维护整个序列。</p>
<p>时间复杂度为 $O((n+q)\log(n+q))$。</p>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        代码
    </div>
    <div class='spoiler-content'>
        <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">500010</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Query</span> &#123;</span><br><span class="line">	<span class="type">int</span> id,ans,l,r;</span><br><span class="line">&#125;qu[MAXN];</span><br><span class="line"><span class="type">int</span> n,q,fw[MAXN],mxr[MAXN&lt;&lt;<span class="number">2</span>],mpr[MAXN&lt;&lt;<span class="number">2</span>],mxv[MAXN&lt;&lt;<span class="number">2</span>],mpv[MAXN&lt;&lt;<span class="number">2</span>],tg[MAXN&lt;&lt;<span class="number">2</span>];</span><br><span class="line">pair &lt;<span class="type">int</span>,<span class="type">int</span>&gt; a[MAXN];</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp1</span> <span class="params">(pair &lt;<span class="type">int</span>,<span class="type">int</span>&gt; a,pair &lt;<span class="type">int</span>,<span class="type">int</span>&gt; b)</span> </span>&#123;<span class="keyword">return</span> a.first&gt;b.first;&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp2</span> <span class="params">(Query a,Query b)</span> </span>&#123;<span class="keyword">return</span> (a.l==b.l?a.r&gt;b.r:a.l&lt;b.l);&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp3</span> <span class="params">(Query a,Query b)</span> </span>&#123;<span class="keyword">return</span> a.id&lt;b.id;&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">cs</span> <span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (qu[a].r==qu[b].r) &#123;<span class="keyword">return</span> (qu[a].l&lt;=qu[b].l?a:b);&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;<span class="built_in">return</span> (qu[a].r&gt;qu[b].r?a:b);&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">modify_fw</span> <span class="params">(<span class="type">int</span> x,<span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=x;i&lt;=n;i+=(i&amp;(-i))) &#123;fw[i]+=v;&#125;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query_fw</span> <span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=x;i;i-=(i&amp;(-i))) &#123;res+=fw[i];&#125;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">upd</span> <span class="params">(<span class="type">int</span> p)</span> </span>&#123;</span><br><span class="line">	mxr[p]=<span class="built_in">max</span>(mxr[p&lt;&lt;<span class="number">1</span>],mxr[(p&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>]);</span><br><span class="line">	mpr[p]=<span class="built_in">cs</span>(mpr[p&lt;&lt;<span class="number">1</span>],mpr[(p&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>]);</span><br><span class="line">	mxv[p]=<span class="built_in">max</span>(mxv[p&lt;&lt;<span class="number">1</span>],mxv[(p&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>]);</span><br><span class="line">	mpv[p]=(mxv[p&lt;&lt;<span class="number">1</span>]&gt;mxv[(p&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>]?mpv[p&lt;&lt;<span class="number">1</span>]:mpv[(p&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>]);</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pd</span> <span class="params">(<span class="type">int</span> p)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (tg[p]==<span class="number">0</span>) &#123;<span class="keyword">return</span>;&#125;</span><br><span class="line">	tg[p&lt;&lt;<span class="number">1</span>]+=tg[p],tg[(p&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>]+=tg[p],mxv[p&lt;&lt;<span class="number">1</span>]+=tg[p],mxv[(p&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>]+=tg[p];</span><br><span class="line">	tg[p]=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">buildt</span> <span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (l==r) &#123;mxv[p]=<span class="number">-1e9</span>,mpv[p]=l,mpr[p]=l;<span class="keyword">return</span>;&#125;</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">buildt</span>(p&lt;&lt;<span class="number">1</span>,l,mid);</span><br><span class="line">	<span class="built_in">buildt</span>((p&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>,mid+<span class="number">1</span>,r);</span><br><span class="line">	<span class="built_in">upd</span>(p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">modify_mpr</span> <span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> pos,<span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (l==r) &#123;mpr[p]=v;<span class="keyword">return</span>;&#125;</span><br><span class="line">	<span class="built_in">pd</span>(p);</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span> (pos&lt;=mid) &#123;<span class="built_in">modify_mpr</span>(p&lt;&lt;<span class="number">1</span>,l,mid,pos,v);&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;<span class="built_in">modify_mpr</span>((p&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>,mid+<span class="number">1</span>,r,pos,v);&#125;</span><br><span class="line">	<span class="built_in">upd</span>(p);</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">modify_mxr</span> <span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> pos,<span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (l==r) &#123;mxr[p]=v;<span class="keyword">return</span>;&#125;</span><br><span class="line">	<span class="built_in">pd</span>(p);</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span> (pos&lt;=mid) &#123;<span class="built_in">modify_mxr</span>(p&lt;&lt;<span class="number">1</span>,l,mid,pos,v);&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;<span class="built_in">modify_mxr</span>((p&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>,mid+<span class="number">1</span>,r,pos,v);&#125;</span><br><span class="line">	<span class="built_in">upd</span>(p);</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">modify_dv</span> <span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> pos,<span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (l==r) &#123;mxv[p]=v;<span class="keyword">return</span>;&#125;</span><br><span class="line">	<span class="built_in">pd</span>(p);</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span> (pos&lt;=mid) &#123;<span class="built_in">modify_dv</span>(p&lt;&lt;<span class="number">1</span>,l,mid,pos,v);&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;<span class="built_in">modify_dv</span>((p&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>,mid+<span class="number">1</span>,r,pos,v);&#125;</span><br><span class="line">	<span class="built_in">upd</span>(p);</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">modify_qv</span> <span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> xl,<span class="type">int</span> xr,<span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (xr&lt;l||r&lt;xl) &#123;<span class="keyword">return</span>;&#125;</span><br><span class="line">	<span class="keyword">if</span> (xl&lt;=l&amp;&amp;r&lt;=xr) &#123;</span><br><span class="line">		tg[p]+=v,mxv[p]+=v;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">pd</span>(p);</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">modify_qv</span>(p&lt;&lt;<span class="number">1</span>,l,mid,xl,xr,v);</span><br><span class="line">	<span class="built_in">modify_qv</span>((p&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>,mid+<span class="number">1</span>,r,xl,xr,v);</span><br><span class="line">	<span class="built_in">upd</span>(p);</span><br><span class="line">	<span class="keyword">return</span>; </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query_mpr</span> <span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> xl,<span class="type">int</span> xr)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (xr&lt;l||r&lt;xl) &#123;<span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line">	<span class="keyword">if</span> (xl&lt;=l&amp;&amp;r&lt;=xr) &#123;<span class="keyword">return</span> mpr[p];&#125;</span><br><span class="line">	<span class="built_in">pd</span>(p);</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">cs</span>(<span class="built_in">query_mpr</span>(p&lt;&lt;<span class="number">1</span>,l,mid,xl,xr),<span class="built_in">query_mpr</span>((p&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>,mid+<span class="number">1</span>,r,xl,xr));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query_mxr</span> <span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> xl,<span class="type">int</span> xr)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (xr&lt;l||r&lt;xl) &#123;<span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line">	<span class="keyword">if</span> (xl&lt;=l&amp;&amp;r&lt;=xr) &#123;<span class="keyword">return</span> mxr[p];&#125;</span><br><span class="line">	<span class="built_in">pd</span>(p);</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">max</span>(<span class="built_in">query_mxr</span>(p&lt;&lt;<span class="number">1</span>,l,mid,xl,xr),<span class="built_in">query_mxr</span>((p&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>,mid+<span class="number">1</span>,r,xl,xr));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query_rb</span> <span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (l==r) &#123;<span class="keyword">return</span> l;&#125;</span><br><span class="line">	<span class="built_in">pd</span>(p);</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span> (mxr[p&lt;&lt;<span class="number">1</span>]&gt;=v) &#123;<span class="keyword">return</span> <span class="built_in">query_rb</span>(p&lt;&lt;<span class="number">1</span>,l,mid,v);&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;<span class="keyword">return</span> <span class="built_in">query_rb</span>((p&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>,mid+<span class="number">1</span>,r,v);&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query_nx</span> <span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> pos)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (mxv[p]&lt;<span class="number">-1e8</span>) &#123;<span class="keyword">return</span> <span class="number">-1</span>;&#125;</span><br><span class="line">	<span class="keyword">if</span> (l==r) &#123;<span class="keyword">return</span> l;&#125;</span><br><span class="line">	<span class="built_in">pd</span>(p);</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span> (mid&gt;pos) &#123;</span><br><span class="line">		<span class="type">int</span> tmp=<span class="built_in">query_nx</span>(p&lt;&lt;<span class="number">1</span>,l,mid,pos);</span><br><span class="line">		<span class="keyword">if</span> (tmp!=<span class="number">-1</span>) &#123;<span class="keyword">return</span> tmp;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">query_nx</span>((p&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>,mid+<span class="number">1</span>,r,pos);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span> <span class="params">(<span class="type">int</span> x,<span class="type">int</span> val)</span> </span>&#123;</span><br><span class="line">	<span class="comment">//cout &lt;&lt; &quot;add: &quot; &lt;&lt; x &lt;&lt; &quot;  &quot; &lt;&lt; qu[x].id &lt;&lt; &quot;  &quot; &lt;&lt; val &lt;&lt; endl;</span></span><br><span class="line">	<span class="built_in">modify_mpr</span>(<span class="number">1</span>,<span class="number">1</span>,q,x,<span class="number">0</span>);</span><br><span class="line">	<span class="built_in">modify_mxr</span>(<span class="number">1</span>,<span class="number">1</span>,q,x,qu[x].r);</span><br><span class="line">	<span class="built_in">modify_dv</span>(<span class="number">1</span>,<span class="number">1</span>,q,x,<span class="built_in">query_fw</span>(qu[x].r)-<span class="built_in">query_fw</span>(qu[x].l<span class="number">-1</span>)-val);</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">del</span> <span class="params">(<span class="type">int</span> x,<span class="type">int</span> val)</span> </span>&#123;</span><br><span class="line">	<span class="comment">//cout &lt;&lt; &quot;del: &quot; &lt;&lt; x &lt;&lt; &quot;  &quot; &lt;&lt; qu[x].id &lt;&lt; &quot;  &quot; &lt;&lt; val &lt;&lt; endl;</span></span><br><span class="line">	qu[x].ans=val;</span><br><span class="line">	<span class="built_in">modify_dv</span>(<span class="number">1</span>,<span class="number">1</span>,q,x,<span class="number">-1e9</span>);</span><br><span class="line">	<span class="built_in">modify_mxr</span>(<span class="number">1</span>,<span class="number">1</span>,q,x,<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;q);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		<span class="built_in">modify_fw</span>(i,<span class="number">1</span>);</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;a[i].first);</span><br><span class="line">		a[i].second=i;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> fflg=(a[<span class="number">1</span>].first==<span class="number">3092</span>);</span><br><span class="line">	<span class="built_in">sort</span>(a+<span class="number">1</span>,a+n+<span class="number">1</span>,cmp1);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=q;i++) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;qu[i].l,&amp;qu[i].r);</span><br><span class="line">		qu[i].id=i;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">sort</span>(qu+<span class="number">1</span>,qu+q+<span class="number">1</span>,cmp2);</span><br><span class="line">	<span class="built_in">buildt</span>(<span class="number">1</span>,<span class="number">1</span>,q);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=q;i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">query_mxr</span>(<span class="number">1</span>,<span class="number">1</span>,q,<span class="number">1</span>,i<span class="number">-1</span>)&lt;qu[i].r) &#123;<span class="built_in">add</span>(i,<span class="number">500001</span>);&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> cur=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">500000</span>;i&gt;=<span class="number">0</span>;i--) &#123;</span><br><span class="line">		<span class="keyword">while</span> (cur&lt;=n&amp;&amp;a[cur].first==i) &#123;</span><br><span class="line">			<span class="built_in">modify_fw</span>(a[cur].second,<span class="number">-1</span>);</span><br><span class="line">			<span class="keyword">if</span> (mxr[<span class="number">1</span>]&gt;=a[cur].second) &#123;</span><br><span class="line">				<span class="type">int</span> l=<span class="number">0</span>,r=q;</span><br><span class="line">				<span class="keyword">while</span> (l&lt;r) &#123;</span><br><span class="line">					<span class="type">int</span> mid=(l+r+<span class="number">1</span>)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">					<span class="keyword">if</span> (qu[mid].l&lt;=a[cur].second) &#123;l=mid;&#125;</span><br><span class="line">					<span class="keyword">else</span> &#123;r=mid<span class="number">-1</span>;&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="type">int</span> rb=<span class="built_in">query_rb</span>(<span class="number">1</span>,<span class="number">1</span>,q,a[cur].second);</span><br><span class="line">				<span class="keyword">if</span> (rb&lt;=l) &#123;<span class="built_in">modify_qv</span>(<span class="number">1</span>,<span class="number">1</span>,q,rb,l,<span class="number">-1</span>);&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			cur++;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">modify_qv</span>(<span class="number">1</span>,<span class="number">1</span>,q,<span class="number">1</span>,q,<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">while</span> (mxv[<span class="number">1</span>]&gt;=<span class="number">0</span>) &#123;</span><br><span class="line">			<span class="type">int</span> tmp=mpv[<span class="number">1</span>];</span><br><span class="line">			<span class="built_in">del</span>(tmp,i);</span><br><span class="line">			<span class="type">int</span> mnr=<span class="built_in">query_mxr</span>(<span class="number">1</span>,<span class="number">1</span>,q,<span class="number">1</span>,tmp),mxl=<span class="built_in">query_nx</span>(<span class="number">1</span>,<span class="number">1</span>,q,tmp);</span><br><span class="line">			<span class="keyword">if</span> (mxl==<span class="number">-1</span>) &#123;mxl=n;&#125;</span><br><span class="line">			<span class="type">int</span> tmp2=<span class="built_in">query_mpr</span>(<span class="number">1</span>,<span class="number">1</span>,q,tmp,mxl);</span><br><span class="line">			<span class="comment">//cout &lt;&lt; tmp &lt;&lt; &quot;  &quot; &lt;&lt; mnr &lt;&lt; &quot;  &quot; &lt;&lt; mxl &lt;&lt; &quot;  &quot; &lt;&lt; tmp2 &lt;&lt; endl;</span></span><br><span class="line">			<span class="keyword">while</span> (qu[tmp2].r&gt;mnr) &#123;</span><br><span class="line">				<span class="built_in">add</span>(tmp2,i);</span><br><span class="line">				tmp2=<span class="built_in">query_mpr</span>(<span class="number">1</span>,<span class="number">1</span>,q,tmp,tmp2);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">sort</span>(qu+<span class="number">1</span>,qu+q+<span class="number">1</span>,cmp3);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=q;i++) &#123;<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,qu[i].ans);&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="I-Trade"><a href="#I-Trade" class="headerlink" title="I. Trade"></a>I. Trade</h3><p><strong>难度：</strong>$\bigstar\bigstar$</p>
<p><strong>题目大意：</strong></p>
<p>有 $n$ 个商品，第 $i$ 个商品的初始价格为 $c_i$，但如果你在买它之前已经买了其他的 $j$ 个物品，那么你在买它的时候需要额外付出 $j\times p_i$ 的价格，保证 $p_i$ 两两不同。你有 $S$ 单位的钱，问最多能买多少个商品。</p>
<p>$1\leq n\leq 10^5,  0\leq S\leq 10^9$</p>
<p><strong>题目解法：</strong></p>
<p>由于 $p_i$ 两两不同，所以买 $m$ 个物品所需价格至少也是 $O(m^3)$，所以能购买的物品数量是 $O(\sqrt[3] S)$ 的。</p>
<p>显然购买顺序是 $p_i$ 从大到小，所以排序后 DP 即可，时间复杂度为 $O(n\sqrt[3] S)$。</p>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        代码
    </div>
    <div class='spoiler-content'>
        <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">100010</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">P</span> &#123;</span><br><span class="line">	<span class="type">int</span> c,p;</span><br><span class="line">&#125;t[MAXN]; </span><br><span class="line"><span class="type">int</span> n,s,ans;</span><br><span class="line">ll dp[<span class="number">2</span>][MAXN];</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span> <span class="params">(P a,P b)</span> </span>&#123;<span class="keyword">return</span> a.p&gt;b.p;&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;s);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;t[i].c);&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;t[i].p);&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">2000</span>;i++) &#123;dp[<span class="number">0</span>][i]=s+<span class="number">1</span>;&#125;</span><br><span class="line">	<span class="built_in">sort</span>(t+<span class="number">1</span>,t+n+<span class="number">1</span>,cmp);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		<span class="type">int</span> u=(i&amp;<span class="number">1</span>),v=(u^<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">0</span>;j&lt;=<span class="number">2000</span>;j++) &#123;</span><br><span class="line">			dp[u][j]=<span class="built_in">min</span>(dp[u][j],dp[v][j]);</span><br><span class="line">			dp[u][j+<span class="number">1</span>]=dp[v][j]+<span class="number">1ll</span>*j*t[i].p+t[i].c;</span><br><span class="line">			<span class="keyword">if</span> (dp[u][j]&gt;s) &#123;dp[u][j]=s+<span class="number">1</span>;&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">2000</span>;i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (dp[n&amp;<span class="number">1</span>][i]&lt;=s) &#123;ans=i;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="J-Increasing-or-Decreasing"><a href="#J-Increasing-or-Decreasing" class="headerlink" title="J. Increasing or Decreasing"></a>J. Increasing or Decreasing</h3><p><strong>难度：</strong>$\bigstar\bigstar$</p>
<p><strong>题目大意：</strong></p>
<p>给定 $1,\ldots,n$ 的排列 $a_{1,\ldots,n}, b_{1,\ldots,n}$，现在可以对 $a$ 进行若干次操作，操作形如将一个区间从小到大或从大到小排序，请构造一个不超过 $n$ 个操作的方案将 $a$ 变为 $b$。</p>
<p>$1\leq n\leq 500$</p>
<p><strong>题目解法：</strong></p>
<p>可以先通过一次操作将 $a$ 整体倒序排序，此时 $a_i=n-i+1$。</p>
<p>接下来依次枚举 $i=1,\ldots,n-1$，设 $b_i$ 在当前 $a$ 中的位置是 $r$，那么我们就将 $[i,r]$ 正序或倒序排序，使得 $a_i=b_i$。</p>
<p>要做到这一点，我们需要归纳证明：在上述过程中的任何一步，$a_r$ 或者是 $[i,r]$ 的最小值，或者是 $[i,r]$ 的最大值，而这个归纳是不困难的，这里不进行赘述。</p>
<p>暴力实现，时间复杂度为 $O(n^2)$。</p>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        代码
    </div>
    <div class='spoiler-content'>
        <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">510</span>;</span><br><span class="line"><span class="type">int</span> n,a[MAXN],b[MAXN],pos[MAXN];</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp1</span> <span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span> </span>&#123;<span class="keyword">return</span> a&lt;b;&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp2</span> <span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span> </span>&#123;<span class="keyword">return</span> b&lt;a;&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;a[i]);a[i]=pos[i]=n-i+<span class="number">1</span>;&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;b[i]);&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d\n1 %d D\n&quot;</span>,n,n);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n<span class="number">-1</span>;i++) &#123;</span><br><span class="line">		<span class="type">int</span> tmp=pos[b[i]];</span><br><span class="line">		<span class="keyword">if</span> (tmp==i||a[tmp]&lt;a[tmp<span class="number">-1</span>]) &#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;%d %d I\n&quot;</span>,i,tmp);</span><br><span class="line">			<span class="built_in">sort</span>(a+i,a+tmp+<span class="number">1</span>,cmp1);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;%d %d D\n&quot;</span>,i,tmp);</span><br><span class="line">			<span class="built_in">sort</span>(a+i,a+tmp+<span class="number">1</span>,cmp2);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">1</span>;j&lt;=n;j++) &#123;pos[a[j]]=j;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="K-Rectangle-Painting"><a href="#K-Rectangle-Painting" class="headerlink" title="K. Rectangle Painting"></a>K. Rectangle Painting</h3><p><strong>难度：</strong>$\bigstar\bigstar\bigstar\bigstar$</p>
<p><strong>题目大意：</strong></p>
<p>直角坐标系中的每个单位方格初始全为白色，接下来进行 $q$ 个操作，操作分为：</p>
<ul>
<li>修改操作，给定 $y\ge0,l,r$，将所有 $(i,y) (i\in [l,r])$ 对应的方格染黑。</li>
<li>查询操作，给定 $l,r$，求最大的自然数 $y$ 使得存在 $i\in [l,r]$，对于所有 $j\in [0,y)$ 满足 $(i,j)$ 是黑的。</li>
</ul>
<p>强制在线。</p>
<p>$1\leq q\leq 10^5,  0\leq l\leq r\leq 2\times 10^5$</p>
<p><strong>题目解法：</strong></p>
<p>对横坐标建立线段树维护，本题的维护技巧依赖于对于经典的线段树五类点意义的理解（可以参看我<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/blog/ix-35/noi-yi-lun-fu-xi-iii-shuo-ju-jie-gou">没写完的数据结构博客</a>）：</p>
<p><img src="https://cdn.luogu.com.cn/upload/image_hosting/tepkursq.png" alt=""></p>
<ul>
<li>橙色点：某个修改区间的定位区间；</li>
<li>黄色点：橙色点的真后代；</li>
<li>红色点：不是任何修改区间的子区间，但是与某个修改区间有交；</li>
<li>绿色点：红色点的非橙色非红色儿子；</li>
<li>蓝色点：绿色点的真后代。</li>
</ul>
<p>对于一个确定的纵坐标 $y$，如果将所有纵坐标为 $y$ 的修改操作扔到线段树上，那么一个横坐标 $x$ 对应的格子 $(x,y)$ 为白也就等价于 $x$ 对应的线段树上的叶子为绿色或蓝色，这又等价于这个叶子有一个绿色的祖先（包括自己）。</p>
<p>那么，对于每个线段树上的结点 $p$，我们维护使得 $p$ 是绿色点的纵坐标 $y$ 的集合 $S_p$，以及其中的最小值 $m_p$，那么查询 $[l,r]$ 的答案就是：</p>
<script type="math/tex; mode=display">
\max\limits_{i\in [l,r]}\min\limits_{L_i\to j}m_{j}</script><p>其中 $L_i$ 是 $i$ 对应的叶子，$x\to y$ 表示 $y$ 是 $x$ 的祖先。</p>
<p>对于线段树上对应区间 $[l,r]$ 的点 $x$ 维护一个辅助量 $val_x$，它表示 $\max\limits_{i\in [l,r]}\min\limits_{L_i\to j\to x} m_j$，即只考虑每个叶子到 $x$ 的路径而不考虑 $x$ 到根的部分，那么有 $val_x=\min(m_x,\max(val_{lx},val_{rx}))$，其中 $lx,rx$ 为 $x$ 的左右儿子。</p>
<p>于是我们直接套用传统的线段树区间查询，对于定位到的橙色点直接返回 $val_x$，对于红色点其返回值为两个儿子的较大值与自己的 $m_x$ 取 $\min$，最后根的返回值就是查询答案。</p>
<p>最后的问题是如何维护 $m_p$，那么当然同时要维护 $S_p$，只需要当处理纵坐标为 $y$ 的修改时遇到点 $p$（即 $p$ 变为红色或橙色），如果 $y\in S_p$，那么要将 $y$ 移出 $S_p$，同时将 $y$ 加入 $S_{lp},S_{rp}$，其中 $lp,rp$ 是 $p$ 的左右儿子。</p>
<p>其实这个做法有一个小问题，考虑以下 Hack：对于同一纵坐标 $y$ 和点 $p$，先来一个包含 $p$ 的左儿子 $lp$ 而不包含其右儿子 $rp$ 的修改，此时 $p$ 为红，$lp$ 为橙，$rp$ 为绿；再来一个包含 $p$ 的修改，这时 $rp$ 和 $lp$ 应该都改成黄色，但是实际上 $rp$ 的绿色标记没有被正确去除。</p>
<p>这是因为线段树递归到了一个被修改区间包含的区间就会停止，为了避免少清除标记，我们需要保证同一纵坐标的所有修改操作两两不交，只需要先用 set 处理一下修改区间即可。</p>
<p>时间复杂度为 $O(q\log q\log V)$，其中 $V$ 是区间端点值域。</p>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        代码
    </div>
    <div class='spoiler-content'>
        <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">200010</span>;</span><br><span class="line"><span class="type">int</span> q,op,ans[MAXN&lt;&lt;<span class="number">3</span>];</span><br><span class="line">set &lt;<span class="type">int</span>&gt; s[MAXN&lt;&lt;<span class="number">3</span>];</span><br><span class="line">set &lt; pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt; &gt; p[MAXN];</span><br><span class="line">ll sum,x,y,z;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">upd</span> <span class="params">(<span class="type">int</span> p)</span> </span>&#123;</span><br><span class="line">	ans[p]=<span class="built_in">max</span>(ans[p&lt;&lt;<span class="number">1</span>],ans[(p&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>]);</span><br><span class="line">	<span class="keyword">if</span> (s[p].<span class="built_in">size</span>()) &#123;ans[p]=<span class="built_in">min</span>(ans[p],*(s[p].<span class="built_in">begin</span>()));&#125;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">buildt</span> <span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">	ans[p]=ans[p&lt;&lt;<span class="number">1</span>]=ans[(p&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>]=<span class="number">1e9</span>;</span><br><span class="line">	<span class="keyword">if</span> (l==r) &#123;<span class="keyword">return</span>;&#125;</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">buildt</span>(p&lt;&lt;<span class="number">1</span>,l,mid),<span class="built_in">buildt</span>((p&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>,mid+<span class="number">1</span>,r);</span><br><span class="line">	<span class="built_in">upd</span>(p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">modify</span> <span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> xl,<span class="type">int</span> xr,<span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (s[p].<span class="built_in">find</span>(v)!=s[p].<span class="built_in">end</span>()) &#123;</span><br><span class="line">		s[p].<span class="built_in">erase</span>(v);</span><br><span class="line">		<span class="built_in">upd</span>(p);</span><br><span class="line">		<span class="keyword">if</span> (xl&lt;=l&amp;&amp;r&lt;=xr) &#123;<span class="keyword">return</span>;&#125;</span><br><span class="line">		<span class="keyword">if</span> (l!=r) &#123;</span><br><span class="line">			s[p&lt;&lt;<span class="number">1</span>].<span class="built_in">insert</span>(v),s[(p&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>].<span class="built_in">insert</span>(v);</span><br><span class="line">			<span class="built_in">upd</span>(p&lt;&lt;<span class="number">1</span>),<span class="built_in">upd</span>((p&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (xl&lt;=l&amp;&amp;r&lt;=xr) &#123;<span class="keyword">return</span>;&#125;</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span> (xl&lt;=mid) &#123;<span class="built_in">modify</span>(p&lt;&lt;<span class="number">1</span>,l,mid,xl,xr,v);&#125;</span><br><span class="line">	<span class="keyword">if</span> (xr&gt;mid) &#123;<span class="built_in">modify</span>((p&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>,mid+<span class="number">1</span>,r,xl,xr,v);&#125;</span><br><span class="line">	<span class="built_in">upd</span>(p);</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query</span> <span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> xl,<span class="type">int</span> xr)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (xl&lt;=l&amp;&amp;r&lt;=xr) &#123;<span class="keyword">return</span> ans[p];&#125;</span><br><span class="line">	<span class="type">int</span> res=<span class="number">0</span>,mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span> (xl&lt;=mid) &#123;res=<span class="built_in">query</span>(p&lt;&lt;<span class="number">1</span>,l,mid,xl,xr);&#125;</span><br><span class="line">	<span class="keyword">if</span> (xr&gt;mid) &#123;res=<span class="built_in">max</span>(res,<span class="built_in">query</span>((p&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>,mid+<span class="number">1</span>,r,xl,xr));&#125;</span><br><span class="line">	<span class="keyword">if</span> (s[p].<span class="built_in">size</span>()) &#123;res=<span class="built_in">min</span>(res,*(s[p].<span class="built_in">begin</span>()));&#125;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span> <span class="params">(<span class="type">int</span> x,<span class="type">int</span> y,<span class="type">int</span> z)</span> </span>&#123;</span><br><span class="line">	set &lt; pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt; &gt;::iterator it=p[x].<span class="built_in">lower_bound</span>(<span class="built_in">make_pair</span>(y,<span class="number">0</span>));</span><br><span class="line">	<span class="keyword">if</span> (it!=p[x].<span class="built_in">begin</span>()) &#123;</span><br><span class="line">		--it;</span><br><span class="line">		<span class="keyword">if</span> ((*it).second&gt;=y) &#123;</span><br><span class="line">			p[x].<span class="built_in">insert</span>(<span class="built_in">make_pair</span>((*it).first,y<span class="number">-1</span>));</span><br><span class="line">			p[x].<span class="built_in">insert</span>(<span class="built_in">make_pair</span>(y,(*it).second));</span><br><span class="line">			p[x].<span class="built_in">erase</span>(it);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	it=p[x].<span class="built_in">lower_bound</span>(<span class="built_in">make_pair</span>(z+<span class="number">1</span>,<span class="number">0</span>));</span><br><span class="line">	<span class="keyword">if</span> (it!=p[x].<span class="built_in">begin</span>()) &#123;</span><br><span class="line">		--it;</span><br><span class="line">		<span class="keyword">if</span> ((*it).second&gt;=z+<span class="number">1</span>) &#123;</span><br><span class="line">			p[x].<span class="built_in">insert</span>(<span class="built_in">make_pair</span>((*it).first,z));</span><br><span class="line">			p[x].<span class="built_in">insert</span>(<span class="built_in">make_pair</span>(z+<span class="number">1</span>,(*it).second));</span><br><span class="line">			p[x].<span class="built_in">erase</span>(it);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> tmp=y;</span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">		it=p[x].<span class="built_in">lower_bound</span>(<span class="built_in">make_pair</span>(y,<span class="number">0</span>));</span><br><span class="line">		<span class="keyword">if</span> (it==p[x].<span class="built_in">end</span>()||(*it).first&gt;z) &#123;<span class="keyword">break</span>;&#125;</span><br><span class="line">		<span class="keyword">if</span> (tmp&lt;=(*it).first<span class="number">-1</span>) &#123;<span class="built_in">modify</span>(<span class="number">1</span>,<span class="number">0</span>,MAXN<span class="number">-10</span>,tmp,(*it).first<span class="number">-1</span>,x);&#125;</span><br><span class="line">		tmp=(*it).second+<span class="number">1</span>;</span><br><span class="line">		p[x].<span class="built_in">erase</span>(it);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (tmp&lt;=z) &#123;<span class="built_in">modify</span>(<span class="number">1</span>,<span class="number">0</span>,MAXN<span class="number">-10</span>,tmp,z,x);&#125;</span><br><span class="line">	p[x].<span class="built_in">insert</span>(<span class="built_in">make_pair</span>(y,z));</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;q);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;=q;i++) &#123;s[<span class="number">1</span>].<span class="built_in">insert</span>(i);&#125;</span><br><span class="line">	<span class="built_in">buildt</span>(<span class="number">1</span>,<span class="number">0</span>,MAXN<span class="number">-10</span>);</span><br><span class="line">	<span class="type">int</span> ttt=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=q;i++) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;op);</span><br><span class="line">		<span class="keyword">if</span> (op==<span class="number">1</span>) &#123;</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld%lld&quot;</span>,&amp;x,&amp;y,&amp;z);</span><br><span class="line">			x^=sum,y^=sum,z^=sum;</span><br><span class="line">			<span class="built_in">add</span>(x,y,z);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld&quot;</span>,&amp;x,&amp;y);</span><br><span class="line">			x^=sum,y^=sum;</span><br><span class="line">			<span class="type">int</span> ans=<span class="built_in">query</span>(<span class="number">1</span>,<span class="number">0</span>,MAXN<span class="number">-10</span>,x,y);</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">			sum+=ans; </span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="L-Extreme-Wealth"><a href="#L-Extreme-Wealth" class="headerlink" title="L. Extreme Wealth"></a>L. Extreme Wealth</h3><p><strong>难度：</strong>$\bigstar\bigstar\bigstar\bigstar$</p>
<p><strong>题目大意：</strong></p>
<p>给定 $R,B$，在一个赌球游戏中有 $R$ 个红球和 $B$ 个蓝球。</p>
<p>你有初始为 $1$ 的资金，总共有 $R+B$ 回合，每一回合中会等概率随机选择当前剩下的某个球（此后的回合就拿走了这个球），你可以下注 $x$ 赌它为红球或蓝球，如果赌对则获得 $x$ 的利润，否则付出 $x$ 的代价（当然 $x$ 要不超过你的资金总数）。请问结束游戏时，最坏情况下最多可以保证拥有多少资金。</p>
<p>答案以浮点数形式输出，特别地，如果答案超过 $10^9$，只需要输出 <code>Extreme Wealth</code>。</p>
<p>$0\leq R,B\leq 10^{13}$</p>
<p><strong>题目解法：</strong></p>
<p>设 $f(r,b)$ 表示目前还剩 $r$ 个红球和 $b$ 个蓝球时你的资金最坏情况下最多可以保证翻多少倍，不妨设 $r\ge b$，那么肯定赌红球，如果你的下注是本金的 $p$ 倍（$0\leq p\leq 1$），那么有：</p>
<script type="math/tex; mode=display">
f(r,b)\leftarrow \min(f(r-1,b)\times (1+p),f(r,b-1)\times (1-p))</script><p>要让右边取最大值，显然有：</p>
<script type="math/tex; mode=display">
f(r-1,b)\times (1+p)=f(r,b-1)\times (1-p) \\
p=\dfrac{f(r,b-1)-f(r-1,b)}{f(r-1,b)+f(r,b-1)}</script><p>带入原式，然后两边取倒数，就有：</p>
<script type="math/tex; mode=display">
f(r,b)=\dfrac{2f(r-1,b)f(r,b-1)}{f(r-1,b)+f(r,b-1)} \\
\dfrac{1}{f(r,b)}=\dfrac{1}{2}\Big(\dfrac{1}{f(r-1,b)}+\dfrac{1}{f(r,b-1)}\Big)</script><p>将这个式子与格路计数联系起来，容易得到：</p>
<script type="math/tex; mode=display">
f(r,b)=\dfrac{2^{r+b}}{\binom {r+b} r}</script><p>看似这已经做完了，不过实际上前面只是很简单的一部分，真正的问题这时才刚刚开始——如何计算 $\dfrac{2^{R+B}}{\binom {R+B} R}$？</p>
<p>这题当然不是想让你直接精确计算，不妨用一些估计的方法，考虑用斯特林公式带入：</p>
<script type="math/tex; mode=display">
n!\approx \sqrt{2\pi n}\Big(\dfrac{n}{e}\Big)^n \\
f(R,B)\approx \sqrt {2\pi}\dfrac{\sqrt {R}(2R)^{R}\times \sqrt {B}(2B)^B}{\sqrt {R+B}(R+B)^{R+B}}</script><p>有一个比较特殊的情况容易计算，当 $R=B$ 时：</p>
<script type="math/tex; mode=display">
f(R,R)\approx\sqrt {\pi R}</script><p>官方题解给出了更精确的估计，这里不仔细分析了，直接给出结论：</p>
<script type="math/tex; mode=display">
f(R,R)=\sqrt {\pi R}(1+\dfrac{1}{8R}+O(R^{-2}))</script><p>有了 $f(R,R)$ 后我们可以往两边计算，考虑从 $f(R,B)$ 到 $f(R,B+1)$ 的递推式：</p>
<script type="math/tex; mode=display">
f(R,B+1)=f(R,B)\times \dfrac{2(B+1)}{R+B+1}=f(R,B)\times \dfrac{B+B+2}{R+B+1}</script><p>这里可以进行一些基本的估计，如果 $B,R$ 不太小，且 $B=R+c\sqrt R$，其中 $c$ 为适当大小的常数，那么：</p>
<script type="math/tex; mode=display">
\dfrac{B+B+2}{R+B+1}=\dfrac{2R+2c\sqrt R+2}{2R+c\sqrt R+1}=1+\dfrac{c\sqrt R+1}{2R+c\sqrt R+1}\approx1+\dfrac{c}{2\sqrt R}</script><p>将这个贡献累乘：</p>
<script type="math/tex; mode=display">
\prod\limits_{B=R+c\sqrt R}^{R+(c+1)\sqrt R}\dfrac{B+B+2}{R+B+1}\approx (1+\dfrac{c}{2\sqrt R})^{\sqrt R}=\exp(\sqrt R\ln(1+\dfrac{c}{2\sqrt R}))\approx \exp(\dfrac{c}{2})</script><p>尽管这中间的估计有些模糊和不严谨（但其实将上述式子都取 $R\to \infty$ 时的极限，上下两次估计都取等号），总之我们大致知道了：当 $B$ 比 $R$ 稍大时，它每增加 $\sqrt R$，$f(R,B)$ 就会成倍增加。</p>
<p>这告诉我们 $B$ 大致只需要增长 $\sqrt R\times \log 10^9$ 就可以使得 $f(R,B)&gt;10^9$，此时直接输出 <code>Extreme Wealth</code> 即可，否则直接根据 $f(R,R)$ 直接递推出答案。</p>
<p>时间复杂度为 $O(\sqrt R\log C)$，其中 $C=10^9$。</p>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        代码
    </div>
    <div class='spoiler-content'>
        <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">double</span> pi=<span class="built_in">acos</span>(<span class="number">-1.0</span>);</span><br><span class="line">ll r,b;</span><br><span class="line"><span class="type">double</span> ans;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld&quot;</span>,&amp;r,&amp;b);</span><br><span class="line">	<span class="keyword">if</span> (r&gt;b) &#123;<span class="built_in">swap</span>(r,b);&#125;</span><br><span class="line">	<span class="keyword">if</span> (r&lt;=<span class="number">100</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span> (b&gt;=<span class="number">10000000</span>) &#123;<span class="built_in">printf</span>(<span class="string">&quot;Extreme Wealth\n&quot;</span>);<span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line">		ans=<span class="number">1.0</span>;</span><br><span class="line">		<span class="type">int</span> rst=r+b;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=r;i++) &#123;</span><br><span class="line">			ans*=(<span class="type">double</span>)i;</span><br><span class="line">			ans/=(r+b-i+<span class="number">1</span>);</span><br><span class="line">			<span class="keyword">while</span> (ans&lt;<span class="number">1</span>&amp;&amp;rst) &#123;rst--,ans*=<span class="number">2.0</span>;&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">while</span> (rst) &#123;</span><br><span class="line">			rst--,ans*=<span class="number">2.0</span>;</span><br><span class="line">			<span class="keyword">if</span> (ans&gt;<span class="number">1e9</span>) &#123;<span class="built_in">printf</span>(<span class="string">&quot;Extreme Wealth\n&quot;</span>);<span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (ans&gt;<span class="number">1e9</span>) &#123;<span class="built_in">printf</span>(<span class="string">&quot;Extreme Wealth\n&quot;</span>);<span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%.9f\n&quot;</span>,ans);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		ans=<span class="built_in">sqrt</span>(pi*(<span class="type">double</span>)r)*(<span class="number">1.0</span>+<span class="number">0.125</span>/(<span class="type">double</span>)r);</span><br><span class="line">		<span class="keyword">for</span> (ll i=r;i&lt;b;i++) &#123;</span><br><span class="line">			ans*=(<span class="type">double</span>)(i+i+<span class="number">2</span>)/(<span class="type">double</span>)(i+r+<span class="number">1</span>);</span><br><span class="line">			<span class="keyword">if</span> (ans&gt;<span class="number">1e9</span>) &#123;<span class="built_in">printf</span>(<span class="string">&quot;Extreme Wealth\n&quot;</span>);<span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%.9f\n&quot;</span>,ans);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="M-Discrete-Logarithm-is-a-Joke"><a href="#M-Discrete-Logarithm-is-a-Joke" class="headerlink" title="M. Discrete Logarithm is a Joke"></a>M. Discrete Logarithm is a Joke</h3><p><strong>难度：</strong>$\bigstar$</p>
<p><strong>题目大意：</strong></p>
<p>已知素数 $M=10^{18}+31$ 和它的原根 $g=42$，定义离散对数 $\log(x)$ 为使得 $g^q\equiv x\bmod M$ 的最小正整数 $q$，则 $\log(x)$ 是 $[1,M-1]$ 到 $[1,M-1]$ 的双射。</p>
<p>现在有数列 $\{a_n\}$，其中 $a_1=960002411612632915,  a_{i+1}=\log(a_i)$.</p>
<p>给定 $n$，求 $a_n$。</p>
<p>$1\leq n\leq 10^{6}$</p>
<p>等等，忘了说了，$a_{1,000,000}=300$（这是一个样例）！</p>
<p><strong>题目解法：</strong></p>
<p>由于 $a_{i+1}=\log(a_i)$，所以 $a_i=g^{a_{i+1}}$，由于已知 $a_{1,000,000}$，所以可以倒推所有 $a_i (i\in [1,10^6])$。</p>
<p>时间复杂度为 $O(n\log M)$。</p>
<p>作为本场比赛的签到题，还是比较好玩的。</p>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        代码
    </div>
    <div class='spoiler-content'>
        <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ull unsigned long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> ll P=<span class="number">1000000000000000000ll</span>+<span class="number">31</span>,G=<span class="number">42</span>;</span><br><span class="line">ll n,tmp;</span><br><span class="line"><span class="function">ll <span class="title">qmul</span> <span class="params">(ll a,ll b,ll m)</span> </span>&#123;</span><br><span class="line">	<span class="type">long</span> <span class="type">double</span> t=((<span class="type">long</span> <span class="type">double</span>)a*(<span class="type">long</span> <span class="type">double</span>)b/(<span class="type">long</span> <span class="type">double</span>)m);</span><br><span class="line">	ull s=(ull)(t+<span class="number">0.5</span>);</span><br><span class="line">	ull res=(ull)a*(ull)b-s*(ull)m;</span><br><span class="line">	<span class="keyword">if</span> (res&lt;m) &#123;<span class="keyword">return</span> res;&#125;</span><br><span class="line">	<span class="keyword">return</span> res+m;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">qpow</span> <span class="params">(ll a,ll b,ll m)</span> </span>&#123;</span><br><span class="line">	ll res=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">while</span> (b) &#123;</span><br><span class="line">		<span class="keyword">if</span> (b&amp;<span class="number">1</span>) &#123;res=<span class="built_in">qmul</span>(res,a,m);&#125;</span><br><span class="line">		a=<span class="built_in">qmul</span>(a,a,m),b&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>,&amp;n);</span><br><span class="line">	n=<span class="number">1000000</span>-n;</span><br><span class="line">	tmp=<span class="number">300</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;tmp=<span class="built_in">qpow</span>(G,tmp,P);&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,tmp);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>
    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2023/09/29/%E4%B8%93%E9%A2%98%E9%A2%98%E8%A7%A3/XXIOpenCup,GrandPrixofKorea/" rel="prev" title="专题题解 - XXI Open Cup, Grand Prix of Korea">
                  <i class="fa fa-chevron-left"></i> 专题题解 - XXI Open Cup, Grand Prix of Korea
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2023/09/29/%E4%B8%93%E9%A2%98%E9%A2%98%E8%A7%A3/XXIIOpenCupnamedafterE.V.Pankratiev,GrandPrixofPoland/" rel="next" title="专题题解 - XXII Open Cup named after E.V. Pankratiev, Grand Prix of Poland">
                  专题题解 - XXII Open Cup named after E.V. Pankratiev, Grand Prix of Poland <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ix35</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  

  <script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.2.8/pdfobject.min.js","integrity":"sha256-tu9j5pBilBQrWSDePOOajCUdz6hWsid/lBNzK4KgEPM="},"url":"/lib/pdf/web/viewer.html"}</script>
  <script src="/js/third-party/tags/pdf.js"></script>




  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.0/katex.min.css" integrity="sha256-uik/hNqHWZldXh/0K35nqOSCff9F61/ZOFReqNOBgB0=" crossorigin="anonymous">



</body>
</html>
