<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css" integrity="sha256-xejo6yLi6vGtAjcMIsY8BHdKsLg7QynVlFMzdQgUuy8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"itz-ix35.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.12.3","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":true,"show_result":true,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="https:&#x2F;&#x2F;codeforces.com&#x2F;gym&#x2F;103409">
<meta property="og:type" content="article">
<meta property="og:title" content="专题题解 - XXII Open Cup, Grand Prix of EDG">
<meta property="og:url" content="https://itz-ix35.github.io/2023/09/29/%E4%B8%93%E9%A2%98%E9%A2%98%E8%A7%A3/XXIIOpenCup,GrandPrixofEDG/index.html">
<meta property="og:site_name" content="ix35&#39;s Blog">
<meta property="og:description" content="https:&#x2F;&#x2F;codeforces.com&#x2F;gym&#x2F;103409">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-09-29T12:47:44.105Z">
<meta property="article:modified_time" content="2025-02-21T01:06:29.693Z">
<meta property="article:author" content="ix35">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://itz-ix35.github.io/2023/09/29/%E4%B8%93%E9%A2%98%E9%A2%98%E8%A7%A3/XXIIOpenCup,GrandPrixofEDG/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://itz-ix35.github.io/2023/09/29/%E4%B8%93%E9%A2%98%E9%A2%98%E8%A7%A3/XXIIOpenCup,GrandPrixofEDG/","path":"2023/09/29/专题题解/XXIIOpenCup,GrandPrixofEDG/","title":"专题题解 - XXII Open Cup, Grand Prix of EDG"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>专题题解 - XXII Open Cup, Grand Prix of EDG | ix35's Blog</title>
  






  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">ix35's Blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-essays"><a href="/essay/" rel="section"><i class="fa fa-tags fa-fw"></i>随笔选辑</a></li><li class="menu-item menu-item-game-guide"><a href="/game-guide/" rel="section"><i class="fa fa-tags fa-fw"></i>游戏攻略</a></li><li class="menu-item menu-item-game-review"><a href="/game-review/" rel="section"><i class="fa fa-tags fa-fw"></i>游戏评测</a></li><li class="menu-item menu-item-music"><a href="/music/" rel="section"><i class="fa fa-tags fa-fw"></i>音乐分享</a></li><li class="menu-item menu-item-notes"><a href="/note/" rel="section"><i class="fa fa-tags fa-fw"></i>课程笔记</a></li><li class="menu-item menu-item-solutions"><a href="/solution/" rel="section"><i class="fa fa-tags fa-fw"></i>专题题解</a></li><li class="menu-item menu-item-technology"><a href="/technology/" rel="section"><i class="fa fa-tags fa-fw"></i>科普文章</a></li><li class="menu-item menu-item-travelogue"><a href="/travel/" rel="section"><i class="fa fa-tags fa-fw"></i>远古游记</a></li><li class="menu-item menu-item-gallery"><a href="/gallery/" rel="section"><i class="fa fa-image fa-fw"></i>画廊</a></li><li class="menu-item menu-item-data"><a href="/data/" rel="section"><i class="fa fa-database fa-fw"></i>数据</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#A-A-Hero-Named-Magnus"><span class="nav-text">A. A Hero Named Magnus</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#B-A-Plus-B-Problem"><span class="nav-text">B. A Plus B Problem</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#C-AC-Automaton"><span class="nav-text">*C. AC Automaton</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#D-Assumption-is-All-You-Need"><span class="nav-text">D. Assumption is All You Need</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#E-Buy-and-Delete"><span class="nav-text">E. Buy and Delete</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#F-Illuminations-II"><span class="nav-text">F. Illuminations II</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#G-Occupy-the-Cities"><span class="nav-text">G. Occupy the Cities</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#H-Popcount-Words"><span class="nav-text">H. Popcount Words</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#I-PTSD"><span class="nav-text">I. PTSD</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#J-Suffix-Automaton"><span class="nav-text">J. Suffix Automaton</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#K-Tax"><span class="nav-text">K. Tax</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#L-Wiring-Engineering"><span class="nav-text">*L. Wiring Engineering</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="ix35"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">ix35</p>
  <div class="site-description" itemprop="description"></div>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/Itz-ix35" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Itz-ix35" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:2757336405@qq.com" title="E-Mail → mailto:2757336405@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.luogu.com.cn/user/113546" title="Luogu → https:&#x2F;&#x2F;www.luogu.com.cn&#x2F;user&#x2F;113546" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>Luogu</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://space.bilibili.com/187505795" title="Bilibili → https:&#x2F;&#x2F;space.bilibili.com&#x2F;187505795" rel="noopener" target="_blank"><i class="fab fa-youtube fa-fw"></i>Bilibili</a>
      </span>
  </div>



        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://itz-ix35.github.io/2023/09/29/%E4%B8%93%E9%A2%98%E9%A2%98%E8%A7%A3/XXIIOpenCup,GrandPrixofEDG/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="ix35">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ix35's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="专题题解 - XXII Open Cup, Grand Prix of EDG | ix35's Blog">
      <meta itemprop="description" content="https://codeforces.com/gym/103409">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          专题题解 - XXII Open Cup, Grand Prix of EDG
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-09-29 20:47:44" itemprop="dateCreated datePublished" datetime="2023-09-29T20:47:44+08:00">2023-09-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E4%B8%93%E9%A2%98%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">专题题解</span></a>
        </span>
    </span>

  
</div>

            <div class="post-description">https://codeforces.com/gym/103409</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>打 * 号表示没有写的题，暂时没来得及写。</p>
<hr>
<h3 id="A-A-Hero-Named-Magnus"><a href="#A-A-Hero-Named-Magnus" class="headerlink" title="A. A Hero Named Magnus"></a>A. A Hero Named Magnus</h3><p><strong>难度：</strong>$\bigstar$</p>
<p><strong>题目大意：</strong></p>
<p>你和某人进行 BO $n$ 的比赛，前 $x-1$ 局你都可能会输，之后你永远都赢，求 $n$ 的最小值使得你保证获胜。 </p>
<p>$1\leq x\leq 2\times 10^9$</p>
<p><strong>题目解法：</strong></p>
<p>显然答案为 $n=2\times x-1$，时间复杂度为 $O(1)$。</p>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        代码
    </div>
    <div class='spoiler-content'>
        <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line">ll t,n;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>,&amp;t);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> ii=<span class="number">1</span>;ii&lt;=t;ii++) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>,&amp;n);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,<span class="number">2</span>*n<span class="number">-1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="B-A-Plus-B-Problem"><a href="#B-A-Plus-B-Problem" class="headerlink" title="B. A Plus B Problem"></a>B. A Plus B Problem</h3><p><strong>难度：</strong>$\bigstar$</p>
<p><strong>题目大意：</strong></p>
<p>有两个 $n$ 位的可能含前导零的十进制整数 $A,B$，令 $C$ 为它们的和的末 $n$ 位，现在有 $q$ 次操作，每次修改 $A$ 或 $B$ 中的某一位，你需要输出 $C$ 中对应位的新的值，以及三个数中总共有多少数位发生了变化。</p>
<p>$1\leq n,q\leq 10^6$</p>
<p><strong>题目解法：</strong></p>
<p>考虑如何维护进位：维护所有 $A,B$ 对应位的和不为 $9$ 的位，那么一位上有没有进位就取决于上一个和不为 $9$ 的位的和是否 $\ge 10$。</p>
<p>所以我们用 set 维护这些位，就可以 $O(\log n)$ 知道某一位当前是否有前面过来的进位，以及它的进位最多能影响后面多少位。</p>
<p>时间复杂度为 $O((n+q)\log n)$。</p>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        代码
    </div>
    <div class='spoiler-content'>
        <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1000010</span>;</span><br><span class="line"><span class="type">int</span> n,q,x,y,z,a[MAXN],b[MAXN];</span><br><span class="line"><span class="type">char</span> c[MAXN];</span><br><span class="line">set &lt;<span class="type">int</span>&gt; s;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">read</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">	<span class="type">char</span> c=<span class="built_in">getchar</span>();</span><br><span class="line">	<span class="keyword">while</span> (c&lt;<span class="string">&#x27;0&#x27;</span>||c&gt;<span class="string">&#x27;9&#x27;</span>) &#123;c=<span class="built_in">getchar</span>();&#125;</span><br><span class="line">	<span class="keyword">while</span> (c&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;c&lt;=<span class="string">&#x27;9&#x27;</span>) &#123;</span><br><span class="line">		res=res*<span class="number">10</span>+c-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">		c=<span class="built_in">getchar</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;q);</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,c+<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;a[i]=c[i]-<span class="string">&#x27;0&#x27;</span>;&#125;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,c+<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;b[i]=c[i]-<span class="string">&#x27;0&#x27;</span>;&#125;</span><br><span class="line">	s.<span class="built_in">insert</span>(<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (a[i]+b[i]!=<span class="number">9</span>) &#123;s.<span class="built_in">insert</span>(i);&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	s.<span class="built_in">insert</span>(n+<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=q;i++) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;x,&amp;y,&amp;z);</span><br><span class="line">		s.<span class="built_in">erase</span>(y);</span><br><span class="line">		set&lt;<span class="type">int</span>&gt;::iterator it=s.<span class="built_in">lower_bound</span>(y);</span><br><span class="line">		<span class="type">int</span> yl=a[y]+b[y]+(a[(*it)]+b[(*it)]&gt;=<span class="number">10</span>);</span><br><span class="line">		<span class="keyword">if</span> (x==<span class="number">1</span>) &#123;a[y]=z;&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;b[y]=z;&#125;</span><br><span class="line">		<span class="type">int</span> sm=a[y]+b[y]+(a[(*it)]+b[(*it)]&gt;=<span class="number">10</span>);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,sm%<span class="number">10</span>);</span><br><span class="line">		<span class="keyword">if</span> (yl==sm) &#123;<span class="built_in">printf</span>(<span class="string">&quot;0\n&quot;</span>);&#125; </span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> ((yl&lt;<span class="number">10</span>)^(sm&lt;<span class="number">10</span>)) &#123;</span><br><span class="line">			it--;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,y+<span class="number">2</span>-<span class="built_in">max</span>(<span class="number">1</span>,(*it)));</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;<span class="built_in">printf</span>(<span class="string">&quot;2\n&quot;</span>);&#125;</span><br><span class="line">		<span class="keyword">if</span> (a[y]+b[y]!=<span class="number">9</span>) &#123;s.<span class="built_in">insert</span>(y);&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="C-AC-Automaton"><a href="#C-AC-Automaton" class="headerlink" title="*C. AC Automaton"></a>*C. AC Automaton</h3><p><strong>难度：</strong>$\bigstar\bigstar\bigstar\bigstar$</p>
<hr>
<h3 id="D-Assumption-is-All-You-Need"><a href="#D-Assumption-is-All-You-Need" class="headerlink" title="D. Assumption is All You Need"></a>D. Assumption is All You Need</h3><p><strong>难度：</strong>$\bigstar\bigstar$</p>
<p><strong>题目大意：</strong></p>
<p>给定 $1,\ldots,n$ 的排列 $A_1,\ldots,A_n$ 和 $B_1,\ldots,B_n$，一次操作可以交换 $A$ 中的一对逆序对，请判断能否通过若干次操作把 $A$ 变成 $B$，如果可以还请构造。</p>
<p>$1\leq n\leq 2021$</p>
<p><strong>题目解法：</strong></p>
<p>考虑依次将 $1,\ldots,n$ 归位。</p>
<p>比如先考虑 $1$，显然 $1$ 只能往前交换，所以 $1$ 交换之后不能到目标位置（它在 $B$ 中位置）的前面，那么我们考虑 $2$，如果 $2$ 在 $A$ 中的位置在 $1$ 之前，而又在 $1$ 的目标位置之后，那么就可以交换 $1,2$。同时，如果在某组解中没有交换 $1,2$ 而是交换了 $1,x (x&gt;2)$，那么这一操作是可以用先交换 $1,2$，再交换 $2,x$ 来代替的，所以先交换 $1,2$ 肯定不会错过可行解（也可以理解成对于其他数来说 $1,2$ 都一样，那么由于 $1$ 还在目标位置左边，那么不如就把 $2$ 尽量往后放）。</p>
<p>同理，再考虑 $1,3$，如果 $3$ 又夹在 $1$ 的当前位置和目标位置中间，就又可以交换 $1,3$，以此类推。</p>
<p>如果某一步中 $x$ 当前位置已经在目标位置左边，那么无解。</p>
<p>时间复杂度为 $O(n^2)$。</p>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        代码
    </div>
    <div class='spoiler-content'>
        <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">2022</span>;</span><br><span class="line"><span class="type">int</span> t,n,a[MAXN],b[MAXN],p[MAXN],q[MAXN];</span><br><span class="line">vector &lt; pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt; &gt; ans;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;t);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> ii=<span class="number">1</span>;ii&lt;=t;ii++) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;a[i]);p[a[i]]=i;&#125;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;b[i]);q[b[i]]=i;&#125;</span><br><span class="line">		<span class="type">int</span> flg=<span class="number">1</span>;</span><br><span class="line">		ans.<span class="built_in">clear</span>();</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (p[i]&lt;q[i]) &#123;</span><br><span class="line">				flg=<span class="number">0</span>;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> j=i+<span class="number">1</span>;j&lt;=n;j++) &#123;</span><br><span class="line">				<span class="keyword">if</span> (p[i]&gt;p[j]&amp;&amp;p[j]&gt;=q[i]) &#123;</span><br><span class="line">					ans.<span class="built_in">push_back</span>(<span class="built_in">make_pair</span>(p[j],p[i]));</span><br><span class="line">					<span class="built_in">swap</span>(p[i],p[j]);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (flg==<span class="number">0</span>) &#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;-1\n&quot;</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="type">int</span> len=ans.<span class="built_in">size</span>();</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,len);</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;i++) &#123;</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;%d %d\n&quot;</span>,ans[i].first,ans[i].second);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="E-Buy-and-Delete"><a href="#E-Buy-and-Delete" class="headerlink" title="E. Buy and Delete"></a>E. Buy and Delete</h3><p><strong>难度：</strong>$\bigstar$</p>
<p><strong>题目大意：</strong></p>
<p>给定 $n$ 个点 $m$ 条边的边带权有向图 $G$，边权为正。</p>
<p>记一个子图 $G’$ 的权值 $w(G’)$ 为：最少可以将 $G’$ 中的边拆成多少个 DAG（空图权值为 $0$）。</p>
<p>你需要选择一组边权和不超过 $C$ 的边集，使得其构成的子图权值最大，输出最大的权值。</p>
<p>$1\leq n\leq 2000, 1\leq m\leq 5000$</p>
<p><strong>题目解法：</strong></p>
<p>显然 $w(G’)\leq 2$，因为可以分成 $i<j$ 的边 $(i,j)$ 和 $i>j$ 的边 $(i,j)$ 这两种。</p>
<p>而 $w(G’)=0$ 当且仅当没有边，$w(G’)=1$ 当且仅当 $G’$ 是 DAG。</p>
<p>所以使得 $w(G’)\ge 1$ 的最小边权和是边权的最小值，使得 $w(G’)=2$ 的最小边权和是最小环的边权和。</p>
<p>用 Dijkstra 求最小环即可。</p>
<p>时间复杂度为 $O(nm\log n)$。</p>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        代码
    </div>
    <div class='spoiler-content'>
        <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">2010</span>;</span><br><span class="line"><span class="type">int</span> n,m,c,x,y,z,mn,zxh,dis[MAXN],vis[MAXN];</span><br><span class="line">vector &lt; pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt; &gt; v[MAXN];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span> <span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">	priority_queue &lt; pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt; &gt; q;</span><br><span class="line">	<span class="built_in">memset</span>(dis,<span class="number">0x3f</span>,<span class="built_in">sizeof</span>(dis));</span><br><span class="line">	<span class="built_in">memset</span>(vis,<span class="number">0</span>,<span class="built_in">sizeof</span>(vis));</span><br><span class="line">	dis[x]=<span class="number">0</span>;</span><br><span class="line">	q.<span class="built_in">push</span>(<span class="built_in">make_pair</span>(<span class="number">0</span>,x));</span><br><span class="line">	<span class="keyword">while</span> (q.<span class="built_in">size</span>()) &#123;</span><br><span class="line">		pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt; a=q.<span class="built_in">top</span>();</span><br><span class="line">		q.<span class="built_in">pop</span>();</span><br><span class="line">		<span class="keyword">if</span> (vis[a.second]) &#123;<span class="keyword">continue</span>;&#125;</span><br><span class="line">		vis[a.second]=<span class="number">1</span>;</span><br><span class="line">		<span class="type">int</span> len=v[a.second].<span class="built_in">size</span>();</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;i++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (v[a.second][i].first==x) &#123;zxh=<span class="built_in">min</span>(zxh,dis[a.second]+v[a.second][i].second);&#125;</span><br><span class="line">			<span class="keyword">if</span> (dis[v[a.second][i].first]&gt;dis[a.second]+v[a.second][i].second) &#123;</span><br><span class="line">				dis[v[a.second][i].first]=dis[a.second]+v[a.second][i].second;</span><br><span class="line">				q.<span class="built_in">push</span>(<span class="built_in">make_pair</span>(-dis[v[a.second][i].first],v[a.second][i].first));</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;n,&amp;m,&amp;c);</span><br><span class="line">	mn=zxh=c+<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;x,&amp;y,&amp;z);</span><br><span class="line">		mn=<span class="built_in">min</span>(mn,z);</span><br><span class="line">		v[x].<span class="built_in">push_back</span>(<span class="built_in">make_pair</span>(y,z));</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;<span class="built_in">solve</span>(i);&#125;</span><br><span class="line">	<span class="keyword">if</span> (c&lt;mn) &#123;<span class="built_in">printf</span>(<span class="string">&quot;0\n&quot;</span>);&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (c&lt;zxh) &#123;<span class="built_in">printf</span>(<span class="string">&quot;1\n&quot;</span>);&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;<span class="built_in">printf</span>(<span class="string">&quot;2\n&quot;</span>);&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="F-Illuminations-II"><a href="#F-Illuminations-II" class="headerlink" title="F. Illuminations II"></a>F. Illuminations II</h3><p><strong>难度：</strong>$\bigstar\bigstar$</p>
<p><strong>题目大意：</strong></p>
<p>给定一个凸 $n$ 边形和一个凸 $m$ 边形，后者完全包含在前者内部。</p>
<p>随机从 $n$ 边形的内边界选择一个点，求从这个点能看到的 $m$ 边形外边界的部分的长度期望。</p>
<p>$3\leq n,m\leq 2\times 10^5$</p>
<p><strong>题目解法：</strong></p>
<p>从 $n$ 边形上某个点能看到的 $m$ 边形外边界的部分显然是一段连续的边。</p>
<p>根据期望的线性性，转化为求出 $m$ 边形每条边能被 $n$ 边形内边界上多长的一段点看到，只需要求出两个端点即可。</p>
<p>设 $m$ 边形上一条边是 $AB$，我们只需要求出直线 $AB$ 与 $n$ 边形的两个交点即可，不妨考虑射线 $AB$，为了快速对每条边求出这个射线与 $n$ 边形的交点，可以用双指针转一圈，转化为只需要判定射线是否与 $n$ 边形的某条边相交，而这是容易的。</p>
<p>时间复杂度为 $O(n+m)$。</p>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        代码
    </div>
    <div class='spoiler-content'>
        <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">200010</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">double</span> eps=<span class="number">1e-8</span>,pi=<span class="built_in">acos</span>(<span class="number">-1.0</span>),INF=<span class="number">1e9</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Vec</span> &#123;</span><br><span class="line">	<span class="type">double</span> x,y;</span><br><span class="line">	<span class="built_in">Vec</span> () &#123;x=y=<span class="number">0.0</span>;&#125;</span><br><span class="line">	<span class="built_in">Vec</span> (<span class="type">double</span> a,<span class="type">double</span> b) &#123;x=a,y=b;&#125;</span><br><span class="line">	<span class="type">bool</span> <span class="keyword">operator</span> == (Vec b) &#123;<span class="built_in">return</span> ((<span class="built_in">fabs</span>(x-b.x)&lt;eps)&amp;&amp;(<span class="built_in">fabs</span>(y-b.y)&lt;eps));&#125;</span><br><span class="line">	<span class="type">bool</span> <span class="keyword">operator</span> != (Vec b) &#123;<span class="built_in">return</span> ((<span class="built_in">fabs</span>(x-b.x)&gt;<span class="number">0</span>)||(<span class="built_in">fabs</span>(y-b.y)&gt;<span class="number">0</span>));&#125;</span><br><span class="line">	Vec <span class="keyword">operator</span> + (Vec b) &#123;<span class="keyword">return</span> <span class="built_in">Vec</span>(x+b.x,y+b.y);&#125;</span><br><span class="line">	Vec <span class="keyword">operator</span> - (Vec b) &#123;<span class="keyword">return</span> <span class="built_in">Vec</span>(x-b.x,y-b.y);&#125;</span><br><span class="line">	Vec <span class="keyword">operator</span> - () &#123;<span class="keyword">return</span> <span class="built_in">Vec</span>(-x,-y);&#125;</span><br><span class="line">	Vec <span class="keyword">operator</span> * (<span class="type">double</span> b) &#123;<span class="keyword">return</span> <span class="built_in">Vec</span>(x*b,y*b);&#125;</span><br><span class="line">	Vec <span class="keyword">operator</span> / (<span class="type">double</span> b) &#123;<span class="keyword">return</span> <span class="built_in">Vec</span>(x/b,y/b);&#125;</span><br><span class="line">	<span class="type">double</span> <span class="keyword">operator</span> ^ (Vec b) &#123;<span class="keyword">return</span> x*b.x+y*b.y;&#125;</span><br><span class="line">	<span class="type">double</span> <span class="keyword">operator</span> * (Vec b) &#123;<span class="keyword">return</span> x*b.y-y*b.x;&#125;</span><br><span class="line">	<span class="function"><span class="type">double</span> <span class="title">len</span> <span class="params">()</span> </span>&#123;<span class="keyword">return</span> <span class="built_in">sqrt</span>(x*x+y*y);&#125;</span><br><span class="line">	<span class="function"><span class="type">double</span> <span class="title">polangle</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="type">double</span> res=<span class="built_in">atan2</span>(y,x);</span><br><span class="line">		<span class="keyword">return</span> (res&gt;=<span class="number">0</span>?res:res+<span class="number">2</span>*pi);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">quad</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (x&gt;<span class="number">0</span>&amp;&amp;y&gt;=<span class="number">0</span>) &#123;<span class="keyword">return</span> <span class="number">1</span>;&#125;</span><br><span class="line">		<span class="keyword">if</span> (x&lt;=<span class="number">0</span>&amp;&amp;y&gt;<span class="number">0</span>) &#123;<span class="keyword">return</span> <span class="number">2</span>;&#125;</span><br><span class="line">		<span class="keyword">if</span> (x&lt;<span class="number">0</span>&amp;&amp;y&lt;=<span class="number">0</span>) &#123;<span class="keyword">return</span> <span class="number">3</span>;&#125;</span><br><span class="line">		<span class="keyword">if</span> (x&gt;=<span class="number">0</span>&amp;&amp;y&lt;<span class="number">0</span>) &#123;<span class="keyword">return</span> <span class="number">4</span>;&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">Vec <span class="title">scale</span> <span class="params">(Vec c,<span class="type">double</span> t)</span> </span>&#123;<span class="keyword">return</span> c+(*<span class="keyword">this</span>-c)*t;&#125;</span><br><span class="line">	<span class="function">Vec <span class="title">rot</span> <span class="params">(Vec c,<span class="type">double</span> a)</span> </span>&#123;</span><br><span class="line">		Vec tmp=*<span class="keyword">this</span>-c;</span><br><span class="line">		<span class="keyword">return</span> c+<span class="built_in">Vec</span>(tmp.x*<span class="built_in">cos</span>(a)-tmp.y*<span class="built_in">sin</span>(a),tmp.x*<span class="built_in">sin</span>(a)+tmp.y*<span class="built_in">cos</span>(a));</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">Vec <span class="title">perp</span> <span class="params">()</span> </span>&#123;<span class="keyword">return</span> <span class="built_in">Vec</span>(-y,x);&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">input</span> <span class="params">()</span> </span>&#123;<span class="built_in">scanf</span>(<span class="string">&quot;%lf%lf&quot;</span>,&amp;x,&amp;y);&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">output</span> <span class="params">()</span> </span>&#123;<span class="built_in">printf</span>(<span class="string">&quot;(%lf,%lf)\n&quot;</span>,x,y);&#125;</span><br><span class="line">&#125;p[MAXN],q[MAXN];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Line</span> &#123;</span><br><span class="line">	Vec p,q;</span><br><span class="line">	<span class="type">double</span> agl;</span><br><span class="line">	<span class="built_in">Line</span> () &#123;p=q=<span class="built_in">Vec</span>(<span class="number">0</span>,<span class="number">0</span>),agl=<span class="number">0.0</span>;&#125;</span><br><span class="line">	<span class="built_in">Line</span> (Vec a) &#123;p=<span class="built_in">Vec</span>(<span class="number">0</span>,<span class="number">0</span>),q=a,agl=a.<span class="built_in">polangle</span>();&#125;</span><br><span class="line">	<span class="built_in">Line</span> (Vec a,Vec b) &#123;p=a,q=b,agl=(b-a).<span class="built_in">polangle</span>();&#125;</span><br><span class="line">	<span class="type">bool</span> <span class="keyword">operator</span> == (Line b) &#123;<span class="built_in">return</span> (p==b.p)&amp;&amp;(q==b.q);&#125;</span><br><span class="line">	<span class="type">bool</span> <span class="keyword">operator</span> != (Line b) &#123;<span class="built_in">return</span> (p!=b.p)||(q!=b.q);&#125;</span><br><span class="line">	<span class="function"><span class="type">double</span> <span class="title">len</span> <span class="params">()</span> </span>&#123;<span class="keyword">return</span> (q-p).<span class="built_in">len</span>();&#125;</span><br><span class="line">	<span class="function">Line <span class="title">scale</span> <span class="params">(Vec c,<span class="type">double</span> t)</span> </span>&#123;<span class="keyword">return</span> <span class="built_in">Line</span>(p.<span class="built_in">scale</span>(c,t),q.<span class="built_in">scale</span>(c,t));&#125;</span><br><span class="line">	<span class="function">Line <span class="title">rot</span> <span class="params">(<span class="type">double</span> a)</span> </span>&#123;<span class="keyword">return</span> <span class="built_in">Line</span>(p,q.<span class="built_in">rot</span>(p,a));&#125;</span><br><span class="line">	<span class="function">Vec <span class="title">norm</span> <span class="params">()</span> </span>&#123;<span class="keyword">return</span> ((q-p)/((q-p).<span class="built_in">len</span>())).<span class="built_in">perp</span>();&#125;</span><br><span class="line">	<span class="function"><span class="type">double</span> <span class="title">linedis</span> <span class="params">(Vec c)</span> </span>&#123;<span class="keyword">return</span> <span class="built_in">fabs</span>(((p-c)*(q-c))/((p-q).<span class="built_in">len</span>()));&#125;</span><br><span class="line">	<span class="function">Line <span class="title">line_perp</span> <span class="params">(Vec c)</span> </span>&#123;<span class="keyword">return</span> <span class="built_in">Line</span>(c,c+<span class="built_in">norm</span>());&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">input</span> <span class="params">()</span> </span>&#123;p.<span class="built_in">input</span>();q.<span class="built_in">input</span>();&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">output</span> <span class="params">()</span> </span>&#123;<span class="built_in">printf</span>(<span class="string">&quot;(%lf,%lf) - (%lf,%lf)\n&quot;</span>,p.x,p.y,q.x,q.y);&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Circle</span> &#123;</span><br><span class="line">	Vec c;</span><br><span class="line">	<span class="type">double</span> r;</span><br><span class="line">	<span class="built_in">Circle</span> () &#123;c=<span class="built_in">Vec</span>(<span class="number">0</span>,<span class="number">0</span>),r=<span class="number">0.0</span>;&#125;</span><br><span class="line">	<span class="built_in">Circle</span> (<span class="type">double</span> a) &#123;c=<span class="built_in">Vec</span>(<span class="number">0</span>,<span class="number">0</span>),r=a;&#125;</span><br><span class="line">	<span class="built_in">Circle</span> (Vec a,<span class="type">double</span> b) &#123;c=a,r=b;&#125;</span><br><span class="line">	<span class="type">bool</span> <span class="keyword">operator</span> == (Circle b) &#123;<span class="built_in">return</span> (c==b.c)&amp;&amp;(<span class="built_in">fabs</span>(r-b.r)&lt;eps);&#125;</span><br><span class="line">	<span class="type">bool</span> <span class="keyword">operator</span> != (Circle b) &#123;<span class="built_in">return</span> (c!=b.c)||(<span class="built_in">fabs</span>(r-b.r)&gt;eps);&#125;</span><br><span class="line">	<span class="function"><span class="type">double</span> <span class="title">area</span> <span class="params">()</span> </span>&#123;<span class="keyword">return</span> pi*r*r;&#125;</span><br><span class="line">	<span class="function"><span class="type">double</span> <span class="title">peri</span> <span class="params">()</span> </span>&#123;<span class="keyword">return</span> <span class="number">2</span>*pi*r;&#125;</span><br><span class="line">	<span class="function"><span class="type">double</span> <span class="title">power</span> <span class="params">(Vec p)</span> </span>&#123;<span class="keyword">return</span> ((p-c).<span class="built_in">len</span>())*((p-c).<span class="built_in">len</span>())-r*r;&#125;</span><br><span class="line">	<span class="function">Line <span class="title">tagent</span> <span class="params">(Vec a)</span> </span>&#123;<span class="keyword">return</span> <span class="built_in">Line</span>(c,a).<span class="built_in">line_perp</span>(a);&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">input</span> <span class="params">()</span> </span>&#123;c.<span class="built_in">input</span>();<span class="built_in">scanf</span>(<span class="string">&quot;%lf&quot;</span>,&amp;r);&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">output</span> <span class="params">()</span> </span>&#123;<span class="built_in">printf</span>(<span class="string">&quot;(%lf,%lf,%lf)\n&quot;</span>,c.x,c.y,r);&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">sgn</span> <span class="params">(<span class="type">double</span> x)</span> </span>&#123;<span class="keyword">return</span> (x&gt;-eps?x&gt;eps:<span class="number">-1</span>);&#125;</span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">orient</span> <span class="params">(Vec a,Vec b,Vec c)</span> </span>&#123;<span class="keyword">return</span> (b-a)*(c-a);&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmpd</span> <span class="params">(Vec a,Vec b)</span> </span>&#123;<span class="keyword">return</span> (<span class="built_in">sgn</span>(a.x-b.x)?a.x&lt;b.x:a.y&lt;b.y);&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmpa</span> <span class="params">(Vec a,Vec b)</span> </span>&#123;<span class="keyword">return</span> (a.<span class="built_in">quad</span>()==b.<span class="built_in">quad</span>()?(<span class="built_in">fabs</span>(a*b)&lt;eps?a.x&lt;b.x:a*b&gt;<span class="number">0</span>):a.<span class="built_in">quad</span>()&lt;b.<span class="built_in">quad</span>());&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmpl</span> <span class="params">(Line a,Line b)</span> </span>&#123;<span class="keyword">return</span> (<span class="built_in">sgn</span>(a.agl-b.agl)?a.agl-b.agl&lt;<span class="number">0</span>:<span class="built_in">orient</span>(a.p,a.q,b.q)&gt;<span class="number">0</span>);&#125;</span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">angle</span> <span class="params">(Vec a,Vec b)</span> </span>&#123;<span class="keyword">return</span> <span class="built_in">acos</span>(a^b/a.<span class="built_in">len</span>()/b.<span class="built_in">len</span>());&#125;</span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">oriangle</span> <span class="params">(Vec a,Vec b,Vec c)</span> </span>&#123;<span class="keyword">return</span> (<span class="built_in">orient</span>(a,b,c)&gt;=<span class="number">0</span>?<span class="built_in">angle</span>(b-a,c-a):pi*<span class="number">2.0</span>-<span class="built_in">angle</span>(b-a,c-a));&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">on_line</span> <span class="params">(Line a,Vec c)</span> </span>&#123;<span class="keyword">return</span> <span class="built_in">fabs</span>((c-a.p)*(c-a.q))&lt;eps;&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">on_segment</span> <span class="params">(Line a,Vec c)</span> </span>&#123;<span class="keyword">return</span> (<span class="built_in">on_line</span>(a,c)&amp;&amp;((c-a.p)^(c-a.q))&lt;=<span class="number">0</span>);&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">on_circle</span> <span class="params">(Circle a,Vec c)</span> </span>&#123;<span class="keyword">return</span> <span class="built_in">fabs</span>(a.<span class="built_in">power</span>(c))&lt;eps;&#125;</span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">area3</span> <span class="params">(Vec a,Vec b,Vec c)</span> </span>&#123;<span class="keyword">return</span> ((b-a)*(c-a))/<span class="number">2.0</span>;&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">para</span> <span class="params">(Line a,Line b)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">fabs</span>((a.q-a.p)*(b.q-b.p))&lt;eps) &#123;<span class="keyword">return</span> <span class="number">1</span>;&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">Vec <span class="title">itsc</span> <span class="params">(Line a,Line b)</span> </span>&#123;</span><br><span class="line">	<span class="type">double</span> tmp1=<span class="built_in">area3</span>(b.p,a.p,a.q);</span><br><span class="line">	<span class="type">double</span> tmp2=<span class="built_in">area3</span>(b.q,a.p,a.q)-tmp1;</span><br><span class="line">	<span class="keyword">return</span> b.q.<span class="built_in">scale</span>(b.p,-tmp1/tmp2);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">Line <span class="title">perpbisector</span> <span class="params">(Line a)</span> </span>&#123;</span><br><span class="line">	Vec tmp=(a.p+a.q)/<span class="number">2.0</span>;</span><br><span class="line">	<span class="keyword">return</span> a.<span class="built_in">line_perp</span>(tmp);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">Line <span class="title">anglebisector</span> <span class="params">(Line a,Line b)</span> </span>&#123;</span><br><span class="line">	Vec x=a.q-a.p,y=b.q-b.p;</span><br><span class="line">	<span class="keyword">return</span> a.<span class="built_in">rot</span>(<span class="built_in">oriangle</span>(<span class="built_in">Vec</span>(<span class="number">0</span>,<span class="number">0</span>),x,y)/<span class="number">2.0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">Vec <span class="title">projection</span> <span class="params">(Line a,Vec c)</span> </span>&#123;<span class="keyword">return</span> <span class="built_in">itsc</span>(a,a.<span class="built_in">line_perp</span>(c));&#125;</span><br><span class="line"><span class="function">Vec <span class="title">axial_sym</span> <span class="params">(Line a,Vec c)</span> </span>&#123;</span><br><span class="line">	Vec tmp=<span class="built_in">projection</span>(a,c);</span><br><span class="line">	<span class="keyword">return</span> tmp*<span class="number">2.0</span>-c;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">Vec <span class="title">getoc</span> <span class="params">(Vec a,Vec b,Vec c)</span> </span>&#123;<span class="keyword">return</span> <span class="built_in">itsc</span>(<span class="built_in">perpbisector</span>(<span class="built_in">Line</span>(a,b)),<span class="built_in">perpbisector</span>(<span class="built_in">Line</span>(a,c)));&#125;</span><br><span class="line"><span class="function">Vec <span class="title">getgc</span> <span class="params">(Vec a,Vec b,Vec c)</span> </span>&#123;<span class="keyword">return</span> <span class="built_in">Vec</span>((a.x+b.x+c.x)/<span class="number">3.0</span>,(a.y+b.y+c.y)/<span class="number">3.0</span>);&#125;</span><br><span class="line"><span class="function">Vec <span class="title">getic</span> <span class="params">(Vec a,Vec b,Vec c)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">itsc</span>(<span class="built_in">anglebisector</span>(<span class="built_in">Line</span>(a,b),<span class="built_in">Line</span>(a,c)),<span class="built_in">anglebisector</span>(<span class="built_in">Line</span>(b,a),<span class="built_in">Line</span>(b,c)));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">Vec <span class="title">gethc</span> <span class="params">(Vec a,Vec b,Vec c)</span> </span>&#123;<span class="keyword">return</span> <span class="built_in">itsc</span>(<span class="built_in">Line</span>(b,c).<span class="built_in">line_perp</span>(a),<span class="built_in">Line</span>(a,b).<span class="built_in">line_perp</span>(c));&#125;</span><br><span class="line"><span class="function">Circle <span class="title">outer</span> <span class="params">(Vec a,Vec b,Vec c)</span> </span>&#123;</span><br><span class="line">	Vec d=<span class="built_in">getoc</span>(a,b,c);</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">Circle</span>(d,(d-a).<span class="built_in">len</span>());</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">Circle <span class="title">inner</span> <span class="params">(Vec a,Vec b,Vec c)</span> </span>&#123;</span><br><span class="line">	Vec d=<span class="built_in">getic</span>(a,b,c);</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">Circle</span>(d,<span class="built_in">Line</span>(a,b).<span class="built_in">linedis</span>(d));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">Vec <span class="title">inver</span> <span class="params">(Circle c,Vec a)</span> </span>&#123;</span><br><span class="line">	<span class="type">double</span> tmp=c.r/((a-c.c).<span class="built_in">len</span>());</span><br><span class="line">	<span class="keyword">return</span> a.<span class="built_in">scale</span>(c.c,tmp*tmp);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">Line <span class="title">inver</span> <span class="params">(Circle c,Circle a)</span> </span>&#123;</span><br><span class="line">	Vec t=a.c*<span class="number">2.0</span>-c.c;</span><br><span class="line">	Vec s=a.c+((t-a.c).<span class="built_in">perp</span>());</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">Line</span>(<span class="built_in">inver</span>(c,t),<span class="built_in">inver</span>(c,s));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">Circle <span class="title">inver</span> <span class="params">(Circle c,Line a)</span> </span>&#123;<span class="keyword">return</span> <span class="built_in">outer</span>(c.c,<span class="built_in">inver</span>(c,a.p),<span class="built_in">inver</span>(c,a.q));&#125;</span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">area</span> <span class="params">(Vec *a,<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">	<span class="type">double</span> res=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++) &#123;res+=a[i]*a[(i+<span class="number">1</span>)%n];&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">fabs</span>(res/<span class="number">2.0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">in_polygon</span> <span class="params">(Vec *a,<span class="type">int</span> n,Vec b)</span> </span>&#123;</span><br><span class="line">	Vec sd=<span class="built_in">Vec</span>(b.x<span class="number">-2e9</span>,b.y<span class="number">-1</span>);</span><br><span class="line">	<span class="type">int</span> cnt=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++) &#123;</span><br><span class="line">		Vec tmp=<span class="built_in">itsc</span>(<span class="built_in">Line</span>(b,sd),<span class="built_in">Line</span>(a[i],a[(i+<span class="number">1</span>)%n]));</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">on_segment</span>(<span class="built_in">Line</span>(a[i],a[(i+<span class="number">1</span>)%n]),tmp)&amp;&amp;<span class="built_in">on_segment</span>(<span class="built_in">Line</span>(b,sd),tmp)) &#123;cnt++;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> (cnt&amp;<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">convex</span> <span class="params">(Vec *a,<span class="type">int</span> n,Vec *b)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (n==<span class="number">1</span>) &#123;b[<span class="number">0</span>]=a[<span class="number">0</span>];<span class="keyword">return</span> <span class="number">1</span>;&#125;</span><br><span class="line">	<span class="built_in">sort</span>(a,a+n,cmpd);</span><br><span class="line">	<span class="type">int</span> hd=<span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++) &#123;</span><br><span class="line">		<span class="keyword">while</span> (hd&gt;<span class="number">0</span>&amp;&amp;<span class="built_in">orient</span>(b[hd<span class="number">-1</span>],b[hd],a[i])&lt;=<span class="number">0</span>) &#123;hd--;&#125;</span><br><span class="line">		b[++hd]=a[i];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> tmp=hd;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=n<span class="number">-2</span>;i&gt;=<span class="number">0</span>;i--) &#123;</span><br><span class="line">		<span class="keyword">while</span> (hd&gt;tmp&amp;&amp;<span class="built_in">orient</span>(b[hd<span class="number">-1</span>],b[hd],a[i])&lt;=<span class="number">0</span>) &#123;hd--;&#125;</span><br><span class="line">		b[++hd]=a[i];</span><br><span class="line">	&#125;</span><br><span class="line">	b[hd]=<span class="built_in">Vec</span>(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">return</span> hd;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">diameter</span> <span class="params">(Vec *a,<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (n==<span class="number">1</span>) &#123;<span class="keyword">return</span> <span class="number">0.0</span>;&#125;</span><br><span class="line">	<span class="keyword">if</span> (n==<span class="number">2</span>) &#123;<span class="keyword">return</span> (a[<span class="number">1</span>]-a[<span class="number">0</span>]).<span class="built_in">len</span>();&#125;</span><br><span class="line">	<span class="type">double</span> res=<span class="number">0.0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>,j=<span class="number">1</span>;i&lt;n;i++) &#123;</span><br><span class="line">		<span class="keyword">while</span> (<span class="built_in">orient</span>(a[i],a[(i+<span class="number">1</span>)%n],a[j])&lt;<span class="built_in">orient</span>(a[i],a[(i+<span class="number">1</span>)%n],a[(j+<span class="number">1</span>)%n])) &#123;j=(j+<span class="number">1</span>)%n;&#125;</span><br><span class="line">		res=<span class="built_in">max</span>(res,<span class="built_in">max</span>((a[j]-a[i]).<span class="built_in">len</span>(),(a[j]-a[(i+<span class="number">1</span>)%n]).<span class="built_in">len</span>()));</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">Circle <span class="title">circle_cover</span> <span class="params">(Vec *a,<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;n;i++) &#123;</span><br><span class="line">		<span class="type">int</span> j=<span class="built_in">rand</span>()%i;</span><br><span class="line">		<span class="built_in">swap</span>(a[i],a[j]);</span><br><span class="line">	&#125;</span><br><span class="line">	Circle c;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (c.<span class="built_in">power</span>(a[i])&gt;=<span class="number">0</span>) &#123;</span><br><span class="line">			c.c=a[i],c.r=<span class="number">0</span>;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">0</span>;j&lt;i;j++) &#123;</span><br><span class="line">				<span class="keyword">if</span> (c.<span class="built_in">power</span>(a[j])&gt;=<span class="number">0</span>) &#123;</span><br><span class="line">					c.c=(a[i]+a[j])/<span class="number">2.0</span>,c.r=(c.c-a[i]).<span class="built_in">len</span>();</span><br><span class="line">					<span class="keyword">for</span> (<span class="type">int</span> k=<span class="number">0</span>;k&lt;j;k++) &#123;</span><br><span class="line">						<span class="keyword">if</span> (c.<span class="built_in">power</span>(a[k])&gt;=<span class="number">0</span>) &#123;c=<span class="built_in">outer</span>(a[i],a[j],a[k]);&#125;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> n,m,cur,le[MAXN],re[MAXN];</span><br><span class="line"><span class="type">double</span> ans,sum[MAXN*<span class="number">2</span>],lt[MAXN],rt[MAXN];</span><br><span class="line"><span class="function">Vec <span class="title">chk</span> <span class="params">(Vec a,Vec b,Vec c,Vec d)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">para</span>(<span class="built_in">Line</span>(a,b),<span class="built_in">Line</span>(c,d))) &#123;<span class="keyword">return</span> <span class="built_in">Vec</span>(<span class="number">-1e10</span>,<span class="number">-1e10</span>);&#125;</span><br><span class="line">	Vec tmp=<span class="built_in">itsc</span>(<span class="built_in">Line</span>(a,b),<span class="built_in">Line</span>(c,d));</span><br><span class="line">	<span class="keyword">if</span> (((b-a)^(b-tmp))&lt;eps&amp;&amp;((tmp-c)^(tmp-d))&lt;eps) &#123;<span class="keyword">return</span> tmp;&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;<span class="keyword">return</span> <span class="built_in">Vec</span>(<span class="number">-1e10</span>,<span class="number">-1e10</span>);&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++) &#123;p[i].<span class="built_in">input</span>();&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;m;i++) &#123;q[i].<span class="built_in">input</span>();&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">chk</span>(q[<span class="number">0</span>],q[<span class="number">1</span>],p[i],p[(i+<span class="number">1</span>)%n]).x&gt;<span class="number">-5e9</span>) &#123;cur=i;<span class="keyword">break</span>;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;m;i++) &#123;</span><br><span class="line">		<span class="keyword">while</span> (<span class="built_in">chk</span>(q[i],q[(i+<span class="number">1</span>)%m],p[cur],p[(cur+<span class="number">1</span>)%n]).x&lt;<span class="number">-5e9</span>) &#123;cur=(cur+<span class="number">1</span>)%n;&#125;</span><br><span class="line">		Vec tmp=<span class="built_in">chk</span>(q[i],q[(i+<span class="number">1</span>)%m],p[cur],p[(cur+<span class="number">1</span>)%n]);</span><br><span class="line">		re[i]=cur,rt[i]=(tmp-p[cur]).<span class="built_in">len</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">chk</span>(q[<span class="number">1</span>],q[<span class="number">0</span>],p[i],p[(i+<span class="number">1</span>)%n]).x&gt;<span class="number">-5e9</span>) &#123;cur=i;<span class="keyword">break</span>;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;m;i++) &#123;</span><br><span class="line">		<span class="keyword">while</span> (<span class="built_in">chk</span>(q[(i+<span class="number">1</span>)%m],q[i],p[cur],p[(cur+<span class="number">1</span>)%n]).x&lt;<span class="number">-5e9</span>) &#123;cur=(cur+<span class="number">1</span>)%n;&#125;</span><br><span class="line">		Vec tmp=<span class="built_in">chk</span>(q[(i+<span class="number">1</span>)%m],q[i],p[cur],p[(cur+<span class="number">1</span>)%n]);</span><br><span class="line">		le[i]=cur,lt[i]=(tmp-p[(cur+<span class="number">1</span>)%n]).<span class="built_in">len</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	sum[<span class="number">0</span>]=(p[<span class="number">1</span>]-p[<span class="number">0</span>]).<span class="built_in">len</span>();</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;<span class="number">2</span>*n;i++) &#123;sum[i]=sum[i<span class="number">-1</span>]+(p[i%n]-p[(i+<span class="number">1</span>)%n]).<span class="built_in">len</span>();&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;m;i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (le[i]&gt;re[i]) &#123;re[i]+=n;&#125;</span><br><span class="line">		ans+=(sum[re[i]<span class="number">-1</span>]-sum[le[i]]+rt[i]+lt[i])*(q[i]-q[(i+<span class="number">1</span>)%m]).<span class="built_in">len</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	ans/=sum[n<span class="number">-1</span>];</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%.9f\n&quot;</span>,ans);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="G-Occupy-the-Cities"><a href="#G-Occupy-the-Cities" class="headerlink" title="G. Occupy the Cities"></a>G. Occupy the Cities</h3><p><strong>难度：</strong>$\bigstar$</p>
<p><strong>题目大意：</strong></p>
<p>给定一个长度为 $n$ 的 $\texttt{0,1}$ 串，每一步中任何一个 $\texttt{1}$ 都可以将相邻的某一个 $\texttt{0}$ 也变成 $\texttt{1}$，求最少要多少步才能使得串变成全 $\texttt{1}$。</p>
<p>$1\leq n\leq 10^6$</p>
<p><strong>题目解法：</strong></p>
<p>二分答案，从左往右贪心判定。</p>
<p>时间复杂度为 $O(n\log n)$。</p>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        代码
    </div>
    <div class='spoiler-content'>
        <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1000010</span>;</span><br><span class="line"><span class="type">int</span> t,n,cnt,a[MAXN];</span><br><span class="line"><span class="type">char</span> c[MAXN];</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">chk</span> <span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> mx=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=cnt;i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (a[i]-x&gt;mx+<span class="number">1</span>) &#123;<span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line">		<span class="keyword">if</span> (a[i]-x==mx+<span class="number">1</span>) &#123;mx=a[i]+x<span class="number">-1</span>;&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;mx=a[i]+x;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> (mx&gt;=n);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;t);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> ii=<span class="number">1</span>;ii&lt;=t;ii++) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d%s&quot;</span>,&amp;n,c+<span class="number">1</span>);</span><br><span class="line">		cnt=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (c[i]==<span class="string">&#x27;1&#x27;</span>) &#123;a[++cnt]=i;&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (cnt==n) &#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;0\n&quot;</span>);</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="type">int</span> l=<span class="number">1</span>,r=n<span class="number">-1</span>;</span><br><span class="line">		<span class="keyword">while</span> (l&lt;r) &#123;</span><br><span class="line">			<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">chk</span>(mid)) &#123;r=mid;&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;l=mid+<span class="number">1</span>;&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,l);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="H-Popcount-Words"><a href="#H-Popcount-Words" class="headerlink" title="H. Popcount Words"></a>H. Popcount Words</h3><p><strong>难度：</strong>$\bigstar\bigstar\bigstar$</p>
<p><strong>题目大意：</strong></p>
<p>定义 $s_i$ 表示 $\operatorname{popcount}(i)\bmod 2$，令 $w(l,r)$ 表示由 $s_l,\ldots,s_r$ 依次拼接成的字符串。</p>
<p>给定 $n$ 个区间 $[l_i,r_i]$，令 $S$ 是由 $w(l_1,r_1),\ldots,w(l_n,r_n)$ 依次拼接成的字符串。</p>
<p>还有 $q$ 个询问，每个询问给定字符串 $T$，求 $T$ 在 $S$ 中的出现次数。</p>
<p>$1\leq n,q\leq 10^5, 1\leq l_i,r_i\leq 10^9, 1\leq \sum |T|\leq 5\times 10^5$</p>
<p><strong>题目解法：</strong></p>
<p>这里的 $w(l,r)$ 是一个很经典的递归构造的字符串，令 $S(0,0)=\texttt{0}, S(0,1)=\texttt{1}$，然后 $S(i+1,0)=S(i,0)+S(i,1), S(i+1,1)=S(i,1)+S(i,0)$，那么 $w(l,r)$ 就可以拆分成 $O(\log r)$ 个 $S(i,j)$ 的拼接。</p>
<p>所以 $S$ 可以拆分成 $O(n\log V)$ 个 $S(i,j)$ 的拼接，其中 $V$ 是 $l_i,r_i$ 的值域。</p>
<p>建出所有模式串的 AC 自动机，那么我们只需要先预处理出所有 $S(i,j)$（只有 $O(\log V)$ 个）在 AC 自动机上运行的结果（从一个点会跳到哪个点），就可以算出 $S$ 在 AC 自动机上行进的整个过程，而由于 $S(i,j)$ 是递归定义的，所以我们可以用类似倍增的方法算出所有 $f(u,i,j)$ 表示从 AC 自动机上点 $u$ 出发走 $S(i,j)$ 这个串会走到哪里。</p>
<p>然后我们要统计答案，先算出 AC 自动机上每个点经过了几次：由于我们已经可以知道从某个点 $u$ 出发走某个 $S(i,j)$ 走了几次（记为 $g(u,i,j)$），所以我们可以将这个过程再次根据递归结构“分解”，也就是从 $g(u,i,j)$ 递推到 $g(u,0,0)$ 和 $g(u,0,1)$，也就知道每个点走了几次了。</p>
<p>然后再 Fail 树上 DP 一下得到每个串的匹配次数。</p>
<p>时间复杂度为 $O((n+\sum |T|)\log V)$。</p>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        代码
    </div>
    <div class='spoiler-content'>
        <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> GCC optimize(2, 3, <span class="string">&quot;Ofast&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> GCC target(<span class="string">&quot;avx&quot;</span>, <span class="string">&quot;avx2&quot;</span>)</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">500010</span>;</span><br><span class="line"><span class="type">int</span> n,q,l,r,tot=<span class="number">1</span>,ch[MAXN][<span class="number">2</span>],dy[MAXN],fl[MAXN],f[MAXN][<span class="number">31</span>][<span class="number">2</span>];</span><br><span class="line">ll g[MAXN][<span class="number">31</span>][<span class="number">2</span>],dp[MAXN];</span><br><span class="line"><span class="type">char</span> c[MAXN];</span><br><span class="line">vector &lt; pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt; &gt; v;</span><br><span class="line">vector &lt;<span class="type">int</span>&gt; sn[MAXN];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">lb</span> <span class="params">(<span class="type">int</span> x)</span> </span>&#123;<span class="keyword">return</span> (x&amp;(-x));&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">ppc</span> <span class="params">(<span class="type">int</span> x)</span> </span>&#123;<span class="keyword">return</span> (x==<span class="number">0</span>?<span class="number">0</span>:(<span class="built_in">ppc</span>(x-<span class="built_in">lb</span>(x))^<span class="number">1</span>));&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">glg</span> <span class="params">(<span class="type">int</span> x)</span> </span>&#123;<span class="keyword">return</span> (x==<span class="number">1</span>?<span class="number">0</span>:(<span class="built_in">glg</span>(x&gt;&gt;<span class="number">1</span>)+<span class="number">1</span>));&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">chai</span> <span class="params">(<span class="type">int</span> l,<span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">	r++;</span><br><span class="line">	<span class="keyword">while</span> (l+<span class="built_in">lb</span>(l)&lt;=r) &#123;</span><br><span class="line">		v.<span class="built_in">push_back</span>(<span class="built_in">make_pair</span>(<span class="built_in">glg</span>(<span class="built_in">lb</span>(l)),<span class="built_in">ppc</span>(l)));</span><br><span class="line">		l+=<span class="built_in">lb</span>(l);</span><br><span class="line">		<span class="comment">//cout &lt;&lt; l &lt;&lt; &quot;  &quot; &lt;&lt; r &lt;&lt; &quot;    &quot; &lt;&lt; v.back().first &lt;&lt; &quot;  &quot; &lt;&lt; v.back().second &lt;&lt; endl;</span></span><br><span class="line">	&#125;</span><br><span class="line">	stack &lt; pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt; &gt; tmp;</span><br><span class="line">	<span class="keyword">while</span> (r-<span class="built_in">lb</span>(r)&gt;=l) &#123;</span><br><span class="line">		tmp.<span class="built_in">push</span>(<span class="built_in">make_pair</span>(<span class="built_in">glg</span>(<span class="built_in">lb</span>(r)),<span class="built_in">ppc</span>(r)^<span class="number">1</span>));</span><br><span class="line">		r-=<span class="built_in">lb</span>(r);</span><br><span class="line">		<span class="comment">//cout &lt;&lt; l &lt;&lt; &quot;  &quot; &lt;&lt; r &lt;&lt; &quot;    &quot; &lt;&lt; v.back().first &lt;&lt; &quot;  &quot; &lt;&lt; v.back().second &lt;&lt; endl;</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">while</span> (tmp.<span class="built_in">size</span>()) &#123;v.<span class="built_in">push_back</span>(tmp.<span class="built_in">top</span>());tmp.<span class="built_in">pop</span>();&#125;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ins</span> <span class="params">(<span class="type">char</span>* c,<span class="type">int</span> id)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> len=<span class="built_in">strlen</span>(c+<span class="number">1</span>),p=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=len;i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (!ch[p][c[i]-<span class="string">&#x27;0&#x27;</span>]) &#123;ch[p][c[i]-<span class="string">&#x27;0&#x27;</span>]=++tot;&#125;</span><br><span class="line">		p=ch[p][c[i]-<span class="string">&#x27;0&#x27;</span>];</span><br><span class="line">	&#125;</span><br><span class="line">	dy[id]=p;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">gtfail</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	ch[<span class="number">0</span>][<span class="number">0</span>]=ch[<span class="number">0</span>][<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">	queue &lt;<span class="type">int</span>&gt; q;</span><br><span class="line">	q.<span class="built_in">push</span>(<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">while</span> (q.<span class="built_in">size</span>()) &#123;</span><br><span class="line">		<span class="type">int</span> a=q.<span class="built_in">front</span>();</span><br><span class="line">		q.<span class="built_in">pop</span>();</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">1</span>;i++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (!ch[a][i]) &#123;ch[a][i]=ch[fl[a]][i];&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;fl[ch[a][i]]=ch[fl[a]][i];q.<span class="built_in">push</span>(ch[a][i]);&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (a&gt;<span class="number">1</span>) &#123;sn[fl[a]].<span class="built_in">push_back</span>(a);&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span> <span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> len=sn[x].<span class="built_in">size</span>();</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;i++) &#123;</span><br><span class="line">		<span class="built_in">dfs</span>(sn[x][i]);</span><br><span class="line">		dp[x]+=dp[sn[x][i]];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">read</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">	<span class="type">char</span> c=<span class="built_in">getchar</span>();</span><br><span class="line">	<span class="keyword">while</span> (c&lt;<span class="string">&#x27;0&#x27;</span>||c&gt;<span class="string">&#x27;9&#x27;</span>) &#123;c=<span class="built_in">getchar</span>();&#125;</span><br><span class="line">	<span class="keyword">while</span> (c&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;c&lt;=<span class="string">&#x27;9&#x27;</span>) &#123;</span><br><span class="line">		res=res*<span class="number">10</span>+c-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">		c=<span class="built_in">getchar</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">write</span> <span class="params">(ll x)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (x&lt;=<span class="number">9</span>) &#123;<span class="built_in">putchar</span>(x+<span class="string">&#x27;0&#x27;</span>);<span class="keyword">return</span>;&#125;</span><br><span class="line">	<span class="built_in">write</span>(x/<span class="number">10</span>);</span><br><span class="line">	<span class="built_in">putchar</span>(x%<span class="number">10</span>+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	n=<span class="built_in">read</span>();</span><br><span class="line">	q=<span class="built_in">read</span>();</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		l=<span class="built_in">read</span>();</span><br><span class="line">		r=<span class="built_in">read</span>();</span><br><span class="line">		<span class="built_in">chai</span>(l,r);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=q;i++) &#123;</span><br><span class="line">		cin &gt;&gt; c+<span class="number">1</span>;</span><br><span class="line">		<span class="built_in">ins</span>(c,i);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">gtfail</span>();</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=tot;i++) &#123;</span><br><span class="line">		f[i][<span class="number">0</span>][<span class="number">0</span>]=ch[i][<span class="number">0</span>],f[i][<span class="number">0</span>][<span class="number">1</span>]=ch[i][<span class="number">1</span>];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">29</span>;i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">1</span>;j&lt;=tot;j++) &#123;</span><br><span class="line">			f[j][i][<span class="number">0</span>]=f[f[j][i<span class="number">-1</span>][<span class="number">0</span>]][i<span class="number">-1</span>][<span class="number">1</span>];</span><br><span class="line">			f[j][i][<span class="number">1</span>]=f[f[j][i<span class="number">-1</span>][<span class="number">1</span>]][i<span class="number">-1</span>][<span class="number">0</span>];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> len=v.<span class="built_in">size</span>(),cur=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;i++) &#123;</span><br><span class="line">		g[cur][v[i].first][v[i].second]++;</span><br><span class="line">		cur=f[cur][v[i].first][v[i].second];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">29</span>;i&gt;=<span class="number">1</span>;i--) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">1</span>;j&lt;=tot;j++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (g[j][i][<span class="number">0</span>]) &#123;</span><br><span class="line">				g[j][i<span class="number">-1</span>][<span class="number">0</span>]+=g[j][i][<span class="number">0</span>],g[f[j][i<span class="number">-1</span>][<span class="number">0</span>]][i<span class="number">-1</span>][<span class="number">1</span>]+=g[j][i][<span class="number">0</span>];</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (g[j][i][<span class="number">1</span>]) &#123;</span><br><span class="line">				g[j][i<span class="number">-1</span>][<span class="number">1</span>]+=g[j][i][<span class="number">1</span>],g[f[j][i<span class="number">-1</span>][<span class="number">1</span>]][i<span class="number">-1</span>][<span class="number">0</span>]+=g[j][i][<span class="number">1</span>];</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=tot;i++) &#123;dp[ch[i][<span class="number">0</span>]]+=g[i][<span class="number">0</span>][<span class="number">0</span>],dp[ch[i][<span class="number">1</span>]]+=g[i][<span class="number">0</span>][<span class="number">1</span>];&#125;</span><br><span class="line">	<span class="built_in">dfs</span>(<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=q;i++) &#123;<span class="built_in">write</span>(dp[dy[i]]);<span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="I-PTSD"><a href="#I-PTSD" class="headerlink" title="I. PTSD"></a>I. PTSD</h3><p><strong>难度：</strong>$\bigstar$</p>
<p><strong>题目大意：</strong></p>
<p>给定长度为 $n$ 的 $\texttt{0,1}$ 串 $S$，你要将 $\{1,\ldots,n\}$ 划分成若干个子集，使得所有满足 $S_i=\texttt{1}$ 且 $i$ 在其所属子集中为次大值的 $i$ 之和最大。</p>
<p>$1\leq n\leq 10^6$</p>
<p><strong>题目解法：</strong></p>
<p>从大到小贪心，维护当前还剩几个可以作为最大值的数，如果还有这样的数且当前位为 $1$，就将它们分入一个集合，否则就将当前数也加入可以作为最大值的候选。</p>
<p>时间复杂度为 $O(n)$。</p>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        代码
    </div>
    <div class='spoiler-content'>
        <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1000010</span>;</span><br><span class="line">ll t,n,ans,lft;</span><br><span class="line"><span class="type">char</span> c[MAXN];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>,&amp;t);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> ii=<span class="number">1</span>;ii&lt;=t;ii++) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%lld%s&quot;</span>,&amp;n,c+<span class="number">1</span>);</span><br><span class="line">		ans=lft=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=n;i&gt;=<span class="number">1</span>;i--) &#123;</span><br><span class="line">			<span class="keyword">if</span> (lft&amp;&amp;c[i]==<span class="string">&#x27;1&#x27;</span>) &#123;</span><br><span class="line">				lft--,ans+=i;</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				lft++;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="J-Suffix-Automaton"><a href="#J-Suffix-Automaton" class="headerlink" title="J. Suffix Automaton"></a>J. Suffix Automaton</h3><p><strong>难度：</strong>$\bigstar\bigstar$</p>
<p><strong>题目大意：</strong></p>
<p>给定字符串 $S$，将所有 $S$ 的本质不同非空子串按长度为第一关键字，字典序为第二关键字排序，$q$ 次询问其中第 $k$ 个子串是什么（输出最前一次出现的左右端点）。</p>
<p>$1\leq |S|,q\leq 10^6$</p>
<p><strong>题目解法：</strong></p>
<p>本题用后缀数组处理更为直观一些。</p>
<p>预处理后缀数组，考虑将 height 数组按值排序，离线询问，三者（询问值，height 值和子串长度）同时从小到大考虑。</p>
<p>假设当前考虑到了长度为 $i$ 的子串，我们维护长度小于 $i$ 的子串数量，还维护所有长度为 $i$ 的不同子串在后缀数组中的首次出现位置，于是我们就只需要快速求出其中的第 $k$ 小，用一个维护第 $k$ 小值的倍增树状数组即可，而求出最前一次出现的左右端点只需要利用一个建立在后缀数组上的查询最小值的 ST 表即可实现。</p>
<p>时间复杂度为 $O((|S|+q)\log |S|)$。</p>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        代码
    </div>
    <div class='spoiler-content'>
        <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1000010</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Query</span> &#123;</span><br><span class="line">	<span class="type">int</span> id,ansl,ansr;</span><br><span class="line">	ll k;</span><br><span class="line">&#125;q[MAXN];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Event</span> &#123;</span><br><span class="line">	<span class="type">int</span> p,v;</span><br><span class="line">&#125;e[MAXN];</span><br><span class="line"><span class="type">int</span> n,qu,cura,curb,sa[MAXN],rk[MAXN],zz[MAXN],buc[MAXN],sec[MAXN],h[MAXN];</span><br><span class="line"><span class="type">int</span> lg[MAXN],fw[MAXN],st[MAXN][<span class="number">21</span>];</span><br><span class="line"><span class="type">char</span> c[MAXN];</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp1</span> <span class="params">(Query a,Query b)</span> </span>&#123;<span class="keyword">return</span> a.k&lt;b.k;&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp2</span> <span class="params">(Query a,Query b)</span> </span>&#123;<span class="keyword">return</span> a.id&lt;b.id;&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp3</span> <span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span> </span>&#123;<span class="keyword">return</span> c[a]&lt;c[b];&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp4</span> <span class="params">(Event a,Event b)</span> </span>&#123;<span class="keyword">return</span> a.v&lt;b.v;&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">bucsort</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="built_in">max</span>(n,<span class="number">26</span>);i++) &#123;buc[i]=<span class="number">0</span>;&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;buc[rk[i]]++;&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="built_in">max</span>(n,<span class="number">26</span>);i++) &#123;buc[i]+=buc[i<span class="number">-1</span>];&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=n;i&gt;=<span class="number">1</span>;i--) &#123;rk[sec[i]]=buc[rk[sec[i]]]--;&#125;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">getsa</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;rk[i]=c[i]-<span class="string">&#x27;a&#x27;</span>+<span class="number">1</span>;&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;sa[i]=i;&#125;</span><br><span class="line">	<span class="built_in">sort</span>(sa+<span class="number">1</span>,sa+n+<span class="number">1</span>,cmp3);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">19</span>;i++) &#123;</span><br><span class="line">		<span class="type">int</span> tmp=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=n;j&gt;=n-(<span class="number">1</span>&lt;&lt;i)+<span class="number">1</span>;j--) &#123;sec[++tmp]=j;&#125;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">1</span>;<span class="built_in">j</span>&lt;=n;j++) &#123;</span><br><span class="line">			zz[j]=rk[j];</span><br><span class="line">			<span class="keyword">if</span> (sa[j]&gt;(<span class="number">1</span>&lt;&lt;i)) &#123;sec[++tmp]=sa[j]-(<span class="number">1</span>&lt;&lt;i);&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">bucsort</span>();</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">1</span>;j&lt;=n;j++) &#123;sa[rk[j]]=j;&#125;</span><br><span class="line">		tmp=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">1</span>;j&lt;=n;j++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (j==<span class="number">1</span>||zz[sa[j]]!=zz[sa[j<span class="number">-1</span>]]||zz[sa[j]+(<span class="number">1</span>&lt;&lt;i)]!=zz[sa[j<span class="number">-1</span>]+(<span class="number">1</span>&lt;&lt;i)]) &#123;tmp++;&#125;</span><br><span class="line">			rk[sa[j]]=tmp;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">querymn</span> <span class="params">(<span class="type">int</span> l,<span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> k=lg[r-l+<span class="number">1</span>];</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">min</span>(st[l][k],st[r-(<span class="number">1</span>&lt;&lt;k)+<span class="number">1</span>][k]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">modify</span> <span class="params">(<span class="type">int</span> x,<span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=x;i&lt;=n+<span class="number">1</span>;i+=(i&amp;(-i))) &#123;fw[i]+=v;&#125;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">kth</span> <span class="params">(<span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> tmp=<span class="number">0</span>,sum=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">19</span>;i&gt;=<span class="number">0</span>;i--) &#123;</span><br><span class="line">		<span class="keyword">if</span> (tmp+(<span class="number">1</span>&lt;&lt;i)&lt;=n+<span class="number">1</span>&amp;&amp;sum+fw[tmp+(<span class="number">1</span>&lt;&lt;i)]&lt;k) &#123;</span><br><span class="line">			sum+=fw[tmp+(<span class="number">1</span>&lt;&lt;i)];</span><br><span class="line">			tmp+=(<span class="number">1</span>&lt;&lt;i);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> tmp+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%s%d&quot;</span>,c+<span class="number">1</span>,&amp;qu);</span><br><span class="line">	n=<span class="built_in">strlen</span>(c+<span class="number">1</span>);</span><br><span class="line">	<span class="built_in">getsa</span>();</span><br><span class="line">	<span class="type">int</span> cur=<span class="number">0</span>;</span><br><span class="line">	lg[<span class="number">0</span>]=<span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		lg[i]=lg[i&gt;&gt;<span class="number">1</span>]+<span class="number">1</span>,st[i][<span class="number">0</span>]=sa[i];</span><br><span class="line">		<span class="keyword">if</span> (rk[i]==<span class="number">1</span>) &#123;h[rk[i]]=cur=<span class="number">0</span>;&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">while</span> (i+cur&lt;=n&amp;&amp;sa[rk[i]<span class="number">-1</span>]+cur&lt;=n&amp;&amp;c[i+cur]==c[sa[rk[i]<span class="number">-1</span>]+cur]) &#123;cur++;&#125;</span><br><span class="line">			h[rk[i]]=cur;</span><br><span class="line">			cur=<span class="built_in">max</span>(<span class="number">0</span>,cur<span class="number">-1</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">20</span>;i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">1</span>;j+(<span class="number">1</span>&lt;&lt;i)<span class="number">-1</span>&lt;=n;j++) &#123;st[j][i]=<span class="built_in">min</span>(st[j][i<span class="number">-1</span>],st[j+(<span class="number">1</span>&lt;&lt;(i<span class="number">-1</span>))][i<span class="number">-1</span>]);&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">2</span>;i&lt;=n;i++) &#123;e[i<span class="number">-1</span>].p=i,e[i<span class="number">-1</span>].v=h[i];&#125;</span><br><span class="line">	<span class="built_in">sort</span>(e+<span class="number">1</span>,e+n,cmp4);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=qu;i++) &#123;<span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>,&amp;q[i].k);q[i].id=i;&#125;</span><br><span class="line">	<span class="built_in">sort</span>(q+<span class="number">1</span>,q+qu+<span class="number">1</span>,cmp1);</span><br><span class="line">	cura=curb=<span class="number">1</span>;</span><br><span class="line">	ll nw=<span class="number">0</span>,al=<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">modify</span>(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">	<span class="built_in">modify</span>(n+<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		<span class="comment">//cout &lt;&lt; i &lt;&lt; endl;</span></span><br><span class="line">		<span class="keyword">if</span> (i&gt;<span class="number">1</span>) &#123;</span><br><span class="line">			al--;</span><br><span class="line">			<span class="built_in">modify</span>(rk[n-i+<span class="number">2</span>],<span class="number">-1</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">while</span> (cura&lt;=n<span class="number">-1</span>&amp;&amp;e[cura].v&lt;i) &#123;<span class="built_in">modify</span>(e[cura++].p,<span class="number">1</span>);al++;&#125;</span><br><span class="line">		<span class="keyword">while</span> (curb&lt;=qu&amp;&amp;q[curb].k&lt;=nw+al) &#123;</span><br><span class="line">			<span class="type">int</span> tmp=q[curb].k-nw;</span><br><span class="line">			<span class="type">int</span> tmpa=<span class="built_in">kth</span>(tmp),tmpb=<span class="built_in">kth</span>(tmp+<span class="number">1</span>);</span><br><span class="line">			<span class="comment">//cout &lt;&lt; curb &lt;&lt; &quot;  &quot; &lt;&lt; q[curb].k &lt;&lt; &quot;  &quot; &lt;&lt; nw &lt;&lt; &quot;  &quot; &lt;&lt; </span></span><br><span class="line">			<span class="comment">//al &lt;&lt; &quot;  &quot; &lt;&lt; i &lt;&lt; &quot;  &quot; &lt;&lt; tmp &lt;&lt; &quot;  &quot; &lt;&lt; tmpa &lt;&lt; &quot;  &quot; &lt;&lt; tmpb &lt;&lt; endl;</span></span><br><span class="line">			q[curb].ansl=<span class="built_in">querymn</span>(tmpa,tmpb<span class="number">-1</span>);</span><br><span class="line">			q[curb].ansr=q[curb].ansl+i<span class="number">-1</span>;</span><br><span class="line">			curb++;</span><br><span class="line">		&#125;</span><br><span class="line">		nw+=al;</span><br><span class="line">		<span class="comment">//cout &lt;&lt; i &lt;&lt; &quot;  &quot; &lt;&lt; al &lt;&lt; &quot;  &quot; &lt;&lt; nw &lt;&lt; endl;</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">while</span> (curb&lt;=qu) &#123;</span><br><span class="line">		q[curb].ansl=q[curb].ansr=<span class="number">-1</span>;</span><br><span class="line">		curb++;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">sort</span>(q+<span class="number">1</span>,q+qu+<span class="number">1</span>,cmp2);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=qu;i++) &#123;<span class="built_in">printf</span>(<span class="string">&quot;%d %d\n&quot;</span>,q[i].ansl,q[i].ansr);&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="K-Tax"><a href="#K-Tax" class="headerlink" title="K. Tax"></a>K. Tax</h3><p><strong>难度：</strong>$\bigstar\bigstar\bigstar$</p>
<p><strong>题目大意：</strong></p>
<p>给定一个 $n$ 个点 $m$ 条边的无向图，任意两个点间至多有一条边，每条边有颜色 $c_i$，第 $x$ 次经过颜色 $c_i$ 的边需要支付 $x\times w_i$ 的钱。</p>
<p>对于每个 $i\in [2,n]$，求出从 $1$ 到 $i$ 走一条最短路，至少需要支付多少钱。</p>
<p>$1\leq n\leq 50$</p>
<p><strong>题目解法：</strong></p>
<p>首先求出以 $1$ 出发的最短路 DAG，由于这是分层 DAG，且只有 $50$ 个点，所以可以算出路径数量非常少，直接暴搜即可。</p>
<p>实际上感觉非常不好想。</p>
<p>时间复杂度大约为 $O(3^{\frac{n}{3}})$。</p>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        代码
    </div>
    <div class='spoiler-content'>
        <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">60</span>;</span><br><span class="line"><span class="type">int</span> n,m,x,y,z,w[MAXN*MAXN],dis[MAXN],ans[MAXN],cnt[MAXN*MAXN],c[MAXN][MAXN];</span><br><span class="line">vector &lt;<span class="type">int</span>&gt; v[MAXN],v2[MAXN];</span><br><span class="line">queue &lt;<span class="type">int</span>&gt; q;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span> <span class="params">(<span class="type">int</span> x,<span class="type">int</span> cs)</span> </span>&#123;</span><br><span class="line">	ans[x]=<span class="built_in">min</span>(ans[x],cs);</span><br><span class="line">	<span class="type">int</span> len=v2[x].<span class="built_in">size</span>();</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;i++) &#123;</span><br><span class="line">		<span class="type">int</span> tmp=c[x][v2[x][i]];</span><br><span class="line">		<span class="built_in">dfs</span>(v2[x][i],cs+w[tmp]*(++cnt[tmp]));</span><br><span class="line">		cnt[tmp]--;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++) &#123;<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;w[i]);&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;x,&amp;y,&amp;z);</span><br><span class="line">		c[x][y]=c[y][x]=z;</span><br><span class="line">		v[x].<span class="built_in">push_back</span>(y),v[y].<span class="built_in">push_back</span>(x);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">memset</span>(dis,<span class="number">0x3f</span>,<span class="built_in">sizeof</span>(dis));</span><br><span class="line">	<span class="built_in">memset</span>(ans,<span class="number">0x3f</span>,<span class="built_in">sizeof</span>(ans));</span><br><span class="line">	q.<span class="built_in">push</span>(<span class="number">1</span>);</span><br><span class="line">	dis[<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span> (q.<span class="built_in">size</span>()) &#123;</span><br><span class="line">		<span class="type">int</span> a=q.<span class="built_in">front</span>();</span><br><span class="line">		q.<span class="built_in">pop</span>();</span><br><span class="line">		<span class="type">int</span> len=v[a].<span class="built_in">size</span>();</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;i++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (dis[v[a][i]]==<span class="number">0x3f3f3f3f</span>) &#123;</span><br><span class="line">				dis[v[a][i]]=dis[a]+<span class="number">1</span>;</span><br><span class="line">				q.<span class="built_in">push</span>(v[a][i]);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">1</span>;j&lt;=n;j++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (c[i][j]&amp;&amp;dis[j]==dis[i]+<span class="number">1</span>) &#123;</span><br><span class="line">				v2[i].<span class="built_in">push_back</span>(j);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">dfs</span>(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">2</span>;i&lt;=n;i++) &#123;<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans[i]);&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="L-Wiring-Engineering"><a href="#L-Wiring-Engineering" class="headerlink" title="*L. Wiring Engineering"></a>*L. Wiring Engineering</h3><p><strong>难度：</strong>$\bigstar\bigstar\bigstar$</p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>
    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2023/09/29/%E4%B8%93%E9%A2%98%E9%A2%98%E8%A7%A3/XXIIOpenCupnamedafterE.V.Pankratiev,GrandPrixofPoland/" rel="prev" title="专题题解 - XXII Open Cup named after E.V. Pankratiev, Grand Prix of Poland">
                  <i class="fa fa-chevron-left"></i> 专题题解 - XXII Open Cup named after E.V. Pankratiev, Grand Prix of Poland
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2023/09/29/%E7%A7%91%E6%99%AE%E6%96%87%E7%AB%A0/%E5%8D%95%E4%BD%8D%E8%92%99%E6%97%A5%E7%9F%A9%E9%98%B5%E4%B9%98%E6%B3%95/" rel="next" title="科普文章 - 单位蒙日矩阵乘法">
                  科普文章 - 单位蒙日矩阵乘法 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ix35</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  

  <script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.2.8/pdfobject.min.js","integrity":"sha256-tu9j5pBilBQrWSDePOOajCUdz6hWsid/lBNzK4KgEPM="},"url":"/lib/pdf/web/viewer.html"}</script>
  <script src="/js/third-party/tags/pdf.js"></script>




  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.0/katex.min.css" integrity="sha256-uik/hNqHWZldXh/0K35nqOSCff9F61/ZOFReqNOBgB0=" crossorigin="anonymous">



</body>
</html>
