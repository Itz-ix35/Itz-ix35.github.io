<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css" integrity="sha256-xejo6yLi6vGtAjcMIsY8BHdKsLg7QynVlFMzdQgUuy8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"itz-ix35.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.12.3","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":true,"show_result":true,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="https:&#x2F;&#x2F;qoj.ac&#x2F;contest&#x2F;986">
<meta property="og:type" content="article">
<meta property="og:title" content="专题题解 - IOI 2022">
<meta property="og:url" content="https://itz-ix35.github.io/2023/09/29/%E4%B8%93%E9%A2%98%E9%A2%98%E8%A7%A3/IOI2022/index.html">
<meta property="og:site_name" content="ix35&#39;s Blog">
<meta property="og:description" content="https:&#x2F;&#x2F;qoj.ac&#x2F;contest&#x2F;986">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.luogu.com.cn/upload/image_hosting/13skltjt.png">
<meta property="og:image" content="https://cdn.luogu.com.cn/upload/image_hosting/04jh6u5y.png">
<meta property="og:image" content="https://cdn.luogu.com.cn/upload/image_hosting/70fvbft8.png">
<meta property="article:published_time" content="2023-09-29T12:47:44.087Z">
<meta property="article:modified_time" content="2025-02-21T01:01:29.410Z">
<meta property="article:author" content="ix35">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.luogu.com.cn/upload/image_hosting/13skltjt.png">


<link rel="canonical" href="https://itz-ix35.github.io/2023/09/29/%E4%B8%93%E9%A2%98%E9%A2%98%E8%A7%A3/IOI2022/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://itz-ix35.github.io/2023/09/29/%E4%B8%93%E9%A2%98%E9%A2%98%E8%A7%A3/IOI2022/","path":"2023/09/29/专题题解/IOI2022/","title":"专题题解 - IOI 2022"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>专题题解 - IOI 2022 | ix35's Blog</title>
  






  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">ix35's Blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-essays"><a href="/essay/" rel="section"><i class="fa fa-tags fa-fw"></i>随笔选辑</a></li><li class="menu-item menu-item-game-guide"><a href="/game-guide/" rel="section"><i class="fa fa-tags fa-fw"></i>游戏攻略</a></li><li class="menu-item menu-item-game-review"><a href="/game-review/" rel="section"><i class="fa fa-tags fa-fw"></i>游戏评测</a></li><li class="menu-item menu-item-music"><a href="/music/" rel="section"><i class="fa fa-tags fa-fw"></i>音乐分享</a></li><li class="menu-item menu-item-notes"><a href="/note/" rel="section"><i class="fa fa-tags fa-fw"></i>课程笔记</a></li><li class="menu-item menu-item-solutions"><a href="/solution/" rel="section"><i class="fa fa-tags fa-fw"></i>专题题解</a></li><li class="menu-item menu-item-technology"><a href="/technology/" rel="section"><i class="fa fa-tags fa-fw"></i>科普文章</a></li><li class="menu-item menu-item-travelogue"><a href="/travel/" rel="section"><i class="fa fa-tags fa-fw"></i>远古游记</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#IOI-2022-D1T1-Fish"><span class="nav-text">IOI 2022 D1T1 Fish</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%A7%E6%84%8F%EF%BC%9A"><span class="nav-text">题目大意：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A"><span class="nav-text">题解：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#IOI-2022-D1T2-Prison"><span class="nav-text">IOI 2022 D1T2 Prison</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%A7%E6%84%8F%EF%BC%9A-1"><span class="nav-text">题目大意：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-1"><span class="nav-text">题解：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#IOI-2022-D1T3-Towers"><span class="nav-text">IOI 2022 D1T3 Towers</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%A7%E6%84%8F%EF%BC%9A-2"><span class="nav-text">题目大意：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-2"><span class="nav-text">题解：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#IOI-2022-D2T1-Circuit"><span class="nav-text">IOI 2022 D2T1 Circuit</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%A7%E6%84%8F%EF%BC%9A-3"><span class="nav-text">题目大意：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-3"><span class="nav-text">题解：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#IOI-2022-D2T2-Insects"><span class="nav-text">IOI 2022 D2T2 Insects</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%A7%E6%84%8F%EF%BC%9A-4"><span class="nav-text">题目大意：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-4"><span class="nav-text">题解：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#IOI-2022-D2T3-Islands"><span class="nav-text">IOI 2022 D2T3 Islands</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%A7%E6%84%8F%EF%BC%9A-5"><span class="nav-text">题目大意：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-5"><span class="nav-text">题解：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%94%90%E8%AF%84%E7%8E%AF%E8%8A%82"><span class="nav-text">锐评环节</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="ix35"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">ix35</p>
  <div class="site-description" itemprop="description"></div>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/Itz-ix35" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Itz-ix35" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:2757336405@qq.com" title="E-Mail → mailto:2757336405@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.luogu.com.cn/user/113546" title="Luogu → https:&#x2F;&#x2F;www.luogu.com.cn&#x2F;user&#x2F;113546" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>Luogu</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://space.bilibili.com/187505795" title="Bilibili → https:&#x2F;&#x2F;space.bilibili.com&#x2F;187505795" rel="noopener" target="_blank"><i class="fab fa-youtube fa-fw"></i>Bilibili</a>
      </span>
  </div>



        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://itz-ix35.github.io/2023/09/29/%E4%B8%93%E9%A2%98%E9%A2%98%E8%A7%A3/IOI2022/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="ix35">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ix35's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="专题题解 - IOI 2022 | ix35's Blog">
      <meta itemprop="description" content="https://qoj.ac/contest/986">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          专题题解 - IOI 2022
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-09-29 20:47:44" itemprop="dateCreated datePublished" datetime="2023-09-29T20:47:44+08:00">2023-09-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E4%B8%93%E9%A2%98%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">专题题解</span></a>
        </span>
    </span>

  
</div>

            <div class="post-description">https://qoj.ac/contest/986</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h2 id="IOI-2022-D1T1-Fish"><a href="#IOI-2022-D1T1-Fish" class="headerlink" title="IOI 2022 D1T1 Fish"></a>IOI 2022 D1T1 Fish</h2><h3 id="题目大意："><a href="#题目大意：" class="headerlink" title="题目大意："></a>题目大意：</h3><p>有一个 $N\times N$ 的网格，其中的 $M$ 个位置有垒球，第 $i$ 个垒球的位置为 $(x_i,y_i)$，重量为 $w_i$。</p>
<p>你可以为每一列 $c$ 选择一个前缀的行 $1,2,\ldots,\ldots,r_c$ 修建长堤，这样 $(1,c),(2,c),\ldots,(r_c,c)$ 这些位置就会被长堤覆盖。</p>
<p>如果一个垒球的位置没有被长堤覆盖，且其左右相邻的位置至少有一个被长堤覆盖，那么就会有一个 ix35 走到长堤上捡起这个垒球，即如果垒球的位置为 $(x,y)$，它能被捡起当且仅当 $(x,y)$ 未被长堤覆盖且 $(x,y-1),(x,y+1)$ 至少有一个被长堤覆盖。</p>
<p>求最多能捡起总重多少的垒球。</p>
<p>$N\leq 10^5, M\leq 3\times 10^5$</p>
<h3 id="题解："><a href="#题解：" class="headerlink" title="题解："></a>题解：</h3><p>假设 $r_{c-1}<r_c>r_{c+1}$，那么第 $c$ 列的垒球都不能被捡起，所以不如直接把第 $c$ 列修到顶，即 $r_c$ 可以改为 $N$。</p>
<p>假设 $r_{c-1}&gt;r_c&lt;r_{c+1}$，那么第 $c$ 列不如不修，所以 $r_c$ 可以改为 $0$。</p>
<p>于是我们观察长堤的形状，发现修建了长堤的列可以分成若干连续段，每一段内 $r_c$ 先递增后递减。</p>
<p>据此容易写出 DP，时间复杂度为 $O(M\log M+N)$。</p>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        代码
    </div>
    <div class='spoiler-content'>
        <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;fish.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">300010</span>;</span><br><span class="line"><span class="type">int</span> x[N],y[N],w[N];</span><br><span class="line">ll dp[N][<span class="number">2</span>],f[N],g[N];</span><br><span class="line">vector &lt;<span class="type">int</span>&gt; v[N];</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span> <span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span> </span>&#123;<span class="keyword">return</span> y[a]&lt;y[b];&#125;</span><br><span class="line"><span class="function">ll <span class="title">max_weights</span> <span class="params">(<span class="type">int</span> n,<span class="type">int</span> m,vector &lt;<span class="type">int</span>&gt; X,vector &lt;<span class="type">int</span>&gt; Y,vector &lt;<span class="type">int</span>&gt; W)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;m;i++) &#123;x[i+<span class="number">1</span>]=X[i]+<span class="number">1</span>,y[i+<span class="number">1</span>]=Y[i],w[i+<span class="number">1</span>]=W[i];v[X[i]+<span class="number">1</span>].<span class="built_in">push_back</span>(i+<span class="number">1</span>);&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		f[i]=g[i]=<span class="built_in">max</span>(f[i<span class="number">-1</span>],g[i<span class="number">-1</span>]);</span><br><span class="line">		<span class="built_in">sort</span>(v[i].<span class="built_in">begin</span>(),v[i].<span class="built_in">end</span>(),cmp);</span><br><span class="line">		<span class="type">int</span> l1=v[i<span class="number">-1</span>].<span class="built_in">size</span>(),l2=v[i].<span class="built_in">size</span>(),c1=l1;</span><br><span class="line">		ll mx=<span class="built_in">max</span>(f[i<span class="number">-2</span>],g[i<span class="number">-2</span>]);</span><br><span class="line">		<span class="keyword">if</span> (i!=<span class="number">1</span>) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> j=l2<span class="number">-1</span>;j&gt;=<span class="number">0</span>;j--) &#123;</span><br><span class="line">				<span class="keyword">if</span> (j&lt;l2<span class="number">-1</span>) &#123;dp[v[i][j]][<span class="number">0</span>]=dp[v[i][j+<span class="number">1</span>]][<span class="number">0</span>]+w[v[i][j]];&#125;</span><br><span class="line">				<span class="keyword">while</span> (c1&amp;&amp;y[v[i<span class="number">-1</span>][c1<span class="number">-1</span>]]&gt;y[v[i][j]]) &#123;mx=<span class="built_in">max</span>(mx,dp[v[i<span class="number">-1</span>][--c1]][<span class="number">0</span>]);&#125;</span><br><span class="line">				dp[v[i][j]][<span class="number">0</span>]=<span class="built_in">max</span>(dp[v[i][j]][<span class="number">0</span>],mx+w[v[i][j]]);</span><br><span class="line">				f[i]=<span class="built_in">max</span>(f[i],dp[v[i][j]][<span class="number">0</span>]);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		c1=<span class="number">0</span>,mx=f[i<span class="number">-1</span>];</span><br><span class="line">		<span class="keyword">if</span> (i!=n) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">0</span>;j&lt;l2;j++)  &#123;</span><br><span class="line">				<span class="keyword">if</span> (j) &#123;dp[v[i][j]][<span class="number">1</span>]=dp[v[i][j<span class="number">-1</span>]][<span class="number">1</span>]+w[v[i][j]];&#125;</span><br><span class="line">				<span class="keyword">while</span> (c1&lt;l1&amp;&amp;y[v[i<span class="number">-1</span>][c1]]&lt;y[v[i][j]]) &#123;mx=<span class="built_in">max</span>(mx,dp[v[i<span class="number">-1</span>][c1++]][<span class="number">1</span>]);&#125;</span><br><span class="line">				dp[v[i][j]][<span class="number">1</span>]=<span class="built_in">max</span>(dp[v[i][j]][<span class="number">1</span>],mx+w[v[i][j]]);</span><br><span class="line">				g[i]=<span class="built_in">max</span>(g[i],dp[v[i][j]][<span class="number">1</span>]);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	ll res=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++) &#123;</span><br><span class="line">		res=<span class="built_in">max</span>(res,<span class="built_in">max</span>(dp[i][<span class="number">0</span>],dp[i][<span class="number">1</span>]));</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h2 id="IOI-2022-D1T2-Prison"><a href="#IOI-2022-D1T2-Prison" class="headerlink" title="IOI 2022 D1T2 Prison"></a>IOI 2022 D1T2 Prison</h2><h3 id="题目大意：-1"><a href="#题目大意：-1" class="headerlink" title="题目大意："></a>题目大意：</h3><p>有 $500$ 个囚犯，还有一个房间，房间中有两个袋子 $A,B$，分别装有 $n_A,n_B$ 个垒球，此外还有一个数字 $x$，初始为 $0$。囚犯们已知 $1\leq n_A,n_B\leq N$ 且 $n_A\ne n_B$，他们的目标是指出 $n_A$ 和 $n_B$ 的大小关系。</p>
<p>现在会按照随机的顺序每次叫一个囚犯进房间，此时囚犯可以看到数字 $x$，并做出两种选择之一：打开袋子 $A$，或者打开袋子 $B$，即获知 $n_A$ 或 $n_B$。</p>
<p>此时囚犯知道了 $x$ 以及一个袋子中的垒球数量，他可以做出三种选择之一：指出 $n_A&lt;n_B$，或者指出 $n_B&lt;n_A$，或者将 $x$ 修改为 $x’$（也可以 $x’=x$）。</p>
<p>你需要构造一种策略，使得任意时刻 $0\leq x\leq X$，且在 $500$ 个囚犯都进去过一次之前得到 $n_A,n_B$ 的大小关系。</p>
<p>$N\leq 5000$，当你构造的 $X$ 满足 $X\leq 20$ 时得满分。</p>
<h3 id="题解：-1"><a href="#题解：-1" class="headerlink" title="题解："></a>题解：</h3><p>这里写的就是我的思考过程。</p>
<p>首先考虑一个最最 naive 的方法：考虑 $n_A,n_B$ 的二进制表示，前两个人比较 $n_A,n_B$ 的最高位，第三个和第四个人比较 $n_A,n_B$ 的次高位，以此类推，那么可以实现如下：</p>
<ul>
<li>第 $2i$ 个人离开房间后确保 $x$ 为 $3i$；</li>
<li>第 $2i+1$ 个人来到房间，会发现 $x$ 为 $3i$，于是查看 $n_A$，如果 $n_A$ 第 $i$ 高位为 $0$ 则将 $x$ 改为 $3i+1$，否则改为 $3i+2$；</li>
<li>第 $2i+2$ 个人来到房间，根据 $x$ 是 $3i+1$ 还是 $3i+2$ 就可以知道 $n_A$ 第 $i$ 高位是 $0$ 还是 $1$，他再查看 $n_B$，如果这一位不同，那么可以直接得到答案，否则就把 $x$ 改成 $3i+3$，再比较下一位。</li>
</ul>
<p>这样需要 $X=38$ 左右。</p>
<p>我们将这方法略作修改，如果第 $2$ 个人进来看到 $n_A,n_B$ 最高位相同，并不是只能把 $x$ 改成 $3$ 然后交给下一个人，实际上他还掌握更多信息，比如 $n_B$ 的次高位，于是我们将策略改成如下：</p>
<ul>
<li>第 $1$ 个人来到房间，会发现 $x=0$，查看 $n_A$，根据最高位跳到 $x=1$ 或 $x=2$；</li>
<li>第 $2i$ 个人来到房间，根据 $x$ 的奇偶性知道 $n_A$ 当前比较位是 $0$ 还是 $1$，然后查看 $n_B$，如果不同则直接返回，否则看 $n_B$ 的下一位，根据 $0$ 还是 $1$ 跳到两个不同的 $x$；</li>
<li>第 $2i+1$ 个人同理，不过查看的是 $n_A$。</li>
</ul>
<p>这样只需要 $2\log N$ 次，即 $X=26$。</p>
<p>再优化一下，发现这里采用二进制不如采用三进制，$3^8&gt;N$，所以只需要 $X=3\times 8=24$ 即可。</p>
<p>再想一想，其实对于不同的数据范围可以采用不同的进制，于是我们考虑 DP，令 $f(i)$ 表示 $N=i$ 需要的最小的 $X$，枚举将 $i$ 分成 $j$ 段，那么 $f(i)\leftarrow f(\lceil\dfrac{i}{j}\rceil)+j$，这样应该可以 $X=22$ 或者 $X=21$。</p>
<p>现在只需要卡一下常数就可以了，我们注意到如果第一个人进去发现 $n_A=1$ 或者 $n_A=N$ 都可以直接返回结果（因为保证 $n_A\ne n_B$），所以我们每次可以把边上两个数砍掉，于是转移变成 $f(i)\leftarrow f(\lceil\dfrac{i-2}{j}\rceil)+j$，这样就能顺利得到 $X=20$ 的解。</p>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        代码
    </div>
    <div class='spoiler-content'>
        <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;prison.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">5010</span>,M=<span class="number">30</span>;</span><br><span class="line"><span class="type">int</span> dp[N],pre[N],mk[M];</span><br><span class="line">vector&lt; pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt; &gt; v[M],w[M];</span><br><span class="line">vector&lt; vector&lt;<span class="type">int</span>&gt; &gt; <span class="built_in">devise_strategy</span> (<span class="type">int</span> n) &#123;</span><br><span class="line">	vector&lt; vector&lt;<span class="type">int</span>&gt; &gt; ans;</span><br><span class="line">	dp[<span class="number">1</span>]=dp[<span class="number">2</span>]=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">3</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		dp[i]=<span class="number">1e9</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">1</span>;j&lt;=<span class="number">20</span>;j++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (dp[(i+j<span class="number">-3</span>)/j]+j&lt;=dp[i]) &#123;pre[i]=j,dp[i]=dp[(i+j<span class="number">-3</span>)/j]+j;&#125; </span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	v[<span class="number">0</span>].<span class="built_in">push_back</span>(<span class="built_in">make_pair</span>(<span class="number">1</span>,n));</span><br><span class="line">	w[<span class="number">0</span>].<span class="built_in">push_back</span>(<span class="built_in">make_pair</span>(<span class="number">1</span>,n));</span><br><span class="line">	<span class="type">int</span> cur=<span class="number">0</span>,tot=<span class="number">0</span>,fk=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;=tot;i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (i==<span class="number">0</span>||(mk[i]^mk[i<span class="number">-1</span>])) &#123;</span><br><span class="line">			cur=tot;</span><br><span class="line">			<span class="type">int</span> le=<span class="number">0</span>;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> k=i;k&lt;=tot;k++) &#123;</span><br><span class="line">				<span class="type">int</span> len=v[k].<span class="built_in">size</span>();</span><br><span class="line">				<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">0</span>;j&lt;len;j++) &#123;le=<span class="built_in">max</span>(le,v[i][j].second-v[i][j].first+<span class="number">1</span>);&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (pre[le]) &#123;</span><br><span class="line">				fk=(le+pre[le]<span class="number">-3</span>)/pre[le];</span><br><span class="line">				<span class="keyword">while</span> (tot&lt;cur+(le+fk<span class="number">-3</span>)/fk) &#123;tot++;mk[tot]=(mk[i]^<span class="number">1</span>);&#125;</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;fk=<span class="number">0</span>;&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		vector &lt;<span class="type">int</span>&gt; <span class="built_in">tmp</span>(n+<span class="number">1</span>);</span><br><span class="line">		tmp[<span class="number">0</span>]=mk[i];</span><br><span class="line">		<span class="type">int</span> len=v[i].<span class="built_in">size</span>();</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">0</span>;j&lt;len;j++) &#123;</span><br><span class="line">			<span class="comment">//printf(&quot;%d  %d    %d  %d\n&quot;,i,j,v[i][j].first,v[i][j].second);</span></span><br><span class="line">			<span class="type">int</span> nle=v[i][j].second-v[i][j].first+<span class="number">1</span>;</span><br><span class="line">			<span class="keyword">if</span> (fk) &#123;</span><br><span class="line">				<span class="keyword">for</span> (<span class="type">int</span> k=<span class="number">1</span>;k&lt;=(nle+fk<span class="number">-3</span>)/fk;k++) &#123;</span><br><span class="line">					v[cur+k].<span class="built_in">push_back</span>(<span class="built_in">make_pair</span>(v[i][j].first+<span class="number">1</span>+(k<span class="number">-1</span>)*fk,v[i][j].first+<span class="built_in">min</span>(nle<span class="number">-2</span>,k*fk)));</span><br><span class="line">					w[cur+k].<span class="built_in">push_back</span>(v[i][j]);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> k=<span class="number">1</span>;k&lt;=n;k++) &#123;</span><br><span class="line">				<span class="keyword">if</span> (k&gt;=w[i][j].first&amp;&amp;k&lt;=w[i][j].second) &#123;</span><br><span class="line">					<span class="keyword">if</span> (k&lt;=v[i][j].first) &#123;tmp[k]=(mk[i]?<span class="number">-2</span>:<span class="number">-1</span>);&#125;</span><br><span class="line">					<span class="keyword">else</span> <span class="keyword">if</span> (k&gt;=v[i][j].second) &#123;tmp[k]=(mk[i]?<span class="number">-1</span>:<span class="number">-2</span>);&#125;</span><br><span class="line">					<span class="keyword">else</span> &#123;tmp[k]=cur+(k-v[i][j].first<span class="number">-1</span>)/fk+<span class="number">1</span>;&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		ans.<span class="built_in">push_back</span>(tmp);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//printf(&quot;%d  %d\n&quot;,tot,dp[n]);</span></span><br><span class="line">	<span class="comment">//for (int i=0;i&lt;=tot;i++) &#123;printf(&quot;%d&quot;,mk[i]);</span></span><br><span class="line">		<span class="comment">//for (int j=0;j&lt;=n;j++) &#123;</span></span><br><span class="line">		<span class="comment">//	printf(&quot;%-5d  &quot;,ans[i][j]);</span></span><br><span class="line">		<span class="comment">//&#125;</span></span><br><span class="line">		<span class="comment">//printf(&quot;\n&quot;);</span></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line">	<span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h2 id="IOI-2022-D1T3-Towers"><a href="#IOI-2022-D1T3-Towers" class="headerlink" title="IOI 2022 D1T3 Towers"></a>IOI 2022 D1T3 Towers</h2><h3 id="题目大意：-2"><a href="#题目大意：-2" class="headerlink" title="题目大意："></a>题目大意：</h3><p>有 $N$ 座塔，第 $i$ 座塔高度为 $h_i$，保证高度两两不同。</p>
<p>现在有 $Q$ 个询问，每个询问给定 $l,r,d$，询问从 $[l,r]$ 中至多可以选择多少个塔，使得他们两两可以 $d$-通信。</p>
<p>两座塔 $i&lt;j$ 可以 $d$-通信，当且仅当存在一座塔 $k$ 使得 $i&lt;k&lt;j$ 且 $h_k-d\ge\max(h_i,h_j)$。</p>
<p>垒球。</p>
<p>$N,Q\leq 10^5$。</p>
<h3 id="题解：-2"><a href="#题解：-2" class="headerlink" title="题解："></a>题解：</h3><p>对于一个确定的 $d$，令 $l_i$ 表示 $i$ 左边第一个比 $i$ 高了至少 $d$ 的位置，$r_i$ 表示 $i$ 右边第一个比 $i$ 高了至少 $d$ 的位置。</p>
<p>那么两座塔 $i&lt;j$ 能 $d$-通信，当且仅当 $r_i\leq l_j$，即它们对应的区间 $[l_i,r_i)$ 无交。</p>
<p>同时易证以下两个结论：</p>
<ul>
<li>如果 $i&lt;j$ 满足 $l_j&lt;r_i$，那么一定有 $l_j\leq l_i$，即不可能两个区间既不为包含关系，又相交。</li>
<li>如果对于某个 $d$ 有 $[l_i,r_i)\subseteq [l_j,r_j)$，那么对于更大的 $d$，这一关系也成立。</li>
</ul>
<p>于是我们可以从小到大扫描 $d$，维护当前没有包含任何其他 $[l_j,r_j)$ 的区间 $[l_i,r_i)$，根据第一个结论，它们是两两无交的。我们称这些区间为 $d$ 对应的有效区间。</p>
<p>扫描过程中维护的方法是：用一个链表记录当前的有效区间，并且用优先队列记录每个区间在什么时间（即 $d$ 增大到多少时）会和左边或右边合并，然后在合并时删去一个元素即可。由于询问在线，所以需要用主席树记录每个时刻的有效区间。</p>
<p>询问 $(L,R,d)$ 时，我们首先找到这个 $d$ 对应的情况下，$[L,R]$ 中有多少个有效区间（一个有效区间 $[l_i,r_i)$ 在 $[L,R]$ 中定义为其中心点 $i$ 在 $[L,R]$ 中）。</p>
<p>那么这些有效区间的中心一定是要选择的了，但是可能还不全面，因为左右两边可能还需要各补选 $0$ 个或 $1$ 个塔（这是因为可能某个有效区间与 $[L,R]$ 有交，但是其中心不在 $[L,R]$ 中，就没统计到）。</p>
<p>这个稍微讨论一下即可：</p>
<ul>
<li>如果 $[L,R]$ 中一个有效区间都没有，那么我们找到 $[L,R]$ 中高度的最大值 $h_m$，显然最多只能在 $m$ 左右各选一个，判断一下行不行即可；</li>
<li>如果 $[L,R]$ 中有至少一个有效区间，那么我们找到第一个有效区间左侧的最大值 $h_m$，考虑能不能在 $h_m$ 左边多选一个即可（即 $[L,m-1]$ 的最小值是否不超过 $h_m-d$），右边同理。</li>
</ul>
<p>用 ST 表预处理区间最值。</p>
<p>时间复杂度为 $O((N+Q)\log N)$。</p>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        代码
    </div>
    <div class='spoiler-content'>
        <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;towers.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">100010</span>,M=<span class="number">4000010</span>;</span><br><span class="line"><span class="type">int</span> n,tot,cnt,las,nx[N],pre[N],vis[N],h[N],rt[N],val[N],nv[N],ch[M][<span class="number">2</span>],siz[M],lg[N],st[N][<span class="number">20</span>],st2[N][<span class="number">20</span>];</span><br><span class="line">priority_queue &lt; pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt; &gt; q;</span><br><span class="line">map &lt;<span class="type">int</span>,<span class="type">int</span>&gt; mp; </span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">gtmx</span> <span class="params">(<span class="type">int</span> l,<span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> k=lg[r-l+<span class="number">1</span>];</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">max</span>(st[l][k],st[r-(<span class="number">1</span>&lt;&lt;k)+<span class="number">1</span>][k]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">gtmn</span> <span class="params">(<span class="type">int</span> l,<span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> k=lg[r-l+<span class="number">1</span>];</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">min</span>(st2[l][k],st2[r-(<span class="number">1</span>&lt;&lt;k)+<span class="number">1</span>][k]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">upd</span> <span class="params">(<span class="type">int</span> i)</span> </span>&#123;</span><br><span class="line">	nv[i]=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line">	<span class="keyword">if</span> (nx[i]) &#123;nv[i]=<span class="built_in">min</span>(nv[i],<span class="built_in">gtmx</span>(i+<span class="number">1</span>,nx[i]<span class="number">-1</span>)-h[i]+<span class="number">1</span>);&#125;</span><br><span class="line">	<span class="keyword">if</span> (pre[i]) &#123;nv[i]=<span class="built_in">min</span>(nv[i],<span class="built_in">gtmx</span>(pre[i]+<span class="number">1</span>,i<span class="number">-1</span>)-h[i]+<span class="number">1</span>);&#125;</span><br><span class="line">	q.<span class="built_in">push</span>(<span class="built_in">make_pair</span>(-nv[i],i));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">modify</span> <span class="params">(<span class="type">int</span> rt,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> pos,<span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> p=++tot;</span><br><span class="line">	siz[p]=siz[rt]+v;</span><br><span class="line">	<span class="keyword">if</span> (l==r) &#123;<span class="keyword">return</span> p;&#125;</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span> (pos&lt;=mid) &#123;</span><br><span class="line">		ch[p][<span class="number">0</span>]=<span class="built_in">modify</span>(ch[rt][<span class="number">0</span>],l,mid,pos,v);</span><br><span class="line">		ch[p][<span class="number">1</span>]=ch[rt][<span class="number">1</span>];</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		ch[p][<span class="number">0</span>]=ch[rt][<span class="number">0</span>];</span><br><span class="line">		ch[p][<span class="number">1</span>]=<span class="built_in">modify</span>(ch[rt][<span class="number">1</span>],mid+<span class="number">1</span>,r,pos,v);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query</span> <span class="params">(<span class="type">int</span> rt,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> xl,<span class="type">int</span> xr)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (xl&lt;=l&amp;&amp;r&lt;=xr) &#123;<span class="keyword">return</span> siz[rt];&#125;</span><br><span class="line">	<span class="keyword">if</span> (xr&lt;l||r&lt;xl) &#123;<span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">query</span>(ch[rt][<span class="number">0</span>],l,mid,xl,xr)+<span class="built_in">query</span>(ch[rt][<span class="number">1</span>],mid+<span class="number">1</span>,r,xl,xr);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">querynx</span> <span class="params">(<span class="type">int</span> rt,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> pos)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (r&lt;pos||!siz[rt]) &#123;<span class="keyword">return</span> n+<span class="number">1</span>;&#125;</span><br><span class="line">	<span class="keyword">if</span> (l==r) &#123;<span class="keyword">return</span> l;&#125;</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>,tmp=<span class="built_in">querynx</span>(ch[rt][<span class="number">0</span>],l,mid,pos);</span><br><span class="line">	<span class="keyword">if</span> (tmp&lt;=n) &#123;<span class="keyword">return</span> tmp;&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;<span class="keyword">return</span> <span class="built_in">querynx</span>(ch[rt][<span class="number">1</span>],mid+<span class="number">1</span>,r,pos);&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">querypre</span> <span class="params">(<span class="type">int</span> rt,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> pos)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (l&gt;pos||!siz[rt]) &#123;<span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line">	<span class="keyword">if</span> (l==r) &#123;<span class="keyword">return</span> l;&#125;</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>,tmp=<span class="built_in">querypre</span>(ch[rt][<span class="number">1</span>],mid+<span class="number">1</span>,r,pos);</span><br><span class="line">	<span class="keyword">if</span> (tmp) &#123;<span class="keyword">return</span> tmp;&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;<span class="keyword">return</span> <span class="built_in">querypre</span>(ch[rt][<span class="number">0</span>],l,mid,pos);&#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span> <span class="params">(<span class="type">int</span> N,vector &lt;<span class="type">int</span>&gt; H)</span> </span>&#123;</span><br><span class="line">	n=N,las=<span class="number">0</span>,val[<span class="number">0</span>]=<span class="number">1</span>,lg[<span class="number">0</span>]=<span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;lg[i]=lg[i&gt;&gt;<span class="number">1</span>]+<span class="number">1</span>,st[i][<span class="number">0</span>]=st2[i][<span class="number">0</span>]=h[i]=H[i<span class="number">-1</span>],mp[h[i]]=i;&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">18</span>;i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">1</span>;j+(<span class="number">1</span>&lt;&lt;i)<span class="number">-1</span>&lt;=n;j++) &#123;</span><br><span class="line">			st[j][i]=<span class="built_in">max</span>(st[j][i<span class="number">-1</span>],st[j+(<span class="number">1</span>&lt;&lt;(i<span class="number">-1</span>))][i<span class="number">-1</span>]);</span><br><span class="line">			st2[j][i]=<span class="built_in">min</span>(st2[j][i<span class="number">-1</span>],st2[j+(<span class="number">1</span>&lt;&lt;(i<span class="number">-1</span>))][i<span class="number">-1</span>]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> ((i==<span class="number">1</span>||h[i<span class="number">-1</span>]&gt;h[i])&amp;&amp;(i==n||h[i+<span class="number">1</span>]&gt;h[i])) &#123;</span><br><span class="line">			pre[i]=las,nx[las]=i;</span><br><span class="line">			rt[<span class="number">0</span>]=<span class="built_in">modify</span>(rt[<span class="number">0</span>],<span class="number">1</span>,n,i,<span class="number">1</span>),las=i;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	pre[<span class="number">0</span>]=las;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=las;i;i=pre[i]) &#123;<span class="built_in">upd</span>(i);&#125;</span><br><span class="line">	las=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">while</span> (q.<span class="built_in">size</span>()) &#123;</span><br><span class="line">		pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt; a=q.<span class="built_in">top</span>();</span><br><span class="line">		q.<span class="built_in">pop</span>();</span><br><span class="line">		<span class="type">int</span> x=a.second,v=-a.first;</span><br><span class="line">		<span class="keyword">if</span> (nv[x]!=v||vis[x]) &#123;<span class="keyword">continue</span>;&#125;</span><br><span class="line">		vis[x]=<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">if</span> (v==las) &#123;rt[cnt]=<span class="built_in">modify</span>(rt[cnt],<span class="number">1</span>,n,x,<span class="number">-1</span>);&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			val[++cnt]=las=v;</span><br><span class="line">			rt[cnt]=<span class="built_in">modify</span>(rt[cnt<span class="number">-1</span>],<span class="number">1</span>,n,x,<span class="number">-1</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		nx[pre[x]]=nx[x];</span><br><span class="line">		pre[nx[x]]=pre[x];</span><br><span class="line">		<span class="keyword">if</span> (pre[x]) &#123;<span class="built_in">upd</span>(pre[x]);&#125;</span><br><span class="line">		<span class="keyword">if</span> (nx[x]) &#123;<span class="built_in">upd</span>(nx[x]);&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">max_towers</span> <span class="params">(<span class="type">int</span> L, <span class="type">int</span> R, <span class="type">int</span> D)</span> </span>&#123;</span><br><span class="line">	L++,R++;</span><br><span class="line">	<span class="type">int</span> l=<span class="number">0</span>,r=cnt;</span><br><span class="line">	<span class="keyword">while</span> (l&lt;r) &#123;</span><br><span class="line">		<span class="type">int</span> mid=(l+r+<span class="number">1</span>)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">if</span> (D&gt;=val[mid]) &#123;l=mid;&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;r=mid<span class="number">-1</span>;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> res=<span class="built_in">query</span>(rt[l],<span class="number">1</span>,n,L,R),fir=<span class="built_in">querynx</span>(rt[l],<span class="number">1</span>,n,L),las=<span class="built_in">querypre</span>(rt[l],<span class="number">1</span>,n,R);</span><br><span class="line">	<span class="comment">//cout &lt;&lt; L &lt;&lt; &quot;  &quot; &lt;&lt; R &lt;&lt; &quot;  &quot; &lt;&lt; res &lt;&lt; &quot;  &quot; &lt;&lt; fir &lt;&lt; &quot;  &quot; &lt;&lt; las &lt;&lt; endl;</span></span><br><span class="line">	<span class="keyword">if</span> (fir&gt;R) &#123;</span><br><span class="line">		<span class="type">int</span> mid=mp[<span class="built_in">gtmx</span>(L,R)];</span><br><span class="line">		<span class="built_in">assert</span>(L&lt;=mid&amp;&amp;mid&lt;=R);</span><br><span class="line">		<span class="comment">//cout &lt;&lt; mid &lt;&lt; endl;</span></span><br><span class="line">		<span class="comment">//cout &lt;&lt; h[mid]-gtmn(L,mid-1) &lt;&lt; endl;</span></span><br><span class="line">		<span class="comment">//cout &lt;&lt; h[mid]-gtmn(mid+1,R) &lt;&lt; endl;</span></span><br><span class="line">		<span class="keyword">if</span> (mid&gt;L&amp;&amp;mid&lt;R&amp;&amp;h[mid]-<span class="built_in">gtmn</span>(L,mid<span class="number">-1</span>)&gt;=D&amp;&amp;h[mid]-<span class="built_in">gtmn</span>(mid+<span class="number">1</span>,R)&gt;=D) &#123;res+=<span class="number">2</span>;&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;res++;&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (fir&gt;L+<span class="number">1</span>) &#123;</span><br><span class="line">			<span class="type">int</span> mid=mp[<span class="built_in">gtmx</span>(L+<span class="number">1</span>,fir<span class="number">-1</span>)];</span><br><span class="line">			<span class="built_in">assert</span>(mid&gt;=L+<span class="number">1</span>&amp;&amp;mid&lt;=fir<span class="number">-1</span>);</span><br><span class="line">			<span class="keyword">if</span> (h[mid]-<span class="built_in">gtmn</span>(L,mid<span class="number">-1</span>)&gt;=D) &#123;res++;&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (las&lt;R<span class="number">-1</span>) &#123;</span><br><span class="line">			<span class="type">int</span> mid=mp[<span class="built_in">gtmx</span>(las+<span class="number">1</span>,R<span class="number">-1</span>)];</span><br><span class="line">			<span class="built_in">assert</span>(mid&gt;=las+<span class="number">1</span>&amp;&amp;mid&lt;=R<span class="number">-1</span>);</span><br><span class="line">			<span class="keyword">if</span> (h[mid]-<span class="built_in">gtmn</span>(mid+<span class="number">1</span>,R)&gt;=D) &#123;res++;&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h2 id="IOI-2022-D2T1-Circuit"><a href="#IOI-2022-D2T1-Circuit" class="headerlink" title="IOI 2022 D2T1 Circuit"></a>IOI 2022 D2T1 Circuit</h2><h3 id="题目大意：-3"><a href="#题目大意：-3" class="headerlink" title="题目大意："></a>题目大意：</h3><p>给定一个 $N$ 个非叶结点，$M$ 个叶结点的值，叶结点有初值 $0$ 或 $1$，某个非叶结点如果有 $x$ 个儿子，则需要设置一个参数 $y\in [1,x]$，表示如果其儿子有至少 $y$ 个的值为 $1$，那么它的值也为 $1$。</p>
<p>现在进行 $Q$ 次操作，每次翻转编号在区间 $[l,r]$ 内的叶结点的初值（$0$ 变成 $1$，$1$ 变成 $0$），然后询问有多少种为非叶结点设置参数的方案，使得根结点值为 $1$，对 $10^9+2022$ 取模。</p>
<p>$N,M,Q\leq 10^5$</p>
<h3 id="题解：-3"><a href="#题解：-3" class="headerlink" title="题解："></a>题解：</h3><p>如果你是赛后做题，那么解题的关键或许是看到排行榜——有一车人过了这题，说明这题是水题。</p>
<p>或者是觉得这题看上去非常不可做，因为编号区间和树的形态并无关联，我们不可能用任何树上的数据解构解决此题。</p>
<p>无论如何，我们可以猜想：<strong>每个非叶结点对答案的贡献独立</strong>，幸运的是这是对的，证明并不困难，略。</p>
<p>于是首先树形 DP 算出每个非叶结点单独为黑色时的答案，然后用线段树维护总的答案即可，时间复杂度为 $O(Q\log M+N+M)$。</p>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        代码
    </div>
    <div class='spoiler-content'>
        <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;circuit.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std; </span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">200010</span>,P=<span class="number">1000002022</span>;</span><br><span class="line"><span class="type">int</span> n,m,a[N],val[N],dp[N],dgr[N],wsum[N*<span class="number">2</span>],bsum[N*<span class="number">2</span>],tg[N*<span class="number">2</span>];</span><br><span class="line">vector &lt;<span class="type">int</span>&gt; v[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs1</span> <span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> len=v[x].<span class="built_in">size</span>();</span><br><span class="line">	dp[x]=<span class="built_in">max</span>(<span class="number">1</span>,dgr[x]);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;i++) &#123;</span><br><span class="line">		<span class="built_in">dfs1</span>(v[x][i]);</span><br><span class="line">		dp[x]=(<span class="number">1ll</span>*dp[x]*dp[v[x][i]])%P;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs2</span> <span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> len=v[x].<span class="built_in">size</span>();</span><br><span class="line">	vector &lt;<span class="type">int</span>&gt; <span class="built_in">pre</span>(len+<span class="number">1</span>),<span class="built_in">suf</span>(len+<span class="number">1</span>);</span><br><span class="line">	pre[<span class="number">0</span>]=suf[len]=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;i++) &#123;pre[i+<span class="number">1</span>]=(<span class="number">1ll</span>*pre[i]*dp[v[x][i]])%P;&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=len<span class="number">-1</span>;i&gt;=<span class="number">0</span>;i--) &#123;suf[i]=(<span class="number">1ll</span>*suf[i+<span class="number">1</span>]*dp[v[x][i]])%P;&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;i++) &#123;</span><br><span class="line">		val[v[x][i]]=<span class="number">1ll</span>*val[x]*pre[i]%P*suf[i+<span class="number">1</span>]%P;</span><br><span class="line">		<span class="built_in">dfs2</span>(v[x][i]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">upd</span> <span class="params">(<span class="type">int</span> p)</span> </span>&#123;</span><br><span class="line">	bsum[p]=(bsum[p&lt;&lt;<span class="number">1</span>]+bsum[(p&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>])%P;</span><br><span class="line">	wsum[p]=(wsum[p&lt;&lt;<span class="number">1</span>]+wsum[(p&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>])%P;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pd</span> <span class="params">(<span class="type">int</span> p)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (tg[p]) &#123;</span><br><span class="line">		tg[p&lt;&lt;<span class="number">1</span>]^=<span class="number">1</span>,tg[(p&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>]^=<span class="number">1</span>;</span><br><span class="line">		<span class="built_in">swap</span>(bsum[p&lt;&lt;<span class="number">1</span>],wsum[p&lt;&lt;<span class="number">1</span>]);</span><br><span class="line">		<span class="built_in">swap</span>(bsum[(p&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>],wsum[(p&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>]);</span><br><span class="line">		tg[p]=<span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">buildt</span> <span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (l==r) &#123;</span><br><span class="line">		<span class="keyword">if</span> (a[l]) &#123;bsum[p]=val[l+n];&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;wsum[p]=val[l+n];&#125;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">buildt</span>(p&lt;&lt;<span class="number">1</span>,l,mid),<span class="built_in">buildt</span>((p&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>,mid+<span class="number">1</span>,r);</span><br><span class="line">	<span class="built_in">upd</span>(p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">modify</span> <span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> xl,<span class="type">int</span> xr)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (xr&lt;l||r&lt;xl) &#123;<span class="keyword">return</span>;&#125;</span><br><span class="line">	<span class="keyword">if</span> (xl&lt;=l&amp;&amp;r&lt;=xr) &#123;</span><br><span class="line">		tg[p]^=<span class="number">1</span>;</span><br><span class="line">		<span class="built_in">swap</span>(bsum[p],wsum[p]);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">pd</span>(p);</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">modify</span>(p&lt;&lt;<span class="number">1</span>,l,mid,xl,xr),<span class="built_in">modify</span>((p&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>,mid+<span class="number">1</span>,r,xl,xr);</span><br><span class="line">	<span class="built_in">upd</span>(p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span> <span class="params">(<span class="type">int</span> N,<span class="type">int</span> M,vector &lt;<span class="type">int</span>&gt; Q,vector &lt;<span class="type">int</span>&gt; A)</span> </span>&#123;</span><br><span class="line">	n=N,m=M;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;n+m;i++) &#123;v[Q[i]+<span class="number">1</span>].<span class="built_in">push_back</span>(i+<span class="number">1</span>);dgr[Q[i]+<span class="number">1</span>]++;&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++) &#123;a[i]=A[i<span class="number">-1</span>];&#125;</span><br><span class="line">	<span class="built_in">dfs1</span>(<span class="number">1</span>);</span><br><span class="line">	val[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">dfs2</span>(<span class="number">1</span>);</span><br><span class="line">	<span class="built_in">buildt</span>(<span class="number">1</span>,<span class="number">1</span>,m);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">count_ways</span> <span class="params">(<span class="type">int</span> L, <span class="type">int</span> R)</span> </span>&#123;</span><br><span class="line">	<span class="built_in">modify</span>(<span class="number">1</span>,<span class="number">1</span>,m,L-n+<span class="number">1</span>,R-n+<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">return</span> bsum[<span class="number">1</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h2 id="IOI-2022-D2T2-Insects"><a href="#IOI-2022-D2T2-Insects" class="headerlink" title="IOI 2022 D2T2 Insects"></a>IOI 2022 D2T2 Insects</h2><h3 id="题目大意：-4"><a href="#题目大意：-4" class="headerlink" title="题目大意："></a>题目大意：</h3><p>现在有 $N$ 个未知数 $a_{1\ldots n}$，还有一台神秘机器，机器初始是空的，你可以进行下列三种操作：</p>
<ul>
<li>将一个数 $a_i$ 加入机器；</li>
<li>将一个数 $a_i$ 取出机器；</li>
<li>询问机器里出现次数<strong>最多</strong>的数的出现次数。</li>
</ul>
<p>你需要求出 $a_{1\ldots n}$ 中出现次数<strong>最少</strong>的数的出现次数，设每种操作进行次数的最大值为 $Q$。</p>
<p>$N\leq 2000$，$Q\leq 3N$ 可得满分。</p>
<h3 id="题解：-4"><a href="#题解：-4" class="headerlink" title="题解："></a>题解：</h3><p>首先可以想到一个 $O(N^2)$ 次操作的算法：每次放一对数进去，就能知道它们是否相等。</p>
<p>还有一种 $O(N^2)$ 次操作的算法（记为青蛙算法）：每次选择一个数，然后得到与它相等的所有数（加入一个别的数如果众数出现次数没有增加则说明不相等）。</p>
<p>还有一种 $O(N^2)$ 次操作的算法（记为垒球算法）：每次选择当前剩下的所有不同的数各一个（时刻保持众数出现次数为 $1$ 即可），这样当某一次得到的不同的数的个数和上一次不同时，就知道出现次数最少的已经取完了。</p>
<p>综合青蛙算法和垒球算法，可以得到 $O(N\sqrt N)$ 的算法。</p>
<p>考虑垒球算法的扩展：如果保持众数出现次数始终小于等于 $C$，就可以得到每个数的前 $C$ 次出现，设不同的数有 $x$ 种，如果选出了恰好 $Cx$ 个数则说明出现次数最少的数也出现了 $\ge C$ 次，否则说明是 $&lt;C$ 次。</p>
<p>所以可以二分，得到了 $O(N\log N)$ 的垒球算法。</p>
<p>然后发现这个二分的操作次数实际上可以变成 $O(N)$，因为如果二分之后发现答案 $\ge C$，那么此时已经放进机器里的就不用动了，可以看成总数大致减半；如果二分之后答案 $&lt;C$，那么此刻不在机器里的数就可以全部扔掉了，总数也大致减半，根据等比数列求和这就是 $3N$ 次左右的。</p>
<p>然后一交获得了 $99$ 分的好成绩，下面使用你的独门技巧乱搞卡常即可。这里我的方法是在判断时只要某个时刻机器里已经有 $Cx$ 个数就直接退出循环，没必要加剩下的数，同时为了防卡，初始序列要随机重排。</p>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        代码
    </div>
    <div class='spoiler-content'>
        <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;insects.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">in</span> <span class="params">(<span class="type">int</span> x)</span> </span>&#123;<span class="built_in">move_inside</span>(x<span class="number">-1</span>);&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">out</span> <span class="params">(<span class="type">int</span> x)</span> </span>&#123;<span class="built_in">move_outside</span>(x<span class="number">-1</span>);&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">qry</span> <span class="params">()</span> </span>&#123;<span class="keyword">return</span> <span class="built_in">press_button</span>();&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> NN=<span class="number">2010</span>;</span><br><span class="line"><span class="type">int</span> cnt,sta[NN],fbd[NN],a[NN];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">min_cardinality</span> <span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		a[i]=i;</span><br><span class="line">		<span class="built_in">in</span>(i);</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">qry</span>()&gt;<span class="number">1</span>) &#123;<span class="built_in">out</span>(i);&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;sta[i]=<span class="number">1</span>,cnt++;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">random_shuffle</span>(a+<span class="number">1</span>,a+n+<span class="number">1</span>);</span><br><span class="line">	<span class="type">int</span> l=<span class="number">1</span>,r=n/cnt,nw=cnt;</span><br><span class="line">	<span class="keyword">while</span> (l&lt;r) &#123;</span><br><span class="line">		<span class="type">int</span> mid=(l+r+<span class="number">1</span>)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (!sta[a[i]]&amp;&amp;!fbd[a[i]]) &#123;</span><br><span class="line">				<span class="built_in">in</span>(a[i]);</span><br><span class="line">				<span class="keyword">if</span> (<span class="built_in">qry</span>()&gt;mid) &#123;<span class="built_in">out</span>(a[i]);&#125;</span><br><span class="line">				<span class="keyword">else</span> &#123;sta[a[i]]=<span class="number">2</span>,nw++;&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (nw==mid*cnt) &#123;<span class="keyword">break</span>;&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (nw==mid*cnt) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">				<span class="keyword">if</span> (sta[i]==<span class="number">2</span>) &#123;sta[i]=<span class="number">1</span>;&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			l=mid;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			r=nw/cnt;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">				<span class="keyword">if</span> (!sta[i]) &#123;fbd[i]=<span class="number">1</span>;&#125;</span><br><span class="line">				<span class="keyword">if</span> (sta[i]==<span class="number">2</span>) &#123;<span class="built_in">out</span>(i),nw--,sta[i]=<span class="number">0</span>;&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> l;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h2 id="IOI-2022-D2T3-Islands"><a href="#IOI-2022-D2T3-Islands" class="headerlink" title="IOI 2022 D2T3 Islands"></a>IOI 2022 D2T3 Islands</h2><h3 id="题目大意：-5"><a href="#题目大意：-5" class="headerlink" title="题目大意："></a>题目大意：</h3><p>有一张 $N$ 个点，$M$ 条边的有向图，你需要从点 $1$ 出发走一些边回到点 $1$，要求：</p>
<ul>
<li>一条边经过后就会反向，也就是下次经过必须是从反方向经过；</li>
<li>不能连续经过同一条边。</li>
</ul>
<p>构造一组方案，或说明无解。</p>
<p>$N\leq 10^5, M\leq 2\times 10^5$</p>
<h3 id="题解：-5"><a href="#题解：-5" class="headerlink" title="题解："></a>题解：</h3><p>如果一个结点出度为 $0$，那么走到这里就寄了，所以可以删掉。</p>
<p>删掉之后可能会导致另一些点出度也变为 $0$，也要删掉，这个可以做一次拓扑排序，就相当于我们删掉了所有不能走到环的点。</p>
<p>现在我们断言，如果点 $1$ 的<strong>出度</strong> $\ge 2$，那么一定有解，下面给出构造。</p>
<p>事实上考虑下列结构：由于不存在零出度点，所以我们可以为每个点（除了 $1$）指定一条出边，这样整张图就形成了若干个基环树，以及一棵以 $1$ 为根的树，如下图所示：</p>
<p><img src="https://cdn.luogu.com.cn/upload/image_hosting/13skltjt.png" alt=""></p>
<p>现在我们加上 $1$ 的两条出边，那么有以下两种情况：</p>
<ul>
<li><p>Case 1：至少一条出边指向以 $1$ 为根的树外。</p>
<p>如下图所示，$y,z$ 是出边到达的点，至少有一个在某个基环树上。</p>
<p><img src="https://cdn.luogu.com.cn/upload/image_hosting/04jh6u5y.png" alt=""></p>
<p>对于这种情况，我们先走到 $y$，然后沿着继续走，在 $y$ 所属的基环树上绕一圈，再回到 $1$，现在整张图和初始情况相比就是 $y$ 所在的基环树的环（红色环）被反向了。</p>
<p>然后再走到 $z$，同理绕一圈（蓝色环）再回 $1$。</p>
<p>然后再走一次 $y$，再绕一次红色环，这样红色环被绕了两次，就变回最初的方向了，同理再走一次 $z$，使得蓝色环也回到最初方向。</p>
</li>
<li><p>Case 2：两条出边都指向 $1$ 为根的树内。</p>
<p>如下图左上部分所示：</p>
<p><img src="https://cdn.luogu.com.cn/upload/image_hosting/70fvbft8.png" alt=""></p>
<p>这种情况我们考虑 $y,z$ 的 LCA，如果 LCA 恰好是 $1$，那么按照和 Case 1 相同的方法做就是没有问题的。</p>
<p>否则我们换一种构造：首先走到 $y$，然后沿着树上路径走到 $x$，也就是绕了右上图的红色环。</p>
<p>然后走到 $z$，沿着树上路径走到 LCA，再从 LCA 走回 $y$，再走 $y\to x$ 这条边，如左下图的蓝色环。</p>
<p>最后从 $x$ 沿树上路径走到 LCA，再从 LCA 走到 $z$，再走 $z\to x$ 这条边，如右下图的红色环，构造完成。</p>
<p>证明比较简单，注意图中 $y,z$ 是动态变化的，在实现的时候，构造过程中的 $y,z$ 始终是 $x$ 的出边指向的点。</p>
</li>
</ul>
<p>那么 $1$ 的出度 $\ge 2$ 的情况已经证完了，下面考虑 $1$ 的出度 $=1$ 的情况。</p>
<p>这时我们只能走这条出边，设为 $1\to x$，之后 $1$ 就可以看出零出度点（只要在不走 $x\to 1$ 这条反向边的情况下回到 $1$ 就寄了），所以我们删去点 $1$，同样这也会导致连锁反应，还是用一个拓扑排序就可以把所有该删的点都删了。</p>
<p>在剩下的新图上，把 $x$ 看成起点继续做即可，即如果 $x$ 的出度 $\ge 2$ 那么按照上面方法得到构造；如果 $x$ 的出度 $=1$ 那么再走它的出边，然后把 $x$ 删掉，以此类推。</p>
<p>时间复杂度应该可以做到 $O(N+M)$，不过我在实现时为了图省事，在记录边的序号以及删点的时候用到了 <code>multiset</code> 和 <code>map</code>，复杂度为 $O(N+M\log M)$。</p>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        代码
    </div>
    <div class='spoiler-content'>
        <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;islands.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">200010</span>;</span><br><span class="line"><span class="type">int</span> n,m,jlx[N],jly[N],out[N],tg[N],nx[N],pre[N],pre2[N],nx2[N],rl[N],zt[N],vis[N];</span><br><span class="line">multiset &lt;<span class="type">int</span>&gt; v[N],w[N];</span><br><span class="line">vector &lt;<span class="type">int</span>&gt; inv[N];</span><br><span class="line">queue &lt;<span class="type">int</span>&gt; q;</span><br><span class="line">map &lt;pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt;,<span class="type">int</span>&gt; mp;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">del</span> <span class="params">(<span class="type">int</span> x=<span class="number">0</span>)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (x) &#123;q.<span class="built_in">push</span>(x);&#125;</span><br><span class="line">	<span class="keyword">while</span> (q.<span class="built_in">size</span>()) &#123;</span><br><span class="line">		<span class="type">int</span> a=q.<span class="built_in">front</span>();</span><br><span class="line">		q.<span class="built_in">pop</span>();</span><br><span class="line">		tg[a]=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">auto</span> x:w[a]) &#123;</span><br><span class="line">			v[x].<span class="built_in">erase</span>(v[x].<span class="built_in">find</span>(a));</span><br><span class="line">			<span class="keyword">if</span> (--out[x]==<span class="number">0</span>) &#123;q.<span class="built_in">push</span>(x);&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">auto</span> x:v[a]) &#123;w[x].<span class="built_in">erase</span>(w[x].<span class="built_in">find</span>(a));&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solvec</span> <span class="params">(<span class="type">int</span> x,<span class="type">int</span> flg,<span class="type">int</span> &amp;y,<span class="type">int</span> &amp;ye,vector &lt;<span class="type">int</span>&gt; &amp;ans)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (flg) &#123;</span><br><span class="line">		mp.<span class="built_in">clear</span>();</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;m;i++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (i!=ye) &#123;mp[<span class="built_in">make_pair</span>(jlx[i],jly[i])]=i;&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">memset</span>(vis,<span class="number">0</span>,<span class="built_in">sizeof</span>(vis));</span><br><span class="line">	<span class="type">int</span> nw=y,cls=<span class="number">0</span>;</span><br><span class="line">	vis[x]=<span class="number">1</span>,pre[y]=x;</span><br><span class="line">	ans.<span class="built_in">push_back</span>(ye);</span><br><span class="line">	<span class="keyword">while</span> (!vis[nw]) &#123;</span><br><span class="line">		vis[nw]=<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">if</span> (zt[nw]) &#123;ans.<span class="built_in">push_back</span>(mp[<span class="built_in">make_pair</span>(nx[nw],nw)]);&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;ans.<span class="built_in">push_back</span>(mp[<span class="built_in">make_pair</span>(nw,nx[nw])]);&#125;</span><br><span class="line">		<span class="keyword">if</span> (!vis[nx[nw]]) &#123;pre[nx[nw]]=nw;&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;cls=nw;&#125;</span><br><span class="line">		nw=nx[nw];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (nw==x) &#123;</span><br><span class="line">		y=nx[x]=cls;</span><br><span class="line">		nw=cls;</span><br><span class="line">		zt[x]^=<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">while</span> (nw!=x) &#123;</span><br><span class="line">			zt[nw]^=<span class="number">1</span>;</span><br><span class="line">			nx[nw]=pre[nw];</span><br><span class="line">			nw=pre[nw];</span><br><span class="line">		&#125;</span><br><span class="line">		ye=mp[<span class="built_in">make_pair</span>(cls,x)];</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="type">int</span> dd=nw;</span><br><span class="line">		nx[dd]=cls;</span><br><span class="line">		nw=cls;</span><br><span class="line">		zt[dd]^=<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">while</span> (nw!=dd) &#123;</span><br><span class="line">			zt[nw]^=<span class="number">1</span>;</span><br><span class="line">			nx[nw]=pre[nw];</span><br><span class="line">			nw=pre[nw];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">while</span> (nw!=y) &#123;</span><br><span class="line">			ans.<span class="built_in">push_back</span>(mp[<span class="built_in">make_pair</span>(pre[nw],nw)]);</span><br><span class="line">			nw=pre[nw];</span><br><span class="line">		&#125;</span><br><span class="line">		ans.<span class="built_in">push_back</span>(ye);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">vector &lt;<span class="type">int</span>&gt; <span class="built_in">solve</span> (<span class="type">int</span> x) &#123;</span><br><span class="line">	vector &lt;<span class="type">int</span>&gt; ans;</span><br><span class="line">	<span class="type">int</span> nw=x;</span><br><span class="line">	<span class="keyword">while</span> (nw!=<span class="number">1</span>) &#123;nw=pre2[nw];&#125;</span><br><span class="line">	<span class="keyword">while</span> (nw!=x) &#123;</span><br><span class="line">		ans.<span class="built_in">push_back</span>(mp[<span class="built_in">make_pair</span>(nw,nx2[nw])]);</span><br><span class="line">		nw=nx2[nw];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (tg[i]&amp;&amp;i!=x) &#123;</span><br><span class="line">			nx[i]=(*v[i].<span class="built_in">begin</span>());</span><br><span class="line">			inv[(*v[i].<span class="built_in">begin</span>())].<span class="built_in">push_back</span>(i);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	q.<span class="built_in">push</span>(x);</span><br><span class="line">	<span class="keyword">while</span> (q.<span class="built_in">size</span>()) &#123;</span><br><span class="line">		<span class="type">int</span> a=q.<span class="built_in">front</span>();</span><br><span class="line">		q.<span class="built_in">pop</span>();</span><br><span class="line">		rl[a]=<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">auto</span> x:inv[a]) &#123;q.<span class="built_in">push</span>(x);&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> y=<span class="number">0</span>,z=<span class="number">0</span>,ye=<span class="number">0</span>,ze=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;m;i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (jlx[i]==x&amp;&amp;tg[jly[i]]) &#123;</span><br><span class="line">			<span class="keyword">if</span> (!y) &#123;y=jly[i],ye=i;&#125;</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span> (!z) &#123;z=jly[i],ze=i;&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//cout &lt;&lt; x &lt;&lt; &quot;  &quot; &lt;&lt; y &lt;&lt; &quot;  &quot; &lt;&lt; ye &lt;&lt; &quot;  &quot; &lt;&lt; z &lt;&lt; &quot;  &quot; &lt;&lt; ze &lt;&lt; &quot;  &quot; &lt;&lt; nx[5] &lt;&lt; endl;</span></span><br><span class="line">	<span class="keyword">if</span> (!rl[z]) &#123;<span class="built_in">swap</span>(y,z),<span class="built_in">swap</span>(ye,ze);&#125;</span><br><span class="line">	<span class="keyword">if</span> (!rl[y]) &#123;</span><br><span class="line">		<span class="built_in">solvec</span>(x,<span class="number">0</span>,y,ye,ans);</span><br><span class="line">		<span class="built_in">solvec</span>(x,<span class="number">0</span>,z,ze,ans);</span><br><span class="line">		<span class="built_in">solvec</span>(x,<span class="number">0</span>,y,ye,ans);</span><br><span class="line">		<span class="built_in">solvec</span>(x,<span class="number">0</span>,z,ze,ans);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="built_in">memset</span>(rl,<span class="number">0</span>,<span class="built_in">sizeof</span>(rl));</span><br><span class="line">		<span class="type">int</span> tmp=y,flg=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">while</span> (tmp!=x) &#123;rl[tmp]=<span class="number">1</span>;tmp=nx[tmp];&#125;</span><br><span class="line">		tmp=z;</span><br><span class="line">		<span class="keyword">while</span> (tmp!=x) &#123;flg|=rl[tmp];tmp=nx[tmp];&#125;</span><br><span class="line">		<span class="keyword">if</span> (!flg) &#123;</span><br><span class="line">			<span class="built_in">solvec</span>(x,<span class="number">0</span>,y,ye,ans);</span><br><span class="line">			<span class="built_in">solvec</span>(x,<span class="number">0</span>,z,ze,ans);</span><br><span class="line">			<span class="built_in">solvec</span>(x,<span class="number">0</span>,y,ye,ans);</span><br><span class="line">			<span class="built_in">solvec</span>(x,<span class="number">0</span>,z,ze,ans);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> (y!=z) &#123;</span><br><span class="line">				<span class="built_in">solvec</span>(x,<span class="number">0</span>,y,ye,ans);</span><br><span class="line">				<span class="built_in">solvec</span>(x,<span class="number">0</span>,z,ze,ans);</span><br><span class="line">				<span class="built_in">solvec</span>(x,<span class="number">0</span>,y,ye,ans);</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				vector &lt;<span class="type">int</span>&gt; tmp;</span><br><span class="line">				<span class="type">int</span> cur=y,len=<span class="number">0</span>;</span><br><span class="line">				<span class="keyword">while</span> (cur!=x) &#123;tmp.<span class="built_in">push_back</span>(mp[<span class="built_in">make_pair</span>(cur,nx[cur])]);len++;cur=nx[cur];&#125;</span><br><span class="line">				ans.<span class="built_in">push_back</span>(ye);</span><br><span class="line">				<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;i++) &#123;ans.<span class="built_in">push_back</span>(tmp[i]);&#125;</span><br><span class="line">				ans.<span class="built_in">push_back</span>(ze);</span><br><span class="line">				ans.<span class="built_in">push_back</span>(ye);</span><br><span class="line">				<span class="keyword">for</span> (<span class="type">int</span> i=len<span class="number">-1</span>;i&gt;=<span class="number">0</span>;i--) &#123;ans.<span class="built_in">push_back</span>(tmp[i]);&#125;</span><br><span class="line">				ans.<span class="built_in">push_back</span>(ze);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">while</span> (nw!=<span class="number">1</span>) &#123;</span><br><span class="line">		ans.<span class="built_in">push_back</span>(mp[<span class="built_in">make_pair</span>(pre2[nw],nw)]);</span><br><span class="line">		nw=pre2[nw];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line">variant &lt; <span class="type">bool</span>,vector&lt;<span class="type">int</span>&gt; &gt; <span class="built_in">find_journey</span> (<span class="type">int</span> N,<span class="type">int</span> M,vector&lt;<span class="type">int</span>&gt; U,vector&lt;<span class="type">int</span>&gt; V) &#123;</span><br><span class="line">	n=N,m=M;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;m;i++) &#123;</span><br><span class="line">		v[U[i]+<span class="number">1</span>].<span class="built_in">insert</span>(V[i]+<span class="number">1</span>),w[V[i]+<span class="number">1</span>].<span class="built_in">insert</span>(U[i]+<span class="number">1</span>),out[U[i]+<span class="number">1</span>]++;</span><br><span class="line">		jlx[i]=U[i]+<span class="number">1</span>,jly[i]=V[i]+<span class="number">1</span>;</span><br><span class="line">		mp[<span class="built_in">make_pair</span>(U[i]+<span class="number">1</span>,V[i]+<span class="number">1</span>)]=i;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		tg[i]=<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">if</span> (!out[i]) &#123;q.<span class="built_in">push</span>(i);&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">del</span>();</span><br><span class="line">	<span class="type">int</span> cur=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">while</span> (cur) &#123;</span><br><span class="line">		<span class="keyword">if</span> (out[cur]==<span class="number">0</span>) &#123;<span class="keyword">return</span> <span class="literal">false</span>;&#125;</span><br><span class="line">		<span class="keyword">if</span> (out[cur]&gt;=<span class="number">2</span>) &#123;<span class="keyword">return</span> <span class="built_in">solve</span>(cur);&#125;</span><br><span class="line">		<span class="type">int</span> tmp=*(v[cur].<span class="built_in">begin</span>());</span><br><span class="line">		<span class="built_in">del</span>(cur);</span><br><span class="line">		nx2[cur]=tmp,pre2[tmp]=cur;</span><br><span class="line">		cur=tmp;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h2 id="锐评环节"><a href="#锐评环节" class="headerlink" title="锐评环节"></a>锐评环节</h2><p>D1T1：比较简单的题，大概是想到单调性之后随便 DP 一下就行了，不过如果没想明白的话可能会用线段树去维护，其实是不用的。</p>
<p>D1T2：人类智慧题，有点看运气，运气好就想出来罢了，主要是到 $X=26$ 那一步比较有难度，后面的使用其他进制并 DP 以及掐头去尾其实都不是很难。</p>
<p>D1T3：偏简单题，主要是想到用区间表示每个点的状态，后面的数据结构部分非常简单。</p>
<p>D2T1：诈骗题，猜出结论就没有难度了，而想到去猜这个结论其实并不很难（正如我前面所说，如果没有这种结论，这题是不可做的）。</p>
<p>D2T2：中档题，每一步优化都不是很难，但是只要少一步就做不出来，然后最后还要为了零点零几分在那卡常。</p>
<p>D2T3：思维简单，代码不太好写题，感觉这题口胡起来非常舒服。</p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>
    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2023/09/29/%E4%B8%93%E9%A2%98%E9%A2%98%E8%A7%A3/IOI2021%E9%9B%86%E8%AE%AD%E9%98%9F%E4%BD%9C%E4%B8%9A%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/" rel="prev" title="专题题解 - IOI 2021 集训队作业部分题解">
                  <i class="fa fa-chevron-left"></i> 专题题解 - IOI 2021 集训队作业部分题解
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2023/09/29/%E4%B8%93%E9%A2%98%E9%A2%98%E8%A7%A3/JOI2018Final/" rel="next" title="专题题解 - JOI 2018 Final">
                  专题题解 - JOI 2018 Final <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ix35</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  

  <script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.2.8/pdfobject.min.js","integrity":"sha256-tu9j5pBilBQrWSDePOOajCUdz6hWsid/lBNzK4KgEPM="},"url":"/lib/pdf/web/viewer.html"}</script>
  <script src="/js/third-party/tags/pdf.js"></script>




  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.0/katex.min.css" integrity="sha256-uik/hNqHWZldXh/0K35nqOSCff9F61/ZOFReqNOBgB0=" crossorigin="anonymous">



</body>
</html>
