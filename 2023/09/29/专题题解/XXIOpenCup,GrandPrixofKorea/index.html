<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css" integrity="sha256-xejo6yLi6vGtAjcMIsY8BHdKsLg7QynVlFMzdQgUuy8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"itz-ix35.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.12.3","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":true,"show_result":true,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="https:&#x2F;&#x2F;codeforces.com&#x2F;gym&#x2F;102759">
<meta property="og:type" content="article">
<meta property="og:title" content="专题题解 - XXI Open Cup, Grand Prix of Korea">
<meta property="og:url" content="https://itz-ix35.github.io/2023/09/29/%E4%B8%93%E9%A2%98%E9%A2%98%E8%A7%A3/XXIOpenCup,GrandPrixofKorea/index.html">
<meta property="og:site_name" content="ix35&#39;s Blog">
<meta property="og:description" content="https:&#x2F;&#x2F;codeforces.com&#x2F;gym&#x2F;102759">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-09-29T12:47:44.102Z">
<meta property="article:modified_time" content="2025-02-21T01:05:58.093Z">
<meta property="article:author" content="ix35">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://itz-ix35.github.io/2023/09/29/%E4%B8%93%E9%A2%98%E9%A2%98%E8%A7%A3/XXIOpenCup,GrandPrixofKorea/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://itz-ix35.github.io/2023/09/29/%E4%B8%93%E9%A2%98%E9%A2%98%E8%A7%A3/XXIOpenCup,GrandPrixofKorea/","path":"2023/09/29/专题题解/XXIOpenCup,GrandPrixofKorea/","title":"专题题解 - XXI Open Cup, Grand Prix of Korea"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>专题题解 - XXI Open Cup, Grand Prix of Korea | ix35's Blog</title>
  






  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">ix35's Blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-essays"><a href="/essay/" rel="section"><i class="fa fa-tags fa-fw"></i>随笔选辑</a></li><li class="menu-item menu-item-game-guide"><a href="/game-guide/" rel="section"><i class="fa fa-tags fa-fw"></i>游戏攻略</a></li><li class="menu-item menu-item-game-review"><a href="/game-review/" rel="section"><i class="fa fa-tags fa-fw"></i>游戏评测</a></li><li class="menu-item menu-item-music"><a href="/music/" rel="section"><i class="fa fa-tags fa-fw"></i>音乐分享</a></li><li class="menu-item menu-item-notes"><a href="/note/" rel="section"><i class="fa fa-tags fa-fw"></i>课程笔记</a></li><li class="menu-item menu-item-solutions"><a href="/solution/" rel="section"><i class="fa fa-tags fa-fw"></i>专题题解</a></li><li class="menu-item menu-item-technology"><a href="/technology/" rel="section"><i class="fa fa-tags fa-fw"></i>科普文章</a></li><li class="menu-item menu-item-travelogue"><a href="/travel/" rel="section"><i class="fa fa-tags fa-fw"></i>远古游记</a></li><li class="menu-item menu-item-gallery"><a href="/gallery/" rel="section"><i class="fa fa-image fa-fw"></i>画廊</a></li><li class="menu-item menu-item-data"><a href="/data/" rel="section"><i class="fa fa-database fa-fw"></i>数据</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#A-Advertisement-Matching"><span class="nav-text">A. Advertisement Matching</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#B-Cactus-Competition"><span class="nav-text">B. Cactus Competition</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#C-Economic-One-way-Roads"><span class="nav-text">C. Economic One-way Roads</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#D-Just-Meeting"><span class="nav-text">D. Just Meeting</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#E-Chemistry"><span class="nav-text">*E. Chemistry</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#F-Interval-Graph"><span class="nav-text">F. Interval Graph</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#G-LCS-8"><span class="nav-text">G. LCS 8</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#H-Alchemy"><span class="nav-text">H. Alchemy</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#I-Query-on-a-Tree-17"><span class="nav-text">I. Query on a Tree 17</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#J-Remote-Control"><span class="nav-text">J. Remote Control</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#K-Sewing-Graph"><span class="nav-text">K. Sewing Graph</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#L-Steel-Slicing-2"><span class="nav-text">*L. Steel Slicing 2</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="ix35"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">ix35</p>
  <div class="site-description" itemprop="description"></div>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/Itz-ix35" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Itz-ix35" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:2757336405@qq.com" title="E-Mail → mailto:2757336405@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.luogu.com.cn/user/113546" title="Luogu → https:&#x2F;&#x2F;www.luogu.com.cn&#x2F;user&#x2F;113546" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>Luogu</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://space.bilibili.com/187505795" title="Bilibili → https:&#x2F;&#x2F;space.bilibili.com&#x2F;187505795" rel="noopener" target="_blank"><i class="fab fa-youtube fa-fw"></i>Bilibili</a>
      </span>
  </div>



        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://itz-ix35.github.io/2023/09/29/%E4%B8%93%E9%A2%98%E9%A2%98%E8%A7%A3/XXIOpenCup,GrandPrixofKorea/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="ix35">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ix35's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="专题题解 - XXI Open Cup, Grand Prix of Korea | ix35's Blog">
      <meta itemprop="description" content="https://codeforces.com/gym/102759">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          专题题解 - XXI Open Cup, Grand Prix of Korea
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-09-29 20:47:44" itemprop="dateCreated datePublished" datetime="2023-09-29T20:47:44+08:00">2023-09-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E4%B8%93%E9%A2%98%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">专题题解</span></a>
        </span>
    </span>

  
</div>

            <div class="post-description">https://codeforces.com/gym/102759</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>本场比赛中的大约三四道题目在之前的联测或 APIO 讲课中出现。</p>
<p>打 * 号表示没有写的题，可能是不打算写了，也可能是暂时没来得及写。</p>
<hr>
<h3 id="A-Advertisement-Matching"><a href="#A-Advertisement-Matching" class="headerlink" title="A. Advertisement Matching"></a>A. Advertisement Matching</h3><p><strong>难度：</strong>$\bigstar\bigstar$</p>
<p><strong>题目大意：</strong></p>
<p>有 $n$ 种广告，第 $i$ 种有 $a_i$ 份，还有 $m$ 个用户，第 $i$ 个用户可以接受 $b_i$ 份广告，每个用户不能接受多份同种广告。</p>
<p>接下来有 $q$ 个操作，每个操作为将某个 $a_i$ 或 $b_i$ 加一或减一，每次操作后请计算是否存在将所有广告分发完的方案。</p>
<p>$1\leq n,m,q\leq 2.5\times 10^5$</p>
<p><strong>题目解法：</strong></p>
<p>霍尔定理扩展的经典问题，朝这个方向稍微想想就可知道，将 $a_i$ 从大到小排序后，当且仅当对于每个 $x\in [1,n]$ 都满足 $\sum\limits_{i=1}^x a_i\leq \sum\limits_{i=1}^m \min(x,b_i)$ 时答案才为肯定。</p>
<p>用线段树维护上述式子，由于都是加减一所以可以假设没有大小顺序的变化，时间复杂度为 $O(q\log n+n+m)$。</p>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        代码
    </div>
    <div class='spoiler-content'>
        <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">500010</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">P</span> &#123;</span><br><span class="line">	<span class="type">int</span> pos,v;</span><br><span class="line">&#125;p[MAXN];</span><br><span class="line"><span class="type">int</span> n,m,q,op,x,fir[MAXN],las[MAXN],a[MAXN],b[MAXN],c[MAXN],rev[MAXN],sum[MAXN];</span><br><span class="line">ll mn[MAXN*<span class="number">2</span>],tg[MAXN*<span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span> <span class="params">(P a,P b)</span> </span>&#123;<span class="keyword">return</span> a.v&gt;b.v;&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pd</span> <span class="params">(<span class="type">int</span> p)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (tg[p]==<span class="number">0</span>) &#123;<span class="keyword">return</span>;&#125;</span><br><span class="line">	mn[p&lt;&lt;<span class="number">1</span>]+=tg[p],mn[(p&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>]+=tg[p],tg[p&lt;&lt;<span class="number">1</span>]+=tg[p],tg[(p&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>]+=tg[p];</span><br><span class="line">	tg[p]=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">modify</span> <span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> xl,<span class="type">int</span> xr,<span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (xr&lt;l||r&lt;xl) &#123;<span class="keyword">return</span>;&#125;</span><br><span class="line">	<span class="keyword">if</span> (xl&lt;=l&amp;&amp;r&lt;=xr) &#123;</span><br><span class="line">		mn[p]+=v,tg[p]+=v;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">pd</span>(p);</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">modify</span>(p&lt;&lt;<span class="number">1</span>,l,mid,xl,xr,v);</span><br><span class="line">	<span class="built_in">modify</span>((p&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>,mid+<span class="number">1</span>,r,xl,xr,v);</span><br><span class="line">	mn[p]=<span class="built_in">min</span>(mn[p&lt;&lt;<span class="number">1</span>],mn[(p&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>]);</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query</span> <span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> pos)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (l==r) &#123;<span class="keyword">return</span> mn[p];&#125;</span><br><span class="line">	<span class="built_in">pd</span>(p);</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span> (pos&lt;=mid) &#123;<span class="keyword">return</span> <span class="built_in">query</span>(p&lt;&lt;<span class="number">1</span>,l,mid,pos);&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;<span class="keyword">return</span> <span class="built_in">query</span>((p&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>,mid+<span class="number">1</span>,r,pos);&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;p[i].v);</span><br><span class="line">		p[i].pos=i,a[i]=p[i].v;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">sort</span>(p+<span class="number">1</span>,p+n+<span class="number">1</span>,cmp);</span><br><span class="line">	c[<span class="number">0</span>]=c[n+<span class="number">1</span>]=<span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		c[i]=p[i].v,rev[p[i].pos]=i;</span><br><span class="line">		<span class="keyword">if</span> (c[i]!=c[i<span class="number">-1</span>]) &#123;fir[c[i]]=i;&#125;</span><br><span class="line">		<span class="keyword">if</span> (c[i]!=c[i+<span class="number">1</span>]) &#123;las[c[i]]=i;&#125;</span><br><span class="line">		<span class="built_in">modify</span>(<span class="number">1</span>,<span class="number">1</span>,n,i,n,-c[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;b[i]);</span><br><span class="line">		sum[b[i]]++;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">250000</span>;i&gt;=<span class="number">1</span>;i--) &#123;sum[i]+=sum[i+<span class="number">1</span>];&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;<span class="built_in">modify</span>(<span class="number">1</span>,<span class="number">1</span>,n,i,n,sum[i]);&#125;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;q);</span><br><span class="line">	<span class="comment">//for (int i=1;i&lt;=n;i++) &#123;assert(fir[c[i]]!=0);assert(las[c[i]]!=0);&#125;</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=q;i++) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;op,&amp;x);</span><br><span class="line">		<span class="keyword">if</span> (op==<span class="number">1</span>) &#123;</span><br><span class="line">			<span class="type">int</span> tmp=rev[x];</span><br><span class="line">			<span class="comment">//if (a[2]==13) cout &lt;&lt; op &lt;&lt; &quot; &quot; &lt;&lt; x &lt;&lt; &quot; &quot; &lt;&lt; tmp &lt;&lt; endl;</span></span><br><span class="line">			<span class="type">int</span> val=c[tmp];</span><br><span class="line">			<span class="type">int</span> fr=fir[val];</span><br><span class="line">			<span class="comment">//assert(fr!=0);</span></span><br><span class="line">			<span class="keyword">if</span> (fr!=tmp) &#123;</span><br><span class="line">				rev[p[fr].pos]=tmp;</span><br><span class="line">				rev[x]=fr;</span><br><span class="line">				p[tmp].pos=p[fr].pos;</span><br><span class="line">				p[fr].pos=x;</span><br><span class="line">			&#125;</span><br><span class="line">			c[fr]++;</span><br><span class="line">			fir[val]++;</span><br><span class="line">			<span class="keyword">if</span> (fir[val]&gt;las[val]) &#123;fir[val]=las[val]=<span class="number">0</span>;&#125;</span><br><span class="line">			<span class="built_in">modify</span>(<span class="number">1</span>,<span class="number">1</span>,n,fr,n,<span class="number">-1</span>);</span><br><span class="line">			las[val+<span class="number">1</span>]=fr;</span><br><span class="line">			<span class="keyword">if</span> (fir[val+<span class="number">1</span>]==<span class="number">0</span>) &#123;fir[val+<span class="number">1</span>]=fr;&#125;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (op==<span class="number">2</span>) &#123;</span><br><span class="line">			<span class="type">int</span> tmp=rev[x];</span><br><span class="line">			<span class="comment">//if (a[2]==13) cout &lt;&lt; op &lt;&lt; &quot; &quot; &lt;&lt; x &lt;&lt; &quot; &quot; &lt;&lt; tmp &lt;&lt; endl;</span></span><br><span class="line">			<span class="type">int</span> val=c[tmp];</span><br><span class="line">			<span class="type">int</span> ls=las[val];</span><br><span class="line">			<span class="comment">//assert(ls!=0);</span></span><br><span class="line">			<span class="keyword">if</span> (ls!=tmp) &#123;</span><br><span class="line">				rev[p[ls].pos]=tmp;</span><br><span class="line">				rev[x]=ls;</span><br><span class="line">				p[tmp].pos=p[ls].pos;</span><br><span class="line">				p[ls].pos=x;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//if (a[2]==13)</span></span><br><span class="line">			<span class="comment">//cout &lt;&lt; val &lt;&lt; &quot;  &quot; &lt;&lt; las[val] &lt;&lt; &quot;  &quot; &lt;&lt;fir[val] &lt;&lt;</span></span><br><span class="line">			<span class="comment">//&quot;  &quot; &lt;&lt;las[val-1] &lt;&lt; &quot;  &quot; &lt;&lt; fir[val-1] &lt;&lt; endl; </span></span><br><span class="line">			c[ls]--;</span><br><span class="line">			las[val]--;</span><br><span class="line">			<span class="keyword">if</span> (fir[val]&gt;las[val]) &#123;fir[val]=las[val]=<span class="number">0</span>;&#125;</span><br><span class="line">			<span class="built_in">modify</span>(<span class="number">1</span>,<span class="number">1</span>,n,ls,n,<span class="number">1</span>);</span><br><span class="line">			fir[val<span class="number">-1</span>]=ls;</span><br><span class="line">			<span class="keyword">if</span> (las[val<span class="number">-1</span>]==<span class="number">0</span>) &#123;las[val<span class="number">-1</span>]=ls;&#125;</span><br><span class="line">			<span class="comment">//if (a[2]==13)</span></span><br><span class="line">			<span class="comment">//cout &lt;&lt; val &lt;&lt; &quot;  &quot; &lt;&lt; las[val] &lt;&lt; &quot;  &quot; &lt;&lt;fir[val] &lt;&lt;</span></span><br><span class="line">			<span class="comment">//&quot;  &quot; &lt;&lt;las[val-1] &lt;&lt; &quot;  &quot; &lt;&lt; fir[val-1] &lt;&lt; endl; </span></span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (op==<span class="number">3</span>) &#123;</span><br><span class="line">			b[x]++;</span><br><span class="line">			<span class="keyword">if</span> (b[x]&lt;=n) &#123;<span class="built_in">modify</span>(<span class="number">1</span>,<span class="number">1</span>,n,b[x],n,<span class="number">1</span>);&#125;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (op==<span class="number">4</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (b[x]&lt;=n) &#123;<span class="built_in">modify</span>(<span class="number">1</span>,<span class="number">1</span>,n,b[x],n,<span class="number">-1</span>);&#125;</span><br><span class="line">			b[x]--;</span><br><span class="line">		&#125;</span><br><span class="line">		ll tmp=mn[<span class="number">1</span>];</span><br><span class="line">		<span class="keyword">if</span> (tmp&gt;=<span class="number">0</span>) &#123;<span class="built_in">printf</span>(<span class="string">&quot;1\n&quot;</span>);&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;<span class="built_in">printf</span>(<span class="string">&quot;0\n&quot;</span>);&#125;</span><br><span class="line">		<span class="comment">//for (int i=1;i&lt;=n;i++) &#123;assert(fir[c[i]]!=0);assert(las[c[i]]!=0);&#125;</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="B-Cactus-Competition"><a href="#B-Cactus-Competition" class="headerlink" title="B. Cactus Competition"></a>B. Cactus Competition</h3><p><strong>难度：</strong>$\bigstar\bigstar$</p>
<p><strong>题目大意：</strong></p>
<p>有 $n\times m$ 网格，给定数组 $a_1,\ldots,a_n$ 和 $b_1,\ldots,b_m$，当且仅当 $a_i+b_j\ge 0$ 时 $(i,j)$ 是黑格，现在请问有多少对 $(s,t)$ 满足：存在一条从 $(s,1)$ 到 $(t,m)$ 的每次仅能够向右或向下行走一步的只通过黑格的路径。</p>
<p>$1\leq n,m\leq 2\times 10^5$</p>
<p><strong>题目解法：</strong></p>
<p>先讲我的做法：</p>
<p>将满足 $a_x+\min(b_i)\ge 0$ 的行 $x$ 称为桥。</p>
<p>那么显然从 $(s,1)$ 可以走到 $(t,m)$，当且仅当可以从 $(s,1)$ 走到一个桥，再从同一个桥可以走到 $(t,m)$。</p>
<p>把桥从上到下依次编号，我们只需要求出从每一个 $(s,1)$ 可以走到的最大编号的桥，和可以走到 $(t,m)$ 的编号最小的桥，然后就是一个平凡的二维偏序问题。</p>
<p>以前一个问题为例，求 $(s,1)$ 可以走到的编号最大的桥，这个问题可以递推，容易证明如果 $s$ 不是桥，那么设 $p$ 是满足 $p&gt;s$ 且 $a_p\ge a_s$ 的最小的 $p$，则如果从 $(s,1)$ 可以到达第 $p$ 行那么 $(s,1)$ 的答案与 $(p,1)$ 相同，否则 $(s,1)$ 走不到任何一个桥。</p>
<p>于是只需要用 ST 表和二分的基本技巧就可以求出上面问题的答案了，再结合树状数组解决二维偏序即可通过。</p>
<p>时间复杂度为 $O(n\log n)$。</p>
<p>大众做法大概就是考虑 $(1,1)$ 到 $(n,m)$ 什么情况可以走通，就是起点终点不能被封锁，并且不能有行列被封锁，然后基于此考虑，复杂度应该是一样的。</p>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        代码
    </div>
    <div class='spoiler-content'>
        <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">200010</span>;</span><br><span class="line"><span class="type">int</span> n,m,a[MAXN],b[MAXN],lg[MAXN],stan[MAXN][<span class="number">20</span>],stbn[MAXN][<span class="number">20</span>],stax[MAXN][<span class="number">20</span>],stbx[MAXN][<span class="number">20</span>];</span><br><span class="line"><span class="type">int</span> cnt,bri[MAXN],mx[MAXN],mn[MAXN],fw[MAXN];</span><br><span class="line">ll ans;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">chkn</span> <span class="params">(<span class="type">int</span> a[],<span class="type">int</span> x,<span class="type">int</span> y)</span> </span>&#123;<span class="keyword">return</span> (a[x]&lt;=a[y]?x:y);&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">chkx</span> <span class="params">(<span class="type">int</span> a[],<span class="type">int</span> x,<span class="type">int</span> y)</span> </span>&#123;<span class="keyword">return</span> (a[x]&gt;=a[y]?x:y);&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">modify</span> <span class="params">(<span class="type">int</span> x,<span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=x;i&lt;=cnt;i+=(i&amp;(-i))) &#123;fw[i]+=v;&#125;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query</span> <span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=x;i;i-=(i&amp;(-i))) &#123;res+=fw[i];&#125;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">queryan</span> <span class="params">(<span class="type">int</span> l,<span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> k=lg[r-l+<span class="number">1</span>];</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">chkn</span>(a,stan[l][k],stan[r-(<span class="number">1</span>&lt;&lt;k)+<span class="number">1</span>][k]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">queryax</span> <span class="params">(<span class="type">int</span> l,<span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> k=lg[r-l+<span class="number">1</span>];</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">chkx</span>(a,stax[l][k],stax[r-(<span class="number">1</span>&lt;&lt;k)+<span class="number">1</span>][k]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">querybn</span> <span class="params">(<span class="type">int</span> l,<span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> k=lg[r-l+<span class="number">1</span>];</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">chkn</span>(b,stbn[l][k],stbn[r-(<span class="number">1</span>&lt;&lt;k)+<span class="number">1</span>][k]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">querybx</span> <span class="params">(<span class="type">int</span> l,<span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> k=lg[r-l+<span class="number">1</span>];</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">chkx</span>(b,stbx[l][k],stbx[r-(<span class="number">1</span>&lt;&lt;k)+<span class="number">1</span>][k]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">memset</span>(mn,<span class="number">0x3f</span>,<span class="built_in">sizeof</span>(mn));</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">	lg[<span class="number">0</span>]=<span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;a[i]);</span><br><span class="line">		stan[i][<span class="number">0</span>]=stax[i][<span class="number">0</span>]=i,lg[i]=lg[i&gt;&gt;<span class="number">1</span>]+<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> tmp=<span class="number">1e9</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;b[i]);</span><br><span class="line">		stbn[i][<span class="number">0</span>]=stbx[i][<span class="number">0</span>]=i,lg[i]=lg[i&gt;&gt;<span class="number">1</span>]+<span class="number">1</span>;</span><br><span class="line">		tmp=<span class="built_in">min</span>(tmp,b[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;a[i]=<span class="built_in">min</span>(a[i],-tmp);&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">18</span>;i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">1</span>;j+(<span class="number">1</span>&lt;&lt;i)<span class="number">-1</span>&lt;=n;j++) &#123;</span><br><span class="line">			stan[j][i]=<span class="built_in">chkn</span>(a,stan[j][i<span class="number">-1</span>],stan[j+(<span class="number">1</span>&lt;&lt;(i<span class="number">-1</span>))][i<span class="number">-1</span>]);</span><br><span class="line">			stax[j][i]=<span class="built_in">chkx</span>(a,stax[j][i<span class="number">-1</span>],stax[j+(<span class="number">1</span>&lt;&lt;(i<span class="number">-1</span>))][i<span class="number">-1</span>]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">1</span>;j+(<span class="number">1</span>&lt;&lt;i)<span class="number">-1</span>&lt;=m;j++) &#123;</span><br><span class="line">			stbn[j][i]=<span class="built_in">chkn</span>(b,stbn[j][i<span class="number">-1</span>],stbn[j+(<span class="number">1</span>&lt;&lt;(i<span class="number">-1</span>))][i<span class="number">-1</span>]);</span><br><span class="line">			stbx[j][i]=<span class="built_in">chkx</span>(b,stbx[j][i<span class="number">-1</span>],stbx[j+(<span class="number">1</span>&lt;&lt;(i<span class="number">-1</span>))][i<span class="number">-1</span>]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=n;i&gt;=<span class="number">1</span>;i--) &#123;</span><br><span class="line">		<span class="keyword">if</span> (a[i]+b[<span class="number">1</span>]&lt;<span class="number">0</span>) &#123;<span class="keyword">continue</span>;&#125;</span><br><span class="line">		<span class="type">int</span> l=i+<span class="number">1</span>,r=n+<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">while</span> (l&lt;r) &#123;</span><br><span class="line">			<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">			<span class="keyword">if</span> (a[<span class="built_in">queryax</span>(i+<span class="number">1</span>,mid)]&gt;=a[i]) &#123;r=mid;&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;l=mid+<span class="number">1</span>;&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="type">int</span> tmp=l;</span><br><span class="line">		l=<span class="number">1</span>,r=m;</span><br><span class="line">		<span class="keyword">while</span> (l&lt;r) &#123;</span><br><span class="line">			<span class="type">int</span> mid=(l+r+<span class="number">1</span>)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">			<span class="keyword">if</span> (b[<span class="built_in">querybn</span>(<span class="number">1</span>,mid)]+a[i]&gt;=<span class="number">0</span>) &#123;l=mid;&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;r=mid<span class="number">-1</span>;&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (l==m) &#123;bri[i]=++cnt;mn[i]=cnt;&#125;</span><br><span class="line">		<span class="keyword">if</span> (tmp!=n+<span class="number">1</span>) &#123;</span><br><span class="line">			<span class="type">int</span> tmp2=b[<span class="built_in">querybx</span>(<span class="number">1</span>,l)],tmp3=a[<span class="built_in">queryan</span>(i,tmp)];</span><br><span class="line">			<span class="keyword">if</span> (tmp2+tmp3&gt;=<span class="number">0</span>) &#123;mn[i]=<span class="built_in">min</span>(mn[i],mn[tmp]);&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (a[i]+b[m]&lt;<span class="number">0</span>) &#123;<span class="keyword">continue</span>;&#125;</span><br><span class="line">		<span class="type">int</span> l=<span class="number">0</span>,r=i<span class="number">-1</span>;</span><br><span class="line">		<span class="keyword">while</span> (l&lt;r) &#123;</span><br><span class="line">			<span class="type">int</span> mid=(l+r+<span class="number">1</span>)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">			<span class="keyword">if</span> (a[<span class="built_in">queryax</span>(mid,i<span class="number">-1</span>)]&gt;=a[i]) &#123;l=mid;&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;r=mid<span class="number">-1</span>;&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="type">int</span> tmp=l;</span><br><span class="line">		l=<span class="number">1</span>,r=m;</span><br><span class="line">		<span class="keyword">while</span> (l&lt;r) &#123;</span><br><span class="line">			<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">			<span class="keyword">if</span> (b[<span class="built_in">querybn</span>(mid,m)]+a[i]&gt;=<span class="number">0</span>) &#123;r=mid;&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;l=mid+<span class="number">1</span>;&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (l==<span class="number">1</span>) &#123;mx[i]=bri[i];&#125;</span><br><span class="line">		<span class="keyword">if</span> (tmp!=<span class="number">0</span>) &#123;</span><br><span class="line">			<span class="type">int</span> tmp2=b[<span class="built_in">querybx</span>(l,m)],tmp3=a[<span class="built_in">queryan</span>(tmp,i)];</span><br><span class="line">			<span class="keyword">if</span> (tmp2+tmp3&gt;=<span class="number">0</span>) &#123;mx[i]=<span class="built_in">max</span>(mx[i],mx[tmp]);&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//for (int i=1;i&lt;=n;i++) &#123;cout &lt;&lt; i &lt;&lt; &quot;  &quot; &lt;&lt; mn[i] &lt;&lt; &quot;  &quot; &lt;&lt; mx[i] &lt;&lt; endl;&#125;</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> l=<span class="number">1</span>,r;l&lt;=n+<span class="number">1</span>;l=r+<span class="number">1</span>) &#123;</span><br><span class="line">		r=l;</span><br><span class="line">		<span class="keyword">while</span> (r&lt;=n&amp;&amp;!bri[r]) &#123;r++;&#125;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=<span class="built_in">max</span>(<span class="number">1</span>,l<span class="number">-1</span>);i&lt;r;i++) &#123;ans+=<span class="built_in">query</span>(mx[i]);&#125;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=l;i&lt;=<span class="built_in">min</span>(n,r);i++) &#123;<span class="built_in">modify</span>(mn[i],<span class="number">1</span>);&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="C-Economic-One-way-Roads"><a href="#C-Economic-One-way-Roads" class="headerlink" title="C. Economic One-way Roads"></a>C. Economic One-way Roads</h3><p><strong>难度：</strong>$\bigstar\bigstar\bigstar\bigstar$</p>
<p><strong>题目大意：</strong></p>
<p>给定 $n$ 个点的无向图，你需要给每条边定向，每种方向各有一个边权，你需要使得定向后的图强连通，求定向边权和的最小值。</p>
<p>$2\leq n\leq 18$</p>
<p><strong>题目解法：</strong></p>
<p>本题需要用到强连通图的耳分解相关知识。</p>
<p>设点集为 $V$，对于其一个子集 $S$，如果 $u,w\in S$，而 $v_1,\ldots,v_k\in V-S$，并且存在有向路径 $u\to v_1\to \ldots\to v_k\to w$，那么就称这条路径是 $S$ 的一个耳。</p>
<p>一个有向图是强连通图，当且仅当：</p>
<ul>
<li>设有一个点集 $S$，初始为 $\{1\}$；</li>
<li>每次选择 $S$ 的一个耳，将其中所有点加入 $S$ 中；</li>
<li>重复上述过程，可以使得 $S=V$。</li>
</ul>
<p>所以在本题中，我们设 $f(S)$ 表示上述过程中的点集为 $S$ 时，$S$ 内部定向边权和的最小值。</p>
<p>简单的想法是枚举耳的点集，将它加到 $S$ 中，但复杂度可达 $O(3^n\operatorname{poly}(n))$。</p>
<p>考虑一个点一个点地加入一个耳，设 $g(S,v,w)$ 表示当前点集为 $S$，目前正在加一个耳，终点为 $w$，当前这个耳构造到了 $v$（可以发现耳的起点 $u$ 不用算入状态），那么每次枚举 $v$ 的后继 $v’$，转移到 $g(S\cup \{v’\},v’,w)$ 即可。</p>
<p>注意到 $(v,w)$ 和 $(w,v)$ 两条边不能同时出现，所以还需要额外记录一个 $b$ 表示耳的上一条边是否就是 $(w,v)$，如果是的话则不能在下一步选择 $(v,w)$ 这条边使得耳闭合。</p>
<p>时间复杂度为 $O(2^n\times n^3)$。</p>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        代码
    </div>
    <div class='spoiler-content'>
        <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">20</span>;</span><br><span class="line"><span class="type">int</span> n,del,d[MAXN][MAXN],res[<span class="number">1</span>&lt;&lt;<span class="number">18</span>],f[<span class="number">1</span>&lt;&lt;<span class="number">18</span>][MAXN][MAXN][<span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">1</span>;j&lt;=n;j++) &#123;<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;d[i][j]);&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=i+<span class="number">1</span>;j&lt;=n;j++) &#123;</span><br><span class="line">			<span class="type">int</span> tmp=<span class="built_in">min</span>(d[i][j],d[j][i]);</span><br><span class="line">			<span class="keyword">if</span> (tmp&gt;=<span class="number">0</span>) &#123;del+=tmp,d[i][j]-=tmp,d[j][i]-=tmp;&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">memset</span>(res,<span class="number">0x3f</span>,<span class="built_in">sizeof</span>(res));</span><br><span class="line">	<span class="built_in">memset</span>(f,<span class="number">0x3f</span>,<span class="built_in">sizeof</span>(f));</span><br><span class="line">	res[<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;(<span class="number">1</span>&lt;&lt;n);i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">0</span>;j&lt;n;j++) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> k=<span class="number">0</span>;k&lt;n;k++) &#123;</span><br><span class="line">				<span class="keyword">if</span> ((i&amp;(<span class="number">1</span>&lt;&lt;j))&amp;&amp;(i&amp;(<span class="number">1</span>&lt;&lt;k))&amp;&amp;d[j+<span class="number">1</span>][k+<span class="number">1</span>]!=<span class="number">-1</span>) &#123;</span><br><span class="line">					res[i]=<span class="built_in">min</span>(res[i],f[i][j][k][<span class="number">1</span>]+d[j+<span class="number">1</span>][k+<span class="number">1</span>]);</span><br><span class="line">					<span class="comment">//cout &lt;&lt; i &lt;&lt; &quot;  &quot; &lt;&lt; j &lt;&lt; &quot;  &quot; &lt;&lt; k &lt;&lt; &quot;    &quot; &lt;&lt; </span></span><br><span class="line">					<span class="comment">//f[i][j][k][1] &lt;&lt; &quot;  &quot; &lt;&lt; d[j+1][k+1] &lt;&lt; &quot;    &quot; &lt;&lt; res[i] &lt;&lt; endl;</span></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">0</span>;j&lt;n;j++) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> k=<span class="number">0</span>;k&lt;n;k++) &#123;</span><br><span class="line">				<span class="keyword">if</span> ((i&amp;(<span class="number">1</span>&lt;&lt;j))&amp;&amp;(i&amp;(<span class="number">1</span>&lt;&lt;k))) &#123;</span><br><span class="line">					f[i][j][k][<span class="number">0</span>]=<span class="built_in">min</span>(f[i][j][k][<span class="number">0</span>],res[i]);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">0</span>;j&lt;n;j++) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> k=<span class="number">0</span>;k&lt;n;k++) &#123;</span><br><span class="line">				<span class="keyword">for</span> (<span class="type">int</span> l=<span class="number">0</span>;l&lt;n;l++) &#123;</span><br><span class="line">					<span class="keyword">if</span> ((i&amp;(<span class="number">1</span>&lt;&lt;j))&amp;&amp;(i&amp;(<span class="number">1</span>&lt;&lt;k))&amp;&amp;(!(i&amp;(<span class="number">1</span>&lt;&lt;l)))&amp;&amp;d[j+<span class="number">1</span>][l+<span class="number">1</span>]!=<span class="number">-1</span>) &#123;</span><br><span class="line">						f[i^(<span class="number">1</span>&lt;&lt;l)][l][k][j!=k]=<span class="built_in">min</span>(f[i^(<span class="number">1</span>&lt;&lt;l)][l][k][j==k],</span><br><span class="line">						<span class="built_in">min</span>(f[i][j][k][<span class="number">0</span>],f[i][j][k][<span class="number">1</span>])+d[j+<span class="number">1</span>][l+<span class="number">1</span>]);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//cout &lt;&lt; del &lt;&lt; endl;</span></span><br><span class="line">	<span class="keyword">if</span> (res[(<span class="number">1</span>&lt;&lt;n)<span class="number">-1</span>]==<span class="number">0x3f3f3f3f</span>) &#123;<span class="built_in">printf</span>(<span class="string">&quot;-1\n&quot;</span>);&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,del+res[(<span class="number">1</span>&lt;&lt;n)<span class="number">-1</span>]);&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="D-Just-Meeting"><a href="#D-Just-Meeting" class="headerlink" title="D. Just Meeting"></a>D. Just Meeting</h3><p><strong>难度：</strong>$\bigstar$</p>
<p><strong>题目大意：</strong></p>
<p>定义一个 $n$ 个点的无向带权完全图（$i,j$ 之间边权为 $w(i,j)$ 为正整数）是正规的，当且仅当对于任意不同的 $1\leq i,j,k\leq n$，都有 $w(i,j),w(j,k),w(k,i)$ 三个数中最小值不唯一。</p>
<p>给定点数 $n$ 和 $m$ 条带权边，问是否可以将图补全成正规的图，如果可以则请求出补全后图的边权和最小值。</p>
<p>$1\leq n,m\leq 3\times 10^5$</p>
<p><strong>题目解法：</strong></p>
<p>每个连通块是独立的，连通块之间的所有边权都设为 $1$ 即可。</p>
<p>首先容易证明 $w(i,j)\ge \min(w(j,k),w(i,k))$，所以如果我们构建图的一个生成树，那么非树边 $(i,j)$ 的权值必须大于等于它们树上路径权值的最小值。</p>
<p>再联想到最大生成树中有 $w(i,j)\leq \min(w(j,k),w(i,k))$，所以如果我们取最大生成树，就应该有 $(i,j)$ 间的权值应该恰好等于它们树上路径权值的最小值。</p>
<p>于是用维护子树大小的并查集处理一下即可，注意判定是否有解需要支持查询树链最小值。</p>
<p>时间复杂度为 $O((n+m)\log n)$。</p>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        代码
    </div>
    <div class='spoiler-content'>
        <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">300010</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">E</span> &#123;</span><br><span class="line">	<span class="type">int</span> u,v,w;</span><br><span class="line">	<span class="built_in">E</span> (<span class="type">int</span> a=<span class="number">0</span>,<span class="type">int</span> b=<span class="number">0</span>,<span class="type">int</span> c=<span class="number">0</span>) &#123;u=a,v=b,w=c;&#125;</span><br><span class="line">&#125;e[MAXN];</span><br><span class="line"><span class="type">int</span> n,m,x,y,z,f[MAXN],g[MAXN],dep[MAXN],fa[MAXN][<span class="number">22</span>],mn[MAXN][<span class="number">22</span>];</span><br><span class="line">ll res,ans;</span><br><span class="line">vector &lt; pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt; &gt; v[MAXN];</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span> <span class="params">(E a,E b)</span> </span>&#123;<span class="keyword">return</span> a.w&gt;b.w;&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">findr</span> <span class="params">(<span class="type">int</span> x)</span> </span>&#123;<span class="keyword">return</span> (f[x]==x?x:f[x]=<span class="built_in">findr</span>(f[x]));&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span> <span class="params">(<span class="type">int</span> x,<span class="type">int</span> faa,<span class="type">int</span> w)</span> </span>&#123;</span><br><span class="line">	fa[x][<span class="number">0</span>]=faa,mn[x][<span class="number">0</span>]=w,dep[x]=dep[faa]+<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">20</span>;i++) &#123;</span><br><span class="line">		fa[x][i]=fa[fa[x][i<span class="number">-1</span>]][i<span class="number">-1</span>];</span><br><span class="line">		mn[x][i]=<span class="built_in">min</span>(mn[x][i<span class="number">-1</span>],mn[fa[x][i<span class="number">-1</span>]][i<span class="number">-1</span>]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> len=v[x].<span class="built_in">size</span>();</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (v[x][i].first==faa) &#123;<span class="keyword">continue</span>;&#125;</span><br><span class="line">		<span class="built_in">dfs</span>(v[x][i].first,x,v[x][i].second);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query</span> <span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> res=<span class="number">1e9</span>;</span><br><span class="line">	<span class="keyword">if</span> (dep[x]&lt;dep[y]) &#123;<span class="built_in">swap</span>(x,y);&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">20</span>;i&gt;=<span class="number">0</span>;i--) &#123;</span><br><span class="line">		<span class="keyword">if</span> (dep[x]-(<span class="number">1</span>&lt;&lt;i)&gt;=dep[y]) &#123;</span><br><span class="line">			res=<span class="built_in">min</span>(res,mn[x][i]);</span><br><span class="line">			x=fa[x][i];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (x==y) &#123;<span class="keyword">return</span> res;&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">20</span>;i&gt;=<span class="number">0</span>;i--) &#123;</span><br><span class="line">		<span class="keyword">if</span> (fa[x][i]!=fa[y][i]) &#123;</span><br><span class="line">			res=<span class="built_in">min</span>(res,<span class="built_in">min</span>(mn[x][i],mn[y][i]));</span><br><span class="line">			x=fa[x][i],y=fa[y][i];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">min</span>(res,<span class="built_in">min</span>(mn[x][<span class="number">0</span>],mn[y][<span class="number">0</span>]));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;x,&amp;y,&amp;z);</span><br><span class="line">		e[i]=<span class="built_in">E</span>(x,y,z);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">sort</span>(e+<span class="number">1</span>,e+m+<span class="number">1</span>,cmp);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;f[i]=i,g[i]=<span class="number">1</span>;&#125;</span><br><span class="line">	res=(<span class="number">1ll</span>*n*(n<span class="number">-1</span>)/<span class="number">2</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++) &#123;</span><br><span class="line">		<span class="type">int</span> fx=<span class="built_in">findr</span>(e[i].u),fy=<span class="built_in">findr</span>(e[i].v);</span><br><span class="line">		<span class="keyword">if</span> (fx!=fy) &#123;</span><br><span class="line">			res-=<span class="number">1ll</span>*g[fx]*g[fy];</span><br><span class="line">			ans+=<span class="number">1ll</span>*g[fx]*g[fy]*e[i].w;</span><br><span class="line">			f[fx]=fy;</span><br><span class="line">			g[fy]+=g[fx];</span><br><span class="line">			v[e[i].u].<span class="built_in">push_back</span>(<span class="built_in">make_pair</span>(e[i].v,e[i].w));</span><br><span class="line">			v[e[i].v].<span class="built_in">push_back</span>(<span class="built_in">make_pair</span>(e[i].u,e[i].w));</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">findr</span>(i)==i) &#123;<span class="built_in">dfs</span>(i,<span class="number">0</span>,<span class="number">0</span>);&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">query</span>(e[i].u,e[i].v)!=e[i].w) &#123;<span class="built_in">printf</span>(<span class="string">&quot;-1\n&quot;</span>);<span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	ans+=res;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="E-Chemistry"><a href="#E-Chemistry" class="headerlink" title="*E. Chemistry"></a>*E. Chemistry</h3><p><strong>难度：</strong>$\bigstar\bigstar$</p>
<hr>
<h3 id="F-Interval-Graph"><a href="#F-Interval-Graph" class="headerlink" title="F. Interval Graph"></a>F. Interval Graph</h3><p><strong>难度：</strong>$\bigstar\bigstar$</p>
<p><strong>题目大意：</strong></p>
<p>给定 $n$ 个带权区间，你可以删除一些区间，对剩下的区间建区间图（每个区间对应一个点，两个区间有交就连边），要求该图无环，求剩下的区间权值和的最大值。</p>
<p>$1\leq n\leq 2.5\times 10^5$</p>
<p><strong>题目解法：</strong></p>
<p>区间图是弦图，因此有环当且仅当有三元环，也等价于有三个区间存在公共点。</p>
<p>所以我们需要挑选一些区间，使得被这些区间覆盖后每个点至多被覆盖两次，这是经典的 <a target="_blank" rel="noopener" href="https://www.luogu.com.cn/blog/ix-35/solution-p6967">Delight for a Cat 型费用流建模</a>，建出图后用原始对偶费用流求解即可，最大流只为 $2$ 所以只要做两次最长路。</p>
<p>初始势能有一种简单设法：$E_i=-W\times i$，其中 $W$ 是权值最大值。</p>
<p>时间复杂度为 $O(n\log n)$。</p>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        代码
    </div>
    <div class='spoiler-content'>
        <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">750010</span>;</span><br><span class="line"><span class="type">int</span> n,x[MAXN],y[MAXN],eg,hd[MAXN],ver[<span class="number">2</span>*MAXN],nx[<span class="number">2</span>*MAXN],las[MAXN],vis[MAXN];</span><br><span class="line">ll ans,shi=<span class="number">1e12</span>,z[MAXN],w[<span class="number">2</span>*MAXN],dis[MAXN],sh[MAXN];</span><br><span class="line">priority_queue &lt; pair&lt;ll,<span class="type">int</span>&gt; &gt; q;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add_edge</span> <span class="params">(<span class="type">int</span> x,<span class="type">int</span> y,ll z)</span> </span>&#123;</span><br><span class="line">	ver[++eg]=y;</span><br><span class="line">	nx[eg]=hd[x],w[eg]=z;</span><br><span class="line">	hd[x]=eg;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%lld&quot;</span>,&amp;x[i],&amp;y[i],&amp;z[i]);</span><br><span class="line">		y[i]++;</span><br><span class="line">		<span class="built_in">add_edge</span>(x[i],y[i],<span class="number">1ll</span>*shi*(y[i]-x[i])-z[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">500000</span>;i++) &#123;<span class="built_in">add_edge</span>(i,i+<span class="number">1</span>,shi);&#125;</span><br><span class="line">	<span class="built_in">memset</span>(dis,<span class="number">0x3f</span>,<span class="built_in">sizeof</span>(dis));</span><br><span class="line">	dis[<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">	q.<span class="built_in">push</span>(<span class="built_in">make_pair</span>(<span class="number">0</span>,<span class="number">1</span>));</span><br><span class="line">	<span class="keyword">while</span> (q.<span class="built_in">size</span>()) &#123;</span><br><span class="line">		pair &lt;ll,<span class="type">int</span>&gt; a=q.<span class="built_in">top</span>();</span><br><span class="line">		q.<span class="built_in">pop</span>();</span><br><span class="line">		<span class="keyword">if</span> (vis[a.second]) &#123;<span class="keyword">continue</span>;&#125;</span><br><span class="line">		vis[a.second]=<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=hd[a.second];i;i=nx[i]) &#123;</span><br><span class="line">			<span class="keyword">if</span> (dis[ver[i]]&gt;dis[a.second]+w[i]) &#123;</span><br><span class="line">				dis[ver[i]]=dis[a.second]+w[i],las[ver[i]]=i;</span><br><span class="line">				q.<span class="built_in">push</span>(<span class="built_in">make_pair</span>(-dis[ver[i]],ver[i]));</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	ans+=shi*<span class="number">500000ll</span>-dis[<span class="number">500001</span>];</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">500001</span>;i++) &#123;sh[i]=-shi*i+dis[i];&#125;</span><br><span class="line">	<span class="comment">//for (int i=1;i&lt;=10;i++) &#123;</span></span><br><span class="line">	<span class="comment">//	cout &lt;&lt; i &lt;&lt; &quot;  &quot; &lt;&lt; sh[i] &lt;&lt; endl;</span></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line">	<span class="type">int</span> tmp=<span class="number">500001</span>;</span><br><span class="line">	eg=<span class="number">0</span>;</span><br><span class="line">	<span class="built_in">memset</span>(hd,<span class="number">0</span>,<span class="built_in">sizeof</span>(hd));</span><br><span class="line">	<span class="built_in">memset</span>(dis,<span class="number">0x3f</span>,<span class="built_in">sizeof</span>(dis));</span><br><span class="line">	<span class="built_in">memset</span>(vis,<span class="number">0</span>,<span class="built_in">sizeof</span>(vis));</span><br><span class="line">	<span class="keyword">while</span> (tmp!=<span class="number">1</span>) &#123;</span><br><span class="line">		<span class="type">int</span> xx=las[tmp];</span><br><span class="line">		<span class="keyword">if</span> (xx&lt;=n) &#123;</span><br><span class="line">			vis[xx]=<span class="number">1</span>;</span><br><span class="line">			<span class="built_in">add_edge</span>(y[xx],x[xx],z[xx]+sh[y[xx]]-sh[x[xx]]);</span><br><span class="line">			<span class="comment">//cout &lt;&lt; y[xx] &lt;&lt; &quot;  &quot; &lt;&lt; x[xx] &lt;&lt; &quot;  &quot; &lt;&lt; </span></span><br><span class="line">			<span class="comment">//z[xx]+sh[y[xx]]-sh[x[xx]] &lt;&lt; endl;</span></span><br><span class="line">			tmp=x[xx];</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="built_in">add_edge</span>(tmp,tmp<span class="number">-1</span>,sh[tmp]-sh[tmp<span class="number">-1</span>]);</span><br><span class="line">			tmp--;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">500000</span>;i++) &#123;<span class="built_in">add_edge</span>(i,i+<span class="number">1</span>,sh[i]-sh[i+<span class="number">1</span>]);&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (!vis[i]) &#123;<span class="built_in">add_edge</span>(x[i],y[i],-z[i]+sh[x[i]]-sh[y[i]]);&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">memset</span>(vis,<span class="number">0</span>,<span class="built_in">sizeof</span>(vis));</span><br><span class="line">	dis[<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">	q.<span class="built_in">push</span>(<span class="built_in">make_pair</span>(<span class="number">0</span>,<span class="number">1</span>));</span><br><span class="line">	<span class="keyword">while</span> (q.<span class="built_in">size</span>()) &#123;</span><br><span class="line">		pair &lt;ll,<span class="type">int</span>&gt; a=q.<span class="built_in">top</span>();</span><br><span class="line">		q.<span class="built_in">pop</span>();</span><br><span class="line">		<span class="keyword">if</span> (vis[a.second]) &#123;<span class="keyword">continue</span>;&#125;</span><br><span class="line">		vis[a.second]=<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=hd[a.second];i;i=nx[i]) &#123;</span><br><span class="line">			<span class="keyword">if</span> (dis[ver[i]]&gt;dis[a.second]+w[i]) &#123;</span><br><span class="line">				dis[ver[i]]=dis[a.second]+w[i],las[ver[i]]=i;</span><br><span class="line">				q.<span class="built_in">push</span>(<span class="built_in">make_pair</span>(-dis[ver[i]],ver[i]));</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	ans+=sh[<span class="number">1</span>]-sh[<span class="number">500001</span>]-dis[<span class="number">500001</span>];</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="G-LCS-8"><a href="#G-LCS-8" class="headerlink" title="G. LCS 8"></a>G. LCS 8</h3><p><strong>难度：</strong>$\bigstar\bigstar\bigstar\bigstar$</p>
<p><strong>题目大意：</strong></p>
<p>给定长度为 $n$ 的字符串 $S$ 和 $k$，求长度为 $n$ 的字符串 $T$ 的数量，使得 $S$ 与 $T$ 的最长公共子序列长度不小于 $n-k$，字符集为大写字母。</p>
<p>$1\leq n\leq 50000,  0\leq k\leq 3$</p>
<p><strong>题目解法：</strong></p>
<p>解一（代码区发现的解法）：</p>
<p>考虑用 DP 解决 LCS 问题时需要用到的结构，尝试对这一结构进行递推计数。</p>
<p>设 $dp(x,a_0,a_1,a_2,a_3)$ 表示已经填入 $T_1,\ldots,T_x$，并且 $a_i$ 是使得 $\operatorname{LCS}(T_1\ldots T_x,S_1\ldots S_{x-i+a_i})=x-i$ 成立的最小自然数，其中下标取 $x-i+a_i$ 的理由是注意到这个下标应当在 $[x-i,x-i+3]$ 之间（否则就是无用的状态），也就是说 $a_i\in [0,3]$，特别地如果 $a_i$ 不存在则认为其等于 $4$。</p>
<p>增加一个数时通过简单的讨论转移即可。</p>
<p>时间复杂度为 $O(k^k\times n|\Sigma|)$。</p>
<p>解二（题解）：</p>
<p>直接尝试刻画求 LCS 时 DP 数组的形态。</p>
<p>设 $f(i,j)$ 表示 $\operatorname{LCS}(T_1\ldots T_i,S_1\ldots S_j)$，将状态设为 $(i,f(i,i-k),\ldots,f(i,i),\ldots,f(i,i+k))$，事实上由于 $f(i,j)-f(i,j-1)\in [0,1]$，并且我们只需要 $f(i,i)\in [i-k,i]$ 的状态，所以总的状态数是 $O(2^{2k}\times nk)$。</p>
<p>转移需要进行一定的预处理，比之上一种做法复杂得多。</p>
<p>最终的时间复杂度为 $O(2^{4k}|\Sigma|+2^{2k}\times nk)$。</p>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        代码
    </div>
    <div class='spoiler-content'>
        <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">50010</span>,P=<span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line"><span class="type">int</span> n,k,ans,a[<span class="number">4</span>],b[<span class="number">4</span>],dp[<span class="number">2</span>][<span class="number">630</span>],nx[MAXN][<span class="number">26</span>];</span><br><span class="line"><span class="type">char</span> c[MAXN];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">encode</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">3</span>;i&gt;=<span class="number">0</span>;i--) &#123;res=res*<span class="number">5</span>+a[i];&#125;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">decode</span> <span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">3</span>;i++) &#123;b[i]=x%<span class="number">5</span>;x/=<span class="number">5</span>;&#125;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,c+<span class="number">1</span>);</span><br><span class="line">	n=<span class="built_in">strlen</span>(c+<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=n;i&gt;=<span class="number">1</span>;i--) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">0</span>;j&lt;=<span class="number">25</span>;j++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (c[i]-<span class="string">&#x27;A&#x27;</span>!=j) &#123;nx[i][j]=nx[i+<span class="number">1</span>][j]+<span class="number">1</span>;&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;k);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">3</span>;i++) &#123;a[i]=i;&#125;</span><br><span class="line">	dp[<span class="number">0</span>][<span class="built_in">encode</span>()]=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		<span class="built_in">memset</span>(dp[i&amp;<span class="number">1</span>],<span class="number">0</span>,<span class="built_in">sizeof</span>(dp[i&amp;<span class="number">1</span>]));</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">0</span>;j&lt;=<span class="number">624</span>;j++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (!dp[(i&amp;<span class="number">1</span>)^<span class="number">1</span>][j]) &#123;<span class="keyword">continue</span>;&#125;</span><br><span class="line">			<span class="built_in">decode</span>(j);</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> k=<span class="number">0</span>;k&lt;=<span class="number">25</span>;k++) &#123;</span><br><span class="line">				a[<span class="number">0</span>]=<span class="number">4</span>,a[<span class="number">1</span>]=b[<span class="number">0</span>],a[<span class="number">2</span>]=b[<span class="number">1</span>],a[<span class="number">3</span>]=b[<span class="number">2</span>];</span><br><span class="line">				<span class="keyword">for</span> (<span class="type">int</span> l=<span class="number">0</span>;l&lt;=<span class="number">3</span>;l++) &#123;a[l]=<span class="built_in">min</span>(a[l],b[l]+nx[i-l+b[l]][k]);&#125;</span><br><span class="line">				<span class="comment">//cout &lt;&lt; i &lt;&lt; &quot;  &quot; &lt;&lt; j &lt;&lt; &quot;  &quot; &lt;&lt; k &lt;&lt; &quot;  &quot; &lt;&lt; a[0] &lt;&lt; </span></span><br><span class="line">				<span class="comment">//&quot;  &quot; &lt;&lt; b[0] &lt;&lt; &quot;  &quot; &lt;&lt; nx[i+b[0]][k] &lt;&lt; endl;</span></span><br><span class="line">				dp[i&amp;<span class="number">1</span>][<span class="built_in">encode</span>()]=(dp[i&amp;<span class="number">1</span>][<span class="built_in">encode</span>()]+dp[(i&amp;<span class="number">1</span>)^<span class="number">1</span>][j])%P;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">0</span>;j&lt;=<span class="number">624</span>;j++) &#123;</span><br><span class="line">		<span class="built_in">decode</span>(j);</span><br><span class="line">		<span class="keyword">if</span> (b[k]&lt;=k) &#123;ans=(ans+dp[n&amp;<span class="number">1</span>][j])%P;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="H-Alchemy"><a href="#H-Alchemy" class="headerlink" title="H. Alchemy"></a>H. Alchemy</h3><p><strong>难度：</strong>$\bigstar$</p>
<p><strong>题目大意：</strong></p>
<p>现在有一堆 $[0,n)$ 中的数，其中 $i$ 有 $c_i$ 个，你每次可以选择一些数将它们删除，然后加入它们的 $\operatorname{mex}$，最后你需要使得只剩一个数，问这个数的最大值。</p>
<p>$1\leq n\leq 10^5$</p>
<p><strong>题目解法：</strong></p>
<p>假设 $\sum c_i=1$，那么答案是显然的（但注意并不一定是那个为 $1$ 的 $c_i$，当 $i=0$ 时）。</p>
<p>否则，先考虑枚举 $x$，要拼出 $x$，首先可以把所有 $\ge x$ 的数都回收成 $0$，然后这样考虑：要拼出一个 $x$ 需要 $0,\ldots,x-1$ 各一个，要拼出 $x-1$ 需要 $0,\ldots,x-2$ 各一个，要拼出两个 $x-2$ 需要 $0,\ldots,x-3$ 各两个，以此类推一直分解到 $0$，看看 $0$ 够不够用即可，如果过程中某个 $c_i\ne 0$，那么如果 $c_i$ 小于等于实际需要，那么可以将实际需要的抵消掉 $c_i$，如果 $c_i$ 大于实际需要那么可以将多余的回收成 $0$。</p>
<p>根据上述过程可知答案具有可二分性，二分答案并判定，显然答案不超过 $2\times 10^5$，时间复杂度为 $O(n\log n)$。</p>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        代码
    </div>
    <div class='spoiler-content'>
        <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">200010</span>;</span><br><span class="line"><span class="type">int</span> n,mn,c[MAXN];</span><br><span class="line">ll sum;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">chk</span> <span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">	ll cnt=c[<span class="number">0</span>];</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=x;i&lt;=<span class="number">100000</span>;i++) &#123;cnt+=c[i];&#125;</span><br><span class="line">	ll sum=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=x<span class="number">-1</span>;i&gt;=<span class="number">1</span>;i--) &#123;</span><br><span class="line">		<span class="keyword">if</span> (c[i]&lt;sum) &#123;sum+=sum-c[i];&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;cnt+=c[i]-sum;&#125;</span><br><span class="line">		<span class="keyword">if</span> (sum&gt;<span class="number">1e17</span>) &#123;<span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> (sum&lt;=cnt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;=n<span class="number">-1</span>;i++) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;c[i]);</span><br><span class="line">		<span class="keyword">if</span> (c[i]) &#123;mn=i;&#125;</span><br><span class="line">		sum+=c[i];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (sum==<span class="number">1</span>) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">max</span>(mn,<span class="number">1</span>));</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> l=<span class="number">1</span>,r=<span class="number">200000</span>;</span><br><span class="line">	<span class="keyword">while</span> (l&lt;r) &#123;</span><br><span class="line">		<span class="type">int</span> mid=(l+r+<span class="number">1</span>)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">chk</span>(mid)) &#123;l=mid;&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;r=mid<span class="number">-1</span>;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,l);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="I-Query-on-a-Tree-17"><a href="#I-Query-on-a-Tree-17" class="headerlink" title="I. Query on a Tree 17"></a>I. Query on a Tree 17</h3><p><strong>难度：</strong>$\bigstar\bigstar\bigstar$</p>
<p><strong>题目大意：</strong></p>
<p>维护 $n$ 个点的以 $1$ 为根的点带权树，支持 $q$ 次子树或路径修改点权，每次修改后输出最浅的带权重心。</p>
<p>$1\leq n,q\leq 10^5$</p>
<p><strong>题目解法：</strong></p>
<p>一个结论是：写出树的 DFS 序，并且将 $i$ 重复 $a_i$（点权）次，那么最浅的带权重心的子树对应的区间一定包含这个序列的中位数（因为其长度应该大于等于总长一半，否则可以再往上走一步）。</p>
<p>于是我们维护这个序列长度和按照 DFS 序的点权前缀和，这当然就契合重链剖分的维护特点，于是我们每次查询中位数，然后从那个点树上倍增就可以找到带权重心。</p>
<p>时间复杂度为 $O(n+q\log^2 n)$。</p>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        代码
    </div>
    <div class='spoiler-content'>
        <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">100010</span>;</span><br><span class="line"><span class="type">int</span> n,q,op,x,y,tot,f[MAXN][<span class="number">20</span>],dep[MAXN],siz[MAXN],wsn[MAXN],tp[MAXN];</span><br><span class="line"><span class="type">int</span> dfn[MAXN],ed[MAXN],rev[MAXN];</span><br><span class="line">ll s,tg[MAXN*<span class="number">4</span>],sum[MAXN*<span class="number">4</span>];</span><br><span class="line">vector &lt;<span class="type">int</span>&gt; v[MAXN];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs1</span> <span class="params">(<span class="type">int</span> x,<span class="type">int</span> fa)</span> </span>&#123;</span><br><span class="line">	siz[x]=<span class="number">1</span>,dep[x]=dep[fa]+<span class="number">1</span>,f[x][<span class="number">0</span>]=fa;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">18</span>;i++) &#123;f[x][i]=f[f[x][i<span class="number">-1</span>]][i<span class="number">-1</span>];&#125;</span><br><span class="line">	<span class="type">int</span> len=v[x].<span class="built_in">size</span>();</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (v[x][i]==fa) &#123;<span class="keyword">continue</span>;&#125;</span><br><span class="line">		<span class="built_in">dfs1</span>(v[x][i],x);</span><br><span class="line">		siz[x]+=siz[v[x][i]];</span><br><span class="line">		<span class="keyword">if</span> (siz[v[x][i]]&gt;siz[wsn[x]]) &#123;wsn[x]=v[x][i];&#125; </span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs2</span> <span class="params">(<span class="type">int</span> x,<span class="type">int</span> fa)</span> </span>&#123;</span><br><span class="line">	++tot;</span><br><span class="line">	dfn[x]=ed[x]=tot,rev[tot]=x;</span><br><span class="line">	<span class="keyword">if</span> (wsn[x]) &#123;</span><br><span class="line">		tp[wsn[x]]=tp[x];</span><br><span class="line">		<span class="built_in">dfs2</span>(wsn[x],x);</span><br><span class="line">		ed[x]=ed[wsn[x]];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> len=v[x].<span class="built_in">size</span>();</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (v[x][i]==fa||v[x][i]==wsn[x]) &#123;<span class="keyword">continue</span>;&#125;</span><br><span class="line">		tp[v[x][i]]=v[x][i];</span><br><span class="line">		<span class="built_in">dfs2</span>(v[x][i],x);</span><br><span class="line">		ed[x]=ed[v[x][i]];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pd</span> <span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (tg[p]==<span class="number">0</span>) &#123;<span class="keyword">return</span>;&#125;</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	tg[p&lt;&lt;<span class="number">1</span>]+=tg[p],tg[(p&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>]+=tg[p];</span><br><span class="line">	sum[p&lt;&lt;<span class="number">1</span>]+=tg[p]*(mid-l+<span class="number">1</span>),sum[(p&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>]+=tg[p]*(r-mid);</span><br><span class="line">	tg[p]=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">return</span>; </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">modify</span> <span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> xl,<span class="type">int</span> xr,<span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (xr&lt;l||r&lt;xl) &#123;<span class="keyword">return</span>;&#125;</span><br><span class="line">	<span class="keyword">if</span> (xl&lt;=l&amp;&amp;r&lt;=xr) &#123;</span><br><span class="line">		sum[p]+=<span class="number">1ll</span>*(r-l+<span class="number">1</span>)*v;</span><br><span class="line">		tg[p]+=v;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">pd</span>(p,l,r);</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">modify</span>(p&lt;&lt;<span class="number">1</span>,l,mid,xl,xr,v);</span><br><span class="line">	<span class="built_in">modify</span>((p&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>,mid+<span class="number">1</span>,r,xl,xr,v);</span><br><span class="line">	sum[p]=sum[p&lt;&lt;<span class="number">1</span>]+sum[(p&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>];</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">query</span> <span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> xl,<span class="type">int</span> xr)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (xr&lt;l||r&lt;xl) &#123;<span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line">	<span class="keyword">if</span> (xl&lt;=l&amp;&amp;r&lt;=xr) &#123;<span class="keyword">return</span> sum[p];&#125;</span><br><span class="line">	<span class="built_in">pd</span>(p,l,r);</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">query</span>(p&lt;&lt;<span class="number">1</span>,l,mid,xl,xr)+<span class="built_in">query</span>((p&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>,mid+<span class="number">1</span>,r,xl,xr);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query</span> <span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">18</span>;i&gt;=<span class="number">0</span>;i--) &#123;</span><br><span class="line">		<span class="keyword">if</span> (f[x][i]==<span class="number">0</span>) &#123;<span class="keyword">continue</span>;&#125;</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">query</span>(<span class="number">1</span>,<span class="number">1</span>,n,dfn[f[x][i]],ed[f[x][i]])*<span class="number">2</span>&lt;=s) &#123;x=f[x][i];&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">query</span>(<span class="number">1</span>,<span class="number">1</span>,n,dfn[x],ed[x])*<span class="number">2</span>&lt;=s) &#123;x=f[x][<span class="number">0</span>];&#125;</span><br><span class="line">	<span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n<span class="number">-1</span>;i++) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;x,&amp;y);</span><br><span class="line">		v[x].<span class="built_in">push_back</span>(y),v[y].<span class="built_in">push_back</span>(x);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">dfs1</span>(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">	tp[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">dfs2</span>(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;q);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=q;i++) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;op);</span><br><span class="line">		<span class="keyword">if</span> (op==<span class="number">1</span>) &#123;</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);</span><br><span class="line">			<span class="comment">//if (n==100) &#123;cout &lt;&lt; op &lt;&lt; &quot;  &quot; &lt;&lt; x &lt;&lt; endl;&#125;</span></span><br><span class="line">			<span class="built_in">modify</span>(<span class="number">1</span>,<span class="number">1</span>,n,dfn[x],ed[x],<span class="number">1</span>); </span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;x,&amp;y);</span><br><span class="line">			<span class="comment">//if (n==100) &#123;cout &lt;&lt; op &lt;&lt; &quot;  &quot; &lt;&lt; x &lt;&lt; &quot;  &quot; &lt;&lt; y &lt;&lt; endl;&#125;</span></span><br><span class="line">			<span class="type">int</span> fx=tp[x],fy=tp[y];</span><br><span class="line">			<span class="keyword">while</span> (fx!=fy) &#123;</span><br><span class="line">				<span class="keyword">if</span> (dep[fx]&lt;dep[fy]) &#123;<span class="built_in">swap</span>(fx,fy),<span class="built_in">swap</span>(x,y);&#125;</span><br><span class="line">				<span class="built_in">modify</span>(<span class="number">1</span>,<span class="number">1</span>,n,dfn[fx],dfn[x],<span class="number">1</span>);</span><br><span class="line">				x=f[fx][<span class="number">0</span>];</span><br><span class="line">				fx=tp[x];</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (dep[x]&lt;dep[y]) &#123;<span class="built_in">swap</span>(x,y);&#125;</span><br><span class="line">			<span class="built_in">modify</span>(<span class="number">1</span>,<span class="number">1</span>,n,dfn[y],dfn[x],<span class="number">1</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="type">int</span> l=<span class="number">1</span>,r=n;</span><br><span class="line">		s=sum[<span class="number">1</span>];</span><br><span class="line">		<span class="comment">//for (int j=1;j&lt;=n;j++) &#123;</span></span><br><span class="line">		<span class="comment">//	cout &lt;&lt; j &lt;&lt; &quot;  &quot; &lt;&lt; rev[j] &lt;&lt; &quot;  &quot; &lt;&lt; query(1,1,n,j,j) &lt;&lt; endl;</span></span><br><span class="line">		<span class="comment">//&#125;</span></span><br><span class="line">		<span class="keyword">while</span> (l&lt;r) &#123;</span><br><span class="line">			<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">query</span>(<span class="number">1</span>,<span class="number">1</span>,n,<span class="number">1</span>,mid)*<span class="number">2</span>&lt;s) &#123;l=mid+<span class="number">1</span>;&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;r=mid;&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//cout &lt;&lt; rev[l] &lt;&lt; &quot;  &quot; &lt;&lt; s &lt;&lt; endl;</span></span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">query</span>(rev[l]));</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="J-Remote-Control"><a href="#J-Remote-Control" class="headerlink" title="J. Remote Control"></a>J. Remote Control</h3><p><strong>难度：</strong>$\bigstar$</p>
<p><strong>题目大意：</strong></p>
<p>给定长度为 $n$ 的操作序列，包含 $\text{L,R,U,D}$ 四种指令，一个机器人从坐标系中某点出发，依次按照对应指令向左右上下行走一个单位长度，特别的是，如果行动后会到达 $(0,0)$，那么机器人会忽视这个指令。</p>
<p>现在给定 $q$ 组 $(x,y)$，表示机器人的起点，问每组起点对应的终点。</p>
<p>$1\leq n,q\leq 3\times 10^5$</p>
<p><strong>题目解法：</strong></p>
<p>首先预处理 $f(i)$ 表示如果机器人位于执行一次第 $i$ 个指令后就会到达 $(0,0)$ 的位置，那么它依次执行指令 $i+1,\ldots,n$ 后会到哪里，状态数是 $O(n)$，而转移只需要考虑机器人下一次碰到 $(0,0)$ 四周的时刻即可。</p>
<p>对于询问，也是找到机器人第一次碰到 $(0,0)$ 四周的时刻，然后根据 $f(i)$ 计算答案。</p>
<p>时间复杂度为 $O((n+q)\log n)$。</p>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        代码
    </div>
    <div class='spoiler-content'>
        <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">300010</span>;</span><br><span class="line"><span class="type">int</span> n,q,x,y,sumx[MAXN],sumy[MAXN],dpx[MAXN],dpy[MAXN];</span><br><span class="line"><span class="type">char</span> c[MAXN];</span><br><span class="line">map &lt; pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt;,<span class="type">int</span> &gt; mp;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%s&quot;</span>,&amp;n,c+<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		sumx[i]=sumx[i<span class="number">-1</span>],sumy[i]=sumy[i<span class="number">-1</span>];</span><br><span class="line">		<span class="keyword">if</span> (c[i]==<span class="string">&#x27;L&#x27;</span>) &#123;sumx[i]--;&#125;</span><br><span class="line">		<span class="keyword">if</span> (c[i]==<span class="string">&#x27;R&#x27;</span>) &#123;sumx[i]++;&#125;</span><br><span class="line">		<span class="keyword">if</span> (c[i]==<span class="string">&#x27;U&#x27;</span>) &#123;sumy[i]++;&#125;</span><br><span class="line">		<span class="keyword">if</span> (c[i]==<span class="string">&#x27;D&#x27;</span>) &#123;sumy[i]--;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=n;i&gt;=<span class="number">1</span>;i--) &#123;</span><br><span class="line">		<span class="keyword">if</span> (c[i]==<span class="string">&#x27;L&#x27;</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (mp.<span class="built_in">find</span>(<span class="built_in">make_pair</span>(sumx[i]<span class="number">-1</span>,sumy[i]))==mp.<span class="built_in">end</span>()) &#123;</span><br><span class="line">				dpx[i]=<span class="number">1</span>+sumx[n]-sumx[i],dpy[i]=sumy[n]-sumy[i];</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="type">int</span> tmp=mp[<span class="built_in">make_pair</span>(sumx[i]<span class="number">-1</span>,sumy[i])];</span><br><span class="line">				dpx[i]=dpx[tmp],dpy[i]=dpy[tmp];</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (c[i]==<span class="string">&#x27;R&#x27;</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (mp.<span class="built_in">find</span>(<span class="built_in">make_pair</span>(sumx[i]+<span class="number">1</span>,sumy[i]))==mp.<span class="built_in">end</span>()) &#123;</span><br><span class="line">				dpx[i]=<span class="number">-1</span>+sumx[n]-sumx[i],dpy[i]=sumy[n]-sumy[i];</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="type">int</span> tmp=mp[<span class="built_in">make_pair</span>(sumx[i]+<span class="number">1</span>,sumy[i])];</span><br><span class="line">				dpx[i]=dpx[tmp],dpy[i]=dpy[tmp];</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (c[i]==<span class="string">&#x27;U&#x27;</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (mp.<span class="built_in">find</span>(<span class="built_in">make_pair</span>(sumx[i],sumy[i]+<span class="number">1</span>))==mp.<span class="built_in">end</span>()) &#123;</span><br><span class="line">				dpx[i]=sumx[n]-sumx[i],dpy[i]=<span class="number">-1</span>+sumy[n]-sumy[i];</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="type">int</span> tmp=mp[<span class="built_in">make_pair</span>(sumx[i],sumy[i]+<span class="number">1</span>)];</span><br><span class="line">				dpx[i]=dpx[tmp],dpy[i]=dpy[tmp];</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> (mp.<span class="built_in">find</span>(<span class="built_in">make_pair</span>(sumx[i],sumy[i]<span class="number">-1</span>))==mp.<span class="built_in">end</span>()) &#123;</span><br><span class="line">				dpx[i]=sumx[n]-sumx[i],dpy[i]=<span class="number">1</span>+sumy[n]-sumy[i];</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="type">int</span> tmp=mp[<span class="built_in">make_pair</span>(sumx[i],sumy[i]<span class="number">-1</span>)];</span><br><span class="line">				dpx[i]=dpx[tmp],dpy[i]=dpy[tmp];</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		mp[<span class="built_in">make_pair</span>(sumx[i],sumy[i])]=i;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;q);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=q;i++) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;x,&amp;y);</span><br><span class="line">		<span class="keyword">if</span> (mp.<span class="built_in">find</span>(<span class="built_in">make_pair</span>(-x,-y))==mp.<span class="built_in">end</span>()) &#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;%d %d\n&quot;</span>,x+sumx[n],y+sumy[n]);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="type">int</span> tmp=mp[<span class="built_in">make_pair</span>(-x,-y)];</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;%d %d\n&quot;</span>,dpx[tmp],dpy[tmp]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="K-Sewing-Graph"><a href="#K-Sewing-Graph" class="headerlink" title="K. Sewing Graph"></a>K. Sewing Graph</h3><p><strong>难度：</strong>$\bigstar$</p>
<p><strong>题目大意：</strong></p>
<p>给定 $n$ 个平面上的点，请构造一个尽可能短的由这些点组成的序列 $s_1,\ldots,s_m$，使得：</p>
<ul>
<li>分别连接 $s_{2k}$ 和 $s_{2k+1}$，构成的图连通且没有两条边交叉；</li>
<li>分别连接 $s_{2k-1}$ 和 $s_{2k}$，构成的图连通且没有两条边交叉；</li>
</ul>
<p>求构造 $m$ 和点列。</p>
<p>$2\leq n\leq 1000$</p>
<p><strong>题目解法：</strong></p>
<p>按横坐标第一关键字，纵坐标第二关键字排序为 $p_1,\ldots,p_n$，然后令序列为 $p_1,\ldots,p_{n-1},p_n,p_{n-1},\ldots,p_1$ 即可。</p>
<p>时间复杂度为 $O(n\log n)$，这是本场比赛的签到题。</p>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        代码
    </div>
    <div class='spoiler-content'>
        <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1010</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">P</span> &#123;</span><br><span class="line">	<span class="type">int</span> x,y,id;</span><br><span class="line">&#125;p[MAXN];</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span> <span class="params">(P a,P b)</span> </span>&#123;<span class="keyword">return</span> (a.x==b.x?a.y&lt;b.y:a.x&lt;b.x);&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;p[i].x,&amp;p[i].y);</span><br><span class="line">		p[i].id=i;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">sort</span>(p+<span class="number">1</span>,p+n+<span class="number">1</span>,cmp);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="number">2</span>*n<span class="number">-1</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,p[i].id);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=n<span class="number">-1</span>;i&gt;=<span class="number">1</span>;i--) &#123;<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,p[i].id);&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="L-Steel-Slicing-2"><a href="#L-Steel-Slicing-2" class="headerlink" title="*L. Steel Slicing 2"></a>*L. Steel Slicing 2</h3><p><strong>难度：</strong>$\bigstar\bigstar\bigstar$</p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>
    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2023/09/29/%E4%B8%93%E9%A2%98%E9%A2%98%E8%A7%A3/XR-4/" rel="prev" title="专题题解 - XR-4">
                  <i class="fa fa-chevron-left"></i> 专题题解 - XR-4
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2023/09/29/%E4%B8%93%E9%A2%98%E9%A2%98%E8%A7%A3/XXIOpenCup,GrandPrixofNizhnyNovgorod/" rel="next" title="专题题解 - XXI Open Cup, Grand Prix of Nizhny Novgorod">
                  专题题解 - XXI Open Cup, Grand Prix of Nizhny Novgorod <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ix35</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  

  <script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.2.8/pdfobject.min.js","integrity":"sha256-tu9j5pBilBQrWSDePOOajCUdz6hWsid/lBNzK4KgEPM="},"url":"/lib/pdf/web/viewer.html"}</script>
  <script src="/js/third-party/tags/pdf.js"></script>




  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.0/katex.min.css" integrity="sha256-uik/hNqHWZldXh/0K35nqOSCff9F61/ZOFReqNOBgB0=" crossorigin="anonymous">



</body>
</html>
