<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css" integrity="sha256-xejo6yLi6vGtAjcMIsY8BHdKsLg7QynVlFMzdQgUuy8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"itz-ix35.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.12.3","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"show_result":true,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="持续更新。">
<meta property="og:type" content="article">
<meta property="og:title" content="UOJ 题解">
<meta property="og:url" content="https://itz-ix35.github.io/2023/09/29/UOJ%20%E9%A2%98%E8%A7%A3/index.html">
<meta property="og:site_name" content="ix35&#39;s Blog">
<meta property="og:description" content="持续更新。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.luogu.com.cn/upload/image_hosting/2nz9sd99.png">
<meta property="og:image" content="https://cdn.luogu.com.cn/upload/image_hosting/xlwpl21b.png">
<meta property="og:image" content="https://cdn.luogu.com.cn/upload/image_hosting/k8frnvoo.png">
<meta property="og:image" content="https://itz-ix35.github.io/2023/09/29/UOJ%20%E9%A2%98%E8%A7%A3/pic1.png">
<meta property="og:image" content="https://itz-ix35.github.io/2023/09/29/UOJ%20%E9%A2%98%E8%A7%A3/pic2.png">
<meta property="article:published_time" content="2023-09-29T12:47:44.098Z">
<meta property="article:modified_time" content="2024-06-02T05:13:48.937Z">
<meta property="article:author" content="ix35">
<meta property="article:tag" content="OI">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.luogu.com.cn/upload/image_hosting/2nz9sd99.png">


<link rel="canonical" href="https://itz-ix35.github.io/2023/09/29/UOJ%20%E9%A2%98%E8%A7%A3/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://itz-ix35.github.io/2023/09/29/UOJ%20%E9%A2%98%E8%A7%A3/","path":"2023/09/29/UOJ 题解/","title":"UOJ 题解"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>UOJ 题解 | ix35's Blog</title>
  






  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">ix35's Blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-A-B-Problem"><span class="nav-number">1.</span> <span class="nav-text">#1. A+B Problem</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%A7%E6%84%8F%EF%BC%9A"><span class="nav-number">1.1.</span> <span class="nav-text">题目大意：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A"><span class="nav-number">1.2.</span> <span class="nav-text">题解：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E3%80%90NOI2014%E3%80%91%E8%B5%B7%E5%BA%8A%E5%9B%B0%E9%9A%BE%E7%BB%BC%E5%90%88%E7%97%87"><span class="nav-number">2.</span> <span class="nav-text">#2. 【NOI2014】起床困难综合症</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%A7%E6%84%8F%EF%BC%9A-1"><span class="nav-number">2.1.</span> <span class="nav-text">题目大意：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-1"><span class="nav-number">2.2.</span> <span class="nav-text">题解：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E3%80%90NOI2014%E3%80%91%E9%AD%94%E6%B3%95%E6%A3%AE%E6%9E%97"><span class="nav-number">3.</span> <span class="nav-text">#3. 【NOI2014】魔法森林</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%A7%E6%84%8F%EF%BC%9A-2"><span class="nav-number">3.1.</span> <span class="nav-text">题目大意：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-2"><span class="nav-number">3.2.</span> <span class="nav-text">题解：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E3%80%90NOI2014%E3%80%91%E6%B6%88%E9%99%A4%E6%B8%B8%E6%88%8F"><span class="nav-number">4.</span> <span class="nav-text">#4. 【NOI2014】消除游戏</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%A7%E6%84%8F%EF%BC%9A-3"><span class="nav-number">4.1.</span> <span class="nav-text">题目大意：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-3"><span class="nav-number">4.2.</span> <span class="nav-text">题解：</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E7%82%B9-1%EF%BC%9A"><span class="nav-number">4.2.1.</span> <span class="nav-text">测试点 1：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E7%82%B9-2%EF%BC%9A"><span class="nav-number">4.2.2.</span> <span class="nav-text">测试点 2：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E7%82%B9-3%EF%BC%9A"><span class="nav-number">4.2.3.</span> <span class="nav-text">测试点 3：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E7%82%B9-4%EF%BC%9A"><span class="nav-number">4.2.4.</span> <span class="nav-text">测试点 4：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E7%82%B9-5%EF%BC%9A"><span class="nav-number">4.2.5.</span> <span class="nav-text">测试点 5：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E7%82%B9-6%EF%BC%9A"><span class="nav-number">4.2.6.</span> <span class="nav-text">测试点 6：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E7%82%B9-7%EF%BC%9A"><span class="nav-number">4.2.7.</span> <span class="nav-text">测试点 7：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E7%82%B9-8%EF%BC%9A"><span class="nav-number">4.2.8.</span> <span class="nav-text">测试点 8：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E7%82%B9-9%EF%BC%9A"><span class="nav-number">4.2.9.</span> <span class="nav-text">测试点 9：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E7%82%B9-10%EF%BC%9A"><span class="nav-number">4.2.10.</span> <span class="nav-text">测试点 10：</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E3%80%90NOI2014%E3%80%91%E5%8A%A8%E7%89%A9%E5%9B%AD"><span class="nav-number">5.</span> <span class="nav-text">#5. 【NOI2014】动物园</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%A7%E6%84%8F%EF%BC%9A-4"><span class="nav-number">5.1.</span> <span class="nav-text">题目大意：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-4"><span class="nav-number">5.2.</span> <span class="nav-text">题解：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-%E3%80%90NOI2014%E3%80%91%E9%9A%8F%E6%9C%BA%E6%95%B0%E7%94%9F%E6%88%90%E5%99%A8"><span class="nav-number">6.</span> <span class="nav-text">#6. 【NOI2014】随机数生成器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%A7%E6%84%8F%EF%BC%9A-5"><span class="nav-number">6.1.</span> <span class="nav-text">题目大意：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-5"><span class="nav-number">6.2.</span> <span class="nav-text">题解：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-%E3%80%90NOI2014%E3%80%91%E8%B4%AD%E7%A5%A8"><span class="nav-number">7.</span> <span class="nav-text">#7. 【NOI2014】购票</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%A7%E6%84%8F%EF%BC%9A-6"><span class="nav-number">7.1.</span> <span class="nav-text">题目大意：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-6"><span class="nav-number">7.2.</span> <span class="nav-text">题解：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-Quine"><span class="nav-number">8.</span> <span class="nav-text">#8. Quine</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%A7%E6%84%8F%EF%BC%9A-7"><span class="nav-number">8.1.</span> <span class="nav-text">题目大意：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-7"><span class="nav-number">8.2.</span> <span class="nav-text">题解：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-%E3%80%90UTR-1%E3%80%91vfk%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="nav-number">9.</span> <span class="nav-text">#9. 【UTR #1】vfk的数据</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%A7%E6%84%8F%EF%BC%9A-8"><span class="nav-number">9.1.</span> <span class="nav-text">题目大意：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-8"><span class="nav-number">9.2.</span> <span class="nav-text">题解：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-%E3%80%90UTR-1%E3%80%91pyx%E7%9A%84%E9%9A%BE%E9%A2%98"><span class="nav-number">10.</span> <span class="nav-text">#10. 【UTR #1】pyx的难题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%A7%E6%84%8F%EF%BC%9A-9"><span class="nav-number">10.1.</span> <span class="nav-text">题目大意：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-9"><span class="nav-number">10.2.</span> <span class="nav-text">题解：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-%E3%80%90UTR-1%E3%80%91ydc%E7%9A%84%E5%A4%A7%E6%A0%91"><span class="nav-number">11.</span> <span class="nav-text">#11. 【UTR #1】ydc的大树</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%A7%E6%84%8F%EF%BC%9A-10"><span class="nav-number">11.1.</span> <span class="nav-text">题目大意：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-10"><span class="nav-number">11.2.</span> <span class="nav-text">题解：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12-%E3%80%90UER-1%E3%80%91%E7%8C%9C%E6%95%B0"><span class="nav-number">12.</span> <span class="nav-text">#12. 【UER #1】猜数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%A7%E6%84%8F%EF%BC%9A-11"><span class="nav-number">12.1.</span> <span class="nav-text">题目大意：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-11"><span class="nav-number">12.2.</span> <span class="nav-text">题解：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13-%E3%80%90UER-1%E3%80%91%E8%B7%B3%E8%9A%A4OS"><span class="nav-number">13.</span> <span class="nav-text">#13. 【UER #1】跳蚤OS</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%A7%E6%84%8F%EF%BC%9A-12"><span class="nav-number">13.1.</span> <span class="nav-text">题目大意：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-12"><span class="nav-number">13.2.</span> <span class="nav-text">题解：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-%E3%80%90UER-1%E3%80%91DZY-Loves-Graph"><span class="nav-number">14.</span> <span class="nav-text">#14. 【UER #1】DZY Loves Graph</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%A7%E6%84%8F%EF%BC%9A-13"><span class="nav-number">14.1.</span> <span class="nav-text">题目大意：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-13"><span class="nav-number">14.2.</span> <span class="nav-text">题解：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#15-%E3%80%90NOIP2014%E3%80%91%E7%94%9F%E6%B4%BB%E5%A4%A7%E7%88%86%E7%82%B8%E7%89%88%E7%9F%B3%E5%A4%B4%E5%89%AA%E5%88%80%E5%B8%83"><span class="nav-number">15.</span> <span class="nav-text">#15. 【NOIP2014】生活大爆炸版石头剪刀布</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%A7%E6%84%8F%EF%BC%9A-14"><span class="nav-number">15.1.</span> <span class="nav-text">题目大意：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-14"><span class="nav-number">15.2.</span> <span class="nav-text">题解：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#16-%E3%80%90NOIP2014%E3%80%91%E8%81%94%E5%90%88%E6%9D%83%E5%80%BC"><span class="nav-number">16.</span> <span class="nav-text">#16. 【NOIP2014】联合权值</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%A7%E6%84%8F%EF%BC%9A-15"><span class="nav-number">16.1.</span> <span class="nav-text">题目大意：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-15"><span class="nav-number">16.2.</span> <span class="nav-text">题解：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#17-%E3%80%90NOIP2014%E3%80%91%E9%A3%9E%E6%89%AC%E7%9A%84%E5%B0%8F%E9%B8%9F"><span class="nav-number">17.</span> <span class="nav-text">#17. 【NOIP2014】飞扬的小鸟</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%A7%E6%84%8F%EF%BC%9A-16"><span class="nav-number">17.1.</span> <span class="nav-text">题目大意：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-16"><span class="nav-number">17.2.</span> <span class="nav-text">题解：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#18-%E3%80%90NOIP2014%E3%80%91%E6%97%A0%E7%BA%BF%E7%BD%91%E7%BB%9C%E5%8F%91%E5%B0%84%E5%99%A8%E9%80%89%E5%9D%80"><span class="nav-number">18.</span> <span class="nav-text">#18. 【NOIP2014】无线网络发射器选址</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%A7%E6%84%8F%EF%BC%9A-17"><span class="nav-number">18.1.</span> <span class="nav-text">题目大意：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-17"><span class="nav-number">18.2.</span> <span class="nav-text">题解：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#19-%E3%80%90NOIP2014%E3%80%91%E5%AF%BB%E6%89%BE%E9%81%93%E8%B7%AF"><span class="nav-number">19.</span> <span class="nav-text">#19. 【NOIP2014】寻找道路</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%A7%E6%84%8F%EF%BC%9A-18"><span class="nav-number">19.1.</span> <span class="nav-text">题目大意：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-18"><span class="nav-number">19.2.</span> <span class="nav-text">题解：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#20-%E3%80%90NOIP2014%E3%80%91%E8%A7%A3%E6%96%B9%E7%A8%8B"><span class="nav-number">20.</span> <span class="nav-text">#20. 【NOIP2014】解方程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%A7%E6%84%8F%EF%BC%9A-19"><span class="nav-number">20.1.</span> <span class="nav-text">题目大意：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-19"><span class="nav-number">20.2.</span> <span class="nav-text">题解：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#21-%E3%80%90UR-1%E3%80%91%E7%BC%A9%E8%BF%9B%E4%BC%98%E5%8C%96"><span class="nav-number">21.</span> <span class="nav-text">#21. 【UR #1】缩进优化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%A7%E6%84%8F%EF%BC%9A-20"><span class="nav-number">21.1.</span> <span class="nav-text">题目大意：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-20"><span class="nav-number">21.2.</span> <span class="nav-text">题解：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#22-%E3%80%90UR-1%E3%80%91%E5%A4%96%E6%98%9F%E4%BA%BA"><span class="nav-number">22.</span> <span class="nav-text">#22. 【UR #1】外星人</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%A7%E6%84%8F%EF%BC%9A-21"><span class="nav-number">22.1.</span> <span class="nav-text">题目大意：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-21"><span class="nav-number">22.2.</span> <span class="nav-text">题解：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#23-%E3%80%90UR-1%E3%80%91%E8%B7%B3%E8%9A%A4%E5%9B%BD%E7%8E%8B%E4%B8%8B%E6%B1%9F%E5%8D%97"><span class="nav-number">23.</span> <span class="nav-text">#23. 【UR #1】跳蚤国王下江南</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%A7%E6%84%8F%EF%BC%9A-22"><span class="nav-number">23.1.</span> <span class="nav-text">题目大意：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-22"><span class="nav-number">23.2.</span> <span class="nav-text">题解：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#24-%E3%80%90IOI2014%E3%80%91Rail"><span class="nav-number">24.</span> <span class="nav-text">#24. 【IOI2014】Rail</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%A7%E6%84%8F%EF%BC%9A-23"><span class="nav-number">24.1.</span> <span class="nav-text">题目大意：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-23"><span class="nav-number">24.2.</span> <span class="nav-text">题解：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#25-%E3%80%90IOI2014%E3%80%91Wall"><span class="nav-number">25.</span> <span class="nav-text">#25. 【IOI2014】Wall</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%A7%E6%84%8F%EF%BC%9A-24"><span class="nav-number">25.1.</span> <span class="nav-text">题目大意：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-24"><span class="nav-number">25.2.</span> <span class="nav-text">题解：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#26-%E3%80%90IOI2014%E3%80%91Game"><span class="nav-number">26.</span> <span class="nav-text">#26. 【IOI2014】Game</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%A7%E6%84%8F%EF%BC%9A-25"><span class="nav-number">26.1.</span> <span class="nav-text">题目大意：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-25"><span class="nav-number">26.2.</span> <span class="nav-text">题解：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#27-%E3%80%90IOI2014%E3%80%91Gondola"><span class="nav-number">27.</span> <span class="nav-text">#27. 【IOI2014】Gondola</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%A7%E6%84%8F%EF%BC%9A-26"><span class="nav-number">27.1.</span> <span class="nav-text">题目大意：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-26"><span class="nav-number">27.2.</span> <span class="nav-text">题解：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#28-%E3%80%90IOI2014%E3%80%91Friend"><span class="nav-number">28.</span> <span class="nav-text">#28. 【IOI2014】Friend</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%A7%E6%84%8F%EF%BC%9A-27"><span class="nav-number">28.1.</span> <span class="nav-text">题目大意：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-27"><span class="nav-number">28.2.</span> <span class="nav-text">题解：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#29-%E3%80%90IOI2014%E3%80%91Holiday"><span class="nav-number">29.</span> <span class="nav-text">#29. 【IOI2014】Holiday</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%A7%E6%84%8F%EF%BC%9A-28"><span class="nav-number">29.1.</span> <span class="nav-text">题目大意：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-28"><span class="nav-number">29.2.</span> <span class="nav-text">题解：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#30-%E3%80%90CF-Round-278%E3%80%91Tourists"><span class="nav-number">30.</span> <span class="nav-text">#30. 【CF Round #278】Tourists</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%A7%E6%84%8F%EF%BC%9A-29"><span class="nav-number">30.1.</span> <span class="nav-text">题目大意：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-29"><span class="nav-number">30.2.</span> <span class="nav-text">题解：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#31-%E3%80%90UR-2%E3%80%91%E7%8C%AA%E7%8C%AA%E4%BE%A0%E5%86%8D%E6%88%98%E6%8B%AC%E5%8F%B7%E5%BA%8F%E5%88%97"><span class="nav-number">31.</span> <span class="nav-text">#31. 【UR #2】猪猪侠再战括号序列</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%A7%E6%84%8F%EF%BC%9A-30"><span class="nav-number">31.1.</span> <span class="nav-text">题目大意：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-30"><span class="nav-number">31.2.</span> <span class="nav-text">题解：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#32-%E3%80%90UR-2%E3%80%91%E8%B7%B3%E8%9A%A4%E5%85%AC%E8%B7%AF"><span class="nav-number">32.</span> <span class="nav-text">#32. 【UR #2】跳蚤公路</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%A7%E6%84%8F%EF%BC%9A-31"><span class="nav-number">32.1.</span> <span class="nav-text">题目大意：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-31"><span class="nav-number">32.2.</span> <span class="nav-text">题解：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#33-%E3%80%90UR-2%E3%80%91%E6%A0%91%E4%B8%8AGCD"><span class="nav-number">33.</span> <span class="nav-text">#33. 【UR #2】树上GCD</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%A7%E6%84%8F%EF%BC%9A-32"><span class="nav-number">33.1.</span> <span class="nav-text">题目大意：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-32"><span class="nav-number">33.2.</span> <span class="nav-text">题解：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#34-%E5%A4%9A%E9%A1%B9%E5%BC%8F%E4%B9%98%E6%B3%95"><span class="nav-number">34.</span> <span class="nav-text">#34. 多项式乘法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%A7%E6%84%8F%EF%BC%9A-33"><span class="nav-number">34.1.</span> <span class="nav-text">题目大意：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-33"><span class="nav-number">34.2.</span> <span class="nav-text">题解：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#35-%E5%90%8E%E7%BC%80%E6%8E%92%E5%BA%8F"><span class="nav-number">35.</span> <span class="nav-text">#35. 后缀排序</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%A7%E6%84%8F%EF%BC%9A-34"><span class="nav-number">35.1.</span> <span class="nav-text">题目大意：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-34"><span class="nav-number">35.2.</span> <span class="nav-text">题解：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#36-%E3%80%90%E6%B8%85%E5%8D%8E%E9%9B%86%E8%AE%AD2014%E3%80%91%E7%8E%9B%E9%87%8C%E8%8B%9F%E6%96%AF"><span class="nav-number">36.</span> <span class="nav-text">#36. 【清华集训2014】玛里苟斯</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%A7%E6%84%8F%EF%BC%9A-35"><span class="nav-number">36.1.</span> <span class="nav-text">题目大意：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-35"><span class="nav-number">36.2.</span> <span class="nav-text">题解：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#37-%E3%80%90%E6%B8%85%E5%8D%8E%E9%9B%86%E8%AE%AD2014%E3%80%91%E4%B8%BB%E6%97%8B%E5%BE%8B"><span class="nav-number">37.</span> <span class="nav-text">#37. 【清华集训2014】主旋律</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%A7%E6%84%8F%EF%BC%9A-36"><span class="nav-number">37.1.</span> <span class="nav-text">题目大意：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-36"><span class="nav-number">37.2.</span> <span class="nav-text">题解：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#38-%E3%80%90%E6%B8%85%E5%8D%8E%E9%9B%86%E8%AE%AD2014%E3%80%91%E5%A5%87%E6%95%B0%E5%9B%BD"><span class="nav-number">38.</span> <span class="nav-text">#38. 【清华集训2014】奇数国</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%A7%E6%84%8F%EF%BC%9A-37"><span class="nav-number">38.1.</span> <span class="nav-text">题目大意：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-37"><span class="nav-number">38.2.</span> <span class="nav-text">题解：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#39-%E3%80%90%E6%B8%85%E5%8D%8E%E9%9B%86%E8%AE%AD2014%E3%80%91%E7%AE%80%E5%8D%95%E5%9B%9E%E8%B7%AF"><span class="nav-number">39.</span> <span class="nav-text">#39. 【清华集训2014】简单回路</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%A7%E6%84%8F%EF%BC%9A-38"><span class="nav-number">39.1.</span> <span class="nav-text">题目大意：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-38"><span class="nav-number">39.2.</span> <span class="nav-text">题解：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#40-%E3%80%90%E6%B8%85%E5%8D%8E%E9%9B%86%E8%AE%AD2014%E3%80%91%E5%8D%A1%E5%B8%B8%E6%95%B0"><span class="nav-number">40.</span> <span class="nav-text">#40. 【清华集训2014】卡常数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%A7%E6%84%8F%EF%BC%9A-39"><span class="nav-number">40.1.</span> <span class="nav-text">题目大意：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-39"><span class="nav-number">40.2.</span> <span class="nav-text">题解：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#41-%E3%80%90%E6%B8%85%E5%8D%8E%E9%9B%86%E8%AE%AD2014%E3%80%91%E7%9F%A9%E9%98%B5%E5%8F%98%E6%8D%A2"><span class="nav-number">41.</span> <span class="nav-text">#41. 【清华集训2014】矩阵变换</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%A7%E6%84%8F%EF%BC%9A-40"><span class="nav-number">41.1.</span> <span class="nav-text">题目大意：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-40"><span class="nav-number">41.2.</span> <span class="nav-text">题解：</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="ix35"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">ix35</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">45</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/Itz-ix35" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Itz-ix35" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:2757336405@qq.com" title="E-Mail → mailto:2757336405@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.luogu.com.cn/user/113546" title="Luogu → https:&#x2F;&#x2F;www.luogu.com.cn&#x2F;user&#x2F;113546" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>Luogu</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://space.bilibili.com/187505795" title="Bilibili → https:&#x2F;&#x2F;space.bilibili.com&#x2F;187505795" rel="noopener" target="_blank"><i class="fab fa-youtube fa-fw"></i>Bilibili</a>
      </span>
  </div>



        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://itz-ix35.github.io/2023/09/29/UOJ%20%E9%A2%98%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="ix35">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ix35's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="UOJ 题解 | ix35's Blog">
      <meta itemprop="description" content="持续更新。">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          UOJ 题解
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-09-29 20:47:44" itemprop="dateCreated datePublished" datetime="2023-09-29T20:47:44+08:00">2023-09-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-06-02 13:13:48" itemprop="dateModified" datetime="2024-06-02T13:13:48+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90%E9%A2%98%E8%A7%A3%E3%80%91%E4%B8%93%E9%A2%98%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">【题解】专题题解</span></a>
        </span>
    </span>

  
</div>

            <div class="post-description">持续更新。</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h3 id="1-A-B-Problem"><a href="#1-A-B-Problem" class="headerlink" title="#1. A+B Problem"></a><a target="_blank" rel="noopener" href="https://uoj.ac/problem/1">#1. A+B Problem</a></h3><h4 id="题目大意："><a href="#题目大意：" class="headerlink" title="题目大意："></a>题目大意：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题目大意
    </div>
    <div class='spoiler-content'>
        <p>给定两个数 $a,b$，求它们的和。</p>
<p>$0\leq a,b\leq 10^9$</p>

    </div>
</div>
<h4 id="题解："><a href="#题解：" class="headerlink" title="题解："></a>题解：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题解
    </div>
    <div class='spoiler-content'>
        <p>直接将两个数相加。</p>
<p>时间复杂度：$O(1)$</p>
<p><a target="_blank" rel="noopener" href="https://uoj.ac/submission/582484">https://uoj.ac/submission/582484</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> a,b;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;a,&amp;b);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,a+b);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="2-【NOI2014】起床困难综合症"><a href="#2-【NOI2014】起床困难综合症" class="headerlink" title="#2. 【NOI2014】起床困难综合症"></a><a target="_blank" rel="noopener" href="https://uoj.ac/problem/2">#2. 【NOI2014】起床困难综合症</a></h3><h4 id="题目大意：-1"><a href="#题目大意：-1" class="headerlink" title="题目大意："></a>题目大意：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题目大意
    </div>
    <div class='spoiler-content'>
        <p>有 $n$ 个操作和一个变量 $x$，每个操作形如令 $x\leftarrow x\operatorname{op}_i a_i$，其中 $\operatorname{op}_i$ 可能是 $\operatorname{and},\operatorname{or},\operatorname{xor}$ 中的一个。$x$ 的初始值 $x_0$ 可以在 $[0,m]$ 中任选，求依次经过所有操作后 $x$ 的最大可能值。</p>
<p>$2\leq n\leq 10^5, 0\leq a_i,m&lt;2^{30}$</p>

    </div>
</div>
<h4 id="题解：-1"><a href="#题解：-1" class="headerlink" title="题解："></a>题解：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题解
    </div>
    <div class='spoiler-content'>
        <p>先单独算一下 $x_0=m$ 的情况，然后考虑 $x_0&lt;m$ 的情况：</p>
<p>枚举 $x_0$ 和 $m$ 不同的最高位，一定是 $m$ 这一位为 $1$ 而 $x_0$ 这一位为 $0$，在这之前的所有位 $x_0$ 都和 $m$ 相同，而这之后的所有位 $x_0$ 都可以任取。</p>
<p>注意到操作关于每一位是独立的，所以对于后面任取的那些位可以直接算出来每一位的最大值并加起来，对于前面的位只要算一下 $x_0=m\oplus 2^i$ 的情形即可，$i$ 是当前考虑的位。</p>
<p>时间复杂度：$O(n\log m)$</p>
<p><a target="_blank" rel="noopener" href="https://uoj.ac/submission/582485">https://uoj.ac/submission/582485</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">100010</span>;</span><br><span class="line"><span class="type">int</span> n,m,ans,res,a[N],b[N];</span><br><span class="line"><span class="type">char</span> c[<span class="number">8</span>];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">calc</span> <span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (a[i]==<span class="number">1</span>) &#123;x&amp;=b[i];&#125;</span><br><span class="line">		<span class="keyword">if</span> (a[i]==<span class="number">2</span>) &#123;x|=b[i];&#125;</span><br><span class="line">		<span class="keyword">if</span> (a[i]==<span class="number">3</span>) &#123;x^=b[i];&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%s%d&quot;</span>,c+<span class="number">1</span>,&amp;b[i]);</span><br><span class="line">		a[i]=(c[<span class="number">1</span>]==<span class="string">&#x27;A&#x27;</span>?<span class="number">1</span>:(c[<span class="number">1</span>]==<span class="string">&#x27;O&#x27;</span>?<span class="number">2</span>:<span class="number">3</span>));</span><br><span class="line">	&#125;</span><br><span class="line">	ans=<span class="built_in">calc</span>(m);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">30</span>;i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (m&amp;(<span class="number">1</span>&lt;&lt;i)) &#123;ans=<span class="built_in">max</span>(ans,res|<span class="built_in">calc</span>(m^(<span class="number">1</span>&lt;&lt;i)));&#125;</span><br><span class="line">		res+=((<span class="number">1</span>&lt;&lt;i)&amp;<span class="built_in">max</span>(<span class="built_in">calc</span>(<span class="number">0</span>),<span class="built_in">calc</span>(<span class="number">1</span>&lt;&lt;i)));</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="3-【NOI2014】魔法森林"><a href="#3-【NOI2014】魔法森林" class="headerlink" title="#3. 【NOI2014】魔法森林"></a><a target="_blank" rel="noopener" href="https://uoj.ac/problem/3">#3. 【NOI2014】魔法森林</a></h3><h4 id="题目大意：-2"><a href="#题目大意：-2" class="headerlink" title="题目大意："></a>题目大意：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题目大意
    </div>
    <div class='spoiler-content'>
        <p>给定一张 $n$ 个点 $m$ 条边的无向图，每条边 $e$ 有两种权值 $a_e,b_e$，对于所有 $1\to n$ 的路径 $P$，求 $\max_{e\in P}\{a_e\}+\max_{e\in P}\{b_e\}$ 的最小值，或报告无解。</p>
<p>$2\leq n\leq 50000, 0\leq m\leq 10^5, 1\leq a_e,b_e\leq 50000$</p>

    </div>
</div>
<h4 id="题解：-2"><a href="#题解：-2" class="headerlink" title="题解："></a>题解：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题解
    </div>
    <div class='spoiler-content'>
        <p>将所有边按照 $a_e$ 从小到大排序，一条一条加入图中。用 LCT 动态维护这个图以 $b_e$ 为权值的 MST，每个时刻查询 $1\to n$ 的树链最大值就得到了对于每种 $\max a_e$ 的最小的 $\max b_e$，取个 $\min$ 就是答案。</p>
<p>时间复杂度：$O(m\log m)$</p>
<p><a target="_blank" rel="noopener" href="https://uoj.ac/submission/582530">https://uoj.ac/submission/582530</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">150010</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">E</span> &#123;<span class="type">int</span> x,y,u,v;&#125; e[N];</span><br><span class="line"><span class="type">int</span> n,m,ans,rev[N],f[N],ch[N][<span class="number">2</span>],mn[N];</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span> <span class="params">(E a,E b)</span> </span>&#123;<span class="keyword">return</span> a.u&lt;b.u;&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">upd</span> <span class="params">(<span class="type">int</span> p)</span> </span>&#123;</span><br><span class="line">	mn[p]=(p&gt;n?p-n:<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">if</span> (e[mn[ch[p][<span class="number">0</span>]]].v&gt;e[mn[p]].v) &#123;mn[p]=mn[ch[p][<span class="number">0</span>]];&#125;</span><br><span class="line">	<span class="keyword">if</span> (e[mn[ch[p][<span class="number">1</span>]]].v&gt;e[mn[p]].v) &#123;mn[p]=mn[ch[p][<span class="number">1</span>]];&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">sprd</span> <span class="params">(<span class="type">int</span> p)</span> </span>&#123;<span class="keyword">if</span> (p) rev[p]^=<span class="number">1</span>,<span class="built_in">swap</span>(ch[p][<span class="number">0</span>],ch[p][<span class="number">1</span>]);&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pd</span> <span class="params">(<span class="type">int</span> p)</span> </span>&#123;<span class="keyword">if</span> (rev[p]) <span class="built_in">sprd</span>(ch[p][<span class="number">0</span>]),<span class="built_in">sprd</span>(ch[p][<span class="number">1</span>]),rev[p]=<span class="number">0</span>;&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">chk</span> <span class="params">(<span class="type">int</span> p)</span> </span>&#123;<span class="keyword">return</span> (ch[f[p]][<span class="number">0</span>]==p?<span class="number">0</span>:(ch[f[p]][<span class="number">1</span>]==p?<span class="number">1</span>:<span class="number">-1</span>));&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ps</span> <span class="params">(<span class="type">int</span> p)</span> </span>&#123;<span class="keyword">if</span> (<span class="built_in">chk</span>(p)&gt;=<span class="number">0</span>) <span class="built_in">ps</span>(f[p]);<span class="built_in">pd</span>(p);&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">rot</span> <span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> y=f[x],z=f[y],k=<span class="built_in">chk</span>(x),w=ch[x][k^<span class="number">1</span>];<span class="keyword">if</span> (k==<span class="number">-1</span>) <span class="keyword">return</span>;</span><br><span class="line">	f[x]=z;<span class="keyword">if</span> (<span class="built_in">chk</span>(y)&gt;=<span class="number">0</span>) ch[z][<span class="built_in">chk</span>(y)]=x;ch[y][k]=w;<span class="keyword">if</span> (w) f[w]=y;f[y]=x;ch[x][k^<span class="number">1</span>]=y;<span class="built_in">upd</span>(y),<span class="built_in">upd</span>(x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">splay</span> <span class="params">(<span class="type">int</span> x)</span> </span>&#123;<span class="built_in">ps</span>(x);<span class="keyword">while</span> (<span class="built_in">chk</span>(x)&gt;=<span class="number">0</span>) &#123;<span class="type">int</span> y=f[x];<span class="keyword">if</span> (<span class="built_in">chk</span>(y)==<span class="built_in">chk</span>(x)) <span class="built_in">rot</span>(y); <span class="keyword">else</span> <span class="built_in">rot</span>(x);<span class="built_in">rot</span>(x);&#125;&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">acs</span> <span class="params">(<span class="type">int</span> x)</span> </span>&#123;<span class="keyword">for</span> (<span class="type">int</span> y=<span class="number">0</span>;x;y=x,x=f[x]) &#123;<span class="built_in">splay</span>(x);ch[x][<span class="number">1</span>]=y;<span class="built_in">upd</span>(x);&#125;&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">fdr</span> <span class="params">(<span class="type">int</span> x)</span> </span>&#123;<span class="built_in">acs</span>(x),<span class="built_in">splay</span>(x),<span class="built_in">pd</span>(x);<span class="keyword">while</span> (ch[x][<span class="number">0</span>]) x=ch[x][<span class="number">0</span>],<span class="built_in">pd</span>(x);<span class="keyword">return</span> x;&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">mkr</span> <span class="params">(<span class="type">int</span> x)</span> </span>&#123;<span class="built_in">acs</span>(x),<span class="built_in">splay</span>(x),<span class="built_in">sprd</span>(x);&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">lk</span> <span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span> </span>&#123;<span class="built_in">mkr</span>(x),<span class="built_in">mkr</span>(y);f[y]=x;&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ct</span> <span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span> </span>&#123;<span class="built_in">mkr</span>(x),<span class="built_in">acs</span>(y),<span class="built_in">splay</span>(y);ch[y][<span class="number">0</span>]=f[x]=<span class="number">0</span>;<span class="built_in">upd</span>(y);&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++) &#123;<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d%d&quot;</span>,&amp;e[i].x,&amp;e[i].y,&amp;e[i].u,&amp;e[i].v);mn[i+n]=i;&#125;</span><br><span class="line">	<span class="built_in">sort</span>(e+<span class="number">1</span>,e+m+<span class="number">1</span>,cmp);ans=<span class="number">1e9</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++) &#123;</span><br><span class="line">		<span class="type">int</span> x=e[i].x,y=e[i].y,u=e[i].u,v=e[i].v;</span><br><span class="line">		<span class="built_in">mkr</span>(x);</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">fdr</span>(y)==x) &#123;</span><br><span class="line">			<span class="keyword">if</span> (e[mn[y]].v&lt;=v) &#123;<span class="keyword">continue</span>;&#125;<span class="type">int</span> tmp=mn[y];</span><br><span class="line">			<span class="built_in">ct</span>(e[tmp].x,tmp+n),<span class="built_in">ct</span>(e[tmp].y,tmp+n);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">lk</span>(e[i].x,i+n),<span class="built_in">lk</span>(e[i].y,i+n);</span><br><span class="line">		<span class="built_in">mkr</span>(<span class="number">1</span>);<span class="keyword">if</span> (<span class="built_in">fdr</span>(n)==<span class="number">1</span>) ans=<span class="built_in">min</span>(ans,u+e[mn[n]].v);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans==<span class="number">1e9</span>?<span class="number">-1</span>:ans);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="4-【NOI2014】消除游戏"><a href="#4-【NOI2014】消除游戏" class="headerlink" title="#4. 【NOI2014】消除游戏"></a><a target="_blank" rel="noopener" href="https://uoj.ac/problem/4">#4. 【NOI2014】消除游戏</a></h3><h4 id="题目大意：-3"><a href="#题目大意：-3" class="headerlink" title="题目大意："></a>题目大意：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题目大意
    </div>
    <div class='spoiler-content'>
        <p><strong>这是一道提交答案题。</strong></p>
<p>给定 $n\times m$ 网格，网格中的数都是 $[0,9]$ 的整数。</p>
<p>每轮操作中，你可以选择一条简单路径，满足路径上每个格子都有数，且起始点的数不为 $0$。设你的路径长度为 $l$，路径上的数顺次构成一个整数 $X$：</p>
<ul>
<li>如果 $X$ 是素数，则你的素数加分为 $l^{c_1}$，否则素数加分为 $1$；</li>
<li>如果 $X$ 是回文数，则你的回文加分为 $l^{c_2}$，否则回文加分为 $1$。</li>
</ul>
<p>这轮操作的总分是素数加分和回文加分的和。但是特别地，如果 $X$ 既不是素数又不是回文数，则这个操作非法。</p>
<p>每轮操作结束后，路径上的所有数会消失，然后网格中所有数按重力规则下落。</p>
<p>你最多可以进行 $K$ 轮上述操作，并且每次的路径长度 $l$ 需要满足 $l_{min}\leq l\leq l_{max}$。</p>
<p>此外有一个参数 $F$，如果 $F=0$，则你的总分等于每轮操作总分之和；如果 $F=1$，则再设 $d$ 是操作结束后网格中剩下的数的个数，你的总分等于每轮操作的总分之和除以 $2^d$ 下取整。你要构造一个方案使得总分足够大（有一些不告诉你的评分参数）。</p>
<p>每个测试点给定 $n,m,K,l_{min},l_{max},c_1,c_2,F$ 和初始的网格。</p>

    </div>
</div>
<h4 id="题解：-3"><a href="#题解：-3" class="headerlink" title="题解："></a>题解：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题解
    </div>
    <div class='spoiler-content'>
        <h5 id="测试点-1："><a href="#测试点-1：" class="headerlink" title="测试点 1："></a>测试点 1：</h5><p>$n=m=5, K=100, l_{min}=2, l_{max}=16, c_1=c_2=2, F=1$，网格如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1 1 2 3 4</span><br><span class="line">0 1 2 3 5</span><br><span class="line">0 6 5 4 6</span><br><span class="line">0 7 8 8 7</span><br><span class="line">0 0 0 0 7</span><br></pre></td></tr></table></figure>
<p>我们发现右上角 $4\times 4$ 的块正好可以构成一个长度为 $16$ 的回文数 $1234567887654321$，而左下这一条是一个素数 $10^8+7$。</p>
<p>于是分成这两部分，可以通过该测试点。</p>
<h5 id="测试点-2："><a href="#测试点-2：" class="headerlink" title="测试点 2："></a>测试点 2：</h5><p>$n=m=10, K=100, l_{min}=2, l_{max}=8, c_1=c_2=1, F=1$，网格如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">7 4 1 3 5 9 8 6 1 6</span><br><span class="line">8 0 9 1 1 1 1 7 1 2</span><br><span class="line">9 3 6 7 5 1 5 9 6 0</span><br><span class="line">8 1 8 4 9 7 7 4 3 9</span><br><span class="line">0 4 0 0 9 0 1 7 8 3</span><br><span class="line">8 4 8 7 3 7 8 0 7 0</span><br><span class="line">7 1 6 6 1 0 5 8 9 0</span><br><span class="line">5 9 9 1 1 5 1 5 1 5</span><br><span class="line">8 1 2 7 6 2 3 3 3 0</span><br><span class="line">0 9 1 0 9 4 0 6 1 9</span><br></pre></td></tr></table></figure>
<p>我们发现由于 $F=1$，所以关键在于要把所有数消除光。</p>
<p>可以写个暴力 DFS：每次随机一个起点，然后随机一条从它开始的简单路径，然后检验是否合法，如果合法就删除后递归。如果某个 DFS 分支已经走不下去了就回溯，只要记下之前的地图就可以轻易地完成回溯操作。</p>
<p>这个做法搜出的解大概可以得到 $[7,9]$ 分。</p>
<p>我们可以加个优化：只使用长度 $\leq 4$ 的路径，因为长度越小能蹭到的分数 $1$ 就越多，所以这样总分会稍微大一些，可以通过该测试点。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ull unsigned long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">110</span>;</span><br><span class="line"><span class="type">int</span> n,m,k,l1,l2,c1,c2,f,mp[N][N],vis[N][N],dir[<span class="number">4</span>][<span class="number">2</span>]=&#123;&#123;<span class="number">0</span>,<span class="number">1</span>&#125;,&#123;<span class="number">0</span>,<span class="number">-1</span>&#125;,&#123;<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;<span class="number">-1</span>,<span class="number">0</span>&#125;&#125;;</span><br><span class="line">vector &lt; pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt; &gt; v; </span><br><span class="line">vector &lt; vector &lt; pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt; &gt; &gt; ans; </span><br><span class="line">ull sd;</span><br><span class="line"><span class="function">ull <span class="title">rd</span> <span class="params">()</span> </span>&#123;sd^=(sd&lt;&lt;<span class="number">27</span>);sd^=(sd&gt;&gt;<span class="number">19</span>);sd^=(sd&lt;&lt;<span class="number">25</span>);<span class="keyword">return</span> sd;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">qmul</span> <span class="params">(ll a,ll b,ll p)</span> </span>&#123;<span class="keyword">return</span> (a*b-(ll)((<span class="type">long</span> <span class="type">double</span>)a/p*b)*p+p)%p;&#125;</span><br><span class="line"><span class="function">ll <span class="title">qpow</span> <span class="params">(ll a,ll b,ll p)</span> </span>&#123;</span><br><span class="line">	ll res=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">while</span> (b) &#123;</span><br><span class="line">		<span class="keyword">if</span> (b&amp;<span class="number">1</span>) &#123;res=<span class="built_in">qmul</span>(res,a,p);&#125;</span><br><span class="line">		a=<span class="built_in">qmul</span>(a,a,p),b&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">mr</span> <span class="params">(ll p,ll x)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">qpow</span>(x,p<span class="number">-1</span>,p)!=<span class="number">1</span>) &#123;<span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line">	ll k=p<span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">while</span> (!(k&amp;<span class="number">1</span>)) &#123;</span><br><span class="line">		k&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">		ll tmp=<span class="built_in">qpow</span>(x,k,p);</span><br><span class="line">		<span class="keyword">if</span> (tmp==p<span class="number">-1</span>) &#123;<span class="keyword">return</span> <span class="number">1</span>;&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (tmp!=<span class="number">1</span>) &#123;<span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isp</span> <span class="params">(ll p)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (p==<span class="number">46856248255981</span>||p==<span class="number">1</span>) &#123;<span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line">	<span class="keyword">if</span> (p==<span class="number">2</span>||p==<span class="number">3</span>||p==<span class="number">7</span>||p==<span class="number">61</span>||p==<span class="number">24251</span>) &#123;<span class="keyword">return</span> <span class="number">1</span>;&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">mr</span>(p,<span class="number">2</span>)&amp;&amp;<span class="built_in">mr</span>(p,<span class="number">3</span>)&amp;&amp;<span class="built_in">mr</span>(p,<span class="number">7</span>)&amp;&amp;<span class="built_in">mr</span>(p,<span class="number">61</span>)&amp;&amp;<span class="built_in">mr</span>(p,<span class="number">24251</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">chk</span> <span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span> </span>&#123;<span class="keyword">return</span> (x&gt;<span class="number">0</span>&amp;&amp;y&gt;<span class="number">0</span>&amp;&amp;x&lt;=n&amp;&amp;y&lt;=m&amp;&amp;mp[x][y]!=<span class="number">-1</span>&amp;&amp;!vis[x][y]);&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">sr</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> x=<span class="built_in">rd</span>()%n+<span class="number">1</span>,y=<span class="built_in">rd</span>()%m+<span class="number">1</span>,cc=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span> (mp[x][y]&lt;=<span class="number">0</span>&amp;&amp;cc&lt;=<span class="number">200</span>) &#123;x=<span class="built_in">rd</span>()%n+<span class="number">1</span>,y=<span class="built_in">rd</span>()%n+<span class="number">1</span>,cc++;&#125;</span><br><span class="line">	<span class="keyword">if</span> (mp[x][y]&lt;=<span class="number">0</span>) &#123;<span class="keyword">return</span>;&#125;</span><br><span class="line">	v.<span class="built_in">push_back</span>(<span class="built_in">make_pair</span>(x,y));vis[x][y]=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">4</span>;i++) &#123;</span><br><span class="line">		<span class="type">int</span> dr=<span class="built_in">rd</span>()%<span class="number">4</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">4</span>;i++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (!<span class="built_in">chk</span>(x+dir[dr][<span class="number">0</span>],y+dir[dr][<span class="number">1</span>])) &#123;dr=(dr+<span class="number">1</span>)%<span class="number">4</span>;&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (!<span class="built_in">chk</span>(x+dir[dr][<span class="number">0</span>],y+dir[dr][<span class="number">1</span>])) &#123;<span class="keyword">break</span>;&#125;</span><br><span class="line">		x+=dir[dr][<span class="number">0</span>],y+=dir[dr][<span class="number">1</span>];</span><br><span class="line">		v.<span class="built_in">push_back</span>(<span class="built_in">make_pair</span>(x,y));vis[x][y]=<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">auto</span> x:v) vis[x.first][x.second]=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">chkk</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	ll tmp=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span> (v.<span class="built_in">size</span>()&lt;=<span class="number">1</span>) &#123;<span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">auto</span> x:v) &#123;tmp=tmp*<span class="number">10</span>+mp[x.first][x.second];&#125;</span><br><span class="line">	<span class="type">int</span> flg=<span class="number">1</span>,len=v.<span class="built_in">size</span>();</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;i++) &#123;<span class="keyword">if</span> (mp[v[i].first][v[i].second]!=mp[v[len-i<span class="number">-1</span>].first][v[len-i<span class="number">-1</span>].second]) flg=<span class="number">0</span>;&#125;</span><br><span class="line">	<span class="comment">//if (isp(tmp)||flg) cerr &lt;&lt; tmp &lt;&lt; endl;</span></span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">isp</span>(tmp)||flg;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">drp</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">auto</span> x:v) &#123;mp[x.first][x.second]=<span class="number">-1</span>;&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">1</span>;j&lt;=m;j++) &#123;</span><br><span class="line">		<span class="type">int</span> cnt=n;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=n;i&gt;=<span class="number">1</span>;i--) &#123;</span><br><span class="line">			<span class="keyword">if</span> (mp[i][j]!=<span class="number">-1</span>) &#123;mp[cnt--][j]=mp[i][j];&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">while</span> (cnt) &#123;mp[cnt--][j]=<span class="number">-1</span>;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">dfs</span> <span class="params">(<span class="type">int</span> d)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> tmp[<span class="number">11</span>][<span class="number">11</span>],flg=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">10</span>;i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">1</span>;j&lt;=<span class="number">10</span>;j++) &#123;flg|=(mp[i][j]&gt;=<span class="number">0</span>);tmp[i][j]=mp[i][j];&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (!flg) &#123;<span class="keyword">return</span> <span class="number">1</span>;&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">200</span>/d;i++) &#123;</span><br><span class="line">		v.<span class="built_in">clear</span>();</span><br><span class="line">		<span class="built_in">sr</span>();</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">chkk</span>()) &#123;</span><br><span class="line">			ans.<span class="built_in">push_back</span>(v);</span><br><span class="line">			<span class="built_in">drp</span>();</span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">dfs</span>(d+<span class="number">1</span>)) &#123;<span class="keyword">return</span> <span class="number">1</span>;&#125;</span><br><span class="line">			ans.<span class="built_in">pop_back</span>();</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">10</span>;i++) &#123;</span><br><span class="line">				<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">1</span>;j&lt;=<span class="number">10</span>;j++) &#123;mp[i][j]=tmp[i][j];&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">freopen</span>(<span class="string">&quot;game2.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">	<span class="built_in">freopen</span>(<span class="string">&quot;game2.out&quot;</span>,<span class="string">&quot;w&quot;</span>,stdout);</span><br><span class="line">	<span class="built_in">srand</span>(<span class="built_in">time</span>(<span class="number">0</span>));</span><br><span class="line">	sd=<span class="built_in">rand</span>()+<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d%d%d%d%d%d&quot;</span>,&amp;n,&amp;m,&amp;k,&amp;l1,&amp;l2,&amp;c1,&amp;c2,&amp;f);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">1</span>;j&lt;=m;j++) &#123;<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;mp[i][j]);&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	cerr &lt;&lt; <span class="built_in">dfs</span>(<span class="number">1</span>) &lt;&lt; endl;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans.<span class="built_in">size</span>());</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">auto</span> v:ans) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,v.<span class="built_in">size</span>());</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">auto</span> x:v) &#123;<span class="built_in">printf</span>(<span class="string">&quot;%d %d &quot;</span>,x.first,x.second);&#125;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="测试点-3："><a href="#测试点-3：" class="headerlink" title="测试点 3："></a>测试点 3：</h5><p>$n=m=100, K=500, l_{min}=2, l_{max}=18, c_1=2, c_2=0, F=0$，网格随机。</p>
<p>我们发现，想要得到最大的分数，只需要每次选出的都是一个 $18$ 位素数即可，由于素数密度是 $1/\ln n$ 级别，所以只要每次暴力随机一条路径，用 MR 判一下是不是素数就可以了，$500\times 18=9000$，比 $10000$ 小不少，可以轻松出解。</p>
<h5 id="测试点-4："><a href="#测试点-4：" class="headerlink" title="测试点 4："></a>测试点 4：</h5><p>$n=m=100, K=500, l_{min}=15, l_{max}=18, c_1=2, c_2=0, F=0$，网格随机。</p>
<p>同测试点 3，以下是这两个点的程序。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ull unsigned long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">110</span>;</span><br><span class="line"><span class="type">int</span> n,m,k,l1,l2,c1,c2,f,mp[N][N],vis[N][N],dir[<span class="number">4</span>][<span class="number">2</span>]=&#123;&#123;<span class="number">0</span>,<span class="number">1</span>&#125;,&#123;<span class="number">0</span>,<span class="number">-1</span>&#125;,&#123;<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;<span class="number">-1</span>,<span class="number">0</span>&#125;&#125;;</span><br><span class="line">vector &lt; pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt; &gt; v; </span><br><span class="line">ull sd;</span><br><span class="line"><span class="function">ull <span class="title">rd</span> <span class="params">()</span> </span>&#123;sd^=(sd&lt;&lt;<span class="number">27</span>);sd^=(sd&gt;&gt;<span class="number">19</span>);sd^=(sd&lt;&lt;<span class="number">25</span>);<span class="keyword">return</span> sd;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">qmul</span> <span class="params">(ll a,ll b,ll p)</span> </span>&#123;<span class="keyword">return</span> (a*b-(ll)((<span class="type">long</span> <span class="type">double</span>)a/p*b)*p+p)%p;&#125;</span><br><span class="line"><span class="function">ll <span class="title">qpow</span> <span class="params">(ll a,ll b,ll p)</span> </span>&#123;</span><br><span class="line">	ll res=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">while</span> (b) &#123;</span><br><span class="line">		<span class="keyword">if</span> (b&amp;<span class="number">1</span>) &#123;res=<span class="built_in">qmul</span>(res,a,p);&#125;</span><br><span class="line">		a=<span class="built_in">qmul</span>(a,a,p),b&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">mr</span> <span class="params">(ll p,ll x)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">qpow</span>(x,p<span class="number">-1</span>,p)!=<span class="number">1</span>) &#123;<span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line">	ll k=p<span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">while</span> (!(k&amp;<span class="number">1</span>)) &#123;</span><br><span class="line">		k&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">		ll tmp=<span class="built_in">qpow</span>(x,k,p);</span><br><span class="line">		<span class="keyword">if</span> (tmp==p<span class="number">-1</span>) &#123;<span class="keyword">return</span> <span class="number">1</span>;&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (tmp!=<span class="number">1</span>) &#123;<span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isp</span> <span class="params">(ll p)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (p==<span class="number">46856248255981</span>||p==<span class="number">1</span>) &#123;<span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line">	<span class="keyword">if</span> (p==<span class="number">2</span>||p==<span class="number">3</span>||p==<span class="number">7</span>||p==<span class="number">61</span>||p==<span class="number">24251</span>) &#123;<span class="keyword">return</span> <span class="number">1</span>;&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">mr</span>(p,<span class="number">2</span>)&amp;&amp;<span class="built_in">mr</span>(p,<span class="number">3</span>)&amp;&amp;<span class="built_in">mr</span>(p,<span class="number">7</span>)&amp;&amp;<span class="built_in">mr</span>(p,<span class="number">61</span>)&amp;&amp;<span class="built_in">mr</span>(p,<span class="number">24251</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">chk</span> <span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span> </span>&#123;<span class="keyword">return</span> (x&gt;<span class="number">0</span>&amp;&amp;y&gt;<span class="number">0</span>&amp;&amp;x&lt;=n&amp;&amp;y&lt;=m&amp;&amp;mp[x][y]!=<span class="number">-1</span>&amp;&amp;!vis[x][y]);&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">sr</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> x=<span class="built_in">rd</span>()%n+<span class="number">1</span>,y=<span class="built_in">rd</span>()%m+<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">while</span> (mp[x][y]&lt;=<span class="number">0</span>) &#123;x=<span class="built_in">rd</span>()%n+<span class="number">1</span>,y=<span class="built_in">rd</span>()%n+<span class="number">1</span>;&#125;</span><br><span class="line">	v.<span class="built_in">push_back</span>(<span class="built_in">make_pair</span>(x,y));vis[x][y]=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">17</span>;i++) &#123;</span><br><span class="line">		<span class="type">int</span> dr=<span class="built_in">rd</span>()%<span class="number">4</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">4</span>;i++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (!<span class="built_in">chk</span>(x+dir[dr][<span class="number">0</span>],y+dir[dr][<span class="number">1</span>])) &#123;dr=(dr+<span class="number">1</span>)%<span class="number">4</span>;&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (!<span class="built_in">chk</span>(x+dir[dr][<span class="number">0</span>],y+dir[dr][<span class="number">1</span>])) &#123;<span class="keyword">break</span>;&#125;</span><br><span class="line">		x+=dir[dr][<span class="number">0</span>],y+=dir[dr][<span class="number">1</span>];</span><br><span class="line">		v.<span class="built_in">push_back</span>(<span class="built_in">make_pair</span>(x,y));vis[x][y]=<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">auto</span> x:v) vis[x.first][x.second]=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">chkk</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	ll tmp=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span> (v.<span class="built_in">size</span>()!=<span class="number">18</span>) &#123;<span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">auto</span> x:v) &#123;tmp=tmp*<span class="number">10</span>+mp[x.first][x.second];&#125;</span><br><span class="line">	cerr &lt;&lt; tmp &lt;&lt; endl;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">isp</span>(tmp);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">drp</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">auto</span> x:v) &#123;mp[x.first][x.second]=<span class="number">-1</span>;&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">1</span>;j&lt;=m;j++) &#123;</span><br><span class="line">		<span class="type">int</span> cnt=n;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=n;i&gt;=<span class="number">1</span>;i--) &#123;</span><br><span class="line">			<span class="keyword">if</span> (mp[i][j]!=<span class="number">-1</span>) &#123;mp[cnt--][j]=mp[i][j];&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">while</span> (cnt) &#123;mp[cnt--][j]=<span class="number">-1</span>;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">freopen</span>(<span class="string">&quot;game4.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">	<span class="built_in">freopen</span>(<span class="string">&quot;game4.out&quot;</span>,<span class="string">&quot;w&quot;</span>,stdout);</span><br><span class="line">	<span class="built_in">srand</span>(<span class="built_in">time</span>(<span class="number">0</span>));</span><br><span class="line">	sd=<span class="built_in">rand</span>()+<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d%d%d%d%d%d&quot;</span>,&amp;n,&amp;m,&amp;k,&amp;l1,&amp;l2,&amp;c1,&amp;c2,&amp;f);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">1</span>;j&lt;=m;j++) &#123;<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;mp[i][j]);&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=k;i++) &#123;</span><br><span class="line">		v.<span class="built_in">clear</span>();</span><br><span class="line">		<span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">			<span class="built_in">sr</span>();</span><br><span class="line">			<span class="keyword">if</span> (!<span class="built_in">chkk</span>()) &#123;v.<span class="built_in">clear</span>();&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;<span class="keyword">break</span>;&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,v.<span class="built_in">size</span>());</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">auto</span> x:v) &#123;<span class="built_in">printf</span>(<span class="string">&quot;%d %d &quot;</span>,x.first,x.second);&#125;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">		<span class="built_in">drp</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="测试点-5："><a href="#测试点-5：" class="headerlink" title="测试点 5："></a>测试点 5：</h5><p>$n=m=10, K=100, l_{min}=2, l_{max}=8, c_1=c_2=2, F=0$，网格如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">9 0 4 4 4 0 1 0 0 9</span><br><span class="line">4 3 4 1 5 3 3 6 2 2</span><br><span class="line">6 9 8 0 4 9 9 1 7 7</span><br><span class="line">5 3 2 5 6 8 0 5 8 0</span><br><span class="line">1 7 4 5 0 7 0 5 7 3</span><br><span class="line">5 3 5 1 0 9 7 2 3 4</span><br><span class="line">3 6 3 9 4 5 2 6 4 5</span><br><span class="line">9 7 6 5 5 1 6 6 3 0</span><br><span class="line">9 3 1 0 7 6 8 3 2 2</span><br><span class="line">9 0 9 4 8 4 4 5 0 6</span><br></pre></td></tr></table></figure>
<p>和测试点 2 的区别是 $c=2$ 且 $F=0$，那么不用消完，但是需要尽可能消比较长的段，我们只需要在测试点 2 的爆搜中限制只搜长度等于 $8$ 的路径，就可以得到大概 $7$ 分到 $9$ 分。</p>
<p>搜出一个包含 $12$ 条长度为 $8$ 的路径的解，这时还剩 $4$ 个元素，如果运气好的话（多试几次）还能再找到一条长度为 $3$ 或者 $4$ 的路径，手动把它加上，就可以通过了。</p>
<h5 id="测试点-6："><a href="#测试点-6：" class="headerlink" title="测试点 6："></a>测试点 6：</h5><p>$n=m=1000,  K=1, l_{min}=2, l_{max}=1000, c_1=0, c_2=1, F=0$，网格只包含 $1,2$，随机生成。</p>
<p>翻译一下，其实就是找到一条长度不超过 $1000$ 的尽量长的回文简单路径。</p>
<p>那么暴搜即可，每次随机一个中心，然后往两边扩展，很容易找到长度恰好为 $1000$ 的回文路径。</p>
<h5 id="测试点-7："><a href="#测试点-7：" class="headerlink" title="测试点 7："></a>测试点 7：</h5><p>$n=m=1000,  K=1, l_{min}=2, l_{max}=1000, c_1=0, c_2=1, F=0$，网格只包含 $2,3,4$，随机生成。</p>
<p>同测试点 6，以下是这两个点的程序。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ull unsigned long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1010</span>;</span><br><span class="line"><span class="type">int</span> n,m,k,l1,l2,c1,c2,f,mp[N][N],vis[N][N],dir[<span class="number">4</span>][<span class="number">2</span>]=&#123;&#123;<span class="number">0</span>,<span class="number">1</span>&#125;,&#123;<span class="number">0</span>,<span class="number">-1</span>&#125;,&#123;<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;<span class="number">-1</span>,<span class="number">0</span>&#125;&#125;;</span><br><span class="line">vector &lt; pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt; &gt; v1,v2; </span><br><span class="line">ull sd;</span><br><span class="line"><span class="function">ull <span class="title">rd</span> <span class="params">()</span> </span>&#123;sd^=(sd&lt;&lt;<span class="number">27</span>);sd^=(sd&gt;&gt;<span class="number">19</span>);sd^=(sd&lt;&lt;<span class="number">25</span>);<span class="keyword">return</span> sd;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">chk</span> <span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span> </span>&#123;<span class="keyword">return</span> (x&gt;<span class="number">0</span>&amp;&amp;y&gt;<span class="number">0</span>&amp;&amp;x&lt;=n&amp;&amp;y&lt;=m&amp;&amp;mp[x][y]!=<span class="number">-1</span>&amp;&amp;!vis[x][y]);&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">dfs</span> <span class="params">(<span class="type">int</span> x1,<span class="type">int</span> y1,<span class="type">int</span> x2,<span class="type">int</span> y2,<span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">	<span class="comment">//cout &lt;&lt; x1 &lt;&lt; &quot;  &quot; &lt;&lt; y1 &lt;&lt; &quot;  &quot; &lt;&lt; x2 &lt;&lt; &quot;  &quot;  &lt;&lt; y2 &lt;&lt; &quot;  &quot; &lt;&lt; v &lt;&lt; endl;</span></span><br><span class="line">	v1.<span class="built_in">push_back</span>(<span class="built_in">make_pair</span>(x1,y1)),v2.<span class="built_in">push_back</span>(<span class="built_in">make_pair</span>(x2,y2));</span><br><span class="line">	vis[x1][y1]=vis[x2][y2]=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span> (v==<span class="number">500</span>) &#123;<span class="keyword">return</span> <span class="number">1</span>;&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">3</span>;i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">0</span>;j&lt;=<span class="number">3</span>;j++) &#123;</span><br><span class="line">			<span class="type">int</span> x3=x1+dir[i][<span class="number">0</span>],y3=y1+dir[i][<span class="number">1</span>],x4=x2+dir[j][<span class="number">0</span>],y4=y2+dir[j][<span class="number">1</span>];</span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">chk</span>(x3,y3)&amp;&amp;<span class="built_in">chk</span>(x4,y4)&amp;&amp;mp[x3][y3]==mp[x4][y4]) &#123;</span><br><span class="line">				<span class="keyword">if</span> (<span class="built_in">dfs</span>(x3,y3,x4,y4,v+<span class="number">1</span>)) &#123;<span class="keyword">return</span> <span class="number">1</span>;&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	v1.<span class="built_in">pop_back</span>(),v2.<span class="built_in">pop_back</span>();</span><br><span class="line">	vis[x1][y1]=vis[x2][y2]=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">solve</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> x=<span class="built_in">rd</span>()%n+<span class="number">1</span>,y=<span class="built_in">rd</span>()%m+<span class="number">1</span>,d=<span class="built_in">rd</span>()%<span class="number">4</span>,x2=x+dir[d][<span class="number">0</span>],y2=y+dir[d][<span class="number">1</span>];</span><br><span class="line">	<span class="keyword">while</span> (!<span class="built_in">chk</span>(x,y)||!<span class="built_in">chk</span>(x2,y2)||mp[x][y]!=mp[x2][y2]) &#123;</span><br><span class="line">		x=<span class="built_in">rd</span>()%n+<span class="number">1</span>,y=<span class="built_in">rd</span>()%m+<span class="number">1</span>,d=<span class="built_in">rd</span>()%<span class="number">4</span>,x2=x+dir[d][<span class="number">0</span>],y2=y+dir[d][<span class="number">1</span>];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">dfs</span>(x,y,x2,y2,<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">freopen</span>(<span class="string">&quot;game7.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">	<span class="built_in">freopen</span>(<span class="string">&quot;game7.out&quot;</span>,<span class="string">&quot;w&quot;</span>,stdout);</span><br><span class="line">	<span class="built_in">srand</span>(<span class="built_in">time</span>(<span class="number">0</span>));</span><br><span class="line">	sd=<span class="built_in">rand</span>()+<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d%d%d%d%d%d&quot;</span>,&amp;n,&amp;m,&amp;k,&amp;l1,&amp;l2,&amp;c1,&amp;c2,&amp;f);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">1</span>;j&lt;=m;j++) &#123;<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;mp[i][j]);&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">while</span> (!<span class="built_in">solve</span>());</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;1000 &quot;</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">500</span>;i++) &#123;<span class="built_in">printf</span>(<span class="string">&quot;%d %d &quot;</span>,v1[<span class="number">500</span>-i].first,v1[<span class="number">500</span>-i].second);&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">500</span>;i++) &#123;<span class="built_in">printf</span>(<span class="string">&quot;%d %d &quot;</span>,v2[i<span class="number">-1</span>].first,v2[i<span class="number">-1</span>].second);&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="测试点-8："><a href="#测试点-8：" class="headerlink" title="测试点 8："></a>测试点 8：</h5><p>$n=999, m=100, K=1, l_{min}=2, l_{max}=100000, c_1=0, c_2=1, F=0$，网格似乎很有规律。</p>
<p>这个点和 $6,7$ 不同的是我们需要找出的回文串非常长，不可能直接搜索，而是需要构造。</p>
<p>但是我们可以发现，网格几乎只由 $5,6$ 构成，并且如果 $i+j$ 是奇数那么 $(i,j)$ 上几乎都是 $6$；$i+j$ 是偶数那么 $(i,j)$ 上几乎都是 $5$，只有极少的反例（大概 $200$ 多个位置）。</p>
<p>我们称这些反例所在的位置是坏位置，其他位置是好位置。</p>
<p>那么如果一个长度为奇数的路径经过的都是好位置，则它是回文的，这点非常容易证明（它必是 $5,6$ 交替的一条路径），所以我们找到一个尽可能长的这种好路径即可。</p>
<p>我们可以两行两行构造，在相邻的两行中通过来回绕经过大部分格子，同时避开所有坏位置，如图中蓝色路径：</p>
<p><img src="https://cdn.luogu.com.cn/upload/image_hosting/2nz9sd99.png" alt=""></p>
<p>这做法看起来很好，但是有个 bug，就是如果两个坏位置把路给堵上了，就走不过去了。这时我们可以从旁边一行借个道，如图：</p>
<p><img src="https://cdn.luogu.com.cn/upload/image_hosting/xlwpl21b.png" alt=""></p>
<p>数据中只有 $3$ 个这样的情况，全都特判掉就行了（代码实现时因为一些原因，将行列互换了），最后构造出的长度是 $99475$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ull unsigned long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1010</span>;</span><br><span class="line"><span class="type">int</span> n,m,k,l1,l2,c1,c2,f,mp[N][N],vis[N][N],dir[<span class="number">4</span>][<span class="number">2</span>]=&#123;&#123;<span class="number">0</span>,<span class="number">1</span>&#125;,&#123;<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="number">-1</span>&#125;,&#123;<span class="number">-1</span>,<span class="number">0</span>&#125;&#125;;</span><br><span class="line">vector &lt; pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt; &gt; v; </span><br><span class="line">ull sd;</span><br><span class="line"><span class="function">ull <span class="title">rd</span> <span class="params">()</span> </span>&#123;sd^=(sd&lt;&lt;<span class="number">27</span>);sd^=(sd&gt;&gt;<span class="number">19</span>);sd^=(sd&lt;&lt;<span class="number">25</span>);<span class="keyword">return</span> sd;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">chk</span> <span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span> </span>&#123;<span class="keyword">return</span> (x&gt;<span class="number">0</span>&amp;&amp;y&gt;<span class="number">0</span>&amp;&amp;x&lt;=n&amp;&amp;y&lt;=m&amp;&amp;mp[x][y]!=<span class="number">-1</span>&amp;&amp;!vis[x][y]);&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span> <span class="params">(<span class="type">int</span> l,<span class="type">int</span> x,<span class="type">int</span> d)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (l==<span class="number">101</span>) &#123;<span class="keyword">return</span>;&#125;</span><br><span class="line">	<span class="comment">//cerr &lt;&lt; x &lt;&lt; &quot;  &quot; &lt;&lt; l &lt;&lt; endl;</span></span><br><span class="line">	<span class="built_in">assert</span>(vis[x][l]==<span class="number">0</span>);</span><br><span class="line">	v.<span class="built_in">push_back</span>(<span class="built_in">make_pair</span>(x,l));</span><br><span class="line">	vis[x][l]=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span> (x==<span class="number">818</span>&amp;&amp;l==<span class="number">19</span>) &#123;<span class="built_in">solve</span>(l+<span class="number">1</span>,x,d);<span class="keyword">return</span>;&#125;</span><br><span class="line">	<span class="keyword">if</span> (x==<span class="number">818</span>&amp;&amp;l==<span class="number">20</span>) &#123;</span><br><span class="line">		v.<span class="built_in">push_back</span>(<span class="built_in">make_pair</span>(<span class="number">818</span>,<span class="number">21</span>));vis[<span class="number">818</span>][<span class="number">21</span>]=<span class="number">1</span>;</span><br><span class="line">		v.<span class="built_in">push_back</span>(<span class="built_in">make_pair</span>(<span class="number">817</span>,<span class="number">21</span>));vis[<span class="number">817</span>][<span class="number">21</span>]=<span class="number">1</span>;</span><br><span class="line">		v.<span class="built_in">push_back</span>(<span class="built_in">make_pair</span>(<span class="number">816</span>,<span class="number">21</span>));vis[<span class="number">816</span>][<span class="number">21</span>]=<span class="number">1</span>;</span><br><span class="line">		<span class="built_in">solve</span>(l,x<span class="number">-2</span>,d);<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (x==<span class="number">235</span>&amp;&amp;l==<span class="number">76</span>) &#123;</span><br><span class="line">		v.<span class="built_in">push_back</span>(<span class="built_in">make_pair</span>(<span class="number">235</span>,<span class="number">77</span>));vis[<span class="number">235</span>][<span class="number">77</span>]=<span class="number">1</span>;</span><br><span class="line">		v.<span class="built_in">push_back</span>(<span class="built_in">make_pair</span>(<span class="number">234</span>,<span class="number">77</span>));vis[<span class="number">234</span>][<span class="number">77</span>]=<span class="number">1</span>;</span><br><span class="line">		v.<span class="built_in">push_back</span>(<span class="built_in">make_pair</span>(<span class="number">233</span>,<span class="number">77</span>));vis[<span class="number">233</span>][<span class="number">77</span>]=<span class="number">1</span>;</span><br><span class="line">		<span class="built_in">solve</span>(l,x<span class="number">-2</span>,d);<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (x==<span class="number">269</span>&amp;&amp;l==<span class="number">77</span>) &#123;<span class="built_in">solve</span>(l+<span class="number">1</span>,x,d);<span class="keyword">return</span>;&#125;</span><br><span class="line">	<span class="keyword">if</span> (x==<span class="number">269</span>&amp;&amp;l==<span class="number">78</span>) &#123;</span><br><span class="line">		v.<span class="built_in">push_back</span>(<span class="built_in">make_pair</span>(<span class="number">269</span>,<span class="number">79</span>));vis[<span class="number">269</span>][<span class="number">79</span>]=<span class="number">1</span>;</span><br><span class="line">		v.<span class="built_in">push_back</span>(<span class="built_in">make_pair</span>(<span class="number">270</span>,<span class="number">79</span>));vis[<span class="number">270</span>][<span class="number">79</span>]=<span class="number">1</span>;</span><br><span class="line">		v.<span class="built_in">push_back</span>(<span class="built_in">make_pair</span>(<span class="number">271</span>,<span class="number">79</span>));vis[<span class="number">271</span>][<span class="number">79</span>]=<span class="number">1</span>;</span><br><span class="line">		<span class="built_in">solve</span>(l,x+<span class="number">2</span>,d);<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (d==<span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span> (x==n) &#123;</span><br><span class="line">			<span class="keyword">if</span> (l&amp;<span class="number">1</span>) &#123;<span class="built_in">solve</span>(l+<span class="number">1</span>,x,<span class="number">0</span>);&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;<span class="built_in">solve</span>(l+<span class="number">1</span>,x,<span class="number">1</span>);&#125;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (l&amp;<span class="number">1</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">chk</span>(x,l+<span class="number">1</span>)&amp;&amp;<span class="built_in">chk</span>(x+<span class="number">1</span>,l+<span class="number">1</span>)) &#123;<span class="built_in">solve</span>(l+<span class="number">1</span>,x,d);&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;<span class="built_in">solve</span>(l,x+<span class="number">1</span>,d);&#125;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">chk</span>(x,l<span class="number">-1</span>)&amp;&amp;<span class="built_in">chk</span>(x+<span class="number">1</span>,l<span class="number">-1</span>)) &#123;<span class="built_in">solve</span>(l<span class="number">-1</span>,x,d);&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;<span class="built_in">solve</span>(l,x+<span class="number">1</span>,d);&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (x==<span class="number">1</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (l&amp;<span class="number">1</span>) &#123;<span class="built_in">solve</span>(l+<span class="number">1</span>,x,<span class="number">1</span>);&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;<span class="built_in">solve</span>(l+<span class="number">1</span>,x,<span class="number">0</span>);&#125;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (l&amp;<span class="number">1</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">chk</span>(x,l+<span class="number">1</span>)&amp;&amp;<span class="built_in">chk</span>(x<span class="number">-1</span>,l+<span class="number">1</span>)) &#123;<span class="built_in">solve</span>(l+<span class="number">1</span>,x,d);&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;<span class="built_in">solve</span>(l,x<span class="number">-1</span>,d);&#125;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">chk</span>(x,l<span class="number">-1</span>)&amp;&amp;<span class="built_in">chk</span>(x<span class="number">-1</span>,l<span class="number">-1</span>)) &#123;<span class="built_in">solve</span>(l<span class="number">-1</span>,x,d);&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;<span class="built_in">solve</span>(l,x<span class="number">-1</span>,d);&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">freopen</span>(<span class="string">&quot;game8.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">	<span class="built_in">freopen</span>(<span class="string">&quot;game8.out&quot;</span>,<span class="string">&quot;w&quot;</span>,stdout);</span><br><span class="line">	<span class="built_in">srand</span>(<span class="built_in">time</span>(<span class="number">0</span>));</span><br><span class="line">	sd=<span class="built_in">rand</span>()+<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d%d%d%d%d%d&quot;</span>,&amp;n,&amp;m,&amp;k,&amp;l1,&amp;l2,&amp;c1,&amp;c2,&amp;f);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">1</span>;j&lt;=m;j++) &#123;</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;mp[i][j]);</span><br><span class="line">			<span class="keyword">if</span> ((i+j)&amp;<span class="number">1</span>) &#123;</span><br><span class="line">				<span class="keyword">if</span> (mp[i][j]!=<span class="number">6</span>) &#123;vis[i][j]=<span class="number">1</span>;cout &lt;&lt; i &lt;&lt; <span class="string">&quot;  &quot;</span> &lt;&lt; j &lt;&lt; endl;&#125;</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="keyword">if</span> (mp[i][j]!=<span class="number">5</span>) &#123;vis[i][j]=<span class="number">1</span>;cout &lt;&lt; i &lt;&lt; <span class="string">&quot;  &quot;</span> &lt;&lt; j &lt;&lt; endl;&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">solve</span>(<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">if</span> (v.<span class="built_in">size</span>()%<span class="number">2</span>==<span class="number">0</span>) &#123;v.<span class="built_in">pop_back</span>();&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,v.<span class="built_in">size</span>());</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">auto</span> x:v) &#123;<span class="built_in">assert</span>(x.second&lt;=<span class="number">100</span>);<span class="built_in">printf</span>(<span class="string">&quot;%d %d &quot;</span>,x.first,x.second);&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="测试点-9："><a href="#测试点-9：" class="headerlink" title="测试点 9："></a>测试点 9：</h5><p>$n=129, m=128, K=5, l_{min}=2, l_{max}=20000, c_1=0, c_2=2, F=0$，网格似乎很有规律。</p>
<p>虽然 $K=5$，但是由于分数是根据平方计算，所以我们还是希望一条路径搞定，这样路径最长，分数最大。</p>
<p>用比较好的编辑器打开输入数据后可以观察到每行都几乎是回文的，于是我们可以发现，整个网格几乎关于中轴线对称，只有 $18$ 对位置例外。</p>
<p>那么和测试点 8 就差不多了，我们只考虑左半边，只要绕开这些不对称的坏位置，然后再把左半边的路径翻折到右半边，就一定是一条回文的路径了。</p>
<p>这个测试点由于坏位置很少，所以甚至不需要测试点 8 那样的特判，直接两行两行绕就可以了，最后构造出的长度是 $16440$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ull unsigned long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1010</span>;</span><br><span class="line"><span class="type">int</span> n,m,k,l1,l2,c1,c2,f,mp[N][N],vis[N][N],dir[<span class="number">4</span>][<span class="number">2</span>]=&#123;&#123;<span class="number">0</span>,<span class="number">1</span>&#125;,&#123;<span class="number">0</span>,<span class="number">-1</span>&#125;,&#123;<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;<span class="number">-1</span>,<span class="number">0</span>&#125;&#125;;</span><br><span class="line">vector &lt; pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt; &gt; v; </span><br><span class="line">ull sd;</span><br><span class="line"><span class="function">ull <span class="title">rd</span> <span class="params">()</span> </span>&#123;sd^=(sd&lt;&lt;<span class="number">27</span>);sd^=(sd&gt;&gt;<span class="number">19</span>);sd^=(sd&lt;&lt;<span class="number">25</span>);<span class="keyword">return</span> sd;&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">chk</span> <span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span> </span>&#123;<span class="keyword">return</span> (x&gt;<span class="number">0</span>&amp;&amp;y&gt;<span class="number">0</span>&amp;&amp;x&lt;=n&amp;&amp;y&lt;=m&amp;&amp;mp[x][y]!=<span class="number">-1</span>&amp;&amp;!vis[x][y]);&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span> <span class="params">(<span class="type">int</span> l,<span class="type">int</span> x,<span class="type">int</span> d)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (l==<span class="number">65</span>) &#123;<span class="keyword">return</span>;&#125;</span><br><span class="line">	v.<span class="built_in">push_back</span>(<span class="built_in">make_pair</span>(x,l));</span><br><span class="line">	vis[x][l]=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span> (d==<span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span> (x==n) &#123;</span><br><span class="line">			<span class="keyword">if</span> (l&amp;<span class="number">1</span>) &#123;<span class="built_in">solve</span>(l+<span class="number">1</span>,x,<span class="number">0</span>);&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;<span class="built_in">solve</span>(l+<span class="number">1</span>,x,<span class="number">1</span>);&#125;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (l&amp;<span class="number">1</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">chk</span>(x,l+<span class="number">1</span>)&amp;&amp;<span class="built_in">chk</span>(x+<span class="number">1</span>,l+<span class="number">1</span>)) &#123;<span class="built_in">solve</span>(l+<span class="number">1</span>,x,d);&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;<span class="built_in">solve</span>(l,x+<span class="number">1</span>,d);&#125;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">chk</span>(x,l<span class="number">-1</span>)&amp;&amp;<span class="built_in">chk</span>(x+<span class="number">1</span>,l<span class="number">-1</span>)) &#123;<span class="built_in">solve</span>(l<span class="number">-1</span>,x,d);&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;<span class="built_in">solve</span>(l,x+<span class="number">1</span>,d);&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (x==<span class="number">1</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (l&amp;<span class="number">1</span>) &#123;<span class="built_in">solve</span>(l+<span class="number">1</span>,x,<span class="number">1</span>);&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;<span class="built_in">solve</span>(l+<span class="number">1</span>,x,<span class="number">0</span>);&#125;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (l&amp;<span class="number">1</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">chk</span>(x,l+<span class="number">1</span>)&amp;&amp;<span class="built_in">chk</span>(x<span class="number">-1</span>,l+<span class="number">1</span>)) &#123;<span class="built_in">solve</span>(l+<span class="number">1</span>,x,d);&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;<span class="built_in">solve</span>(l,x<span class="number">-1</span>,d);&#125;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">chk</span>(x,l<span class="number">-1</span>)&amp;&amp;<span class="built_in">chk</span>(x<span class="number">-1</span>,l<span class="number">-1</span>)) &#123;<span class="built_in">solve</span>(l<span class="number">-1</span>,x,d);&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;<span class="built_in">solve</span>(l,x<span class="number">-1</span>,d);&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">freopen</span>(<span class="string">&quot;game9.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">	<span class="built_in">freopen</span>(<span class="string">&quot;game9.out&quot;</span>,<span class="string">&quot;w&quot;</span>,stdout);</span><br><span class="line">	<span class="built_in">srand</span>(<span class="built_in">time</span>(<span class="number">0</span>));</span><br><span class="line">	sd=<span class="built_in">rand</span>()+<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d%d%d%d%d%d&quot;</span>,&amp;n,&amp;m,&amp;k,&amp;l1,&amp;l2,&amp;c1,&amp;c2,&amp;f);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">1</span>;j&lt;=m;j++) &#123;<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;mp[i][j]);&#125;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">1</span>;j&lt;=<span class="number">64</span>;j++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (mp[i][j]!=mp[i][<span class="number">129</span>-j]) &#123;vis[i][j]=<span class="number">1</span>;<span class="built_in">printf</span>(<span class="string">&quot;%d  %d\n&quot;</span>,i,j);&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	cout &lt;&lt; endl;</span><br><span class="line">	<span class="built_in">solve</span>(<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">1</span>;j&lt;=<span class="number">64</span>;j++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (!vis[i][j]) &#123;<span class="built_in">printf</span>(<span class="string">&quot;%d  %d\n&quot;</span>,i,j);&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,<span class="number">2</span>*v.<span class="built_in">size</span>());</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">auto</span> x:v) &#123;<span class="built_in">assert</span>(x.second&lt;=<span class="number">100</span>);<span class="built_in">printf</span>(<span class="string">&quot;%d %d &quot;</span>,x.first,x.second);&#125;</span><br><span class="line">	<span class="built_in">reverse</span>(v.<span class="built_in">begin</span>(),v.<span class="built_in">end</span>());</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">auto</span> x:v) &#123;<span class="built_in">assert</span>(x.second&lt;=<span class="number">100</span>);<span class="built_in">printf</span>(<span class="string">&quot;%d %d &quot;</span>,x.first,<span class="number">129</span>-x.second);&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="测试点-10："><a href="#测试点-10：" class="headerlink" title="测试点 10："></a>测试点 10：</h5><p>$n=3, m=999, K=10, l_{min}=2, l_{max}=2997, c_1=0, c_2=2, F=0$，网格似乎很有规律。</p>
<p>和测试点 9 一样，我们还是希望一条路径搞定，这里 $l_{max}=2997=n\times m$，所以最好是一条路径覆盖所有数。</p>
<p>继续观察网格规律，首先可以发现的是如果将每行三个数三个数划分，将每行看成 $333$ 个三元组构成的序列，则这个序列是回文的。</p>
<p>进一步观察，我们可以输出每个三元组的第一个数，发现每一行关于第一个数都是有周期的。</p>
<p>也就是说，整个网格有如下周期：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1 2 1 2 3 2 3 4 3 4 5 4 5 6 5 4 5 4 3 4 3 2 3 2 1 2 1</span><br><span class="line">4 3 2 5 4 3 6 5 4 7 6 5 8 7 6 7 6 5 6 5 4 5 4 3 4 3 2</span><br><span class="line">5 4 3 6 5 4 7 6 5 8 7 6 9 8 7 8 7 6 7 6 5 6 5 4 5 4 3</span><br></pre></td></tr></table></figure>
<p>观察每行每个三元组的第一个数，第一行是 <code>1 2 3 4 5 4 3 2 1</code>，第二行是 <code>4 5 6 7 8 7 6 5 4</code>，第三行是 <code>5 6 7 8 9 8 7 6 5</code>，有很强的对称性，于是我们尝试对于这个周期解决子问题。</p>
<p>通过尝试或者暴搜，我们发现有一组规律性很强的解，它的前 $9$ 项就是 <code>1 2 3 4 5 4 3 2 1</code>，你能找到吗？</p>
<p>没错！它就藏在第一个 $3\times 3$ 块中：</p>
<p><img src="https://cdn.luogu.com.cn/upload/image_hosting/k8frnvoo.png" alt=""></p>
<p>于是我们发现只要将每个 $3\times 3$ 块都像这样连起来，再把所有块串一起，就是一组合法的解。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ull unsigned long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1010</span>;</span><br><span class="line"><span class="type">int</span> n,m,k,l1,l2,c1,c2,f,mp[N][N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">freopen</span>(<span class="string">&quot;game10.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">	<span class="built_in">freopen</span>(<span class="string">&quot;game10.out&quot;</span>,<span class="string">&quot;w&quot;</span>,stdout);</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d%d%d%d%d%d&quot;</span>,&amp;n,&amp;m,&amp;k,&amp;l1,&amp;l2,&amp;c1,&amp;c2,&amp;f);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">1</span>;j&lt;=m;j++) &#123;<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;mp[i][j]);&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;2997\n&quot;</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">333</span>;i++) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d %d %d %d %d %d %d %d &quot;</span>,<span class="number">1</span>,i*<span class="number">3</span><span class="number">-2</span>,<span class="number">1</span>,i*<span class="number">3</span><span class="number">-1</span>,<span class="number">2</span>,i*<span class="number">3</span><span class="number">-1</span>,<span class="number">2</span>,i*<span class="number">3</span><span class="number">-2</span>);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d %d %d %d %d %d %d %d %d %d &quot;</span>,<span class="number">3</span>,i*<span class="number">3</span><span class="number">-2</span>,<span class="number">3</span>,i*<span class="number">3</span><span class="number">-1</span>,<span class="number">3</span>,i*<span class="number">3</span>,<span class="number">2</span>,i*<span class="number">3</span>,<span class="number">1</span>,i*<span class="number">3</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://uoj.ac/submission/582799">https://uoj.ac/submission/582799</a></p>

    </div>
</div>
<hr>
<h3 id="5-【NOI2014】动物园"><a href="#5-【NOI2014】动物园" class="headerlink" title="#5. 【NOI2014】动物园"></a><a target="_blank" rel="noopener" href="https://uoj.ac/problem/5">#5. 【NOI2014】动物园</a></h3><h4 id="题目大意：-4"><a href="#题目大意：-4" class="headerlink" title="题目大意："></a>题目大意：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题目大意
    </div>
    <div class='spoiler-content'>
        <p>给定一个长度为 $n$ 的字符集为小写字母的字符串 $w$，对于 $w$ 的每个前缀 $w[1,i]$，求出其长度不超过 $\lfloor\frac{i}{2}\rfloor$ 的非空 Border 数量，答案记为 $x_i$，只需要输出 $\prod (x_i+1)\bmod (10^9+7)$。</p>
<p>本题单个测试数据包含 $T$ 组数据。</p>
<p>$1\leq T\leq 5, 1\leq n\leq 10^6$</p>

    </div>
</div>
<h4 id="题解：-4"><a href="#题解：-4" class="headerlink" title="题解："></a>题解：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题解
    </div>
    <div class='spoiler-content'>
        <p>在运行 KMP 算法时，除了求 Fail 数组外顺便求一个 $g_i$ 表示 $w[1,i]$ 的最长的长度不超过一半的 Border，$x_i$ 可以由 $g_i$ 在 Fail 树上的深度求出。$g_i$ 的求法与 Fail 数组几乎完全相同。</p>
<p>时间复杂度：$O(n)$</p>
<p><a target="_blank" rel="noopener" href="https://uoj.ac/submission/582554">https://uoj.ac/submission/582554</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1000010</span>,P=<span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line"><span class="type">int</span> t,n,nx[N],cnt[N];</span><br><span class="line"><span class="type">char</span> s[N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;t);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> ii=<span class="number">1</span>;ii&lt;=t;ii++) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,s+<span class="number">1</span>);n=<span class="built_in">strlen</span>(s+<span class="number">1</span>),cnt[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">		<span class="type">int</span> ans=<span class="number">1</span>;<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">2</span>,j=<span class="number">0</span>,k=<span class="number">0</span>;i&lt;=n;i++) &#123;</span><br><span class="line">			<span class="keyword">while</span> (j&amp;&amp;s[j+<span class="number">1</span>]!=s[i]) &#123;j=nx[j];&#125;</span><br><span class="line">			<span class="keyword">while</span> (k&amp;&amp;s[k+<span class="number">1</span>]!=s[i]) &#123;k=nx[k];&#125;</span><br><span class="line">			<span class="keyword">if</span> (s[j+<span class="number">1</span>]==s[i]) j++;<span class="keyword">if</span> (s[k+<span class="number">1</span>]==s[i]) k++;</span><br><span class="line">			<span class="keyword">while</span> (k+k&gt;i) k=nx[k];</span><br><span class="line">			ans=(<span class="number">1ll</span>*ans*(cnt[k]+<span class="number">1</span>))%P,nx[i]=j,cnt[i]=cnt[j]+<span class="number">1</span>;</span><br><span class="line">		&#125;<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="6-【NOI2014】随机数生成器"><a href="#6-【NOI2014】随机数生成器" class="headerlink" title="#6. 【NOI2014】随机数生成器"></a><a target="_blank" rel="noopener" href="https://uoj.ac/problem/6">#6. 【NOI2014】随机数生成器</a></h3><h4 id="题目大意：-5"><a href="#题目大意：-5" class="headerlink" title="题目大意："></a>题目大意：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题目大意
    </div>
    <div class='spoiler-content'>
        <p>给定 $x_0,a,b,c,d$，令 $x_i=(ax_{i-1}^2+bx_{i-1}+c)\bmod d (i\ge 1)$。</p>
<p>有一个 $n\times m$ 网格。首先生成一个长度为 $n\times m$ 的序列 $T$，初始时 $T_i=i$，然后对于 $i=1,\ldots,n\times m$ 依次进行如下操作：交换 $T_i$ 和 $T_{x_i\bmod i}+1$，接下来再额外进行 $q$ 次交换 $T$ 中两个数的操作（在输入中给出），最后将 $T_1,\ldots,T_{n\times m}$ 按照从上到下，从左到右的顺序填入网格中。</p>
<p>你需要找一条从网格左上角到右下角的路径，每一步只能往右或往下走一格，且经过的所有格子上的数从小到大排序后形成的序列字典序最小。你只需要输出这个排序后形成的序列。</p>
<p>$2\leq n,m\leq 5000, 0\leq q\leq 50000, 0\leq a\leq 300, 0\leq b,c\leq 10^8, 0\leq x_0&lt;d\leq 10^8$</p>

    </div>
</div>
<h4 id="题解：-5"><a href="#题解：-5" class="headerlink" title="题解："></a>题解：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题解
    </div>
    <div class='spoiler-content'>
        <p>首先模拟出网格中的每个数。</p>
<p>然后按照格子里的数从小到大贪心，每一次要检查当前考虑的数 $x$ 能否被加到路径中。考虑一条路径 $S$，如果将其中的格子 $(i,j)$ 按照 $i+j$ 从小到大排序，那么 $i,j$ 分别是单调不降的，显然这也是一个格子集合能出现在同一条路径上的充分条件，所以我们以 $i+j$ 为下标，用一个 <code>set</code> 维护已经确定在路径中的格子，设 $x$ 的位置为 $(i_x,j_x)$，只要检查 $i_x+j_x$ 在 <code>set</code> 中的前驱后继和 $(i_x,j_x)$ 是否满足上述单调关系即可。如果满足，则将 $x$ 也加入路径中。</p>
<p>时间复杂度：$O(q+nm\log (n+m))$</p>
<p><a target="_blank" rel="noopener" href="https://uoj.ac/submission/582737">https://uoj.ac/submission/582737</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">5010</span>;</span><br><span class="line"><span class="type">int</span> n,m,q,x,y,pl[N*N],mp[N][N],xq[N*<span class="number">2</span>];</span><br><span class="line">ll x0,a,b,c,d;</span><br><span class="line"><span class="function">ll <span class="title">gt</span> <span class="params">()</span> </span>&#123;<span class="keyword">return</span> x0=(a*x0*x0+b*x0+c)%d;&#125;</span><br><span class="line">set &lt;<span class="type">int</span>&gt; s;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld%lld%lld%lld%d%d%d&quot;</span>,&amp;x0,&amp;a,&amp;b,&amp;c,&amp;d,&amp;n,&amp;m,&amp;q);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n*m;i++) &#123;<span class="type">int</span> tmp=<span class="built_in">gt</span>();pl[i]=i;<span class="built_in">swap</span>(pl[i],pl[tmp%i+<span class="number">1</span>]);&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=q;i++) &#123;<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;x,&amp;y);<span class="built_in">swap</span>(pl[x],pl[y]);&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n*m;i++) &#123;mp[(i<span class="number">-1</span>)/m+<span class="number">1</span>][(i<span class="number">-1</span>)%m+<span class="number">1</span>]=pl[i];&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">1</span>;j&lt;=m;j++) &#123;pl[mp[i][j]]=(i<span class="number">-1</span>)*m+j;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n*m;i++) &#123;</span><br><span class="line">		<span class="type">int</span> r=(pl[i]<span class="number">-1</span>)/m+<span class="number">1</span>,c=(pl[i]<span class="number">-1</span>)%m+<span class="number">1</span>; </span><br><span class="line">		<span class="type">int</span> flg=<span class="number">1</span>;set&lt;<span class="type">int</span>&gt;::iterator it=s.<span class="built_in">lower_bound</span>(r+c);</span><br><span class="line">		<span class="keyword">if</span> (it!=s.<span class="built_in">end</span>()) &#123;<span class="type">int</span> tm=xq[*it];<span class="keyword">if</span> ((pl[tm]<span class="number">-1</span>)/m+<span class="number">1</span>&lt;r||(pl[tm]<span class="number">-1</span>)%m+<span class="number">1</span>&lt;c) flg=<span class="number">0</span>;&#125;</span><br><span class="line">		<span class="keyword">if</span> (it!=s.<span class="built_in">begin</span>()) &#123;<span class="type">int</span> tm=xq[*(--it)];<span class="keyword">if</span> ((pl[tm]<span class="number">-1</span>)/m+<span class="number">1</span>&gt;r||(pl[tm]<span class="number">-1</span>)%m+<span class="number">1</span>&gt;c) flg=<span class="number">0</span>;&#125;</span><br><span class="line">		<span class="keyword">if</span> (flg) &#123;<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,i);xq[r+c]=i;s.<span class="built_in">insert</span>(r+c);&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="7-【NOI2014】购票"><a href="#7-【NOI2014】购票" class="headerlink" title="#7. 【NOI2014】购票"></a><a target="_blank" rel="noopener" href="https://uoj.ac/problem/7">#7. 【NOI2014】购票</a></h3><h4 id="题目大意：-6"><a href="#题目大意：-6" class="headerlink" title="题目大意："></a>题目大意：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题目大意
    </div>
    <div class='spoiler-content'>
        <p>给定一棵 $n$ 个点的以 $1$ 为根的有根树，每条边有长度 $s_i$，每个点有三个参数 $l_i,p_i,q_i$。从 $x$ 出发通过一步可以到达 $x$ 的一个祖先 $y$，设它们的距离为 $S$，则要求 $S\leq l_i$，且这一步的代价为 $S\times p_i+q_i$。对于每个点 $x$ 求出从它出发走若干步走到根的最小代价和，保证有解，保证每个点到根的距离不超过 $2\times 10^{11}$。</p>
<p>$1\leq n\leq 2\times 10^5, 0\leq p_i\leq 10^6, 0\leq q_i\leq 10^{12}, 0&lt;l_i\leq 2\times 10^{11}$</p>

    </div>
</div>
<h4 id="题解：-6"><a href="#题解：-6" class="headerlink" title="题解："></a>题解：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题解
    </div>
    <div class='spoiler-content'>
        <p>设答案为 $dp_x$，那么 $dp_x=\min_y(dp_y+(dep_x-dep_y)\times p_x+q_x)$，其中 $y$ 可以取 $x$ 的某一段深度较大的祖先。</p>
<p>这是可斜率优化的形式，将 $y$ 的状态看成一次函数 $f(t)=dp_y-dep_y\times t$，于是可以考虑用李超树维护所有 $y$。但是由于是一段树链，所以若使用树链剖分加线段树套李超树的话，时间复杂度将达到 $\log^3(*)$。</p>
<p>有一种方式可以避免这个问题，我们对树进行一次 DFS 并记录下每个点回溯的顺序，称为出栈序，记为 $o_x$。然后按照 DFS 序从小到大枚举每个点，枚举到某个点 $x$ 时设其一个祖先是 $y$，则出栈序在 $[o_x,o_y]$ 中的已经访问过的点就恰好是 $x\to y$ 这条路径上的所有点，这就可以避免树剖，转化为单纯的区间问题，线段树套李超树解决。其实这可以看作是一类 DFS 序应用的扩展。</p>
<p>时间复杂度：$O(n\log n\log P)$</p>
<p><a target="_blank" rel="noopener" href="https://uoj.ac/submission/582740">https://uoj.ac/submission/582740</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">800010</span>,M=<span class="number">8000010</span>,INF=<span class="number">1000000</span>;</span><br><span class="line"><span class="type">int</span> n,t,x,cnt,tot,dep,p[N],ord[N],rev[N],rt[N],val[M],ch[M][<span class="number">2</span>];</span><br><span class="line">ll s[N],l[N],q[N],a[N],b[N],dis[N];</span><br><span class="line">vector &lt;<span class="type">int</span>&gt; sn[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs1</span> <span class="params">(<span class="type">int</span> x)</span> </span>&#123;<span class="keyword">for</span> (<span class="keyword">auto</span> y:sn[x]) &#123;<span class="built_in">dfs1</span>(y);&#125;ord[x]=++cnt;&#125;</span><br><span class="line"><span class="function">ll <span class="title">gt</span> <span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span> </span>&#123;<span class="keyword">return</span> a[x]*y+b[x];&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">modifyt</span> <span class="params">(<span class="type">int</span> &amp;p,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!p) &#123;val[p=++tot]=v;&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;<span class="keyword">if</span> (<span class="built_in">gt</span>(v,mid)&lt;<span class="built_in">gt</span>(val[p],mid)) <span class="built_in">swap</span>(val[p],v);</span><br><span class="line">		<span class="keyword">if</span> (l==r) <span class="keyword">return</span>;(<span class="built_in">gt</span>(v,l)&lt;<span class="built_in">gt</span>(val[p],l))?<span class="built_in">modifyt</span>(ch[p][<span class="number">0</span>],l,mid,v):<span class="built_in">modifyt</span>(ch[p][<span class="number">1</span>],mid+<span class="number">1</span>,r,v);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">queryt</span> <span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!p) &#123;<span class="keyword">return</span> <span class="number">1e18</span>;&#125;ll res=<span class="built_in">gt</span>(val[p],v);</span><br><span class="line">	<span class="keyword">if</span> (l==r) &#123;<span class="keyword">return</span> res;&#125;<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">min</span>(res,v&lt;=mid?<span class="built_in">queryt</span>(ch[p][<span class="number">0</span>],l,mid,v):<span class="built_in">queryt</span>(ch[p][<span class="number">1</span>],mid+<span class="number">1</span>,r,v));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">modify</span> <span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> pos,<span class="type">int</span> val)</span> </span>&#123;</span><br><span class="line">	<span class="built_in">modifyt</span>(rt[p],<span class="number">0</span>,INF,val);<span class="keyword">if</span> (l==r) &#123;<span class="keyword">return</span>;&#125;</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;(pos&lt;=mid)?<span class="built_in">modify</span>(p&lt;&lt;<span class="number">1</span>,l,mid,pos,val):<span class="built_in">modify</span>((p&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>,mid+<span class="number">1</span>,r,pos,val);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">query</span> <span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> xl,<span class="type">int</span> xr,<span class="type">int</span> val)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (xr&lt;l||r&lt;xl) &#123;<span class="keyword">return</span> <span class="number">1e18</span>;&#125; <span class="keyword">if</span> (xl&lt;=l&amp;&amp;r&lt;=xr) &#123;<span class="keyword">return</span> <span class="built_in">queryt</span>(rt[p],<span class="number">0</span>,INF,val);&#125;</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;<span class="keyword">return</span> <span class="built_in">min</span>(<span class="built_in">query</span>(p&lt;&lt;<span class="number">1</span>,l,mid,xl,xr,val),<span class="built_in">query</span>((p&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>,mid+<span class="number">1</span>,r,xl,xr,val));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs2</span> <span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">	b[x]=<span class="built_in">query</span>(<span class="number">1</span>,<span class="number">1</span>,n,ord[x],ord[rev[<span class="built_in">lower_bound</span>(dis,dis+dep+<span class="number">1</span>,dis[dep]-l[x])-dis]],p[x])+p[x]*dis[dep]+q[x];</span><br><span class="line">	<span class="keyword">if</span> (x==<span class="number">1</span>) b[x]=<span class="number">0</span>;a[x]=-dis[dep];<span class="built_in">modify</span>(<span class="number">1</span>,<span class="number">1</span>,n,ord[x],x);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">auto</span> y:sn[x]) &#123;dis[dep+<span class="number">1</span>]=dis[dep]+s[y];rev[++dep]=y;<span class="built_in">dfs2</span>(y);--dep;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;t);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">2</span>;i&lt;=n;i++) &#123;<span class="built_in">scanf</span>(<span class="string">&quot;%d%lld%d%lld%lld&quot;</span>,&amp;x,&amp;s[i],&amp;p[i],&amp;q[i],&amp;l[i]);sn[x].<span class="built_in">push_back</span>(i);&#125;</span><br><span class="line">	<span class="built_in">dfs1</span>(<span class="number">1</span>);</span><br><span class="line">	rev[<span class="number">0</span>]=<span class="number">1</span>;<span class="built_in">dfs2</span>(<span class="number">1</span>);<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">2</span>;i&lt;=n;i++) &#123;<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,b[i]);&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="8-Quine"><a href="#8-Quine" class="headerlink" title="#8. Quine"></a><a target="_blank" rel="noopener" href="https://uoj.ac/problem/8">#8. Quine</a></h3><h4 id="题目大意：-7"><a href="#题目大意：-7" class="headerlink" title="题目大意："></a>题目大意：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题目大意
    </div>
    <div class='spoiler-content'>
        <p>写一个程序，输出它自己的源代码，且源代码至少包含 $10$ 个可见字符。</p>

    </div>
</div>
<h4 id="题解：-7"><a href="#题解：-7" class="headerlink" title="题解："></a>题解：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题解
    </div>
    <div class='spoiler-content'>
        <p>首先考虑这题的困难之处在哪里：如果我们需要输出一些东西，那么就需要把它写在输出语句里，当我们想要输出源代码本身时，这样就会无限嵌套。解决方法也很简单，我们用一个字符串记录要输出的内容，然后将它输出两遍，就不会无限嵌套了。</p>
<p>但是现在新的问题是，源代码中有双引号、换行符等特殊字符，如果将字面量写在字符串中将不能正确编译。这个问题的解决方法也很简单，我们用反斜杠转义先预处理出双引号、反斜杠、换行符等特殊字符，然后在需要输出这些字符时输出预处理的字符串即可。</p>
<p>时间复杂度：$O(1)$</p>
<p><a target="_blank" rel="noopener" href="https://uoj.ac/submission/582818">https://uoj.ac/submission/582818</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="type">char</span> a[<span class="number">2</span>]=<span class="string">&quot;\&quot;&quot;</span>;<span class="type">char</span> b[<span class="number">2</span>]=<span class="string">&quot;\\&quot;</span>;<span class="type">char</span> c[]=<span class="string">&quot;#include &lt;bits/stdc++.h&gt;%sint main () &#123;%schar a[2]=%s%s%s%s;char b[2]=%s%s%s%s;char c[]=%s%s%s;char d[]=%s%s%s;char e[2]=%s%sn%s;%sprintf(%s%s%s%s);%s&#125;&quot;</span>;<span class="type">char</span> d[]=<span class="string">&quot;,e,e,a,b,a,a,a,b,b,a,a,c,a,a,d,a,a,b,a,e,a,c,a,d,e&quot;</span>;<span class="type">char</span> e[<span class="number">2</span>]=<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;#include &lt;bits/stdc++.h&gt;%sint main () &#123;%schar a[2]=%s%s%s%s;char b[2]=%s%s%s%s;char c[]=%s%s%s;char d[]=%s%s%s;char e[2]=%s%sn%s;%sprintf(%s%s%s%s);%s&#125;&quot;</span>,e,e,a,b,a,a,a,b,b,a,a,c,a,a,d,a,a,b,a,e,a,c,a,d,e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="9-【UTR-1】vfk的数据"><a href="#9-【UTR-1】vfk的数据" class="headerlink" title="#9. 【UTR #1】vfk的数据"></a><a target="_blank" rel="noopener" href="https://uoj.ac/problem/9">#9. 【UTR #1】vfk的数据</a></h3><h4 id="题目大意：-8"><a href="#题目大意：-8" class="headerlink" title="题目大意："></a>题目大意：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题目大意
    </div>
    <div class='spoiler-content'>
        <p>给定 $n$ 个同一道题的输入文件名 $S_1,\ldots,S_n$，将它们按照测试点编号从小到大排序。文件名的格式为 <code>题目名 + 测试点编号 + .in</code>。</p>
<p>$1\leq n\leq 10000, 4\leq |S_i|\leq 100$</p>

    </div>
</div>
<h4 id="题解：-8"><a href="#题解：-8" class="headerlink" title="题解："></a>题解：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题解
    </div>
    <div class='spoiler-content'>
        <p>容易发现长度长的串一定编号更大，而长度一样的串直接比较字典序即可。</p>
<p>时间复杂度：$O(\sum |S_i|\log |S|)$</p>
<p><a target="_blank" rel="noopener" href="https://uoj.ac/submission/582821">https://uoj.ac/submission/582821</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">10010</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">T</span> &#123;string s;&#125;t[N];</span><br><span class="line"><span class="type">bool</span> <span class="keyword">operator</span> &lt; (T a,T b) &#123;<span class="keyword">return</span> a.s.<span class="built_in">length</span>()==b.s.<span class="built_in">length</span>()?a.s&lt;b.s:a.s.<span class="built_in">length</span>()&lt;b.s.<span class="built_in">length</span>();&#125;</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	cin &gt;&gt; n;<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) cin &gt;&gt; t[i].s;</span><br><span class="line">	<span class="built_in">sort</span>(t+<span class="number">1</span>,t+n+<span class="number">1</span>);<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) cout &lt;&lt; t[i].s &lt;&lt; endl;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="10-【UTR-1】pyx的难题"><a href="#10-【UTR-1】pyx的难题" class="headerlink" title="#10. 【UTR #1】pyx的难题"></a><a target="_blank" rel="noopener" href="https://uoj.ac/problem/10">#10. 【UTR #1】pyx的难题</a></h3><h4 id="题目大意：-9"><a href="#题目大意：-9" class="headerlink" title="题目大意："></a>题目大意：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题目大意
    </div>
    <div class='spoiler-content'>
        <p>有 $n$ 个任务，第 $i$ 个任务开始时间为 $t_i$，需要花 $s_i$ 单位时间完成，优先级为 $p_i$。所有任务的优先级是两两不同的正整数。有一个人在做任务。他做任务的方法是每单位时间都找到目前已经开始，且尚未完成的任务中，优先级最高的，在这一单位时间内做这个任务。如果没有已经开始且尚未完成的任务，那么这一单位时间闲置。</p>
<p>现在有恰好一个任务的优先级 $p_i$ 丢失了，但是知道这个任务恰好在 $T$ 时刻被完成。求一种可能的 $p_i$，并求此时每个任务完成的时间，保证有解。</p>
<p>$1\leq n\leq 3\times 10^5, 0\leq t_i\leq 10^9, 1\leq s_i,p_i\leq 10^9, 1\leq T\leq 10^{15}$</p>

    </div>
</div>
<h4 id="题解：-9"><a href="#题解：-9" class="headerlink" title="题解："></a>题解：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题解
    </div>
    <div class='spoiler-content'>
        <p>设优先级丢失的任务是任务 $n$。首先我们假设这个任务不存在，模拟一遍做其他任务的过程（可以用优先队列模拟），然后考虑时间段 $[t_n,T]$，这个时间段是可能用来做任务 $n$ 的。</p>
<p>设 $T_0$ 是这个时间段中的闲置时间，$T_i$ 是这个时间段中用来做任务 $i$ 的时间，则加入任务 $n$ 会使得这个时间段做内所有优先级比它低的任务的时间转移成做任务 $n$，所以我们要求：</p>
<script type="math/tex; mode=display">T_0+\sum_{p_i<p_n}T_i=s_n</script><p>按照 $p_i$ 从小到大对任务排序后枚举每个前缀，检验上述条件是否满足即可。求出 $p_n$ 之后再模拟一遍即可得到每个任务的完成时间。</p>
<p>时间复杂度：$O(n\log n)$</p>
<p><a target="_blank" rel="noopener" href="https://uoj.ac/submission/582827">https://uoj.ac/submission/582827</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">300010</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">T</span> &#123;<span class="type">int</span> s,t,p,id;&#125; p[N];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">S</span> &#123;ll tim;<span class="type">int</span> id;<span class="built_in">S</span> (ll a=<span class="number">0</span>,<span class="type">int</span> b=<span class="number">0</span>) &#123;tim=a;id=b;&#125;&#125; q[N];</span><br><span class="line"><span class="type">int</span> n,s,t,tot,lst[N];</span><br><span class="line">ll e,ky,ans[N];</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span> <span class="params">(T a,T b)</span> </span>&#123;<span class="keyword">return</span> a.p&lt;b.p;&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp2</span> <span class="params">(S a,S b)</span> </span>&#123;<span class="keyword">return</span> a.tim&lt;b.tim;&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;p[i].s,&amp;p[i].t,&amp;p[i].p);p[i].id=i;<span class="keyword">if</span> (p[i].p==<span class="number">-1</span>) &#123;p[i].p=<span class="number">1e9</span>+<span class="number">2</span>,s=p[i].s,t=p[i].t;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>,&amp;e);<span class="built_in">sort</span>(p+<span class="number">1</span>,p+n+<span class="number">1</span>,cmp);tot=<span class="number">0</span>;</span><br><span class="line">	q[++tot]=<span class="built_in">S</span>(s,<span class="number">0</span>),q[++tot]=<span class="built_in">S</span>(e,<span class="number">0</span>);q[++tot]=<span class="built_in">S</span>(<span class="number">1e16</span>,<span class="number">0</span>);</span><br><span class="line">	priority_queue &lt; pair&lt;pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt;,<span class="type">int</span>&gt; &gt; pq;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n<span class="number">-1</span>;i++) &#123;q[++tot]=<span class="built_in">S</span>(p[i].s,i);&#125;</span><br><span class="line">	<span class="built_in">sort</span>(q+<span class="number">1</span>,q+tot+<span class="number">1</span>,cmp2);</span><br><span class="line">	ll cur=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=tot;i++) &#123;</span><br><span class="line">		ll tmp=q[i].tim-cur;</span><br><span class="line">		<span class="keyword">while</span> (pq.<span class="built_in">size</span>()&amp;&amp;tmp&gt;=pq.<span class="built_in">top</span>().second) &#123;</span><br><span class="line">			<span class="keyword">if</span> (cur&gt;=s&amp;&amp;cur&lt;e) &#123;lst[pq.<span class="built_in">top</span>().first.second]+=pq.<span class="built_in">top</span>().second;&#125;</span><br><span class="line">			tmp-=pq.<span class="built_in">top</span>().second;pq.<span class="built_in">pop</span>();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (pq.<span class="built_in">size</span>()) &#123;</span><br><span class="line">			<span class="keyword">if</span> (cur&gt;=s&amp;&amp;cur&lt;e) &#123;lst[pq.<span class="built_in">top</span>().first.second]+=tmp;&#125;</span><br><span class="line">			pair &lt;pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt;,<span class="type">int</span>&gt; tmpp=<span class="built_in">make_pair</span>(pq.<span class="built_in">top</span>().first,pq.<span class="built_in">top</span>().second-tmp);</span><br><span class="line">			tmp=<span class="number">0</span>;pq.<span class="built_in">pop</span>();pq.<span class="built_in">push</span>(tmpp);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (cur&gt;=s&amp;&amp;cur&lt;e) &#123;ky+=tmp;&#125;</span><br><span class="line">		<span class="keyword">if</span> (q[i].id) &#123;pq.<span class="built_in">push</span>(<span class="built_in">make_pair</span>(<span class="built_in">make_pair</span>(p[q[i].id].p,q[i].id),p[q[i].id].t));&#125;</span><br><span class="line">		cur=q[i].tim;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (p[i<span class="number">-1</span>].p+<span class="number">1</span>&lt;p[i].p&amp;&amp;ky==t) &#123;p[n].p=p[i<span class="number">-1</span>].p+<span class="number">1</span>;<span class="keyword">break</span>;&#125;</span><br><span class="line">		ky+=lst[i];</span><br><span class="line">	&#125;</span><br><span class="line">	q[++tot]=<span class="built_in">S</span>(p[n].s,n);</span><br><span class="line">	<span class="built_in">sort</span>(q+<span class="number">1</span>,q+tot+<span class="number">1</span>,cmp2);</span><br><span class="line">	cur=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=tot;i++) &#123;</span><br><span class="line">		ll tmp=q[i].tim-cur;</span><br><span class="line">		<span class="keyword">while</span> (pq.<span class="built_in">size</span>()&amp;&amp;tmp&gt;=pq.<span class="built_in">top</span>().second) &#123;</span><br><span class="line">			ans[p[pq.<span class="built_in">top</span>().first.second].id]=(cur+=pq.<span class="built_in">top</span>().second);</span><br><span class="line">			tmp-=pq.<span class="built_in">top</span>().second;pq.<span class="built_in">pop</span>();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (pq.<span class="built_in">size</span>()) &#123;</span><br><span class="line">			pair &lt;pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt;,<span class="type">int</span>&gt; tmpp=<span class="built_in">make_pair</span>(pq.<span class="built_in">top</span>().first,pq.<span class="built_in">top</span>().second-tmp);</span><br><span class="line">			pq.<span class="built_in">pop</span>();pq.<span class="built_in">push</span>(tmpp);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (q[i].id) &#123;pq.<span class="built_in">push</span>(<span class="built_in">make_pair</span>(<span class="built_in">make_pair</span>(p[q[i].id].p,q[i].id),p[q[i].id].t));&#125;</span><br><span class="line">		cur=q[i].tim;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,p[n].p);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;<span class="built_in">printf</span>(<span class="string">&quot;%lld%c&quot;</span>,ans[i],<span class="string">&quot; \n&quot;</span>[i==n]);&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="11-【UTR-1】ydc的大树"><a href="#11-【UTR-1】ydc的大树" class="headerlink" title="#11. 【UTR #1】ydc的大树"></a><a target="_blank" rel="noopener" href="https://uoj.ac/problem/11">#11. 【UTR #1】ydc的大树</a></h3><h4 id="题目大意：-10"><a href="#题目大意：-10" class="headerlink" title="题目大意："></a>题目大意：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题目大意
    </div>
    <div class='spoiler-content'>
        <p>给定一棵 $n$ 个结点的无根树，边有长度 $l_i$。其中有 $m$ 个点是黑的，其余点是白的。如果删去一个白点 $x$ 会导致黑点 $y$ 与任何一个原先离 $y$ 距离最大的黑点都无法连通，则称 $x$ 支配 $y$。被白点 $x$ 支配的点数记为 $f(x)$，求 $\max_x\{f(x)\}$ 和取到最大值的 $x$ 的数量。</p>
<p>$1\leq n\leq 10^5, 1\leq l_i\leq 1000$</p>

    </div>
</div>
<h4 id="题解：-10"><a href="#题解：-10" class="headerlink" title="题解："></a>题解：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题解
    </div>
    <div class='spoiler-content'>
        <p>求出黑点的直径中点，记为 $r$，如果直径中点在某条边中间则任意取一个端点。</p>
<p>$r$ 的各个子树的最大深度分别记为 $d_1\ge \ldots \ge d_k$。考虑 $x$ 支配 $y$ 的条件，以 $r$ 为根时：</p>
<ul>
<li>若 $y$ 在 $x$ 子树内，则 $x$ 一定支配 $y$，因为离 $y$ 最远的黑点一定不会和 $y$ 在直径中心的同一侧。</li>
<li>若 $y$ 不在 $x$ 子树内，则 $x$ 支配 $y$ 当且仅当离 $y$ 最远的黑点全在 $x$ 子树内。</li>
</ul>
<p>考虑第二类情况如何统计。如果 $d_1=d_2$，则：</p>
<ul>
<li>若 $d_1=d_3$，则第二类情况不存在，因为 $d_1,d_2,d_3$ 对应的子树总有一个是和 $y$ 所在子树不同且没有被 $x$ 封住的，这个子树内的最深黑点是离 $y$ 最远的黑点；</li>
<li>若 $d_1\ne d_3$，则第二类情况会发生当且仅当 $y$ 在 $d_1$ 对应的子树里，且 $x$ 子树里包含了所有 $d_2$ 对应子树中的最深点，或反之。</li>
</ul>
<p>如果 $d_1\ne d_2$，则：</p>
<ul>
<li>若 $x$ 的子树里包含了所有 $d_1$ 对应子树中的最深点，那么所有不在 $x$ 子树里的黑点都被 $x$ 支配（事实上所有黑点都被 $x$ 支配）；</li>
<li>若 $d_2\ne d_3$，则当 $x$ 的子树里包含了所有 $d_2$ 对应子树中的最深点且 $y$ 在 $d_1$ 对应子树中时，$x$ 支配 $y$。</li>
</ul>
<p>分别统计以上情况即可。</p>
<p>时间复杂度：$O(n)$</p>
<p><a target="_blank" rel="noopener" href="https://uoj.ac/submission/582898">https://uoj.ac/submission/582898</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> fi first</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">100010</span>;</span><br><span class="line"><span class="type">int</span> n,m,x,y,z,rt,b[N],ds[N],f[N],mx[N],c[N],r[N];</span><br><span class="line">vector &lt; pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt; &gt; v[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span> <span class="params">(<span class="type">int</span> x,<span class="type">int</span> fa,<span class="type">int</span> d=<span class="number">-1</span>)</span> </span>&#123;</span><br><span class="line">	f[x]=fa,c[x]=b[x],mx[x]=(b[x]?ds[x]:<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">auto</span> u:v[x]) &#123;</span><br><span class="line">		<span class="keyword">if</span> (u.fi==fa) <span class="keyword">continue</span>;</span><br><span class="line">		ds[u.fi]=ds[x]+u.second;<span class="built_in">dfs</span>(u.fi,x,d);</span><br><span class="line">		mx[x]=<span class="built_in">max</span>(mx[x],mx[u.fi]),c[x]+=c[u.fi]; </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">gt</span> <span class="params">(<span class="type">int</span> x,<span class="type">int</span> d)</span> </span>&#123;<span class="type">int</span> res=<span class="number">-1</span>;<span class="keyword">for</span> (<span class="keyword">auto</span> u:v[x]) &#123;<span class="keyword">if</span> (u.fi!=f[x]&amp;&amp;mx[u.fi]==d) res=(res==<span class="number">-1</span>?u.fi:<span class="number">0</span>);&#125;<span class="keyword">return</span> res;&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fg</span> <span class="params">(<span class="type">int</span> x,<span class="type">int</span> d,<span class="type">int</span> v)</span> </span>&#123;<span class="keyword">while</span> (x&gt;<span class="number">0</span>) &#123;r[x]+=v;x=<span class="built_in">gt</span>(x,d);&#125;&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++) &#123;<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);b[x]=<span class="number">1</span>,rt=x;&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n<span class="number">-1</span>;i++) &#123;<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;x,&amp;y,&amp;z);v[x].<span class="built_in">push_back</span>(<span class="built_in">make_pair</span>(y,z)),v[y].<span class="built_in">push_back</span>(<span class="built_in">make_pair</span>(x,z));&#125;</span><br><span class="line">	ds[rt]=<span class="number">0</span>;<span class="built_in">dfs</span>(rt,<span class="number">0</span>);</span><br><span class="line">	x=<span class="number">0</span>;<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;<span class="keyword">if</span> (b[i]&amp;&amp;ds[i]&gt;ds[x]) x=i;&#125;ds[x]=<span class="number">0</span>;<span class="built_in">dfs</span>(x,<span class="number">0</span>);</span><br><span class="line">	y=<span class="number">0</span>;<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;<span class="keyword">if</span> (b[i]&amp;&amp;ds[i]&gt;ds[y]) y=i;&#125;</span><br><span class="line">	z=y;<span class="keyword">while</span> (ds[z]*<span class="number">2</span>&gt;ds[y]) z=f[z];ds[z]=<span class="number">0</span>;<span class="built_in">dfs</span>(z,<span class="number">0</span>,ds[y]-ds[z]);</span><br><span class="line">	<span class="type">int</span> t1=<span class="number">0</span>,t2=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span> (t1=<span class="built_in">gt</span>(z,ds[y])) &#123;</span><br><span class="line">		<span class="built_in">fg</span>(t1,ds[y],m-c[t1]);</span><br><span class="line">		<span class="keyword">if</span> ((t2=<span class="built_in">gt</span>(z,ds[x]))&amp;&amp;x!=z) &#123;<span class="built_in">fg</span>(t2,ds[x],c[t1]);&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="type">int</span> fx=x,fy=y,flg=<span class="number">1</span>;<span class="keyword">while</span> (f[fx]!=z) fx=f[fx];<span class="keyword">while</span> (f[fy]!=z) fy=f[fy];</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">auto</span> u:v[z]) &#123;<span class="keyword">if</span> (u.fi!=fx&amp;&amp;u.fi!=fy&amp;&amp;mx[u.fi]==ds[x]) flg=<span class="number">0</span>;&#125;</span><br><span class="line">		<span class="keyword">if</span> (flg) &#123;<span class="built_in">fg</span>(fy,ds[x],c[fx]),<span class="built_in">fg</span>(fx,ds[x],c[fy]);&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	t1=t2=<span class="number">0</span>;<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;<span class="keyword">if</span> (!b[i]) t1=<span class="built_in">max</span>(t1,r[i]+c[i]);&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;<span class="keyword">if</span> (!b[i]) t2+=(r[i]+c[i]==t1);&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d %d\n&quot;</span>,t1,t2);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="12-【UER-1】猜数"><a href="#12-【UER-1】猜数" class="headerlink" title="#12. 【UER #1】猜数"></a><a target="_blank" rel="noopener" href="https://uoj.ac/problem/12">#12. 【UER #1】猜数</a></h3><h4 id="题目大意：-11"><a href="#题目大意：-11" class="headerlink" title="题目大意："></a>题目大意：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题目大意
    </div>
    <div class='spoiler-content'>
        <p>给定两个数 $g,l$，已知 $g\times l$ 是完全平方数。有两个数 $a,b$ 满足 $a\times b=g\times l$ 且 $g\mid a, g\mid b$，求 $a+b$ 的最小值和最大值。</p>
<p>本题单个测试点包含 $T$ 组数据。</p>
<p>$1\leq T\leq 5, 1\leq g,l\leq 10^{18}$</p>

    </div>
</div>
<h4 id="题解：-11"><a href="#题解：-11" class="headerlink" title="题解："></a>题解：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题解
    </div>
    <div class='spoiler-content'>
        <p>根据基本的数学知识，可以知道 $a+b$ 的最小值是 $2\sqrt{gl}$，最大值是 $g+l$，但是 $gl$ 会爆 <code>long long</code>，所以可以用 $2g\sqrt{\frac{l}{g}}$ 来计算。</p>
<p>时间复杂度：$O(\log l)$</p>
<p><a target="_blank" rel="noopener" href="https://uoj.ac/submission/582900">https://uoj.ac/submission/582900</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line">ll t,g,l;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>,&amp;t);</span><br><span class="line">	<span class="keyword">for</span> (ll i=<span class="number">1</span>;i&lt;=t;i++) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld&quot;</span>,&amp;g,&amp;l);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%lld %lld\n&quot;</span>,(ll)(<span class="number">2</span>*g*<span class="built_in">sqrtl</span>((<span class="type">long</span> <span class="type">double</span>)l/(<span class="type">long</span> <span class="type">double</span>)g)+<span class="number">0.5</span>),g+l);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="13-【UER-1】跳蚤OS"><a href="#13-【UER-1】跳蚤OS" class="headerlink" title="#13. 【UER #1】跳蚤OS"></a><a target="_blank" rel="noopener" href="https://uoj.ac/problem/13">#13. 【UER #1】跳蚤OS</a></h3><h4 id="题目大意：-12"><a href="#题目大意：-12" class="headerlink" title="题目大意："></a>题目大意：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题目大意
    </div>
    <div class='spoiler-content'>
        <p>维护一个文件系统，地址以 Linux 风格表示，<code>/</code> 为根目录。首先进行 $n$ 次操作，每次给定两个地址 $s,t$，然后建立一个 $s$ 指向 $t$ 的快捷方式，即每当访问 $s$ 时都会来到 $t$，若 $t$ 也是快捷方式则 $s$ 指向 $t$ 指向的实际位置。</p>
<p>接下来进行 $m$ 次查询，每次给定地址 $s$，求 $s$ 指向的实际位置。</p>
<p>$1\leq n\leq 20000, 1\leq m\leq 10, \sum|s|+\sum|t|\leq 5\times 10^5$</p>

    </div>
</div>
<h4 id="题解：-12"><a href="#题解：-12" class="headerlink" title="题解："></a>题解：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题解
    </div>
    <div class='spoiler-content'>
        <p>用一个 Trie 维护文件结构，对于 Trie 上的结点 $x$，记 $f(x)$ 表示 $x$ 指向的实际位置，想要访问一个地址时就沿 Trie 向下走，设当前位置为 $cur$，每走一层目录就令 $cur\leftarrow f(cur)$，最后就到达了地址指向的实际位置。然后暴力实现修改和查询即可。</p>
<p>时间复杂度：$O(\sum|s|+\sum|t|)$</p>
<p><a target="_blank" rel="noopener" href="https://uoj.ac/submission/582901">https://uoj.ac/submission/582901</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">500010</span>;</span><br><span class="line"><span class="type">int</span> n,m,tot=<span class="number">1</span>,reff[N],f[N],ch[N][<span class="number">27</span>];</span><br><span class="line"><span class="type">char</span> s[N],t[N],fc[N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">ctd</span> <span class="params">(<span class="type">char</span> c)</span> </span>&#123;<span class="keyword">return</span> (c==<span class="string">&#x27;/&#x27;</span>?<span class="number">26</span>:c-<span class="string">&#x27;a&#x27;</span>);&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">gt</span> <span class="params">(<span class="type">char</span>* s)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> n=<span class="built_in">strlen</span>(s+<span class="number">1</span>),p=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span> (n==<span class="number">1</span>) &#123;<span class="keyword">return</span> <span class="number">1</span>;&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">2</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		<span class="type">int</span> tmp=<span class="built_in">ctd</span>(s[i]);</span><br><span class="line">		<span class="keyword">if</span> (!ch[p][tmp]) &#123;ch[p][tmp]=++tot;f[tot]=p,fc[tot]=s[i];&#125;p=ch[p][tmp];</span><br><span class="line">		<span class="keyword">if</span> (s[i]==<span class="string">&#x27;/&#x27;</span>&amp;&amp;reff[p]) &#123;p=reff[p];&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (!ch[p][<span class="number">26</span>]) &#123;ch[p][<span class="number">26</span>]=++tot;f[tot]=p,fc[tot]=<span class="string">&#x27;/&#x27;</span>;&#125;p=ch[p][<span class="number">26</span>];</span><br><span class="line">	<span class="keyword">if</span> (reff[p]) &#123;p=reff[p];&#125;</span><br><span class="line">	<span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">print</span> <span class="params">(<span class="type">int</span> p)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (p==<span class="number">1</span>) &#123;<span class="built_in">putchar</span>(<span class="string">&#x27;/&#x27;</span>);<span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);<span class="keyword">return</span>;&#125;</span><br><span class="line">	stack &lt;<span class="type">char</span>&gt; st;</span><br><span class="line">	p=f[p];<span class="keyword">while</span> (p!=<span class="number">1</span>) &#123;st.<span class="built_in">push</span>(fc[p]);p=f[p];&#125;</span><br><span class="line">	<span class="built_in">putchar</span>(<span class="string">&#x27;/&#x27;</span>);<span class="keyword">while</span> (st.<span class="built_in">size</span>()) &#123;<span class="built_in">putchar</span>(st.<span class="built_in">top</span>());st.<span class="built_in">pop</span>();&#125;<span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;<span class="built_in">scanf</span>(<span class="string">&quot;%s%s&quot;</span>,s+<span class="number">1</span>,t+<span class="number">1</span>);reff[<span class="built_in">gt</span>(s)]=<span class="built_in">gt</span>(t);&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++) &#123;<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,s+<span class="number">1</span>);<span class="built_in">print</span>(<span class="built_in">gt</span>(s));&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="14-【UER-1】DZY-Loves-Graph"><a href="#14-【UER-1】DZY-Loves-Graph" class="headerlink" title="#14. 【UER #1】DZY Loves Graph"></a><a target="_blank" rel="noopener" href="https://uoj.ac/problem/14">#14. 【UER #1】DZY Loves Graph</a></h3><h4 id="题目大意：-13"><a href="#题目大意：-13" class="headerlink" title="题目大意："></a>题目大意：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题目大意
    </div>
    <div class='spoiler-content'>
        <p>维护一张 $n$ 个点的无向图，初始没有边，支持 $m$ 次操作，操作分为三种：</p>
<ul>
<li>操作一：给定 $a,b$，设当前是第 $i$ 次操作，在 $a,b$ 间连一条边权为 $i$ 的边；</li>
<li>操作二：给定 $k$，删除当前边权最大的 $k$ 条边，保证至少存在 $k$ 条边；</li>
<li>操作三：撤回上一次操作，保证上一次操作不是撤回操作。</li>
</ul>
<p>每次操作后，需要输出当前图的最小生成树边权和，或报告不存在生成树。</p>
<p>$1\leq n\leq 3\times 10^5, 1\leq m\leq 5\times 10^5$</p>

    </div>
</div>
<h4 id="题解：-13"><a href="#题解：-13" class="headerlink" title="题解："></a>题解：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题解
    </div>
    <div class='spoiler-content'>
        <p>如果没有操作二，由于加入边的边权递增，所以只要用并查集维护连通性即可。</p>
<p>有操作二的情况下，设 $f_i$ 表示当前图仅考虑边权前 $i$ 小（即加入时间前 $i$ 小）的边时，MST 的权值和。设当前图中边数为 $e$，对于操作一，直接加一条边并更新 $f_{e+1}$ 即可；对于操作二，暴力删掉最后 $k$ 条加入的边，退回到 $e-k$ 条边时的状态即可。</p>
<p>但是这样做的复杂度是依赖势能的，如果有操作三就会变劣。所以我们要判断，如果某个操作二的下一个操作是操作三，那么就不暴力删除最后 $k$ 条边，只是当前输出 $f_{e-k}$ 作为答案；否则这个操作是确实会被执行的，暴力删除最后 $k$ 条边就可以通过势能分析出复杂度是对的。</p>
<p>由于并查集需要撤回，所以只能使用按秩合并。</p>
<p>时间复杂度：$O(m\log n)$</p>
<p><a target="_blank" rel="noopener" href="https://uoj.ac/submission/582901">https://uoj.ac/submission/582901</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">500010</span>;</span><br><span class="line"><span class="type">int</span> n,m,tot=<span class="number">1</span>,reff[N],f[N],ch[N][<span class="number">27</span>];</span><br><span class="line"><span class="type">char</span> s[N],t[N],fc[N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">ctd</span> <span class="params">(<span class="type">char</span> c)</span> </span>&#123;<span class="keyword">return</span> (c==<span class="string">&#x27;/&#x27;</span>?<span class="number">26</span>:c-<span class="string">&#x27;a&#x27;</span>);&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">gt</span> <span class="params">(<span class="type">char</span>* s)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> n=<span class="built_in">strlen</span>(s+<span class="number">1</span>),p=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span> (n==<span class="number">1</span>) &#123;<span class="keyword">return</span> <span class="number">1</span>;&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">2</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		<span class="type">int</span> tmp=<span class="built_in">ctd</span>(s[i]);</span><br><span class="line">		<span class="keyword">if</span> (!ch[p][tmp]) &#123;ch[p][tmp]=++tot;f[tot]=p,fc[tot]=s[i];&#125;p=ch[p][tmp];</span><br><span class="line">		<span class="keyword">if</span> (s[i]==<span class="string">&#x27;/&#x27;</span>&amp;&amp;reff[p]) &#123;p=reff[p];&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (!ch[p][<span class="number">26</span>]) &#123;ch[p][<span class="number">26</span>]=++tot;f[tot]=p,fc[tot]=<span class="string">&#x27;/&#x27;</span>;&#125;p=ch[p][<span class="number">26</span>];</span><br><span class="line">	<span class="keyword">if</span> (reff[p]) &#123;p=reff[p];&#125;</span><br><span class="line">	<span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">print</span> <span class="params">(<span class="type">int</span> p)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (p==<span class="number">1</span>) &#123;<span class="built_in">putchar</span>(<span class="string">&#x27;/&#x27;</span>);<span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);<span class="keyword">return</span>;&#125;</span><br><span class="line">	stack &lt;<span class="type">char</span>&gt; st;</span><br><span class="line">	p=f[p];<span class="keyword">while</span> (p!=<span class="number">1</span>) &#123;st.<span class="built_in">push</span>(fc[p]);p=f[p];&#125;</span><br><span class="line">	<span class="built_in">putchar</span>(<span class="string">&#x27;/&#x27;</span>);<span class="keyword">while</span> (st.<span class="built_in">size</span>()) &#123;<span class="built_in">putchar</span>(st.<span class="built_in">top</span>());st.<span class="built_in">pop</span>();&#125;<span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;<span class="built_in">scanf</span>(<span class="string">&quot;%s%s&quot;</span>,s+<span class="number">1</span>,t+<span class="number">1</span>);reff[<span class="built_in">gt</span>(s)]=<span class="built_in">gt</span>(t);&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++) &#123;<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,s+<span class="number">1</span>);<span class="built_in">print</span>(<span class="built_in">gt</span>(s));&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="15-【NOIP2014】生活大爆炸版石头剪刀布"><a href="#15-【NOIP2014】生活大爆炸版石头剪刀布" class="headerlink" title="#15. 【NOIP2014】生活大爆炸版石头剪刀布"></a><a target="_blank" rel="noopener" href="https://uoj.ac/problem/15">#15. 【NOIP2014】生活大爆炸版石头剪刀布</a></h3><h4 id="题目大意：-14"><a href="#题目大意：-14" class="headerlink" title="题目大意："></a>题目大意：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题目大意
    </div>
    <div class='spoiler-content'>
        <p>生活大爆炸版石头剪刀布中有五种手势，它们的输赢关系如下：</p>
<p><img src="pic1.png" alt="pic1"></p>
<p>两个人 A,B 在玩生活大爆炸版石头剪刀布，共进行了 $n$ 轮，给定两个长度分别为 $n_a,n_b$ 的手势序列 $S_{0\cdots n_a-1},T_{0\cdots n_b-1}$，在第 $i+1$ 轮 A 会出 $S_{i\bmod n_a}$，而 B 会出 $T_{i\bmod n_b}$，每次赢的人得一分，平局则都不得分。求两人最终分别的得分。</p>
<p>$1\leq n,n_a,n_b\leq 200$</p>

    </div>
</div>
<h4 id="题解：-14"><a href="#题解：-14" class="headerlink" title="题解："></a>题解：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题解
    </div>
    <div class='spoiler-content'>
        <p>模拟即可。</p>
<p>时间复杂度：$O(n)$</p>
<p><a target="_blank" rel="noopener" href="https://uoj.ac/submission/582901">https://uoj.ac/submission/582901</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> n,na,nb,ansa,ansb;</span><br><span class="line"><span class="type">int</span> p[<span class="number">210</span>],q[<span class="number">210</span>];</span><br><span class="line"><span class="type">int</span> m[<span class="number">5</span>][<span class="number">5</span>]=&#123;<span class="number">0</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,</span><br><span class="line">             <span class="number">1</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,</span><br><span class="line">             <span class="number">2</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">1</span>,</span><br><span class="line">             <span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,</span><br><span class="line">             <span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">0</span>&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;n,&amp;na,&amp;nb);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;na;i++) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;p[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;nb;i++) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;q[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++) &#123;</span><br><span class="line">        <span class="type">int</span> j=p[i%na];</span><br><span class="line">        <span class="type">int</span> k=q[i%nb];</span><br><span class="line">        <span class="keyword">if</span> (m[j][k]==<span class="number">1</span>) &#123;</span><br><span class="line">            ansa++;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (m[j][k]==<span class="number">2</span>) &#123;</span><br><span class="line">            ansb++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d %d\n&quot;</span>,ansa,ansb);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="16-【NOIP2014】联合权值"><a href="#16-【NOIP2014】联合权值" class="headerlink" title="#16. 【NOIP2014】联合权值"></a><a target="_blank" rel="noopener" href="https://uoj.ac/problem/16">#16. 【NOIP2014】联合权值</a></h3><h4 id="题目大意：-15"><a href="#题目大意：-15" class="headerlink" title="题目大意："></a>题目大意：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题目大意
    </div>
    <div class='spoiler-content'>
        <p>给定一张 $n$ 个点的树，点有权值 $w_i$。如果有序点对 $(u,v)$ 满足 $u,v$ 间的距离为 $2$，则它们会有联合权值 $w_u\times w_v$。求所有联合权值的最大值和总和，其中总和对 $10007$ 取模。</p>
<p>$1\leq n\leq 2\times 10^5, 1\leq w_i\leq 10000$</p>

    </div>
</div>
<h4 id="题解：-15"><a href="#题解：-15" class="headerlink" title="题解："></a>题解：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题解
    </div>
    <div class='spoiler-content'>
        <p>任取一个点为根，距离为 $2$ 的点对要么是兄弟，要么是 $u$ 和 $u$ 的父亲的父亲。后者只需枚举 $u$ 很容易统计，前者只需在每个点 $u$ 处统计其儿子间的所有贡献即可。</p>
<p>时间复杂度：$O(n)$</p>
<p><a target="_blank" rel="noopener" href="https://uoj.ac/submission/582909">https://uoj.ac/submission/582909</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">200010</span>,P=<span class="number">10007</span>;</span><br><span class="line"><span class="type">int</span> n,x,y,eg,w[MAXN],mx,sum,hd[MAXN],ver[<span class="number">2</span>*MAXN],nx[<span class="number">2</span>*MAXN],f[MAXN];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add_edge</span> <span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">	ver[++eg]=y;</span><br><span class="line">	nx[eg]=hd[x];</span><br><span class="line">	hd[x]=eg;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span> <span class="params">(<span class="type">int</span> x,<span class="type">int</span> fa)</span> </span>&#123;</span><br><span class="line">	f[x]=fa;</span><br><span class="line">	<span class="keyword">if</span> (f[fa]) &#123;mx=<span class="built_in">max</span>(mx,w[x]*w[f[fa]]),sum=(sum+w[x]*w[f[fa]])%P;&#125;</span><br><span class="line">	<span class="type">int</span> tmp=<span class="number">0</span>,tmp2=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=hd[x];i;i=nx[i]) &#123;</span><br><span class="line">		<span class="keyword">if</span> (ver[i]==fa) &#123;<span class="keyword">continue</span>;&#125;</span><br><span class="line">		<span class="built_in">dfs</span>(ver[i],x);</span><br><span class="line">		sum=(sum+tmp*w[ver[i]])%P;</span><br><span class="line">		mx=<span class="built_in">max</span>(mx,tmp2*w[ver[i]]);</span><br><span class="line">		tmp=(tmp+w[ver[i]])%P;</span><br><span class="line">		tmp2=<span class="built_in">max</span>(tmp2,w[ver[i]]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n<span class="number">-1</span>;i++) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;x,&amp;y);</span><br><span class="line">		<span class="built_in">add_edge</span>(x,y),<span class="built_in">add_edge</span>(y,x); </span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;w[i]);&#125;</span><br><span class="line">	<span class="built_in">dfs</span>(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d %d\n&quot;</span>,mx,(sum*<span class="number">2</span>)%P); </span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="17-【NOIP2014】飞扬的小鸟"><a href="#17-【NOIP2014】飞扬的小鸟" class="headerlink" title="#17. 【NOIP2014】飞扬的小鸟"></a><a target="_blank" rel="noopener" href="https://uoj.ac/problem/17">#17. 【NOIP2014】飞扬的小鸟</a></h3><h4 id="题目大意：-16"><a href="#题目大意：-16" class="headerlink" title="题目大意："></a>题目大意：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题目大意
    </div>
    <div class='spoiler-content'>
        <p>有一个长度为 $n$，高度为 $m-1$ 的地图，可以看作直角坐标系中的 $[0,n]\times [1,m]$，有 $k$ 个管道，每个管道有三个参数 $p,l,h$，表示它占据了 $[p,p]\times ([1,l]\cup [h,m])$，保证 $p$ 互不相同。</p>
<p>有一个小鸟从 $(0,x)$ 出发（其中 $x$ 是你可以任选的一个数），第 $i$ 秒内，设小鸟原先位置为 $(i-1,y)$，你可以选择点击屏幕，此时小鸟会来到 $(i,\min(m,y+X_i))$；或者不点击屏幕，此时小鸟会来到 $(i,y-Y_i)$，其中 $X_i,Y_i$ 是给定的参数。小鸟超出地图或碰到管道即为失败。</p>
<p>求小鸟能否在 $n$ 秒内不失败，如果能则求出最少需要点击屏幕的次数，否则输出最多能通过几个管道（到达一个横坐标大于 $p$ 的位置即为通过横坐标为 $p$ 的管道）。</p>
<p>$5\leq n\leq 10000, 5\leq m\leq 1000, 0\leq k&lt;n, 1\leq p\leq n-1$</p>

    </div>
</div>
<h4 id="题解：-16"><a href="#题解：-16" class="headerlink" title="题解："></a>题解：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题解
    </div>
    <div class='spoiler-content'>
        <p>每秒钟可以看作从 $+X_i$ 或 $-Y_i$ 中选择一个的背包。记 $dp(i,j)$ 表示到达 $(i,j)$ 所需的最小点击次数，选择 $+X_i$ 即需要多一次点击次数，并且注意点击后纵坐标要和 $m$ 取 $\min$。每经过一个管道，只需把管道堵住的位置的 DP 值设为无穷大即可认为不能通过管道。</p>
<p>可以用滚动数组优化空间。</p>
<p>时间复杂度：$O(nm)$</p>
<p><a target="_blank" rel="noopener" href="https://uoj.ac/submission/582917">https://uoj.ac/submission/582917</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">10010</span>,MAXM=<span class="number">10010</span>;</span><br><span class="line"><span class="type">int</span> n,m,k,x,y,z,cnt,u[MAXN],d[MAXN],l[MAXN],h[MAXN],dp[<span class="number">2</span>][MAXM];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;n,&amp;m,&amp;k);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;u[i],&amp;d[i]);</span><br><span class="line">		h[i]=m+<span class="number">1</span>,l[i]=<span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=k;i++) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;x,&amp;y,&amp;z);</span><br><span class="line">		h[x]=z,l[x]=y;</span><br><span class="line">	&#125;</span><br><span class="line">	dp[<span class="number">0</span>][<span class="number">0</span>]=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">0</span>;j&lt;=m;j++) &#123;dp[i&amp;<span class="number">1</span>][j]=<span class="number">0x3f3f3f3f</span>;&#125;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=u[i];j&lt;=h[i]<span class="number">-1</span>;j++) &#123;</span><br><span class="line">			dp[i&amp;<span class="number">1</span>][j]=<span class="built_in">min</span>(dp[i&amp;<span class="number">1</span>][j-u[i]],dp[(i&amp;<span class="number">1</span>)^<span class="number">1</span>][j-u[i]])+<span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (h[i]&gt;m) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> j=m-u[i];j&lt;=m;j++) &#123;dp[i&amp;<span class="number">1</span>][m]=<span class="built_in">min</span>(dp[i&amp;<span class="number">1</span>][m],<span class="built_in">min</span>(dp[i&amp;<span class="number">1</span>][j],dp[(i&amp;<span class="number">1</span>)^<span class="number">1</span>][j])+<span class="number">1</span>);&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">1</span>;j&lt;=l[i];j++) &#123;dp[i&amp;<span class="number">1</span>][j]=<span class="number">0x3f3f3f3f</span>;&#125;</span><br><span class="line">		<span class="type">int</span> tmp=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=l[i]+<span class="number">1</span>;j&lt;=h[i]<span class="number">-1</span>;j++) &#123;tmp=<span class="built_in">min</span>(tmp,dp[i&amp;<span class="number">1</span>][j]=<span class="built_in">min</span>(dp[i&amp;<span class="number">1</span>][j],j+d[i]&lt;=m?dp[(i&amp;<span class="number">1</span>)^<span class="number">1</span>][j+d[i]]:<span class="number">0x3f3f3f3f</span>));&#125;</span><br><span class="line">		<span class="keyword">if</span> (tmp&gt;=<span class="number">0x3f3f3f3f</span>) &#123;<span class="built_in">printf</span>(<span class="string">&quot;0\n%d\n&quot;</span>,cnt);<span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line">		<span class="keyword">if</span> (h[i]&lt;=m) &#123;cnt++;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> tmp=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> j=l[n]+<span class="number">1</span>;j&lt;=h[n]<span class="number">-1</span>;j++) &#123;tmp=<span class="built_in">min</span>(tmp,dp[n&amp;<span class="number">1</span>][j]);&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;1\n%d\n&quot;</span>,tmp);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="18-【NOIP2014】无线网络发射器选址"><a href="#18-【NOIP2014】无线网络发射器选址" class="headerlink" title="#18. 【NOIP2014】无线网络发射器选址"></a><a target="_blank" rel="noopener" href="https://uoj.ac/problem/18">#18. 【NOIP2014】无线网络发射器选址</a></h3><h4 id="题目大意：-17"><a href="#题目大意：-17" class="headerlink" title="题目大意："></a>题目大意：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题目大意
    </div>
    <div class='spoiler-content'>
        <p>有一个 $129\times 129$ 的网格，行列分别编号为 $0,\ldots,128$。给定参数 $d$，在 $(x,y)$ 处设置无线网络发射器可以覆盖到所有满足 $\max(|x-x’|,|y-y’|)\leq d$ 的格子 $(x’,y’)$。有 $n$ 个给定位置的公共场所，每个公共场所有权值 $w_i$。求一个发射器能覆盖到的公共场所权值和的最大值，以及有几种取到最大值的发射器位置。</p>
<p>$1\leq d,n\leq 20, 1\leq w_i\leq 10^6$</p>

    </div>
</div>
<h4 id="题解：-17"><a href="#题解：-17" class="headerlink" title="题解："></a>题解：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题解
    </div>
    <div class='spoiler-content'>
        <p>暴力枚举发射器位置，再暴力计算能覆盖的位置的公共场所权值和即可。</p>
<p>时间复杂度：$O(n+M^2d^2)$（其中 $M=129$ 为坐标范围）</p>
<p><a target="_blank" rel="noopener" href="https://uoj.ac/submission/582911">https://uoj.ac/submission/582911</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> d,n,x,y,z,ax,ay,p[<span class="number">130</span>][<span class="number">130</span>];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;d,&amp;n);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;x,&amp;y,&amp;z);</span><br><span class="line">		p[x][y]+=z;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">128</span>;i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">0</span>;j&lt;=<span class="number">128</span>;j++) &#123;</span><br><span class="line">			<span class="type">int</span> tmp=<span class="number">0</span>;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> k=<span class="built_in">max</span>(<span class="number">0</span>,i-d);k&lt;=<span class="built_in">min</span>(<span class="number">128</span>,i+d);k++) &#123;</span><br><span class="line">				<span class="keyword">for</span> (<span class="type">int</span> l=<span class="built_in">max</span>(<span class="number">0</span>,j-d);l&lt;=<span class="built_in">min</span>(<span class="number">128</span>,j+d);l++) &#123;</span><br><span class="line">					tmp+=p[k][l];</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (tmp&gt;ay) &#123;ay=tmp,ax=<span class="number">1</span>;&#125;</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span> (tmp==ay) &#123;ax++;&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d %d\n&quot;</span>,ax,ay);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="19-【NOIP2014】寻找道路"><a href="#19-【NOIP2014】寻找道路" class="headerlink" title="#19. 【NOIP2014】寻找道路"></a><a target="_blank" rel="noopener" href="https://uoj.ac/problem/19">#19. 【NOIP2014】寻找道路</a></h3><h4 id="题目大意：-18"><a href="#题目大意：-18" class="headerlink" title="题目大意："></a>题目大意：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题目大意
    </div>
    <div class='spoiler-content'>
        <p>给定 $n$ 个点 $m$ 条边的有向（无权）图 $G$ 和两个点 $s,t$。如果一个点的出边指向的所有点都可达 $t$ 则称其为好点。求一条 $s$ 到 $t$ 的最短路径，满足路径上除了 $t$ 外都是好点。只需要输出路径长度，或报告无解。</p>
<p>$2\leq n\leq 10000, 1\leq m\leq 2\times 10^5, s\ne t$</p>

    </div>
</div>
<h4 id="题解：-18"><a href="#题解：-18" class="headerlink" title="题解："></a>题解：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题解
    </div>
    <div class='spoiler-content'>
        <p>首先从 $t$ 出发在反图 $G’$ 上搜索即可得到所有可达 $t$ 的点。再标记所有不可达 $t$ 的点在反图 $G’$ 上的出边指向的点，则没有被标记的就是好点。</p>
<p>把不是好点且不是 $t$ 的点都删掉，再求一下 $s$ 到 $t$ 的最短路即可。</p>
<p>时间复杂度：$O(n+m)$</p>
<p><a target="_blank" rel="noopener" href="https://uoj.ac/submission/582916">https://uoj.ac/submission/582916</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">10010</span>;</span><br><span class="line"><span class="type">int</span> n,m,s,t,x,y,vis[MAXN],nv[MAXN],vis2[MAXN];</span><br><span class="line">vector &lt;<span class="type">int</span>&gt; v1[MAXN],v2[MAXN];</span><br><span class="line">queue &lt;pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt; &gt; q;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span> <span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">	vis[x]=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;(<span class="type">int</span>)v2[x].<span class="built_in">size</span>();i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (!vis[v2[x][i]]) &#123;</span><br><span class="line">			<span class="built_in">dfs</span>(v2[x][i]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;x,&amp;y);</span><br><span class="line">		v1[x].<span class="built_in">push_back</span>(y);</span><br><span class="line">		v2[y].<span class="built_in">push_back</span>(x);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;s,&amp;t);</span><br><span class="line">	<span class="built_in">dfs</span>(t);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (!vis[i]) &#123;</span><br><span class="line">			nv[i]=<span class="number">1</span>;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">0</span>;j&lt;(<span class="type">int</span>)v2[i].<span class="built_in">size</span>();j++) &#123;</span><br><span class="line">				nv[v2[i][j]]=<span class="number">1</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (nv[s]) &#123;<span class="built_in">printf</span>(<span class="string">&quot;-1\n&quot;</span>);<span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line">	q.<span class="built_in">push</span>(<span class="built_in">make_pair</span>(s,<span class="number">0</span>));</span><br><span class="line">	<span class="keyword">while</span> (!q.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">		pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt; a=q.<span class="built_in">front</span>();</span><br><span class="line">		q.<span class="built_in">pop</span>();</span><br><span class="line">		vis2[a.first]=<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">if</span> (a.first==t) &#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,a.second);</span><br><span class="line">			<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;(<span class="type">int</span>)v1[a.first].<span class="built_in">size</span>();i++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (!nv[v1[a.first][i]]&amp;&amp;!vis2[v1[a.first][i]]) &#123;</span><br><span class="line">				q.<span class="built_in">push</span>(<span class="built_in">make_pair</span>(v1[a.first][i],a.second+<span class="number">1</span>));</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="number">-1</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="20-【NOIP2014】解方程"><a href="#20-【NOIP2014】解方程" class="headerlink" title="#20. 【NOIP2014】解方程"></a><a target="_blank" rel="noopener" href="https://uoj.ac/problem/20">#20. 【NOIP2014】解方程</a></h3><h4 id="题目大意：-19"><a href="#题目大意：-19" class="headerlink" title="题目大意："></a>题目大意：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题目大意
    </div>
    <div class='spoiler-content'>
        <p>求下述方程在 $[1,m]$ 中的所有整数解：</p>
<script type="math/tex; mode=display">\sum_{i=0}^n a_ix^i=0</script><p>$1\leq n\leq 100, 1\leq m\leq 10^6, 0\leq |a_i|\leq 10^{10000}, a_n\ne 0$</p>

    </div>
</div>
<h4 id="题解：-19"><a href="#题解：-19" class="headerlink" title="题解："></a>题解：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题解
    </div>
    <div class='spoiler-content'>
        <p>选大质数 $p$，当 $\sum_{i=0}^n a_ix^i\equiv 0\bmod p$ 时，我们就认为 $x$ 是方程的根，而这是容易判断的。若认为多项式的值模 $p$ 关于 $x$ 随机分布，则 $x$ 不是方程的根而被我们误判的概率为 $\frac{1}{p}$，因此完全判断正确的概率是 $1-\frac{m-s}{p}+o(\frac{1}{p})$，其中 $s$ 是解的数量，多取几个不同的 $p$，则正确率将足够高。</p>
<p>时间复杂度：$O(nm)$</p>
<p><a target="_blank" rel="noopener" href="https://uoj.ac/submission/582914">https://uoj.ac/submission/582914</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">110</span>;</span><br><span class="line"><span class="type">int</span> n,m,ans,a[<span class="number">4</span>][MAXN],p[<span class="number">4</span>]=&#123;<span class="number">0</span>,<span class="number">10007</span>,<span class="number">10000001</span>,<span class="number">10000003</span>&#125;;</span><br><span class="line">priority_queue &lt;<span class="type">int</span>&gt; q;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">read</span> <span class="params">(<span class="type">int</span> pos)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> res[<span class="number">4</span>]=&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,neg=<span class="number">1</span>;</span><br><span class="line">	<span class="type">char</span> c=<span class="built_in">getchar</span>();</span><br><span class="line">	<span class="keyword">while</span> (c&lt;<span class="string">&#x27;0&#x27;</span>||c&gt;<span class="string">&#x27;9&#x27;</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span> (c==<span class="string">&#x27;-&#x27;</span>) &#123;neg=<span class="number">-1</span>;&#125;</span><br><span class="line">		c=<span class="built_in">getchar</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">while</span> (c&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;c&lt;=<span class="string">&#x27;9&#x27;</span>) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">3</span>;i++) &#123;a[i][pos]=(a[i][pos]*<span class="number">10</span>+c-<span class="string">&#x27;0&#x27;</span>)%p[i];&#125;</span><br><span class="line">		c=<span class="built_in">getchar</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (neg==<span class="number">-1</span>) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">3</span>;i++) &#123;a[i][pos]=(p[i]-a[i][pos])%p[i];&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">chk</span> <span class="params">(<span class="type">int</span> pos,<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=n;i&gt;=<span class="number">0</span>;i--) &#123;</span><br><span class="line">		res=((<span class="number">1ll</span>*res*x)%p[pos]+a[pos][i])%p[pos];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">chk2</span> <span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=x;i&lt;=m;i+=p[<span class="number">1</span>]) &#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">chk</span>(<span class="number">2</span>,i)==<span class="number">0</span>&amp;&amp;<span class="built_in">chk</span>(<span class="number">3</span>,i)==<span class="number">0</span>) &#123;res++,q.<span class="built_in">push</span>(-i);&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;=n;i++) &#123;<span class="built_in">read</span>(i);&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="built_in">min</span>(m,p[<span class="number">1</span>]);i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">chk</span>(<span class="number">1</span>,i)==<span class="number">0</span>) &#123;ans+=<span class="built_in">chk2</span>(i);&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">	<span class="keyword">while</span> (!q.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,-q.<span class="built_in">top</span>());</span><br><span class="line">		q.<span class="built_in">pop</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="21-【UR-1】缩进优化"><a href="#21-【UR-1】缩进优化" class="headerlink" title="#21. 【UR #1】缩进优化"></a><a target="_blank" rel="noopener" href="https://uoj.ac/problem/21">#21. 【UR #1】缩进优化</a></h3><h4 id="题目大意：-20"><a href="#题目大意：-20" class="headerlink" title="题目大意："></a>题目大意：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题目大意
    </div>
    <div class='spoiler-content'>
        <p>给定一个长度为 $n$ 的序列 $a_1,\ldots,a_n$，你可以选择一个任意的正整数 $x$，求下式的最小值：</p>
<script type="math/tex; mode=display">\sum_{i=1}^n \left\lfloor\frac{a_i}{x}\right\rfloor+\sum_{i=1}^n (a_i\bmod x)</script><p>$1\leq n\leq 10^6, 1\leq a_i\leq 10^6$</p>

    </div>
</div>
<h4 id="题解：-20"><a href="#题解：-20" class="headerlink" title="题解："></a>题解：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题解
    </div>
    <div class='spoiler-content'>
        <p>将取模按定义展开：</p>
<script type="math/tex; mode=display">
\begin{aligned}
\sum_{i=1}^n \left\lfloor\frac{a_i}{x}\right\rfloor+\sum_{i=1}^n (a_i\bmod x) & =\sum_{i=1}^n \left\lfloor\frac{a_i}{x}\right\rfloor+\sum_{i=1}^n \left(a_i-x\times \left\lfloor\frac{a_i}{x}\right\rfloor\right) \\
& =\sum_{i=1}^n a_i-(x-1)\times \sum_{i=1}^n \left\lfloor\frac{a_i}{x}\right\rfloor
\end{aligned}</script><p>其中第一项是定值。第二项则考虑枚举 $x$，分别对每个 $j$ 求 $[x\times j,x\times (j+1)-1]$ 中 $a_i$ 的个数，这就是满足 $\left\lfloor\frac{a_i}{x}\right\rfloor=j$ 的 $a_i$ 的个数，于是不难计算。</p>
<p>时间复杂度：$O(n+A\log A)$</p>
<p><a target="_blank" rel="noopener" href="https://uoj.ac/submission/582921">https://uoj.ac/submission/582921</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">2000010</span>;</span><br><span class="line">ll n,x,sum,ans,cnt[N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>,&amp;n);<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;<span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>,&amp;x);sum+=x,cnt[x]++;&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N<span class="number">-10</span>;i++) &#123;cnt[i]+=cnt[i<span class="number">-1</span>];&#125;</span><br><span class="line">	ans=<span class="number">1e18</span>;<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=(N<span class="number">-10</span>)/<span class="number">2</span>;i++) &#123;</span><br><span class="line">		ll tmp=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">2</span>*i<span class="number">-1</span>;j&lt;=N<span class="number">-10</span>;j+=i) &#123;tmp+=<span class="number">1ll</span>*(i<span class="number">-1</span>)*(j/i)*(cnt[j]-cnt[j-i]);&#125;</span><br><span class="line">		ans=<span class="built_in">min</span>(ans,sum-tmp);</span><br><span class="line">	&#125;<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="22-【UR-1】外星人"><a href="#22-【UR-1】外星人" class="headerlink" title="#22. 【UR #1】外星人"></a><a target="_blank" rel="noopener" href="https://uoj.ac/problem/22">#22. 【UR #1】外星人</a></h3><h4 id="题目大意：-21"><a href="#题目大意：-21" class="headerlink" title="题目大意："></a>题目大意：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题目大意
    </div>
    <div class='spoiler-content'>
        <p>给定 $n$ 个数 $a_1,\ldots,a_n$，你可以将它们任意排列形成序列 $b_1,\ldots,b_n$，共有 $n!$ 种排列方案。另外给定一个 $x$，定义序列 $b$ 的价值为：</p>
<script type="math/tex; mode=display">(((x\bmod b_1)\bmod b_2)\bmod \ldots)\bmod b_n</script><p>求所有可能的 $b$ 的最大价值以及使得 $b$ 达到最大价值的排列方案数。</p>
<p>$1\leq n\leq 1000, 1\leq x,a_i\leq 5000$</p>

    </div>
</div>
<h4 id="题解：-21"><a href="#题解：-21" class="headerlink" title="题解："></a>题解：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题解
    </div>
    <div class='spoiler-content'>
        <p>将 $a_i$ 从大到小排序。设 $b_i=a_{p_i}$，则我们可以仅考虑排列 $p$ 的所有前缀最大值位置，只有这些位置对应的 $b_i$ 真正对答案产生影响。因为如果某个 $p_i$ 之前存在一个 $p_j&gt;p_i$，那么说明 $x$ 先模了一个比 $b_i$ 更小的数，再模 $b_i$ 肯定是没有作用的。</p>
<p>因此最大价值的计算方法就很简单：选出一个 $a_1,\ldots,a_n$ 的包含 $a_n$ 的子序列（因为 $n$ 肯定是 $p$ 的前缀最大值）并令 $x$ 依次模这个子序列中的数，这是一个有序的问题，令 $f(i,j)$ 表示考虑 $a_1,\ldots,a_i$ 后 $x$ 是否可能变成 $j$，DP 一下即可计算。</p>
<p>再考虑方案数，我们考虑如下问题：假设排列 $p$ 的前缀最大值集合已经固定，如何计数 $p$。按值从大到小考虑，依次枚举 $i=n,\ldots,1$：</p>
<ul>
<li>如果 $i$ 在前缀最大值中，那么它暂时只能放在当前的 $p$ 的开头。</li>
<li>否则，$i$ 可以放在当前 $p$ 的开头外的任意一个位置，所以有 $n-i$ 种方案。</li>
</ul>
<p>也就是说，若前缀最大值集合为 $S$，则 $p$ 的数量为 $\prod_{i\notin S}(n-i)$，也就是贡献可以拆到每个位置上，于是执行一个和计算 $f$ 差不多的 DP 即可求出方案数。</p>
<p>时间复杂度：$O(nA)$</p>
<p><a target="_blank" rel="noopener" href="https://uoj.ac/submission/582925">https://uoj.ac/submission/582925</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1010</span>,M=<span class="number">5010</span>,P=<span class="number">998244353</span>;</span><br><span class="line"><span class="type">int</span> n,x,ans,a[N],f[N][M],g[N][M];</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span> <span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span> </span>&#123;<span class="keyword">return</span> a&gt;b;&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;x);<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;a[i]);&#125;</span><br><span class="line">	<span class="built_in">sort</span>(a+<span class="number">1</span>,a+n+<span class="number">1</span>,cmp);f[<span class="number">0</span>][x]=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n<span class="number">-1</span>;i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">0</span>;j&lt;=x;j++) &#123;<span class="keyword">if</span> (f[i<span class="number">-1</span>][j]) f[i][j]=f[i][j%a[i]]=<span class="number">1</span>;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">0</span>;j&lt;=x;j++) &#123;<span class="keyword">if</span> (f[n<span class="number">-1</span>][j]) f[n][j%a[n]]=<span class="number">1</span>;&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> j=x;j&gt;=<span class="number">0</span>;j--) &#123;<span class="keyword">if</span> (f[n][j]) &#123;ans=j;<span class="keyword">break</span>;&#125;&#125;</span><br><span class="line">	g[n+<span class="number">1</span>][ans]=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=n;i&gt;=<span class="number">1</span>;i--) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">0</span>;j&lt;=x;j++) &#123;g[i][j]=(g[i+<span class="number">1</span>][j%a[i]]+(<span class="number">1ll</span>*g[i+<span class="number">1</span>][j]*(n-i))%P)%P;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d\n%d\n&quot;</span>,ans,g[<span class="number">1</span>][x]);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="23-【UR-1】跳蚤国王下江南"><a href="#23-【UR-1】跳蚤国王下江南" class="headerlink" title="#23. 【UR #1】跳蚤国王下江南"></a><a target="_blank" rel="noopener" href="https://uoj.ac/problem/23">#23. 【UR #1】跳蚤国王下江南</a></h3><h4 id="题目大意：-22"><a href="#题目大意：-22" class="headerlink" title="题目大意："></a>题目大意：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题目大意
    </div>
    <div class='spoiler-content'>
        <p>给定一株 $n$ 个点的仙人掌 $C$，对于每个 $i=0,\ldots,n-1$ 求出从点 $1$ 出发经过恰好 $i$ 条边的简单路径数量。</p>
<p>$1\leq n\leq 10^5$</p>

    </div>
</div>
<h4 id="题解：-22"><a href="#题解：-22" class="headerlink" title="题解："></a>题解：</h4><p>暂无。</p>
<hr>
<h3 id="24-【IOI2014】Rail"><a href="#24-【IOI2014】Rail" class="headerlink" title="#24. 【IOI2014】Rail"></a><a target="_blank" rel="noopener" href="https://uoj.ac/problem/24">#24. 【IOI2014】Rail</a></h3><h4 id="题目大意：-23"><a href="#题目大意：-23" class="headerlink" title="题目大意："></a>题目大意：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题目大意
    </div>
    <div class='spoiler-content'>
        <p><strong>这是一道交互题。</strong></p>
<p>有一个直线形的铁路，上面分为 $m$ 段，按照在铁路上的顺序依次编号为 $1,\ldots,m$。有两条轨道：A 轨道的方向从 $1$ 到 $m$；B 轨道的方向从 $m$ 到 $1$。每个段有三种类型：空类型表示这一段上没有车站；C 类型表示有一个车站，且只能从 B 轨道进入车站，离开车站将进入 A 轨道；D 类型表示有一个车站，且只能从 A 轨道进入车站，离开车站将进入 B 轨道。</p>
<p>对于两个车站 $i,j$，定义 $i$ 到 $j$ 的距离 $dis(i,j)$ 为从 $i$ 出发沿轨道走到 $j$，需要跨越段的最少次数（从一段到另一段记为一次跨越）。</p>
<p>现在不知道 $m$ 的值（但保证 $m\leq 10^6$），也不知道每个段的类型。你只知道总共有 $n$ 个车站，依次编号为 $0,\ldots,n-1$，且 $0$ 号车站的位置是已知的 $loc$，段 $loc$ 的类型为 C。你可以进行若干次询问，每次给定 $i,j$ 询问 $i$ 号车站到 $j$ 号车站的距离，你需要使用不超过 $3\times (n-1)$ 次询问给出所有车站的位置和对应段的类型。</p>
<p>$1\leq n\leq 1000, 1\leq x,a_i\leq 5000$</p>

    </div>
</div>
<h4 id="题解：-23"><a href="#题解：-23" class="headerlink" title="题解："></a>题解：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题解
    </div>
    <div class='spoiler-content'>
        <p>首先问出 $0$ 号车站到其余所有车站的距离，设到 $y$ 号车站的距离是最短的。那么显然 $y$ 号车站的位置为 $loc+dis(0,y)$，类型（即对应段的类型，简称为车站的类型）为 D。</p>
<p>现在我们再问出 $y$ 到所有车站的距离。对于任意不同于 $0,y$ 的车站 $i$，如果 $dis(0,i)=dis(0,y)+dis(y,i)$，则 $i$ 在 $y$ 的左边；否则 $i$ 在 $y$ 的右边。对于左边和右边的车站分别处理，处理方式是类似的，我们以左边为例。</p>
<p>将所有左边的车站按照 $y$ 到它的距离从小到大排序，依次确定位置和类型。假设当前考虑到了车站 $i$，上一个 C 类型车站为 $z$（即满足 $dis(y,z)&lt;dis(y,i)$ 且 $dis(y,z)$ 最大的那个 C 类型车站 $z$）。为了确定 $i$ 的类型，我们询问 $dis(z,i)$，当 $dis(y,i)$ 和 $dis(z,i)$ 都固定时，$i$ 就仅剩两种可能的位置和对应的类型了，如下图所示：</p>
<p><img src="pic2.png" alt="pic2"></p>
<ul>
<li>若 $i$ 是 $C$ 类型的，则其位置为 $p(i_C)=p(y)-dis(y,i)$，从 $z$ 走到 $i$ 需要经过一个 D 类型车站 $u$ 转向；</li>
<li>若 $i$ 是 $D$ 类型的，则其位置为 $p(i_D)=p(z)+dis(z,i)$，从 $y$ 走到 $i$ 需要经过一个 C 类型车站 $u$ 转向。</li>
</ul>
<p>巧妙之处在于，通过计算可以发现，上述两种情况的 $u$ 的位置是相同的，所以我们只需检查这个位置上究竟是一个 C 类型车站还是一个 D 类型车站，就可以知道 $i$ 属于上述的哪种情况，从而确定它的位置和类型。</p>
<p>总共使用了 $3n-C$ 次操作，$C$ 是个固定的小常数。</p>
<p>时间复杂度：$O(n\log n)$</p>
<p><a target="_blank" rel="noopener" href="https://uoj.ac/submission/591632">https://uoj.ac/submission/591632</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;rail.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> M=<span class="number">5010</span>;</span><br><span class="line"><span class="type">int</span> n,x,y,z,disx[M],disy[M];</span><br><span class="line">vector &lt;<span class="type">int</span>&gt; l,r;</span><br><span class="line">map &lt;<span class="type">int</span>,<span class="type">int</span>&gt; mp;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmpl</span> <span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span> </span>&#123;<span class="keyword">return</span> disy[x]&lt;disy[y];&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmpr</span> <span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span> </span>&#123;<span class="keyword">return</span> disx[x]&lt;disx[y];&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">findLocation</span> <span class="params">(<span class="type">int</span> N,<span class="type">int</span> first,<span class="type">int</span> location[],<span class="type">int</span> stype[])</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (N==<span class="number">1</span>) &#123;</span><br><span class="line">		location[<span class="number">0</span>]=first,stype[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	n=N,x=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;n;i++) &#123;</span><br><span class="line">		disx[i]=<span class="built_in">getDistance</span>(x,i);</span><br><span class="line">		<span class="keyword">if</span> (y==<span class="number">0</span>||disx[i]&lt;disx[y]) &#123;y=i;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (i!=y) &#123;disy[i]=<span class="built_in">getDistance</span>(y,i);&#125;</span><br><span class="line">		<span class="keyword">if</span> (i!=x&amp;&amp;i!=y) &#123;</span><br><span class="line">			<span class="keyword">if</span> (disy[i]+disx[y]==disx[i]) &#123;l.<span class="built_in">push_back</span>(i);&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;r.<span class="built_in">push_back</span>(i);&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	r.<span class="built_in">push_back</span>(y),l.<span class="built_in">push_back</span>(x);</span><br><span class="line">	<span class="built_in">sort</span>(l.<span class="built_in">begin</span>(),l.<span class="built_in">end</span>(),cmpl);</span><br><span class="line">	<span class="built_in">sort</span>(r.<span class="built_in">begin</span>(),r.<span class="built_in">end</span>(),cmpr);</span><br><span class="line">	location[x]=first,stype[x]=<span class="number">1</span>,location[y]=first+disx[y],stype[y]=<span class="number">2</span>;</span><br><span class="line">	z=<span class="number">-1</span>;mp.<span class="built_in">clear</span>();</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">auto</span> u:l) &#123;</span><br><span class="line">		<span class="keyword">if</span> (z==<span class="number">-1</span>) &#123;location[u]=location[y]-disy[u],stype[u]=<span class="number">1</span>,z=u,mp[location[u]]=<span class="number">1</span>;<span class="keyword">continue</span>;&#125;</span><br><span class="line">		<span class="type">int</span> tmp=<span class="built_in">getDistance</span>(z,u);</span><br><span class="line">		<span class="type">int</span> pos=location[z]+tmp;</span><br><span class="line">		<span class="keyword">if</span> ((disy[u]-location[y]+pos)%<span class="number">2</span>==<span class="number">0</span>&amp;&amp;mp.<span class="built_in">find</span>(pos-(disy[u]-location[y]+pos)/<span class="number">2</span>)!=mp.<span class="built_in">end</span>()) &#123;</span><br><span class="line">			location[u]=location[z]+tmp,stype[u]=<span class="number">2</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			location[u]=location[y]-disy[u],stype[u]=<span class="number">1</span>,z=u,mp[location[u]]=<span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	z=<span class="number">-1</span>;mp.<span class="built_in">clear</span>();</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">auto</span> u:r) &#123;</span><br><span class="line">		<span class="keyword">if</span> (z==<span class="number">-1</span>) &#123;location[u]=first+disx[u],stype[u]=<span class="number">2</span>,z=u,mp[location[u]]=<span class="number">1</span>;<span class="keyword">continue</span>;&#125;</span><br><span class="line">		<span class="type">int</span> tmp=<span class="built_in">getDistance</span>(z,u);</span><br><span class="line">		<span class="type">int</span> pos=location[z]-tmp;</span><br><span class="line">		<span class="keyword">if</span> ((disx[u]-pos+location[x])%<span class="number">2</span>==<span class="number">0</span>&amp;&amp;mp.<span class="built_in">find</span>(pos+(disx[u]-pos+location[x])/<span class="number">2</span>)!=mp.<span class="built_in">end</span>()) &#123;</span><br><span class="line">			location[u]=location[z]-tmp,stype[u]=<span class="number">1</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			location[u]=first+disx[u],stype[u]=<span class="number">2</span>,z=u,mp[location[u]]=<span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="25-【IOI2014】Wall"><a href="#25-【IOI2014】Wall" class="headerlink" title="#25. 【IOI2014】Wall"></a><a target="_blank" rel="noopener" href="https://uoj.ac/problem/25">#25. 【IOI2014】Wall</a></h3><h4 id="题目大意：-24"><a href="#题目大意：-24" class="headerlink" title="题目大意："></a>题目大意：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题目大意
    </div>
    <div class='spoiler-content'>
        <p>维护一个长度为 $n$ 的序列 $a_0,\ldots,a_{n-1}$，初始全零。接下来进行 $k$ 次操作：</p>
<ul>
<li>操作一：给定 $l,r,v$，将 $a_l,\ldots,a_r$ 全部和 $v$ 取 $\max$；</li>
<li>操作二：给定 $l,r,v$，将 $a_l,\ldots,a_r$ 全部和 $v$ 取 $\min$。</li>
</ul>
<p>求最终的序列。</p>
<p>$1\leq n\leq 2\times 10^6, 1\leq k\leq 5\times 10^5, 0\leq v\leq 10^5$</p>

    </div>
</div>
<h4 id="题解：-24"><a href="#题解：-24" class="headerlink" title="题解："></a>题解：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题解
    </div>
    <div class='spoiler-content'>
        <p>用一个二元组形式的操作 $(d,u)$ 表示将一个数对 $[d,u]$ 取整，即将小于 $d$ 的数变为 $d$，大于 $u$ 的数变为 $u$，于是题目中的操作都可以表示为给一个区间执行一个形如 $(d,u)$ 的操作（操作一即 $d=0$，操作二即 $u=+\infty$）。</p>
<p>我们发现两个操作的复合是可以计算的，具体地：</p>
<script type="math/tex; mode=display">[d_2,u_2]\circ [d_1,u_1]=\begin{cases}[\max(d_1,d_2),\min(u_1,u_2)] & (d_1\leq u_2 \land d_2\leq u_1)\\ [d_2,d_2] & (u_1<d_2)\\ [u_2,u_2] & (u_2<d_1)\end{cases}</script><p>于是可以用线段树维护懒标记的方法维护区间操作，并支持最后求出整个序列。</p>
<p>时间复杂度：$O(n+k\log n)$（代码为 $O((n+k)\log n)$）</p>
<p><a target="_blank" rel="noopener" href="https://uoj.ac/submission/591633">https://uoj.ac/submission/591633</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;wall.h&quot;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">2000010</span>,INF=<span class="number">1e9</span>;</span><br><span class="line"><span class="type">int</span> f[N*<span class="number">4</span>],c[N*<span class="number">4</span>];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">buildt</span> <span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">	f[p]=<span class="number">0</span>,c[p]=INF;</span><br><span class="line">	<span class="keyword">if</span> (l==r) &#123;<span class="keyword">return</span>;&#125;</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">buildt</span>(p*<span class="number">2</span>,l,mid),<span class="built_in">buildt</span>(p*<span class="number">2</span>+<span class="number">1</span>,mid+<span class="number">1</span>,r);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">sprd</span> <span class="params">(<span class="type">int</span> p,<span class="type">int</span> ff,<span class="type">int</span> cc)</span> </span>&#123;</span><br><span class="line">	f[p]=<span class="built_in">max</span>(f[p],ff);</span><br><span class="line">	<span class="keyword">if</span> (f[p]&gt;c[p]) &#123;c[p]=f[p];&#125;</span><br><span class="line">	c[p]=<span class="built_in">min</span>(c[p],cc);</span><br><span class="line">	<span class="keyword">if</span> (f[p]&gt;c[p]) &#123;f[p]=c[p];&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pd</span> <span class="params">(<span class="type">int</span> p)</span> </span>&#123;</span><br><span class="line">	<span class="built_in">sprd</span>(p*<span class="number">2</span>,f[p],c[p]),<span class="built_in">sprd</span>(p*<span class="number">2</span>+<span class="number">1</span>,f[p],c[p]);</span><br><span class="line">	f[p]=<span class="number">0</span>,c[p]=INF;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">modify</span> <span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> xl,<span class="type">int</span> xr,<span class="type">int</span> ff,<span class="type">int</span> cc)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (xr&lt;l||r&lt;xl) &#123;<span class="keyword">return</span>;&#125;</span><br><span class="line">	<span class="keyword">if</span> (xl&lt;=l&amp;&amp;r&lt;=xr) &#123;<span class="built_in">sprd</span>(p,ff,cc);<span class="keyword">return</span>;&#125;</span><br><span class="line">	<span class="built_in">pd</span>(p);</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">modify</span>(p*<span class="number">2</span>,l,mid,xl,xr,ff,cc),<span class="built_in">modify</span>(p*<span class="number">2</span>+<span class="number">1</span>,mid+<span class="number">1</span>,r,xl,xr,ff,cc);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query</span> <span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> pos)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (l==r) &#123;<span class="keyword">return</span> f[p];&#125;</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>,res=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span> (pos&lt;=mid) &#123;res=<span class="built_in">query</span>(p*<span class="number">2</span>,l,mid,pos);&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;res=<span class="built_in">query</span>(p*<span class="number">2</span>+<span class="number">1</span>,mid+<span class="number">1</span>,r,pos);&#125;</span><br><span class="line">	<span class="keyword">if</span> (res&lt;f[p]) &#123;res=f[p];&#125;</span><br><span class="line">	<span class="keyword">if</span> (res&gt;c[p]) &#123;res=c[p];&#125;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">buildWall</span> <span class="params">(<span class="type">int</span> n,<span class="type">int</span> k,<span class="type">int</span> op[],<span class="type">int</span> left[],<span class="type">int</span> right[],<span class="type">int</span> height[],<span class="type">int</span> finalHeight[])</span></span>&#123;</span><br><span class="line">	<span class="built_in">buildt</span>(<span class="number">1</span>,<span class="number">0</span>,n<span class="number">-1</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;k;i++) &#123;<span class="built_in">modify</span>(<span class="number">1</span>,<span class="number">0</span>,n<span class="number">-1</span>,left[i],right[i],op[i]==<span class="number">1</span>?height[i]:<span class="number">0</span>,op[i]==<span class="number">2</span>?height[i]:INF);&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++) &#123;finalHeight[i]=<span class="built_in">query</span>(<span class="number">1</span>,<span class="number">0</span>,n<span class="number">-1</span>,i);&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="26-【IOI2014】Game"><a href="#26-【IOI2014】Game" class="headerlink" title="#26. 【IOI2014】Game"></a><a target="_blank" rel="noopener" href="https://uoj.ac/problem/26">#26. 【IOI2014】Game</a></h3><h4 id="题目大意：-25"><a href="#题目大意：-25" class="headerlink" title="题目大意："></a>题目大意：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题目大意
    </div>
    <div class='spoiler-content'>
        <p><strong>这是一道交互题。</strong></p>
<p>A 和 B 玩游戏，A 心里想一个 $n$ 个点的无向图 $G$，点的编号为 $0,\ldots,n-1$，B 要猜出它是否连通。B 每次可以问两个点 $u,v$ 之间是否有边。现在，交互库会扮演 B 提出询问，你需要扮演 A 回答每个询问，使得在第 $\frac{n(n-1)}{2}$ 次询问前，B 无法确定 $G$ 是否连通。</p>
<p>$4\leq n\leq 1500$</p>

    </div>
</div>
<h4 id="题解：-25"><a href="#题解：-25" class="headerlink" title="题解："></a>题解：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题解
    </div>
    <div class='spoiler-content'>
        <p>显然 $G$ 是个树是最优的，此时我们只要保证在第 $\frac{n(n-1)}{2}$ 次询问之前，当前已经确定的森林只有小于 $n-1$ 条边，即可保证 B 不能确定 $G$ 是否连通。</p>
<p>考虑将树变成有根树，以 $0$ 为根，每个点的父亲编号比自己小。只要有一个点的父亲还没确定（它和父亲的边还没被问过），就无法确定是否连通，所以当询问 $u,v (u&lt;v)$ 时，只要 $u$ 不是最后一个没和 $v$ 问过的比 $v$ 编号小的点，我们都回答没有边；否则才回答有边。这样每个点只有拖到它和之前的点的所有边都问过才能知道是否连通，于是在第 $\frac{n(n-1)}{2}$ 次询问之前肯定还有一个点没确定，也就无法确定 $G$ 是否连通。</p>
<p>时间复杂度 $O(n^2)$</p>
<p><a target="_blank" rel="noopener" href="https://uoj.ac/submission/591636">https://uoj.ac/submission/591636</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;game.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> deg[<span class="number">1510</span>];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">initialize</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">hasEdge</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (u&lt;v) &#123;<span class="built_in">swap</span>(u,v);&#125;</span><br><span class="line">    <span class="keyword">return</span> (++deg[u]==u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="27-【IOI2014】Gondola"><a href="#27-【IOI2014】Gondola" class="headerlink" title="#27. 【IOI2014】Gondola"></a><a target="_blank" rel="noopener" href="https://uoj.ac/problem/27">#27. 【IOI2014】Gondola</a></h3><h4 id="题目大意：-26"><a href="#题目大意：-26" class="headerlink" title="题目大意："></a>题目大意：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题目大意
    </div>
    <div class='spoiler-content'>
        <p>称一个长度为 $n$ 的序列 $a_1,\ldots,a_n$ 是好的，当且仅当它可以通过以下方式得到：</p>
<ul>
<li>初始时令 $a_i=(i+x)\bmod n+1$，其中 $x$ 是一个任选的整数；</li>
<li>接下来进行 $k$ 轮操作（$k$ 是一个任选的非负整数），第 $i$ 轮操作任选一个 $p_i$，然后令 $a_{p_i}\leftarrow n+k$。</li>
</ul>
<p>本题分为三个部分，分别需要解决以下问题：</p>
<ul>
<li>问题一：给定一个长度为 $n$ 的序列 $a_1,\ldots,a_n$，判断它是否是好的；<br>$1\leq n\leq 10^5, 1\leq a_i\leq 2.5\times 10^5$</li>
<li>问题二：给定一个长度为 $n$ 的好序列 $a_1,\ldots,a_n$，构造一种符合上面条件的操作序列生成它，也就是你要给出每一轮操作的 $p_i$；<br>$1\leq n\leq 10^5, 1\leq a_i\leq 2.5\times 10^5$</li>
<li>问题三：给定一个长度为 $n$ 的序列 $a_1,\ldots,a_n$，求有多少种符合上面条件的操作序列可以生成它，对 $10^9+9$ 取模。<br>$1\leq n\leq 10^5, 1\leq a_i\leq 10^9$</li>
</ul>

    </div>
</div>
<h4 id="题解：-26"><a href="#题解：-26" class="headerlink" title="题解："></a>题解：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题解
    </div>
    <div class='spoiler-content'>
        <p>不难发现，只要存在一种 $1,\ldots,n$ 的循环表示可以和 $a_1,\ldots,a_n$ 中 $1,\ldots,n$ 这些数的出现位置完全对应，则是好序列。判断是容易的，如果 $a_1,\ldots,a_n$ 中没有出现 $1,\ldots,n$ 中任何一个数则一定是好序列，否则找到其中一个数的出现位置就确定了上述循环表示，对比一下即可。</p>
<p>构造生成序列也比较平凡，每次把任意一个不在最终的 $a_1,\ldots,a_n$ 中出现的数替换掉即可。</p>
<p>计数则考虑倒过来做，设最终序列 $a_1,\ldots,a_n$ 中出现过的大于 $n$ 的数从大到小排序为 $b_1,\ldots,b_t$，则 $(b_2,b_1]$ 中的数只有一个位置能放（即 $b_1$ 最后的位置），$(b_3,b_2]$ 中的数则有两个位置能发（最后 $b_1$ 或 $b_2$ 的位置），以此类推，$(b_i,b_{i-1}]$ 中的数就都有 $i-1$ 种选择，全部乘起来即为答案。</p>
<p>时间复杂度：$O(n)$（第一问）/$O(A)$（第二问）/$O(n\log A)$（第三问）</p>
<p><a target="_blank" rel="noopener" href="https://uoj.ac/submission/591699">https://uoj.ac/submission/591699</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;gondola.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> P=<span class="number">1e9</span>+<span class="number">9</span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">qpow</span> <span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> res=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">while</span> (b) &#123;</span><br><span class="line">		<span class="keyword">if</span> (b&amp;<span class="number">1</span>) &#123;res=(<span class="number">1ll</span>*res*a)%P;&#125;</span><br><span class="line">		a=(<span class="number">1ll</span>*a*a)%P,b&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt; <span class="title">solve</span> <span class="params">(<span class="type">int</span> n,<span class="type">int</span> on,<span class="type">int</span> s[],<span class="type">int</span> ans[])</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> flg=<span class="number">0</span>,mx=<span class="number">0</span>,cnt=<span class="number">0</span>,ret=<span class="number">1</span>;</span><br><span class="line">	vector &lt;<span class="type">int</span>&gt; <span class="built_in">t</span>(n+<span class="number">1</span>),<span class="built_in">pos</span>(n+<span class="number">1</span>),val,f;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++) &#123;mx=<span class="built_in">max</span>(mx,s[i]);&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (s[i]&lt;=n) &#123;</span><br><span class="line">			flg=<span class="number">1</span>;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">0</span>;j&lt;n;j++) &#123;</span><br><span class="line">				<span class="keyword">if</span> (s[(i+j)%n]&lt;=n&amp;&amp;s[(i+j)%n]!=(s[i]+j<span class="number">-1</span>)%n+<span class="number">1</span>) &#123;<span class="keyword">return</span> <span class="built_in">make_pair</span>(<span class="number">0</span>,<span class="number">0</span>);&#125;</span><br><span class="line">				t[(i+j)%n]=(s[i]+j<span class="number">-1</span>)%n+<span class="number">1</span>,pos[(s[i]+j<span class="number">-1</span>)%n+<span class="number">1</span>]=(i+j)%n;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (!flg) &#123;<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">0</span>;j&lt;n;j++) &#123;t[j]=pos[j]=j;&#125;&#125;</span><br><span class="line">	<span class="keyword">if</span> (mx&gt;<span class="number">250000</span>) &#123;</span><br><span class="line">		<span class="built_in">sort</span>(s,s+n);</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=n<span class="number">-1</span>;i&gt;=<span class="number">1</span>;i--) &#123;</span><br><span class="line">			<span class="keyword">if</span> (s[i]==s[i<span class="number">-1</span>]) &#123;<span class="keyword">return</span> <span class="built_in">make_pair</span>(<span class="number">0</span>,<span class="number">0</span>);&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=n<span class="number">-1</span>;i&gt;=<span class="number">1</span>;i--) &#123;</span><br><span class="line">			<span class="keyword">if</span> (s[i]&lt;=n) &#123;<span class="keyword">break</span>;&#125;</span><br><span class="line">			<span class="type">int</span> l=<span class="built_in">max</span>(n+<span class="number">1</span>,s[i<span class="number">-1</span>]+<span class="number">1</span>),r=s[i]<span class="number">-1</span>;</span><br><span class="line">			cnt++;</span><br><span class="line">			ret=(<span class="number">1ll</span>*ret*<span class="built_in">qpow</span>(cnt,r-l+<span class="number">1</span>))%P;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (s[<span class="number">0</span>]&gt;n) &#123;</span><br><span class="line">			cnt++;</span><br><span class="line">			ret=(<span class="number">1ll</span>*ret*<span class="built_in">qpow</span>(cnt,s[<span class="number">0</span>]-n))%P;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">make_pair</span>(<span class="number">1</span>,ret);</span><br><span class="line">	&#125;</span><br><span class="line">	val.<span class="built_in">resize</span>(mx+<span class="number">1</span>),f.<span class="built_in">resize</span>(mx+<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (val[s[i]]) &#123;<span class="keyword">return</span> <span class="built_in">make_pair</span>(<span class="number">0</span>,<span class="number">0</span>);&#125;</span><br><span class="line">		val[s[i]]=i+<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=mx;i&gt;=<span class="number">1</span>;i--) &#123;</span><br><span class="line">		<span class="keyword">if</span> (val[i]) &#123;cnt++;&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> (i&lt;=n) &#123;f[i]=s[pos[i]];s[pos[i]]=i;&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;</span><br><span class="line">				f[i]=s[val[mx]<span class="number">-1</span>];</span><br><span class="line">				s[val[mx]<span class="number">-1</span>]=i;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (i&gt;n||(i==n&amp;&amp;!flg)) &#123;ret=(<span class="number">1ll</span>*ret*cnt)%P;&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (on) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=mx;i++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (f[i]) &#123;ans[f[i]-n<span class="number">-1</span>]=i;&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">make_pair</span>(<span class="number">1</span>,ret);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">valid</span> <span class="params">(<span class="type">int</span> n,<span class="type">int</span> inputSeq[])</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> a[<span class="number">1</span>];</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">solve</span>(n,<span class="number">0</span>,inputSeq,a).first;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//----------------------</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">replacement</span> <span class="params">(<span class="type">int</span> n,<span class="type">int</span> gondolaSeq[],<span class="type">int</span> replacementSeq[])</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> ret=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++) &#123;ret=<span class="built_in">max</span>(ret,gondolaSeq[i]);&#125;</span><br><span class="line">	<span class="built_in">solve</span>(n,<span class="number">1</span>,gondolaSeq,replacementSeq);</span><br><span class="line">	<span class="keyword">return</span> ret-n;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//----------------------</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">countReplacement</span> <span class="params">(<span class="type">int</span> n,<span class="type">int</span> inputSeq[])</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> a[<span class="number">1</span>];</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">solve</span>(n,<span class="number">0</span>,inputSeq,a).second;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="28-【IOI2014】Friend"><a href="#28-【IOI2014】Friend" class="headerlink" title="#28. 【IOI2014】Friend"></a><a target="_blank" rel="noopener" href="https://uoj.ac/problem/28">#28. 【IOI2014】Friend</a></h3><h4 id="题目大意：-27"><a href="#题目大意：-27" class="headerlink" title="题目大意："></a>题目大意：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题目大意
    </div>
    <div class='spoiler-content'>
        <p>有一个图 $G$，初始只有一个点，编号为 $0$，接下来依次进行 $n-1$ 轮操作，第 $i$ 轮操作给定 $f_i,p_i$，其中 $f_i&lt;i, p_i\in \{0,1,2\}$，表示新建一个编号为 $i$ 的点，而 $i$ 与之前的点的连边由以下方式确定：</p>
<ul>
<li>若 $p_i=0$，则仅在 $i$ 和 $f_i$ 之间连一条边；</li>
<li>若 $p_i=1$，则对于每个当前与 $f_i$ 有连边的 $j$，在 $i$ 和 $j$ 之间连一条边；</li>
<li>若 $p_i=2$，则将 $p_i=0$ 和 $p_i=1$ 时会连的边都连上。</li>
</ul>
<p>每个点有一个给定的点权 $c_i$，求 $G$ 的最大权独立集。</p>
<p>$2\leq n\leq 10^5, 1\leq c_i\leq 10000$</p>

    </div>
</div>
<h4 id="题解：-27"><a href="#题解：-27" class="headerlink" title="题解："></a>题解：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题解
    </div>
    <div class='spoiler-content'>
        <p>当 $p_i$ 全为 $0$ 时，这就是树的最大权独立集，这告诉我们本题的解必然是某种形式的树形 DP。</p>
<p>以 $f_i$ 为 $i$ 的父亲建立一棵有根树，观察其性质。可以发现，对于 $x$ 子树内的点 $y$，记 $S(y)$ 表示 $y$ 的不在 $x$ 子树内的邻居集合，则对于任意的 $y$，或者 $S(y)=\varnothing$，或者 $S(y)=S(x)$。这容易通过按操作顺序进行归纳证明。</p>
<p>定义 $dp(x,0)$ 表示 $x$ 子树内没有选任何 $S(y)=S(x)$ 的 $y$ 时的最大权独立集权值；$dp(x,1)$ 表示 $x$ 子树内选了至少一个 $S(y)=S(x)$ 的 $y$ 时的最大权独立集权值。计算 $dp(x,*)$ 时，先枚举 $x$ 选不选：如果 $x$ 选了，那么对于其 $p_i=0$ 或 $p_i=2$ 的儿子 $i$ 就只能取 $dp(i,0)$，对于 $p_i=1$ 的儿子则取 $\max(dp(i,0),dp(i,1))$；如果 $x$ 没选：</p>
<ul>
<li>按照编号顺序依次考虑 $x$ 的每个儿子，记两个状态 $a,b$ 分别表示当前是否有至少一个 $p_i\in \{1,3\}$ 和 $p_i\in \{2,3\}$ 的儿子选择 $dp(i,1)$。</li>
<li>若当前考虑的儿子 $i$ 满足 $p_i=1$，那么转移没有限制，否则仅当 $a=0$ 时才能选择 $dp(i,1)$。</li>
<li>于是把 $a,b$ 当成状态在儿子序列上 DP 一下即可。</li>
</ul>
<p>时间复杂度：$O(n)$</p>
<p><a target="_blank" rel="noopener" href="https://uoj.ac/submission/618997">https://uoj.ac/submission/618997</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;friend.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">100010</span>;</span><br><span class="line"><span class="type">int</span> f[N][<span class="number">2</span>],g[<span class="number">2</span>][<span class="number">2</span>],h[<span class="number">2</span>][<span class="number">2</span>];</span><br><span class="line">vector &lt;<span class="type">int</span>&gt; sn[N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">findSample</span> <span class="params">(<span class="type">int</span> n,<span class="type">int</span> c[],<span class="type">int</span> fa[],<span class="type">int</span> p[])</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n<span class="number">-1</span>;i++) &#123;sn[fa[i]].<span class="built_in">push_back</span>(i);&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=n<span class="number">-1</span>;i&gt;=<span class="number">0</span>;i--) &#123;</span><br><span class="line">		g[<span class="number">0</span>][<span class="number">0</span>]=<span class="number">0</span>,g[<span class="number">0</span>][<span class="number">1</span>]=g[<span class="number">1</span>][<span class="number">0</span>]=g[<span class="number">1</span>][<span class="number">1</span>]=<span class="number">-1e9</span>;</span><br><span class="line">		<span class="type">int</span> tmp=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">auto</span> j:sn[i]) &#123;</span><br><span class="line">			<span class="keyword">if</span> (p[j]==<span class="number">0</span>) &#123;</span><br><span class="line">				h[<span class="number">0</span>][<span class="number">0</span>]=g[<span class="number">0</span>][<span class="number">0</span>]+f[j][<span class="number">0</span>];</span><br><span class="line">				h[<span class="number">0</span>][<span class="number">1</span>]=g[<span class="number">0</span>][<span class="number">1</span>]+f[j][<span class="number">0</span>];</span><br><span class="line">				h[<span class="number">1</span>][<span class="number">0</span>]=<span class="built_in">max</span>(g[<span class="number">0</span>][<span class="number">0</span>]+f[j][<span class="number">1</span>],g[<span class="number">1</span>][<span class="number">0</span>]+<span class="built_in">max</span>(f[j][<span class="number">0</span>],f[j][<span class="number">1</span>]));</span><br><span class="line">				h[<span class="number">1</span>][<span class="number">1</span>]=<span class="built_in">max</span>(g[<span class="number">0</span>][<span class="number">1</span>]+f[j][<span class="number">1</span>],g[<span class="number">1</span>][<span class="number">1</span>]+<span class="built_in">max</span>(f[j][<span class="number">0</span>],f[j][<span class="number">1</span>]));</span><br><span class="line">				tmp+=f[j][<span class="number">0</span>];</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (p[j]==<span class="number">1</span>) &#123;</span><br><span class="line">				h[<span class="number">0</span>][<span class="number">0</span>]=g[<span class="number">0</span>][<span class="number">0</span>]+f[j][<span class="number">0</span>];</span><br><span class="line">				h[<span class="number">0</span>][<span class="number">1</span>]=<span class="built_in">max</span>(g[<span class="number">0</span>][<span class="number">0</span>]+f[j][<span class="number">1</span>],g[<span class="number">0</span>][<span class="number">1</span>]+<span class="built_in">max</span>(f[j][<span class="number">0</span>],f[j][<span class="number">1</span>]));</span><br><span class="line">				h[<span class="number">1</span>][<span class="number">0</span>]=g[<span class="number">1</span>][<span class="number">0</span>]+f[j][<span class="number">0</span>];</span><br><span class="line">				h[<span class="number">1</span>][<span class="number">1</span>]=g[<span class="number">1</span>][<span class="number">1</span>]+f[j][<span class="number">0</span>];</span><br><span class="line">				tmp+=<span class="built_in">max</span>(f[j][<span class="number">0</span>],f[j][<span class="number">1</span>]);</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				h[<span class="number">0</span>][<span class="number">0</span>]=g[<span class="number">0</span>][<span class="number">0</span>]+f[j][<span class="number">0</span>];</span><br><span class="line">				h[<span class="number">0</span>][<span class="number">1</span>]=g[<span class="number">0</span>][<span class="number">1</span>]+f[j][<span class="number">0</span>];</span><br><span class="line">				h[<span class="number">1</span>][<span class="number">0</span>]=g[<span class="number">1</span>][<span class="number">0</span>]+f[j][<span class="number">0</span>];</span><br><span class="line">				h[<span class="number">1</span>][<span class="number">1</span>]=<span class="built_in">max</span>(g[<span class="number">1</span>][<span class="number">1</span>]+f[j][<span class="number">0</span>],<span class="built_in">max</span>(g[<span class="number">0</span>][<span class="number">0</span>],g[<span class="number">0</span>][<span class="number">1</span>])+f[j][<span class="number">1</span>]);</span><br><span class="line">				tmp+=f[j][<span class="number">0</span>];</span><br><span class="line">			&#125;</span><br><span class="line">			g[<span class="number">0</span>][<span class="number">0</span>]=h[<span class="number">0</span>][<span class="number">0</span>],g[<span class="number">0</span>][<span class="number">1</span>]=h[<span class="number">0</span>][<span class="number">1</span>],g[<span class="number">1</span>][<span class="number">0</span>]=h[<span class="number">1</span>][<span class="number">0</span>],g[<span class="number">1</span>][<span class="number">1</span>]=h[<span class="number">1</span>][<span class="number">1</span>];</span><br><span class="line">		&#125;</span><br><span class="line">		f[i][<span class="number">0</span>]=<span class="built_in">max</span>(g[<span class="number">0</span>][<span class="number">0</span>],g[<span class="number">1</span>][<span class="number">0</span>]),f[i][<span class="number">1</span>]=<span class="built_in">max</span>(<span class="built_in">max</span>(g[<span class="number">0</span>][<span class="number">1</span>],g[<span class="number">1</span>][<span class="number">1</span>]),tmp+c[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">max</span>(f[<span class="number">0</span>][<span class="number">0</span>],f[<span class="number">0</span>][<span class="number">1</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="29-【IOI2014】Holiday"><a href="#29-【IOI2014】Holiday" class="headerlink" title="#29. 【IOI2014】Holiday"></a><a target="_blank" rel="noopener" href="https://uoj.ac/problem/29">#29. 【IOI2014】Holiday</a></h3><h4 id="题目大意：-28"><a href="#题目大意：-28" class="headerlink" title="题目大意："></a>题目大意：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题目大意
    </div>
    <div class='spoiler-content'>
        <p><strong>本题空间限制为 $64\text{MB}$。</strong></p>
<p>有一个包含 $n$ 个点的链，点 $i$ 上有 $a_i$ 个景点。给定你的初始点 $s$，接下来的 $d$ 天内，每天你可以做如下两件事之一：</p>
<ul>
<li>沿着链的一条边走到另一个点；</li>
<li>参观当前所在点的所有景点。</li>
</ul>
<p>求你 $d$ 天内最多能参观多少个不同的景点。</p>
<p>$1\leq n\leq 10^5, 0\leq d\leq 2n+\lfloor\frac{n}{2}\rfloor, 0\leq a_i\leq 10^9$</p>

    </div>
</div>
<h4 id="题解：-28"><a href="#题解：-28" class="headerlink" title="题解："></a>题解：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题解
    </div>
    <div class='spoiler-content'>
        <p>显然最优路线形如先向左走 $x$ 步，再向右走 $x$ 步回到起点，再向右走 $y$ 步，或者把左右反一下。定义 $l_{1,i}, l_{2,i}, r_{1,i}, r_{2,i}$ 分别表示往左/右走，共花 $i$ 天，不需要/需要最后走回起点，能参观的最大景点数。它们的计算是类似的，以 $l_{1,i}$ 为例。</p>
<p>计算 $l_{1,i}$，枚举往左走了 $j$ 步，那么能参观的最大景点数就是从 $s$ 往左走 $j$ 步范围内的景点数的前 $i-j$ 大值和。不难证明最优的 $j$ 是关于 $i$ 单调不降的，于是可以用决策单调性的分治算法求出所有的 $l_{1,i}$，求区间前 $k$ 大值和用可持久化线段树即可。</p>
<p>最后答案就是 $\max\{l_{1,i}+r_{2,d-i},l_{2,i}+r_{1,d-i}\}$。</p>
<p>由于本题卡空间，最好将景点数离散化后再存进可持久化线段树。</p>
<p>时间复杂度：$O(n\log n\log d)$</p>
<p><a target="_blank" rel="noopener" href="https://uoj.ac/submission/619007">https://uoj.ac/submission/619007</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;holiday.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">100010</span>,D=<span class="number">250010</span>;</span><br><span class="line"><span class="type">int</span> n,tot,cnt,a[N],b[N],rt[N],seq[N],ch[N*<span class="number">20</span>][<span class="number">2</span>],siz[N*<span class="number">20</span>];</span><br><span class="line">ll ans,l1[D],l2[D],r1[D],r2[D],val[N*<span class="number">20</span>];</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span> <span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span> </span>&#123;<span class="keyword">return</span> a[x]&lt;a[y];&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">modify</span> <span class="params">(<span class="type">int</span> rt,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> pos,<span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> p=++tot;</span><br><span class="line">	val[p]=val[rt]+v,siz[p]=siz[rt]+<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span> (l==r) &#123;<span class="keyword">return</span> p;&#125;</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span> (pos&lt;=mid) &#123;ch[p][<span class="number">0</span>]=<span class="built_in">modify</span>(ch[rt][<span class="number">0</span>],l,mid,pos,v),ch[p][<span class="number">1</span>]=ch[rt][<span class="number">1</span>];&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;ch[p][<span class="number">0</span>]=ch[rt][<span class="number">0</span>],ch[p][<span class="number">1</span>]=<span class="built_in">modify</span>(ch[rt][<span class="number">1</span>],mid+<span class="number">1</span>,r,pos,v);&#125;</span><br><span class="line">	<span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">query</span> <span class="params">(<span class="type">int</span> rt,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!rt||l==r) &#123;<span class="keyword">return</span> siz[rt]?<span class="number">1ll</span>*<span class="built_in">min</span>(k,siz[rt])*(val[rt]/siz[rt]):<span class="number">0</span>;&#125;</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span> (k&lt;=siz[ch[rt][<span class="number">1</span>]]) &#123;<span class="keyword">return</span> <span class="built_in">query</span>(ch[rt][<span class="number">1</span>],mid+<span class="number">1</span>,r,k);&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;<span class="keyword">return</span> <span class="built_in">query</span>(ch[rt][<span class="number">0</span>],l,mid,k-siz[ch[rt][<span class="number">1</span>]])+val[ch[rt][<span class="number">1</span>]];&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span> <span class="params">(<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> xl,<span class="type">int</span> xr,<span class="type">int</span> op,ll ans[])</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (l&gt;r) &#123;<span class="keyword">return</span>;&#125;</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>,tr=<span class="built_in">min</span>(xr,mid/op),mxp=xl;</span><br><span class="line">	ll mxv=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=xl;i&lt;=tr;i++) &#123;</span><br><span class="line">		ll tmp=<span class="built_in">query</span>(rt[i],<span class="number">1</span>,cnt,(mid-op*i));</span><br><span class="line">		<span class="keyword">if</span> (tmp&gt;mxv) &#123;mxv=tmp,mxp=i;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	ans[mid]=mxv;</span><br><span class="line">	<span class="built_in">solve</span>(l,mid<span class="number">-1</span>,xl,mxp,op,ans),<span class="built_in">solve</span>(mid+<span class="number">1</span>,r,mxp,xr,op,ans);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">findMaxAttraction</span> <span class="params">(<span class="type">int</span> nn,<span class="type">int</span> s,<span class="type">int</span> d,<span class="type">int</span> aa[])</span> </span>&#123;</span><br><span class="line">	n=nn;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++) &#123;seq[i]=i,a[i]=aa[i];&#125;</span><br><span class="line">	<span class="built_in">sort</span>(seq,seq+n,cmp);b[seq[<span class="number">0</span>]]=++cnt;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;n;i++) &#123;b[seq[i]]=(a[seq[i]]==a[seq[i<span class="number">-1</span>]]?cnt:++cnt);&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=s<span class="number">-1</span>;i&gt;=<span class="number">0</span>;i--) &#123;rt[s-i]=<span class="built_in">modify</span>(rt[s-i<span class="number">-1</span>],<span class="number">1</span>,cnt,b[i],a[i]);&#125;</span><br><span class="line">	<span class="built_in">solve</span>(<span class="number">0</span>,d,<span class="number">1</span>,s,<span class="number">1</span>,l1),<span class="built_in">solve</span>(<span class="number">0</span>,d,<span class="number">1</span>,s,<span class="number">2</span>,l2);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=tot;i++) &#123;ch[i][<span class="number">0</span>]=ch[i][<span class="number">1</span>]=siz[i]=val[i]=<span class="number">0</span>;&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=s;i++) &#123;rt[i]=<span class="number">0</span>;&#125;</span><br><span class="line">	rt[<span class="number">0</span>]=<span class="built_in">modify</span>(rt[<span class="number">0</span>],<span class="number">1</span>,cnt,b[s],a[s]);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=s+<span class="number">1</span>;i&lt;n;i++) &#123;rt[i-s]=<span class="built_in">modify</span>(rt[i-s<span class="number">-1</span>],<span class="number">1</span>,cnt,b[i],a[i]);&#125;</span><br><span class="line">	<span class="built_in">solve</span>(<span class="number">0</span>,d,<span class="number">0</span>,n-s<span class="number">-1</span>,<span class="number">1</span>,r1),<span class="built_in">solve</span>(<span class="number">0</span>,d,<span class="number">0</span>,n-s<span class="number">-1</span>,<span class="number">2</span>,r2);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;=d;i++) &#123;ans=<span class="built_in">max</span>(ans,<span class="built_in">max</span>(l1[i]+r2[d-i],l2[i]+r1[d-i]));&#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="30-【CF-Round-278】Tourists"><a href="#30-【CF-Round-278】Tourists" class="headerlink" title="#30. 【CF Round #278】Tourists"></a><a target="_blank" rel="noopener" href="https://uoj.ac/problem/30">#30. 【CF Round #278】Tourists</a></h3><h4 id="题目大意：-29"><a href="#题目大意：-29" class="headerlink" title="题目大意："></a>题目大意：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题目大意
    </div>
    <div class='spoiler-content'>
        <p>维护一个 $n$ 个点 $m$ 条边的无向图，点带权 $w_i$。支持 $q$ 次操作，操作分为两种：</p>
<ul>
<li>给定 $x,v$，将 $x$ 的点权 $w_x$ 修改为 $v$；</li>
<li>给定 $x,y$，求所有从 $x$ 到 $y$ 的简单路径上点权最小值的最小值。</li>
</ul>
<p>$1\leq n,m,q\leq 10^5, 1\leq w_i,v\leq 10^9$</p>

    </div>
</div>
<h4 id="题解：-29"><a href="#题解：-29" class="headerlink" title="题解："></a>题解：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题解
    </div>
    <div class='spoiler-content'>
        <p>点双连通分量有一个好的性质：对于任意三个不同点 $x,y,z$，存在一条 $x\to y$ 的经过 $z$ 的简单路径，证明可以先找到一个包含 $x,z$ 的简单环，然后考虑 $y\to x$ 的路径与环的交。</p>
<p>于是在本题中，询问 $x\to y$ 的答案就是圆方树上所有 $x\to y$ 路径上的方点对应的点双的点权最小值的最小值（显然不在路径上的方点是访问不到的）。于是我们先求出圆方树，然后在每个方点上维护其周围圆点的点权最小值，询问时查询树链 $\min$ 即可，可以用树链剖分实现。</p>
<p>上面的做法有一个小问题：修改一个圆点权值时可能导致很多方点权值改变。为此我们稍作修改，在每个方点处仅维护其所有儿子的点权最小值（可以用 set 维护），这样修改一个圆点只需修改它自己以及它父亲的树上点权，复杂度就没有问题了。不过注意此时如果树链询问时 LCA 恰好是方点，那么 LCA 的父亲也要计算在内。</p>
<p>时间复杂度：$O(m+n\log n+q\log^2 n)$</p>
<p><a target="_blank" rel="noopener" href="https://uoj.ac/submission/619141">https://uoj.ac/submission/619141</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">200010</span>;</span><br><span class="line"><span class="type">int</span> n,nn,m,q,x,y,tot,a[N],dfn[N],low[N],f[N],seg[N],wsn[N],siz[N],dep[N],tp[N],val[N*<span class="number">4</span>];</span><br><span class="line"><span class="type">char</span> c[<span class="number">10</span>];</span><br><span class="line">vector &lt;<span class="type">int</span>&gt; v[N],u[N];</span><br><span class="line">multiset &lt;<span class="type">int</span>&gt; s[N];</span><br><span class="line">stack &lt;<span class="type">int</span>&gt; st;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span> <span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">	dfn[x]=low[x]=++tot;</span><br><span class="line">	st.<span class="built_in">push</span>(x);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">auto</span> y:v[x]) &#123;</span><br><span class="line">		<span class="keyword">if</span> (!dfn[y]) &#123;</span><br><span class="line">			<span class="built_in">dfs</span>(y);low[x]=<span class="built_in">min</span>(low[x],low[y]);</span><br><span class="line">			<span class="keyword">if</span> (low[y]&gt;=dfn[x]) &#123;</span><br><span class="line">				n++;<span class="keyword">while</span> (st.<span class="built_in">top</span>()!=y) &#123;</span><br><span class="line">					<span class="type">int</span> tmp=st.<span class="built_in">top</span>();st.<span class="built_in">pop</span>();</span><br><span class="line">					u[n].<span class="built_in">push_back</span>(tmp),u[tmp].<span class="built_in">push_back</span>(n);</span><br><span class="line">				&#125;</span><br><span class="line">				st.<span class="built_in">pop</span>();u[n].<span class="built_in">push_back</span>(y),u[y].<span class="built_in">push_back</span>(n);</span><br><span class="line">				u[n].<span class="built_in">push_back</span>(x),u[x].<span class="built_in">push_back</span>(n);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;low[x]=<span class="built_in">min</span>(low[x],dfn[y]);&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs2</span> <span class="params">(<span class="type">int</span> x,<span class="type">int</span> fa)</span> </span>&#123;</span><br><span class="line">	siz[x]=<span class="number">1</span>,dep[x]=dep[fa]+<span class="number">1</span>,f[x]=fa;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">auto</span> y:u[x]) &#123;</span><br><span class="line">		<span class="keyword">if</span> (y==fa) &#123;<span class="keyword">continue</span>;&#125;</span><br><span class="line">		<span class="built_in">dfs2</span>(y,x);</span><br><span class="line">		siz[x]+=siz[y];<span class="keyword">if</span> (siz[y]&gt;siz[wsn[x]]) &#123;wsn[x]=y;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs3</span> <span class="params">(<span class="type">int</span> x,<span class="type">int</span> to)</span> </span>&#123;</span><br><span class="line">	tp[x]=to,seg[x]=++tot;</span><br><span class="line">	<span class="keyword">if</span> (wsn[x]) &#123;<span class="built_in">dfs3</span>(wsn[x],to);&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">auto</span> y:u[x]) &#123;</span><br><span class="line">		<span class="keyword">if</span> (y==f[x]||y==wsn[x]) &#123;<span class="keyword">continue</span>;&#125;</span><br><span class="line">		<span class="built_in">dfs3</span>(y,y);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">modify</span> <span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> pos,<span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (l==r) &#123;val[p]=v;<span class="keyword">return</span>;&#125;</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span> (pos&lt;=mid) &#123;<span class="built_in">modify</span>(p*<span class="number">2</span>,l,mid,pos,v);&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;<span class="built_in">modify</span>(p*<span class="number">2</span>+<span class="number">1</span>,mid+<span class="number">1</span>,r,pos,v);&#125;</span><br><span class="line">	val[p]=<span class="built_in">min</span>(val[p*<span class="number">2</span>],val[p*<span class="number">2</span>+<span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query</span> <span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> xl,<span class="type">int</span> xr)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (xr&lt;l||r&lt;xl) &#123;<span class="keyword">return</span> <span class="number">1e9</span>;&#125;</span><br><span class="line">	<span class="keyword">if</span> (xl&lt;=l&amp;&amp;r&lt;=xr) &#123;<span class="keyword">return</span> val[p];&#125;</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">min</span>(<span class="built_in">query</span>(p*<span class="number">2</span>,l,mid,xl,xr),<span class="built_in">query</span>(p*<span class="number">2</span>+<span class="number">1</span>,mid+<span class="number">1</span>,r,xl,xr));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">queryt</span> <span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> fx=tp[x],fy=tp[y],res=<span class="number">1e9</span>;</span><br><span class="line">	<span class="keyword">while</span> (fx!=fy) &#123;</span><br><span class="line">		<span class="keyword">if</span> (dep[fx]&lt;dep[fy]) &#123;<span class="built_in">swap</span>(x,y),<span class="built_in">swap</span>(fx,fy);&#125;</span><br><span class="line">		res=<span class="built_in">min</span>(res,<span class="built_in">query</span>(<span class="number">1</span>,<span class="number">1</span>,n,seg[fx],seg[x]));</span><br><span class="line">		x=f[fx],fx=tp[x];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (dep[x]&lt;dep[y]) &#123;<span class="built_in">swap</span>(x,y);&#125;</span><br><span class="line">	res=<span class="built_in">min</span>(res,<span class="built_in">query</span>(<span class="number">1</span>,<span class="number">1</span>,n,seg[y],seg[x]));</span><br><span class="line">	<span class="keyword">if</span> (y&gt;nn) &#123;res=<span class="built_in">min</span>(res,a[f[y]]);&#125;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;n,&amp;m,&amp;q);nn=n;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;a[i]);&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;x,&amp;y);</span><br><span class="line">		v[x].<span class="built_in">push_back</span>(y),v[y].<span class="built_in">push_back</span>(x); </span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">dfs</span>(<span class="number">1</span>);tot=<span class="number">0</span>;</span><br><span class="line">	<span class="built_in">dfs2</span>(<span class="number">1</span>,<span class="number">0</span>);<span class="built_in">dfs3</span>(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=nn;i++) &#123;</span><br><span class="line">		<span class="built_in">modify</span>(<span class="number">1</span>,<span class="number">1</span>,n,seg[i],a[i]);</span><br><span class="line">		<span class="keyword">if</span> (f[i]) &#123;s[f[i]].<span class="built_in">insert</span>(a[i]);&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=nn+<span class="number">1</span>;i&lt;=n;i++) &#123;<span class="built_in">modify</span>(<span class="number">1</span>,<span class="number">1</span>,n,seg[i],*s[i].<span class="built_in">begin</span>());&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=q;i++) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,c+<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">if</span> (c[<span class="number">1</span>]==<span class="string">&#x27;C&#x27;</span>) &#123;</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;x,&amp;y);</span><br><span class="line">			<span class="keyword">if</span> (f[x]) &#123;</span><br><span class="line">				s[f[x]].<span class="built_in">erase</span>(s[f[x]].<span class="built_in">find</span>(a[x]));</span><br><span class="line">				s[f[x]].<span class="built_in">insert</span>(y);</span><br><span class="line">				<span class="built_in">modify</span>(<span class="number">1</span>,<span class="number">1</span>,n,seg[f[x]],*s[f[x]].<span class="built_in">begin</span>());</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="built_in">modify</span>(<span class="number">1</span>,<span class="number">1</span>,n,seg[x],a[x]=y);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;x,&amp;y);</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">queryt</span>(x,y));</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="31-【UR-2】猪猪侠再战括号序列"><a href="#31-【UR-2】猪猪侠再战括号序列" class="headerlink" title="#31. 【UR #2】猪猪侠再战括号序列"></a><a target="_blank" rel="noopener" href="https://uoj.ac/problem/31">#31. 【UR #2】猪猪侠再战括号序列</a></h3><h4 id="题目大意：-30"><a href="#题目大意：-30" class="headerlink" title="题目大意："></a>题目大意：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题目大意
    </div>
    <div class='spoiler-content'>
        <p>给定一个长度为 $2\times n$ 的括号串，其中左右括号各有 $n$ 个。你可以进行至多 $n$ 次操作，每次操作可以给定 $l,r$ 然后将 $[l,r]$ 内的括号顺序翻转（不会把左右括号反转）。请将初始的括号串变成括号匹配的。</p>
<p>$1\leq n\leq 10^5$</p>

    </div>
</div>
<h4 id="题解：-30"><a href="#题解：-30" class="headerlink" title="题解："></a>题解：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题解
    </div>
    <div class='spoiler-content'>
        <p>前面 $n$ 个左括号加后面 $n$ 个右括号显然是括号匹配的，所以设第 $i$ 个左括号位置为 $p_i$，第 $i$ 次翻转 $[i,p_i]$ 即可。</p>
<p><a target="_blank" rel="noopener" href="https://uoj.ac/submission/619143">https://uoj.ac/submission/619143</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">200010</span>;</span><br><span class="line"><span class="type">int</span> n,tot,a[N];</span><br><span class="line"><span class="type">char</span> s[N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,s+<span class="number">1</span>);n=<span class="built_in">strlen</span>(s+<span class="number">1</span>)/<span class="number">2</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">2</span>*n;i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (s[i]==<span class="string">&#x27;(&#x27;</span>) &#123;a[++tot]=i;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,n);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;<span class="built_in">printf</span>(<span class="string">&quot;%d %d\n&quot;</span>,i,a[i]);&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="32-【UR-2】跳蚤公路"><a href="#32-【UR-2】跳蚤公路" class="headerlink" title="#32. 【UR #2】跳蚤公路"></a><a target="_blank" rel="noopener" href="https://uoj.ac/problem/32">#32. 【UR #2】跳蚤公路</a></h3><h4 id="题目大意：-31"><a href="#题目大意：-31" class="headerlink" title="题目大意："></a>题目大意：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题目大意
    </div>
    <div class='spoiler-content'>
        <p>给定一张 $n$ 个点的 $m$ 条边的有向图，边有边权 $w_i$，还有红绿白中的一种颜色。你可以选定一个整数 $x$，然后将所有红色边的权值加 $x$，绿色边的权值减 $x$。对于每个 $i=1,\ldots,n$，求有多少种 $x$ 使得不存在 $1\to i$ 的经过负环的路径，或报告这样的 $x$ 有无穷多种。</p>
<p>$1\leq n\leq 100, 1\leq m\leq 10000, |w_i|\leq 10^9$</p>

    </div>
</div>
<h4 id="题解：-31"><a href="#题解：-31" class="headerlink" title="题解："></a>题解：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题解
    </div>
    <div class='spoiler-content'>
        <p>对于每个强连通分量可以分开做，最后做一次可达性统计，每个点的答案取所有可以到达它的强连通分量的答案的并即可。</p>
<p>对于一个强连通分量 $C$ 和一个给定的 $x$，有如下几种可能情况：</p>
<ul>
<li>$C$ 中有一个负环，其中红绿边数量相同，记为情况 $0$；</li>
<li>否则，$C$ 中有一个负环，其中红边比绿边多，记为情况 $1$；</li>
<li>否则，$C$ 中有一个负环，其中绿边比红边多，记为情况 $-1$；</li>
<li>否则，即 $C$ 中没有负环，记为情况 $2$。</li>
</ul>
<p>我们要统计情况 $2$ 的数量，那么首先观察情况类型关于 $x$ 的关系。对于任何 $x$ 只要出现了情况 $0$ 就说明无论 $x$ 怎么取都会有负环，这时候肯定无解；对于情况 $1$，肯定是 $x$ 太小了才会出现，也就是存在一个 $x_1$ 使得 $x\leq x_1$ 时有情况 $1$；情况 $-1$ 类似，当 $x\ge x_{-1}$ 时会有情况 $-1$。</p>
<p>排除情况 $0$ 之后，如果 $x_1\ge x_{-1}$ 则总是有负环，不可能有情况 $2$；否则，当 $x\in (x_1,x_{-1})$ 时会有情况 $2$，此时情况关于 $x$ 从小到大分为 $1,2,-1$ 三段。于是我们可以设计一个二分，每次考虑 $x=mid$，如果是情况 $2$ 则 $mid$ 两边分别是 $1,2$ 和 $2,-1$ 两段，再套一个二分即可；如果是情况 $1$ 则说明 $x\leq mid$ 时都是情况 $1$，可以舍掉左半边；如果是情况 $-1$ 则说明 $x\ge mid$ 时都是情况 $-1$，可以舍掉右半边。</p>
<p>每次二分的判定过程就是 Bellman-Ford 求负环，可以通过记录每个点上次被更新时的前驱来具体得到负环包含哪些边，从而确定情况的类型。</p>
<p>事实上，无解情况（有情况 $0$ 或 $x_1\ge x_{-1}$）也可以在上述二分中处理。</p>
<p>时间复杂度：$O(nm\log(nW))$</p>
<p><a target="_blank" rel="noopener" href="https://uoj.ac/submission/619179">https://uoj.ac/submission/619179</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">110</span>,M=<span class="number">10010</span>;</span><br><span class="line"><span class="type">const</span> ll INF=<span class="number">1e14</span>,HINF=<span class="number">5e13</span>;</span><br><span class="line"><span class="type">int</span> n,m,x,y,z,w,tot,cnt,dfn[N],low[N],vis[N],col[N],pre[N],prec[N],kd[N][N];</span><br><span class="line">vector &lt;<span class="type">int</span>&gt; u[N],v[N],t[N],s1[N],s2[N],scc[N];</span><br><span class="line">vector &lt;ll&gt; s3[N];</span><br><span class="line">ll ansl[N],ansr[N],dis[N];</span><br><span class="line">stack &lt;<span class="type">int</span>&gt; st;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span> <span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">	dfn[x]=low[x]=++tot,vis[x]=<span class="number">1</span>;st.<span class="built_in">push</span>(x);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">auto</span> y:v[x]) &#123;</span><br><span class="line">		<span class="keyword">if</span> (!dfn[y]) &#123;<span class="built_in">dfs</span>(y);low[x]=<span class="built_in">min</span>(low[x],low[y]);&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (vis[y]) &#123;low[x]=<span class="built_in">min</span>(low[x],dfn[y]);&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (low[x]==dfn[x]) &#123;</span><br><span class="line">		++cnt;</span><br><span class="line">		<span class="keyword">while</span> (st.<span class="built_in">top</span>()!=x) &#123;</span><br><span class="line">			<span class="type">int</span> tmp=st.<span class="built_in">top</span>();st.<span class="built_in">pop</span>();</span><br><span class="line">			scc[cnt].<span class="built_in">push_back</span>(tmp),col[tmp]=cnt,vis[tmp]=<span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		st.<span class="built_in">pop</span>();scc[cnt].<span class="built_in">push_back</span>(x),col[x]=cnt,vis[x]=<span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">chk</span> <span class="params">(<span class="type">int</span> x,ll val)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">auto</span> i:scc[x]) &#123;</span><br><span class="line">		s1[i].<span class="built_in">clear</span>(),s2[i].<span class="built_in">clear</span>(),s3[i].<span class="built_in">clear</span>();</span><br><span class="line">		dis[i]=pre[i]=prec[i]=vis[i]=<span class="number">0</span>;</span><br><span class="line">		<span class="type">int</span> len=v[i].<span class="built_in">size</span>();</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">0</span>;j&lt;len;j++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (col[v[i][j]]==x) &#123;</span><br><span class="line">				s1[i].<span class="built_in">push_back</span>(v[i][j]);</span><br><span class="line">				s2[i].<span class="built_in">push_back</span>(t[i][j]);</span><br><span class="line">				s3[i].<span class="built_in">push_back</span>(u[i][j]+t[i][j]*val);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> gen=scc[x].<span class="built_in">size</span>(),flg=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=gen+<span class="number">1</span>;i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">auto</span> j:scc[x]) &#123;</span><br><span class="line">			<span class="type">int</span> len=s1[j].<span class="built_in">size</span>();</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> k=<span class="number">0</span>;k&lt;len;k++) &#123;</span><br><span class="line">				<span class="keyword">if</span> (dis[s1[j][k]]&gt;dis[j]+s3[j][k]) &#123;</span><br><span class="line">					dis[s1[j][k]]=dis[j]+s3[j][k],pre[s1[j][k]]=j,prec[s1[j][k]]=s2[j][k];</span><br><span class="line">					<span class="keyword">if</span> (i==gen+<span class="number">1</span>) &#123;flg=s1[j][k];&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (flg) &#123;</span><br><span class="line">		<span class="type">int</span> cur=flg,cnt=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">while</span> (!vis[cur]) &#123;vis[cur]=<span class="number">1</span>;cur=pre[cur];&#125;</span><br><span class="line">		<span class="keyword">while</span> (vis[cur]) &#123;vis[cur]=<span class="number">0</span>;cur=pre[cur];&#125;</span><br><span class="line">		<span class="keyword">while</span> (!vis[cur]) &#123;cnt+=prec[cur],vis[cur]=<span class="number">1</span>;cur=pre[cur];&#125;</span><br><span class="line">		<span class="keyword">if</span> (cnt==<span class="number">0</span>) &#123;<span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (cnt&gt;<span class="number">0</span>) &#123;<span class="keyword">return</span> <span class="number">1</span>;&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;<span class="keyword">return</span> <span class="number">-1</span>;&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;<span class="keyword">return</span> <span class="number">2</span>;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">calc</span> <span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">	ll l=<span class="number">-1e13</span>,r=<span class="number">1e13</span>;</span><br><span class="line">	<span class="keyword">while</span> (l&lt;=r) &#123;</span><br><span class="line">		ll mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">		<span class="type">int</span> res=<span class="built_in">chk</span>(x,mid);</span><br><span class="line">		<span class="keyword">if</span> (res==<span class="number">0</span>) &#123;ansl[x]=<span class="number">1e13</span>,ansr[x]=<span class="number">-1e13</span>;<span class="keyword">return</span>;&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (res==<span class="number">1</span>) &#123;l=mid+<span class="number">1</span>;&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (res==<span class="number">-1</span>) &#123;r=mid<span class="number">-1</span>;&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			ll tl=l,tr=mid;</span><br><span class="line">			<span class="keyword">while</span> (tl&lt;tr) &#123;</span><br><span class="line">				ll tmid=(tl+tr)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">				<span class="keyword">if</span> (<span class="built_in">chk</span>(x,tmid)==<span class="number">2</span>) &#123;tr=tmid;&#125;</span><br><span class="line">				<span class="keyword">else</span> &#123;tl=tmid+<span class="number">1</span>;&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			ansl[x]=tl;</span><br><span class="line">			tl=mid,tr=r;</span><br><span class="line">			<span class="keyword">while</span> (tl&lt;tr) &#123;</span><br><span class="line">				ll tmid=(tl+tr+<span class="number">1</span>)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">				<span class="keyword">if</span> (<span class="built_in">chk</span>(x,tmid)==<span class="number">2</span>) &#123;tl=tmid;&#125;</span><br><span class="line">				<span class="keyword">else</span> &#123;tr=tmid<span class="number">-1</span>;&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			ansr[x]=tl;</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	ansl[x]=<span class="number">1e13</span>,ansr[x]=<span class="number">-1e13</span>;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d%d&quot;</span>,&amp;x,&amp;y,&amp;z,&amp;w);</span><br><span class="line">		v[x].<span class="built_in">push_back</span>(y),u[x].<span class="built_in">push_back</span>(z),t[x].<span class="built_in">push_back</span>(w);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">dfs</span>(<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=cnt;i++) &#123;</span><br><span class="line">		<span class="built_in">calc</span>(i);</span><br><span class="line">		kd[i][i]=<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">auto</span> j:scc[i]) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">auto</span> k:v[j]) &#123;</span><br><span class="line">				<span class="keyword">if</span> (col[k]!=col[j]) &#123;</span><br><span class="line">					<span class="keyword">for</span> (<span class="type">int</span> l=<span class="number">1</span>;l&lt;=cnt;l++) &#123;kd[i][l]|=kd[col[k]][l];&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=cnt;i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">1</span>;j&lt;=cnt;j++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (kd[j][i]) &#123;ansl[i]=<span class="built_in">max</span>(ansl[i],ansl[j]),ansr[i]=<span class="built_in">min</span>(ansr[i],ansr[j]);&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (!dfn[i]) &#123;<span class="built_in">printf</span>(<span class="string">&quot;-1\n&quot;</span>);&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (ansl[col[i]]&lt;<span class="number">-1e12</span>||ansr[col[i]]&gt;<span class="number">1e12</span>) &#123;<span class="built_in">printf</span>(<span class="string">&quot;-1\n&quot;</span>);&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,<span class="built_in">max</span>(<span class="number">0ll</span>,ansr[col[i]]-ansl[col[i]]+<span class="number">1</span>));&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="33-【UR-2】树上GCD"><a href="#33-【UR-2】树上GCD" class="headerlink" title="#33. 【UR #2】树上GCD"></a><a target="_blank" rel="noopener" href="https://uoj.ac/problem/33">#33. 【UR #2】树上GCD</a></h3><h4 id="题目大意：-32"><a href="#题目大意：-32" class="headerlink" title="题目大意："></a>题目大意：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题目大意
    </div>
    <div class='spoiler-content'>
        <p>给定一棵 $n$ 个点的（无权）有根树，定义：</p>
<script type="math/tex; mode=display">f(u,v)=\gcd(dis(u,l),dis(v,l))\qquad (l=\operatorname{LCA}(u,v))</script><p>对于每个 $i=1,\ldots,n-1$，求 $u&lt;v, f(u,v)=i$ 的 $(u,v)$ 的数量。</p>
<p>$2\leq n\leq 2\times 10^5$</p>

    </div>
</div>
<h4 id="题解：-32"><a href="#题解：-32" class="headerlink" title="题解："></a>题解：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题解
    </div>
    <div class='spoiler-content'>
        <p>首先求出 $\gcd$ 为 $i$ 的倍数的 $(u,v)$ 数量，然后反演一下即得到答案。考虑长链剖分，设当前已经统计的 $x$ 的儿子中，$x$ 子树内到 $x$ 距离为 $d$ 的点数为 $f(x,d)$，考虑如何合并 $x$ 的一个新的轻儿子 $y$。</p>
<p>设 $y$ 子树的高度（到 $y$ 距离的最大值加 $1$）为 $h_y$，统计 $\gcd$ 为 $i (i\leq h_y)$ 的贡献时，设 $S_i$ 表示 $y$ 子树内到 $x$ 距离为 $i$ 倍数的点数，$T_i$ 表示 $\sum_kf(x,ki)$，则贡献为 $S_i\times T_i$。</p>
<p>所有 $S_i$ 容易 $O(h_y\log (h_y))$ 求出，而计算 $T_i$ 时我们将一条长链放到一起看，现在要支持一条长链上 $f$ 数组的单点修改，以及给定 $m,g$ 求所有模 $m$ 等于 $g$ 的下标处的和。根号分治，对于 $m\leq \sqrt L$ 的情况维护所有 $m,g$ 的答案（单点修改要 $O(\sqrt L)$ 对于每个 $m$ 更新），对于 $m&gt;\sqrt L$ 的情况暴力求和即可，其中 $L$ 是长链的长度。</p>
<p>上面没有考虑一个点和自己祖先的贡献，所以这个需要在最后额外算一下。</p>
<p>另一种做法（题解中提到的做法）是点分治，分别讨论 $u,v$ 的 LCA 是否是分治中心，是的情况容易统计，不是的情况也可以归为一个等差数列位置求和，从而每层复杂度是 $O(n\sqrt n)$，由 Master 定理知总复杂度也是 $O(n\sqrt n)$。</p>
<p>时间复杂度：$O(n\sqrt n)$</p>
<p><a target="_blank" rel="noopener" href="https://uoj.ac/submission/619183">https://uoj.ac/submission/619183</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">200010</span>;</span><br><span class="line"><span class="type">int</span> n,x,tot,wsn[N],dep[N],mxd[N],dfn[N],tp[N],cnt[N],blk[N],tmp[N],tmp2[N];</span><br><span class="line">ll ans[N];</span><br><span class="line">vector &lt;<span class="type">int</span>&gt; v[N];</span><br><span class="line">vector &lt; vector&lt;<span class="type">int</span>&gt; &gt; f[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span> <span class="params">(<span class="type">int</span> x,<span class="type">int</span> fa)</span> </span>&#123;</span><br><span class="line">	dep[x]=dep[fa]+<span class="number">1</span>,mxd[x]=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">auto</span> y:v[x]) &#123;</span><br><span class="line">		<span class="built_in">dfs</span>(y,x);mxd[x]=<span class="built_in">max</span>(mxd[x],mxd[y]+<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">if</span> (mxd[y]&gt;mxd[wsn[x]]) &#123;wsn[x]=y;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span> <span class="params">(<span class="type">int</span> tp,<span class="type">int</span> d,<span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> ind=dfn[tp]+d-dep[tp];</span><br><span class="line">	cnt[ind]+=v;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=blk[tp];i++) &#123;f[tp][i][ind%i]+=v;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query</span> <span class="params">(<span class="type">int</span> tp,<span class="type">int</span> d,<span class="type">int</span> g)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> ind=dfn[tp]+d-dep[tp];</span><br><span class="line">	<span class="keyword">if</span> (g&lt;=blk[tp]) &#123;<span class="keyword">return</span> f[tp][g][ind%g];&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=ind;i&lt;=dfn[tp]+mxd[tp]<span class="number">-1</span>;i+=g) &#123;res+=cnt[i];&#125;</span><br><span class="line">		<span class="keyword">return</span> res;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs2</span> <span class="params">(<span class="type">int</span> x,<span class="type">int</span> to)</span> </span>&#123;</span><br><span class="line">	dfn[x]=++tot,tp[x]=to;</span><br><span class="line">	<span class="keyword">if</span> (x==to) &#123;</span><br><span class="line">		blk[x]=<span class="built_in">sqrt</span>(mxd[x]);</span><br><span class="line">		f[x].<span class="built_in">resize</span>(blk[x]+<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=blk[x];i++) &#123;f[x][i].<span class="built_in">resize</span>(i);&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (wsn[x]) &#123;<span class="built_in">dfs2</span>(wsn[x],to);&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">auto</span> y:v[x]) &#123;</span><br><span class="line">		<span class="keyword">if</span> (y==wsn[x]) &#123;<span class="keyword">continue</span>;&#125;</span><br><span class="line">		<span class="built_in">dfs2</span>(y,y);</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=mxd[y];i++) &#123;tmp[i]=cnt[dfn[y]+i<span class="number">-1</span>],tmp2[i]=<span class="number">0</span>;&#125;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=mxd[y];i++) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> j=i;j&lt;=mxd[y];j+=i) &#123;tmp2[i]+=tmp[j];&#125;</span><br><span class="line">			ans[i]+=<span class="number">1ll</span>*<span class="built_in">query</span>(to,dep[x],i)*tmp2[i];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=mxd[y];i++) &#123;<span class="built_in">add</span>(to,dep[x]+i,tmp[i]);tmp[i]=<span class="number">0</span>;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">add</span>(to,dep[x],<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">2</span>;i&lt;=n;i++) &#123;<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);v[x].<span class="built_in">push_back</span>(i);&#125;</span><br><span class="line">	<span class="built_in">dfs</span>(<span class="number">1</span>,<span class="number">0</span>);<span class="built_in">dfs2</span>(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">2</span>;i&lt;=n;i++) &#123;tmp[dep[i]<span class="number">-1</span>]++;&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=n<span class="number">-1</span>;i&gt;=<span class="number">1</span>;i--) &#123;tmp[i]+=tmp[i+<span class="number">1</span>];&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=n;i&gt;=<span class="number">1</span>;i--) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">2</span>*i;j&lt;=n;j+=i) &#123;ans[i]-=ans[j];&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n<span class="number">-1</span>;i++) &#123;<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans[i]+tmp[i]);&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="34-多项式乘法"><a href="#34-多项式乘法" class="headerlink" title="#34. 多项式乘法"></a><a target="_blank" rel="noopener" href="https://uoj.ac/problem/34">#34. 多项式乘法</a></h3><h4 id="题目大意：-33"><a href="#题目大意：-33" class="headerlink" title="题目大意："></a>题目大意：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题目大意
    </div>
    <div class='spoiler-content'>
        <p>给定一个 $n$ 次多项式 $A=\sum a_ix^i$ 和一个 $m$ 次多项式 $B=\sum b_ix^i$，求 $AB$。</p>
<p>$0\leq n,m\leq 10^5, 0\leq a_i,b_i\leq 9$</p>

    </div>
</div>
<h4 id="题解：-33"><a href="#题解：-33" class="headerlink" title="题解："></a>题解：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题解
    </div>
    <div class='spoiler-content'>
        <p>NTT 模板。</p>
<p>时间复杂度：$O((n+m)\log (n+m))$</p>
<p><a target="_blank" rel="noopener" href="https://uoj.ac/submission/619157">https://uoj.ac/submission/619157</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">4000010</span>,P=<span class="number">998244353</span>;</span><br><span class="line"><span class="type">int</span> n,m,lim=<span class="number">1</span>,l,r[MAXN];</span><br><span class="line">ll a[MAXN],b[MAXN],c[MAXN],tmp1[MAXN],tmp2[MAXN],g,invg;</span><br><span class="line"><span class="function">ll <span class="title">qpow</span> <span class="params">(ll a,ll b)</span> </span>&#123;</span><br><span class="line">	ll res=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">while</span> (b) &#123;</span><br><span class="line">		<span class="keyword">if</span> (b&amp;<span class="number">1</span>) &#123;res=(res*a)%P;&#125;</span><br><span class="line">		a=(a*a)%P;</span><br><span class="line">		b&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ntt</span> <span class="params">(ll a[],<span class="type">int</span> lim,<span class="type">int</span> type)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;lim;i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (i&gt;r[i]) &#123;<span class="built_in">swap</span>(a[i],a[r[i]]);&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;lim;i&lt;&lt;=<span class="number">1</span>) &#123;</span><br><span class="line">		ll wn=<span class="built_in">qpow</span>(type==<span class="number">1</span>?g:invg,(P<span class="number">-1</span>)/(i&lt;&lt;<span class="number">1</span>));</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">0</span>;j&lt;lim;j+=(i&lt;&lt;<span class="number">1</span>)) &#123;</span><br><span class="line">			ll wnt=<span class="number">1</span>;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> k=<span class="number">0</span>;k&lt;=i<span class="number">-1</span>;k++) &#123;</span><br><span class="line">				ll x=a[j+k],y=(wnt*a[j+k+i])%P;</span><br><span class="line">				a[j+k]=(x+y)%P,a[j+k+i]=(x-y+P)%P;</span><br><span class="line">				wnt=(wnt*wn)%P;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">mul</span> <span class="params">(ll a[],ll b[],ll c[])</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;lim;i++) &#123;tmp1[i]=a[i],tmp2[i]=b[i];&#125;</span><br><span class="line">	<span class="built_in">ntt</span>(tmp1,lim,<span class="number">1</span>),<span class="built_in">ntt</span>(tmp2,lim,<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;lim;i++) &#123;c[i]=(tmp1[i]*tmp2[i])%P;&#125;</span><br><span class="line">	<span class="built_in">ntt</span>(c,lim,<span class="number">-1</span>);</span><br><span class="line">	ll inv=<span class="built_in">qpow</span>(lim,P<span class="number">-2</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;lim;i++) &#123;c[i]=(c[i]*inv)%P;&#125;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">	n++,m++;</span><br><span class="line">	<span class="keyword">while</span> (lim&lt;n+m) &#123;lim*=<span class="number">2</span>,l++;&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;lim;i++) &#123;r[i]=(r[i&gt;&gt;<span class="number">1</span>]&gt;&gt;<span class="number">1</span>)|((i&amp;<span class="number">1</span>)&lt;&lt;(l<span class="number">-1</span>));&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;=n<span class="number">-1</span>;i++) &#123;<span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>,&amp;a[i]);&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;=m<span class="number">-1</span>;i++) &#123;<span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>,&amp;b[i]);&#125;</span><br><span class="line">	g=<span class="number">3</span>,invg=<span class="built_in">qpow</span>(<span class="number">3</span>,P<span class="number">-2</span>);</span><br><span class="line">	<span class="built_in">mul</span>(a,b,c);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;n+m<span class="number">-1</span>;i++) &#123;<span class="built_in">printf</span>(<span class="string">&quot;%lld &quot;</span>,c[i]);&#125;</span><br><span class="line">	<span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="35-后缀排序"><a href="#35-后缀排序" class="headerlink" title="#35. 后缀排序"></a><a target="_blank" rel="noopener" href="https://uoj.ac/problem/35">#35. 后缀排序</a></h3><h4 id="题目大意：-34"><a href="#题目大意：-34" class="headerlink" title="题目大意："></a>题目大意：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题目大意
    </div>
    <div class='spoiler-content'>
        <p>给定一个字符串 $w$，对于每个 $i=1,\ldots,|w|$ 求 $w$ 的第 $i$ 小非空后缀的起始位置，并对于每个 $i=2,\ldots,|w|$ 求 $w$ 的第 $i$ 小和第 $i-1$ 小非空后缀的最长公共前缀。</p>
<p>$1\leq |w|\leq 10^5$</p>

    </div>
</div>
<h4 id="题解：-34"><a href="#题解：-34" class="headerlink" title="题解："></a>题解：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题解
    </div>
    <div class='spoiler-content'>
        <p>SA 模板。</p>
<p>时间复杂度：$O(|w|\log |w|)$</p>
<p><a target="_blank" rel="noopener" href="https://uoj.ac/submission/619160">https://uoj.ac/submission/619160</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1000010</span>;</span><br><span class="line"><span class="type">int</span> n,sa[MAXN],rk[MAXN],ht[MAXN],sec[MAXN],buc[MAXN],hei[MAXN];</span><br><span class="line"><span class="type">char</span> c[MAXN];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">bucsort</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="built_in">max</span>(n,<span class="number">256</span>);i++) &#123;buc[i]=<span class="number">0</span>;&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;buc[rk[i]]++;&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="built_in">max</span>(n,<span class="number">256</span>);i++) &#123;buc[i]+=buc[i<span class="number">-1</span>];&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=n;i&gt;=<span class="number">1</span>;i--) &#123;sa[buc[rk[sec[i]]]--]=sec[i];&#125;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">buildsa</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;rk[i]=c[i],sec[i]=i;&#125;</span><br><span class="line">	<span class="built_in">bucsort</span>();</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;n;i&lt;&lt;=<span class="number">1</span>) &#123;</span><br><span class="line">		<span class="type">int</span> cnt=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=n-i+<span class="number">1</span>;j&lt;=n;j++) &#123;sec[++cnt]=j;&#125;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">1</span>;j&lt;=n;j++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (sa[j]&gt;i) &#123;sec[++cnt]=sa[j]-i;&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">bucsort</span>();</span><br><span class="line">		cnt=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">1</span>;j&lt;=n;j++) &#123;sec[j]=rk[j];&#125;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">1</span>;j&lt;=n;j++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (j==<span class="number">1</span>||sec[sa[j]]!=sec[sa[j<span class="number">-1</span>]]||sec[sa[j]+i]!=sec[sa[j<span class="number">-1</span>]+i]) &#123;cnt++;&#125;</span><br><span class="line">			rk[sa[j]]=cnt;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,c+<span class="number">1</span>);</span><br><span class="line">	n=<span class="built_in">strlen</span>(c+<span class="number">1</span>);</span><br><span class="line">	<span class="built_in">buildsa</span>();</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,sa[i]);&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>,cur=<span class="number">0</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		cur=<span class="built_in">max</span>(<span class="number">0</span>,cur<span class="number">-1</span>);</span><br><span class="line">		<span class="keyword">while</span> (i+cur&lt;=n&amp;&amp;rk[i]!=<span class="number">1</span>&amp;&amp;sa[rk[i]<span class="number">-1</span>]+cur&lt;=n&amp;&amp;c[i+cur]==c[sa[rk[i]<span class="number">-1</span>]+cur]) &#123;cur++;&#125;</span><br><span class="line">		hei[rk[i]]=cur;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">2</span>;i&lt;=n;i++) &#123;<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,hei[i]);&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="36-【清华集训2014】玛里苟斯"><a href="#36-【清华集训2014】玛里苟斯" class="headerlink" title="#36. 【清华集训2014】玛里苟斯"></a><a target="_blank" rel="noopener" href="https://uoj.ac/problem/36">#36. 【清华集训2014】玛里苟斯</a></h3><h4 id="题目大意：-35"><a href="#题目大意：-35" class="headerlink" title="题目大意："></a>题目大意：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题目大意
    </div>
    <div class='spoiler-content'>
        <p>给定 $k$ 和一个大小为 $n$ 的非负整数可重集 $S$，求 $S$ 的所有子集的异或和的 $k$ 次方的期望，保证答案小于 $2^{63}$。</p>
<p>$1\leq n\leq 10^5, 1\leq k\leq 5$</p>

    </div>
</div>
<h4 id="题解：-35"><a href="#题解：-35" class="headerlink" title="题解："></a>题解：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题解
    </div>
    <div class='spoiler-content'>
        <p>显然只保留 $S$ 的线性基不会改变答案，所以下面只保留 $S$ 的线性基。</p>
<p>设线性基大小为 $s$，线性基中最高非零位为 $2^t$ 位，那么至少有 $2^{s-1}$ 个子集异或和不小于 $2^t$，其 $k$ 次方至少为 $2^{tk}$，从而答案至少为 $2^{tk-1}$。由于答案小于 $2^{63}$，所以 $t&lt;\frac{64}{k}$。对 $k$ 分类讨论：</p>
<ul>
<li>若 $k\ge 3$，则 $t\leq 21$，可以 $O(2^t)$ 暴力枚举线性基中每个数选不选；</li>
<li>若 $k=1$，则每位的贡献可以拆开，仅考虑某一位时线性空间变成一维的，线性基大小缩为 $0$ 或 $1$，若大小为 $1$ 则说明恰好一半的子集异或和这一位为 $1$，贡献系数为 $0.5$；</li>
<li>若 $k=2$，类似 $k=1$，可以枚举两位 $i,j$ 算它们的联合贡献。仅考虑这两位时线性空间变成二维的，线性基缩成 $0$ 或 $1$ 或 $2$ 维的，通过讨论一下线性基的具体形态就可以知道贡献的系数（和一维类似，只有可能是 $0,0.5,0.25$）。</li>
</ul>
<p>直接用高精度模拟即可通过。事实上通过一些精细的分析可以说明，答案的两倍是一个整数。大致的证明思路是考虑任何 $k$ 位 $b_1,\ldots,b_k$ 的联合贡献，其中 $2$ 的幂是 $b_1+\ldots+b_k-\operatorname{Card}\{b_1,\ldots,b_k\}$，这个数不小于 $-1$。</p>
<p>时间复杂度：$O(\min(w^{k+1},2^{\frac{w}{k}}\times k))$（其中 $w=64$ 为位长最大值，代码复杂度在上述基础上乘了 $O(w)$）</p>
<p><a target="_blank" rel="noopener" href="https://uoj.ac/submission/619191">https://uoj.ac/submission/619191</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ull unsigned long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll __int128</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line">ull n,k,x,cnt,b[<span class="number">70</span>],c[<span class="number">4</span>];</span><br><span class="line">ll res;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">BN</span> &#123;</span><br><span class="line">	<span class="type">int</span> m,d[<span class="number">130</span>];</span><br><span class="line">	<span class="built_in">BN</span> (ll x=<span class="number">0</span>) &#123;</span><br><span class="line">		m=<span class="number">0</span>,<span class="built_in">memset</span>(d,<span class="number">0</span>,<span class="built_in">sizeof</span>(d));</span><br><span class="line">		<span class="keyword">while</span> (x) &#123;d[++m]=x%<span class="number">10</span>;x/=<span class="number">10</span>;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;ans,pw2[<span class="number">130</span>];</span><br><span class="line">BN <span class="keyword">operator</span> + (BN a,BN b) &#123;</span><br><span class="line">	BN c;c.m=<span class="built_in">max</span>(a.m,b.m);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=c.m;i++) &#123;</span><br><span class="line">		c.d[i]+=a.d[i]+b.d[i];</span><br><span class="line">		<span class="keyword">if</span> (c.d[i]&gt;=<span class="number">10</span>) &#123;c.d[i]-=<span class="number">10</span>,c.d[i+<span class="number">1</span>]++,c.m=<span class="built_in">max</span>(c.m,i+<span class="number">1</span>);&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br><span class="line">BN <span class="keyword">operator</span> * (BN a,<span class="type">int</span> b) &#123;</span><br><span class="line">	BN c;c.m=a.m;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=c.m;i++) &#123;</span><br><span class="line">		c.d[i]+=a.d[i]*b;</span><br><span class="line">		<span class="keyword">if</span> (c.d[i]&gt;=<span class="number">10</span>) &#123;c.d[i+<span class="number">1</span>]+=c.d[i]/<span class="number">10</span>;c.d[i]%=<span class="number">10</span>,c.m=<span class="built_in">max</span>(c.m,i+<span class="number">1</span>);&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ins</span> <span class="params">(ull x)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">63</span>;i&gt;=<span class="number">0</span>;i--) &#123;</span><br><span class="line">		<span class="keyword">if</span> ((x&gt;&gt;i)&amp;<span class="number">1</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (b[i]) &#123;x^=b[i];&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;b[i]=x,cnt++;<span class="keyword">return</span>;&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span> <span class="params">(<span class="type">int</span> x,ull v)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (x==<span class="number">-1</span>) &#123;</span><br><span class="line">		ll tmp=<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=k;i++) &#123;tmp*=v;&#125;</span><br><span class="line">		res+=tmp;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (!b[x]) &#123;<span class="built_in">dfs</span>(x<span class="number">-1</span>,v);&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;<span class="built_in">dfs</span>(x<span class="number">-1</span>,v),<span class="built_in">dfs</span>(x<span class="number">-1</span>,v^b[x]);&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%llu%llu&quot;</span>,&amp;n,&amp;k);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%llu&quot;</span>,&amp;x);</span><br><span class="line">		<span class="built_in">ins</span>(x);</span><br><span class="line">	&#125;</span><br><span class="line">	pw2[<span class="number">0</span>]=<span class="built_in">BN</span>(<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">128</span>;i++) &#123;pw2[i]=pw2[i<span class="number">-1</span>]*<span class="number">2</span>;&#125;</span><br><span class="line">	<span class="keyword">if</span> (k==<span class="number">1</span>) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">63</span>;i&gt;=<span class="number">0</span>;i--) &#123;</span><br><span class="line">			<span class="type">int</span> flg=<span class="number">0</span>;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">63</span>;j&gt;=<span class="number">0</span>;j--) &#123;flg|=((b[j]&gt;&gt;i)&amp;<span class="number">1</span>);&#125;</span><br><span class="line">			<span class="keyword">if</span> (flg) &#123;ans=ans+pw2[i+cnt<span class="number">-1</span>];&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (k==<span class="number">2</span>) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">63</span>;i&gt;=<span class="number">0</span>;i--) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">63</span>;j&gt;=<span class="number">0</span>;j--) &#123;</span><br><span class="line">				<span class="built_in">memset</span>(c,<span class="number">0</span>,<span class="built_in">sizeof</span>(c));</span><br><span class="line">				<span class="keyword">for</span> (<span class="type">int</span> k=<span class="number">63</span>;k&gt;=<span class="number">0</span>;k--) &#123;c[((b[k]&gt;&gt;i)&amp;<span class="number">1</span>)*<span class="number">2</span>+((b[k]&gt;&gt;j)&amp;<span class="number">1</span>)]=<span class="number">1</span>;&#125;</span><br><span class="line">				<span class="keyword">if</span> (c[<span class="number">1</span>]+c[<span class="number">2</span>]+c[<span class="number">3</span>]&gt;=<span class="number">2</span>) &#123;ans=ans+pw2[i+j+cnt<span class="number">-2</span>];&#125;</span><br><span class="line">				<span class="keyword">else</span> <span class="keyword">if</span> (c[<span class="number">3</span>]) &#123;ans=ans+pw2[i+j+cnt<span class="number">-1</span>];&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;<span class="built_in">dfs</span>(<span class="number">63</span>,<span class="number">0</span>);ans=<span class="built_in">BN</span>(res);&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=cnt;i++) &#123;ans=ans*<span class="number">5</span>;&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=ans.m;i&gt;=cnt+<span class="number">1</span>;i--) &#123;<span class="built_in">putchar</span>(ans.d[i]+<span class="string">&#x27;0&#x27;</span>);&#125;</span><br><span class="line">	<span class="keyword">if</span> (ans.m&lt;cnt+<span class="number">1</span>) &#123;<span class="built_in">putchar</span>(<span class="string">&#x27;0&#x27;</span>);&#125;</span><br><span class="line">	<span class="type">int</span> cur=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">while</span> (cur&lt;=ans.m&amp;&amp;ans.d[cur]==<span class="number">0</span>) &#123;cur++;&#125;</span><br><span class="line">	<span class="keyword">if</span> (cur&lt;=cnt) &#123;<span class="built_in">putchar</span>(<span class="string">&#x27;.&#x27;</span>);&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=cnt;i&gt;=cur;i--) &#123;<span class="built_in">putchar</span>(ans.d[i]+<span class="string">&#x27;0&#x27;</span>);&#125;</span><br><span class="line">	<span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="37-【清华集训2014】主旋律"><a href="#37-【清华集训2014】主旋律" class="headerlink" title="#37. 【清华集训2014】主旋律"></a><a target="_blank" rel="noopener" href="https://uoj.ac/problem/37">#37. 【清华集训2014】主旋律</a></h3><h4 id="题目大意：-36"><a href="#题目大意：-36" class="headerlink" title="题目大意："></a>题目大意：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题目大意
    </div>
    <div class='spoiler-content'>
        <p>给定 $n$ 个点的简单有向图。求有多少个边的子集满足仅保留其中的边时图强连通，对 $10^9+7$ 取模。</p>
<p>$1\leq n\leq 15$</p>

    </div>
</div>
<h4 id="题解：-36"><a href="#题解：-36" class="headerlink" title="题解："></a>题解：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题解
    </div>
    <div class='spoiler-content'>
        <p>设 $f(S)$ 表示点集 $S$ 的导出子图的答案，$h(S)$ 表示点集 $S$ 内部边的数量。考虑怎样计数强连通图，一种通用的办法是对入度为零的 SCC 容斥，我们设 $g(S)$ 表示将 $S$ 选一个边的子集后分为若干个 SCC，互相之间没有边，偶数个 SCC 的方案数减奇数个 SCC 的方案数，则：</p>
<script type="math/tex; mode=display">
f(S)=h(S)+f'(S)+\sum_{T\subset S}g(T)\times 2^{E(S,S-T)} \\
f'(S)=-\sum_{\varnothing \subset T\subset S-\{x\}}g(T)f(S-T)\\
g(S)=-\sum_{T\subset S-\{x\}}g(T)f(S-T)=f'(S)-f(S)</script><p>这里为了方便转移，定义了 $f’(S)$ 表示将 $S$ 选一个边的子集后分成至少两个 SCC，偶数个的方案减奇数个的方案。转移中的 $E(S,T)$ 指起点在 $S$ 中，终点在 $T$ 中的边数；$x$ 是 $S$ 的一个选定的主元，例如 $\operatorname{lowbit}(S)$。</p>
<p>时间复杂度：$O(n\times 3^n)$</p>
<p><a target="_blank" rel="noopener" href="https://uoj.ac/submission/619195">https://uoj.ac/submission/619195</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">20</span>,P=<span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line"><span class="type">int</span> n,m,x,y,pw2[<span class="number">1010</span>],f[<span class="number">1</span>&lt;&lt;<span class="number">15</span>],g[<span class="number">1</span>&lt;&lt;<span class="number">15</span>],h[<span class="number">1</span>&lt;&lt;<span class="number">15</span>],lg[<span class="number">1</span>&lt;&lt;<span class="number">15</span>],e[N][<span class="number">1</span>&lt;&lt;<span class="number">15</span>];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	pw2[<span class="number">0</span>]=<span class="number">1</span>;<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">1000</span>;i++) &#123;pw2[i]=(pw2[i<span class="number">-1</span>]*<span class="number">2</span>)%P;&#125;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++) &#123;lg[<span class="number">1</span>&lt;&lt;i]=i;&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;x,&amp;y);x--,y--;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">0</span>;j&lt;(<span class="number">1</span>&lt;&lt;n);j++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (((j&gt;&gt;x)&amp;<span class="number">1</span>)&amp;&amp;((j&gt;&gt;y)&amp;<span class="number">1</span>)) &#123;h[j]++;&#125;</span><br><span class="line">			<span class="keyword">if</span> ((j&gt;&gt;y)&amp;<span class="number">1</span>) &#123;e[x][j]++;&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	g[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;(<span class="number">1</span>&lt;&lt;n);i++) &#123;</span><br><span class="line">		<span class="type">int</span> msk=i-(i&amp;(-i));</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=msk;j;j=(j<span class="number">-1</span>)&amp;msk) &#123;g[i]=(g[i]<span class="number">-1ll</span>*g[j]*f[i^j])%P;&#125;</span><br><span class="line">		g[i]=(g[i]+P)%P,f[i]=pw2[h[i]];</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=i;j;j=(j<span class="number">-1</span>)&amp;i) &#123;</span><br><span class="line">			<span class="type">int</span> tmp=h[i^j];</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> k=j;k;k-=(k&amp;(-k))) &#123;tmp+=e[lg[k&amp;(-k)]][i^j];&#125;</span><br><span class="line">			f[i]=(f[i]+<span class="number">1ll</span>*g[j]*pw2[tmp])%P;</span><br><span class="line">		&#125;</span><br><span class="line">		g[i]=(g[i]-f[i]+P)%P;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,f[(<span class="number">1</span>&lt;&lt;n)<span class="number">-1</span>]);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="38-【清华集训2014】奇数国"><a href="#38-【清华集训2014】奇数国" class="headerlink" title="#38. 【清华集训2014】奇数国"></a><a target="_blank" rel="noopener" href="https://uoj.ac/problem/38">#38. 【清华集训2014】奇数国</a></h3><h4 id="题目大意：-37"><a href="#题目大意：-37" class="headerlink" title="题目大意："></a>题目大意：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题目大意
    </div>
    <div class='spoiler-content'>
        <p>维护一个长度为 $n=10^5$ 的序列 $a_1,\ldots,a_n$，初始所有数都是 $3$，支持 $m$ 次操作，操作分为两种：</p>
<ul>
<li>操作一：给定 $x,v$，令 $a_x\leftarrow v$，保证 $v$ 的素因数分解中只包含前 $60$ 个素数；</li>
<li>操作二：给定 $l,r$，求 $\varphi(\prod_{i=l}^r a_i)\bmod 19961993$。</li>
</ul>
<p>$1\leq m\leq 10^5, 1\leq v\leq 10^6$</p>

    </div>
</div>
<h4 id="题解：-37"><a href="#题解：-37" class="headerlink" title="题解："></a>题解：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题解
    </div>
    <div class='spoiler-content'>
        <p>考虑欧拉函数的计算：</p>
<script type="math/tex; mode=display">n=\prod p_i^{k_i},\qquad \varphi(n)=\prod p_i^{k_i-1}(p_i-1)</script><p>所以询问时我们需要求出区间乘积包含哪些素因数以及每个素因数的次数，对于每个素数分别维护一个树状数组表示每个位置上的值中这个素因数的次数即可，修改即在每个树状数组上单点修改。</p>
<p>时间复杂度：$O(mT(\log n+\log V))$（其中 $T=60$ 为素数个数，代码复杂度为 $O(mT(\log n+\log V+\log P)$，其中 $P$ 为模数）</p>
<p><a target="_blank" rel="noopener" href="https://uoj.ac/submission/619202">https://uoj.ac/submission/619202</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">100010</span>,P=<span class="number">19961993</span>;</span><br><span class="line"><span class="type">int</span> n,x,y,z,a[MAXN],c[MAXN][<span class="number">70</span>];</span><br><span class="line"><span class="type">int</span> p[<span class="number">60</span>]=&#123;<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">11</span>,<span class="number">13</span>,<span class="number">17</span>,<span class="number">19</span>,<span class="number">23</span>,<span class="number">29</span>,<span class="number">31</span>,<span class="number">37</span>,<span class="number">41</span>,<span class="number">43</span>,<span class="number">47</span>,<span class="number">53</span>,<span class="number">59</span>,<span class="number">61</span>,<span class="number">67</span>,<span class="number">71</span>,<span class="number">73</span>,<span class="number">79</span>,<span class="number">83</span>,<span class="number">89</span>,<span class="number">97</span>,<span class="number">101</span>,<span class="number">103</span>,<span class="number">107</span>,<span class="number">109</span>,<span class="number">113</span>,<span class="number">127</span>,<span class="number">131</span>,<span class="number">137</span>,<span class="number">139</span>,<span class="number">149</span>,<span class="number">151</span>,<span class="number">157</span>,<span class="number">163</span>,<span class="number">167</span>,<span class="number">173</span>,<span class="number">179</span>,<span class="number">181</span>,<span class="number">191</span>,<span class="number">193</span>,<span class="number">197</span>,<span class="number">199</span>,<span class="number">211</span>,<span class="number">223</span>,<span class="number">227</span>,<span class="number">229</span>,<span class="number">233</span>,<span class="number">239</span>,<span class="number">241</span>,<span class="number">251</span>,<span class="number">257</span>,<span class="number">263</span>,<span class="number">269</span>,<span class="number">271</span>,<span class="number">277</span>,<span class="number">281</span>&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">qpow</span> <span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (b) &#123;</span><br><span class="line">        <span class="keyword">if</span> (b&amp;<span class="number">1</span>) &#123;res=(<span class="number">1ll</span>*res*a)%P;&#125;</span><br><span class="line">        a=(<span class="number">1ll</span>*a*a)%P,b&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">modify</span> <span class="params">(<span class="type">int</span> x,<span class="type">int</span> v,<span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=x;i&lt;=<span class="number">100000</span>;i+=(i&amp;(-i))) &#123;</span><br><span class="line">        c[i][t]+=v;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query</span> <span class="params">(<span class="type">int</span> x,<span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=x;i;i-=(i&amp;(-i))) &#123;res+=c[i][t];&#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">100000</span>;i++) &#123;</span><br><span class="line">        a[i]=<span class="number">3</span>;</span><br><span class="line">        <span class="built_in">modify</span>(i,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;x,&amp;y,&amp;z);</span><br><span class="line">        <span class="keyword">if</span> (x==<span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">int</span> phi=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">0</span>;j&lt;=<span class="number">59</span>;j++) &#123;</span><br><span class="line">                <span class="type">int</span> tmp=<span class="built_in">query</span>(z,j)-<span class="built_in">query</span>(y<span class="number">-1</span>,j);</span><br><span class="line">                <span class="keyword">if</span> (tmp) &#123;</span><br><span class="line">                    phi=(<span class="number">1ll</span>*phi*<span class="built_in">qpow</span>(p[j],tmp<span class="number">-1</span>))%P;</span><br><span class="line">                    phi=(<span class="number">1ll</span>*phi*(p[j]<span class="number">-1</span>))%P;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,phi);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">0</span>;j&lt;=<span class="number">59</span>;j++) &#123;</span><br><span class="line">                <span class="type">int</span> cnt1=<span class="number">0</span>,cnt2=<span class="number">0</span>,cur1=a[y],cur2=z;</span><br><span class="line">                <span class="keyword">while</span> (cur1%p[j]==<span class="number">0</span>) &#123;</span><br><span class="line">                    cnt1++,cur1/=p[j];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">while</span> (cur2%p[j]==<span class="number">0</span>) &#123;</span><br><span class="line">                    cnt2++,cur2/=p[j];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="built_in">modify</span>(y,cnt2-cnt1,j);</span><br><span class="line">            &#125;</span><br><span class="line">            a[y]=z;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="39-【清华集训2014】简单回路"><a href="#39-【清华集训2014】简单回路" class="headerlink" title="#39. 【清华集训2014】简单回路"></a><a target="_blank" rel="noopener" href="https://uoj.ac/problem/39">#39. 【清华集训2014】简单回路</a></h3><h4 id="题目大意：-38"><a href="#题目大意：-38" class="headerlink" title="题目大意："></a>题目大意：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题目大意
    </div>
    <div class='spoiler-content'>
        <p>有一个 $n\times m$ 的网格，其中有 $k$ 个障碍物。有 $q$ 次询问，每次给定 $x,y$，求有多少个简单回路不经过任何障碍，且经过了 $(x,y)$ 和 $(x+1,y)$ 之间这条边。</p>
<p>$1\leq n\leq 1000, 1\leq m\leq 6, 1\leq k\leq 100, 1\leq q\leq 10000$</p>

    </div>
</div>
<h4 id="题解：-38"><a href="#题解：-38" class="headerlink" title="题解："></a>题解：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题解
    </div>
    <div class='spoiler-content'>
        <p>一个简单回路经过 $(x,y)$ 和 $(x+1,y)$ 之间这条边相当于在插头 DP 的转移过程中，转移到 $(x,y)$ 这里的时候强制有一个 $(x,y)$ 处向下的插头。</p>
<p>设 $f(i,S)$ 和 $g(i,S)$ 分别表示只考虑 $[1,i]$ / $[i,n]$ 中的行，第 $i$ 行向下 / 向上的插头状态为 $S$ 的方案数。回答询问 $(x,y)$ 时，将所有合法的 $f(x,S)\times g(x+1,T)$ 加起来即可。合法是指 $S,T$ 要能够恰好拼合成一条回路，而且在第 $y$ 列有插头。</p>
<p>插头 DP 的状态数很少，六个插头的时候只有 $C_6=51$ 种，七个插头时只有 $C_7=127$ 种。</p>
<p>时间复杂度：$O(nm^2C_{m+1}+(m+q)C_m^2)$</p>
<p><a target="_blank" rel="noopener" href="https://uoj.ac/submission/622874">https://uoj.ac/submission/622874</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1010</span>,M=<span class="number">150</span>,P=<span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line"><span class="type">int</span> n,m,k,q,x,y,nw,tot,cnt,sta[<span class="number">1</span>&lt;&lt;<span class="number">14</span>],vis[<span class="number">8</span>],rev[N],mp[N][N],f[N][M],g[N][M],con[M][M],dp[<span class="number">2</span>][M];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">s</span> <span class="params">(<span class="type">int</span> x,<span class="type">int</span> v)</span> </span>&#123;<span class="keyword">return</span> (x&gt;&gt;((v<span class="number">-1</span>)&lt;&lt;<span class="number">1</span>))&amp;<span class="number">3</span>;&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">gt</span> <span class="params">(<span class="type">int</span> x)</span> </span>&#123;<span class="keyword">if</span> (sta[x]==<span class="number">-1</span>) &#123;++tot;sta[rev[tot]=x]=tot;&#125; <span class="keyword">return</span> sta[x];&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">cg</span> <span class="params">(<span class="type">int</span> &amp;x,<span class="type">int</span> v,<span class="type">int</span> s)</span> </span>&#123;x&amp;=~(<span class="number">3</span>&lt;&lt;((v<span class="number">-1</span>)&lt;&lt;<span class="number">1</span>));x|=(s&lt;&lt;((v<span class="number">-1</span>)&lt;&lt;<span class="number">1</span>));&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span> <span class="params">(<span class="type">int</span> &amp;x,<span class="type">int</span> y)</span> </span>&#123;x+=y;<span class="keyword">if</span> (x&gt;=P) &#123;x-=P;&#125;&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">fd</span> <span class="params">(<span class="type">int</span> x,<span class="type">int</span> bt,<span class="type">int</span> tp)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=bt;;i+=tp) &#123;</span><br><span class="line">		<span class="type">int</span> tmp=<span class="built_in">s</span>(x,i);</span><br><span class="line">		res+=(tmp==<span class="number">1</span>?<span class="number">1</span>:(tmp==<span class="number">2</span>?<span class="number">-1</span>:<span class="number">0</span>));</span><br><span class="line">		<span class="keyword">if</span> (res==<span class="number">0</span>) &#123;<span class="keyword">return</span> i;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">calc</span> <span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> ls=nw;nw^=<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">memset</span>(dp[nw],<span class="number">0</span>,<span class="built_in">sizeof</span>(dp[nw]));</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;=tot;i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (!dp[ls][i]) &#123;<span class="keyword">continue</span>;&#125;</span><br><span class="line">		<span class="type">int</span> u=rev[i],p=<span class="built_in">s</span>(u,y),q=<span class="built_in">s</span>(u,y+<span class="number">1</span>),c1=((y!=m)&amp;&amp;(!mp[x][y+<span class="number">1</span>])),c2=(!mp[x+<span class="number">1</span>][y]);</span><br><span class="line">		<span class="keyword">if</span> (mp[x][y]) &#123;</span><br><span class="line">			<span class="keyword">if</span> (!p&amp;&amp;!q) &#123;<span class="built_in">add</span>(dp[nw][i],dp[ls][i]);&#125;</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (!p&amp;&amp;!q) &#123;</span><br><span class="line">			<span class="built_in">add</span>(dp[nw][i],dp[ls][i]);</span><br><span class="line">			<span class="keyword">if</span> (c1&amp;&amp;c2) &#123;<span class="built_in">cg</span>(u,y,<span class="number">1</span>),<span class="built_in">cg</span>(u,y+<span class="number">1</span>,<span class="number">2</span>);<span class="built_in">add</span>(dp[nw][<span class="built_in">gt</span>(u)],dp[ls][i]);&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (!p&amp;&amp;q) &#123;</span><br><span class="line">			<span class="keyword">if</span> (c1) &#123;<span class="built_in">add</span>(dp[nw][i],dp[ls][i]);&#125;</span><br><span class="line">			<span class="keyword">if</span> (c2) &#123;<span class="built_in">cg</span>(u,y,q),<span class="built_in">cg</span>(u,y+<span class="number">1</span>,<span class="number">0</span>);<span class="built_in">add</span>(dp[nw][<span class="built_in">gt</span>(u)],dp[ls][i]);&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (p&amp;&amp;!q) &#123;</span><br><span class="line">			<span class="keyword">if</span> (c2) &#123;<span class="built_in">add</span>(dp[nw][i],dp[ls][i]);&#125;</span><br><span class="line">			<span class="keyword">if</span> (c1) &#123;<span class="built_in">cg</span>(u,y+<span class="number">1</span>,p),<span class="built_in">cg</span>(u,y,<span class="number">0</span>);<span class="built_in">add</span>(dp[nw][<span class="built_in">gt</span>(u)],dp[ls][i]);&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (p&amp;&amp;q) &#123;</span><br><span class="line">			<span class="keyword">if</span> (p==<span class="number">1</span>&amp;&amp;q==<span class="number">2</span>) &#123;<span class="keyword">continue</span>;&#125;</span><br><span class="line">			<span class="type">int</span> p1=<span class="built_in">fd</span>(u,y,p==<span class="number">2</span>?<span class="number">-1</span>:<span class="number">1</span>),q1=<span class="built_in">fd</span>(u,y+<span class="number">1</span>,q==<span class="number">2</span>?<span class="number">-1</span>:<span class="number">1</span>);</span><br><span class="line">			<span class="built_in">cg</span>(u,y,<span class="number">0</span>),<span class="built_in">cg</span>(u,y+<span class="number">1</span>,<span class="number">0</span>),<span class="built_in">cg</span>(u,<span class="built_in">min</span>(p1,q1),<span class="number">1</span>),<span class="built_in">cg</span>(u,<span class="built_in">max</span>(p1,q1),<span class="number">2</span>);</span><br><span class="line">			<span class="built_in">add</span>(dp[nw][<span class="built_in">gt</span>(u)],dp[ls][i]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span> <span class="params">(<span class="type">int</span> f[][M])</span> </span>&#123;</span><br><span class="line">	<span class="built_in">memset</span>(dp[<span class="number">0</span>],<span class="number">0</span>,<span class="built_in">sizeof</span>(dp[<span class="number">0</span>]));</span><br><span class="line">	nw=<span class="number">0</span>,dp[<span class="number">0</span>][<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n<span class="number">-1</span>;i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">1</span>;j&lt;=m;j++) &#123;<span class="built_in">calc</span>(i,j);&#125;</span><br><span class="line">		<span class="built_in">memset</span>(dp[nw^<span class="number">1</span>],<span class="number">0</span>,<span class="built_in">sizeof</span>(dp[nw^<span class="number">1</span>]));</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">0</span>;j&lt;=tot;j++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (dp[nw][j]) &#123;f[i][j]=dp[nw][j];dp[nw^<span class="number">1</span>][<span class="built_in">gt</span>(rev[j]&lt;&lt;<span class="number">2</span>)]=dp[nw][j];&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		nw^=<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span> <span class="params">(<span class="type">int</span> x,<span class="type">int</span> y,<span class="type">int</span> u)</span> </span>&#123;</span><br><span class="line">	cnt++,vis[u]=<span class="number">1</span>;</span><br><span class="line">	<span class="type">int</span> v=<span class="built_in">fd</span>(x,u,<span class="built_in">s</span>(x,u)==<span class="number">2</span>?<span class="number">-1</span>:<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">if</span> (!vis[v]) &#123;<span class="built_in">dfs</span>(x,y,v);&#125;</span><br><span class="line">	v=<span class="built_in">fd</span>(y,u,<span class="built_in">s</span>(y,u)==<span class="number">2</span>?<span class="number">-1</span>:<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">if</span> (!vis[v]) &#123;<span class="built_in">dfs</span>(x,y,v);&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">chk</span> <span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">	cnt=<span class="number">0</span>;<span class="type">int</span> lbt=<span class="number">0</span>,ppc=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">6</span>;i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> ((<span class="built_in">s</span>(x,i)==<span class="number">0</span>)!=(<span class="built_in">s</span>(y,i)==<span class="number">0</span>)) &#123;<span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">s</span>(x,i)) &#123;lbt=i,ppc++,vis[i]=<span class="number">0</span>;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">dfs</span>(x,y,lbt);</span><br><span class="line">	<span class="keyword">return</span> (cnt==ppc);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">memset</span>(sta,<span class="number">-1</span>,<span class="built_in">sizeof</span>(sta));sta[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;n,&amp;m,&amp;k);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=k;i++) &#123;<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;x,&amp;y);mp[x][y]=<span class="number">1</span>;&#125;</span><br><span class="line">	<span class="built_in">solve</span>(f);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n/<span class="number">2</span>;i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">1</span>;j&lt;=m;j++) &#123;<span class="built_in">swap</span>(mp[i][j],mp[n-i+<span class="number">1</span>][j]);&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">solve</span>(g);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=tot;i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">1</span>;j&lt;=tot;j++) &#123;con[i][j]=<span class="built_in">chk</span>(rev[i],rev[j]);&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;q);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=q;i++) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;x,&amp;y);</span><br><span class="line">		<span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">1</span>;j&lt;=tot;j++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (!<span class="built_in">s</span>(rev[j],y)) &#123;<span class="keyword">continue</span>;&#125;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> k=<span class="number">1</span>;k&lt;=tot;k++) &#123;</span><br><span class="line">				<span class="keyword">if</span> (con[j][k]) &#123;res=(res+<span class="number">1ll</span>*f[x][j]*g[n-x][k])%P;&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,res);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="40-【清华集训2014】卡常数"><a href="#40-【清华集训2014】卡常数" class="headerlink" title="#40. 【清华集训2014】卡常数"></a><a target="_blank" rel="noopener" href="https://uoj.ac/problem/40">#40. 【清华集训2014】卡常数</a></h3><h4 id="题目大意：-39"><a href="#题目大意：-39" class="headerlink" title="题目大意："></a>题目大意：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题目大意
    </div>
    <div class='spoiler-content'>
        <p>三维空间中有 $n$ 个点，第 $i$ 个点坐标为 $(x_i,y_i,z_i)$。支持 $m$ 次操作：修改一个点的坐标为 $(x,y,z)$；给定 $x,y,z,r$，求到 $(x,y,z)$ 距离恰好为 $r$ 的点，保证答案唯一存在。所有操作参数都进行了如下加密：$x\to f(las\times x+1)$，其中 $f(x)=ax-b\sin x$，$las$ 为上次询问的答案，初始为 $0.1$。保证数据随机。</p>
<p>$1\leq n,m\leq 65536, |x_i|,|y_i|,|z_i|,|x|,|y|,|z|\leq 100, 0\leq r\leq 400, 0\leq b&lt;a&lt;5$</p>

    </div>
</div>
<h4 id="题解：-39"><a href="#题解：-39" class="headerlink" title="题解："></a>题解：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题解
    </div>
    <div class='spoiler-content'>
        <p>首先，参数的解密是容易的，因为 $f’(x)=a-b\cos x&gt;0$，故 $f(x)$ 单调，可以二分。</p>
<p>用 KDTree 支持查询即可。由于数据随机，所以不需要重构 KDTree。</p>
<p>注意有两种剪枝，因为长方体与球面无交分为相离和包含两种关系，需要分别判断。</p>
<p>时间复杂度：$O(n\log n+mn)$</p>
<p><a target="_blank" rel="noopener" href="https://uoj.ac/submission/623801">https://uoj.ac/submission/623801</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">135010</span>;</span><br><span class="line"><span class="type">const</span> db eps=<span class="number">1e-7</span>;</span><br><span class="line"><span class="type">int</span> n,m,tot,rt,dim,op,ch[N][<span class="number">2</span>],f[N],ava[N],bel[N],c[N],rev[N];</span><br><span class="line">db a,b,u,r,las=<span class="number">0.1</span>,ns[<span class="number">3</span>],s[N][<span class="number">3</span>],mn[N][<span class="number">3</span>],mx[N][<span class="number">3</span>];</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span> <span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span> </span>&#123;<span class="keyword">return</span> s[x][dim]&lt;s[y][dim];&#125;</span><br><span class="line"><span class="function">db <span class="title">gf</span> <span class="params">(db x)</span> </span>&#123;<span class="keyword">return</span> a*x-b*<span class="built_in">sin</span>(x);&#125;</span><br><span class="line"><span class="function">db <span class="title">revf</span> <span class="params">(db l,db r,db x)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">60</span>;i++) &#123;</span><br><span class="line">		db mid=(l+r)/<span class="number">2.0</span>;</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">gf</span>(las*mid+<span class="number">1</span>)&gt;x) &#123;r=mid;&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;l=mid;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> l;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">upd</span> <span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">2</span>;i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (ava[x]) &#123;mn[x][i]=mx[x][i]=s[x][i];&#125; <span class="keyword">else</span> &#123;mn[x][i]=<span class="number">1e18</span>,mx[x][i]=<span class="number">-1e18</span>;&#125;</span><br><span class="line">		<span class="keyword">if</span> (ch[x][<span class="number">0</span>]) &#123;mn[x][i]=<span class="built_in">min</span>(mn[x][i],mn[ch[x][<span class="number">0</span>]][i]),mx[x][i]=<span class="built_in">max</span>(mx[x][i],mx[ch[x][<span class="number">0</span>]][i]);&#125;</span><br><span class="line">		<span class="keyword">if</span> (ch[x][<span class="number">1</span>]) &#123;mn[x][i]=<span class="built_in">min</span>(mn[x][i],mn[ch[x][<span class="number">1</span>]][i]),mx[x][i]=<span class="built_in">max</span>(mx[x][i],mx[ch[x][<span class="number">1</span>]][i]);&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">buildt</span> <span class="params">(<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> d)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (l&gt;r) &#123;<span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;dim=d;</span><br><span class="line">	<span class="built_in">nth_element</span>(c+l,c+mid,c+r+<span class="number">1</span>,cmp);</span><br><span class="line">	f[ch[c[mid]][<span class="number">0</span>]=<span class="built_in">buildt</span>(l,mid<span class="number">-1</span>,(d+<span class="number">1</span>)%<span class="number">3</span>)]=f[ch[c[mid]][<span class="number">1</span>]=<span class="built_in">buildt</span>(mid+<span class="number">1</span>,r,(d+<span class="number">1</span>)%<span class="number">3</span>)]=c[mid];</span><br><span class="line">	<span class="built_in">upd</span>(c[mid]);<span class="keyword">return</span> c[mid];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query</span> <span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!x) &#123;<span class="keyword">return</span> <span class="number">-1</span>;&#125;</span><br><span class="line">	db dis=<span class="number">0</span>,tmp=<span class="number">0</span>;</span><br><span class="line">	dis=<span class="number">0</span>;</span><br><span class="line">	tmp=<span class="built_in">max</span>(<span class="built_in">fabs</span>(ns[<span class="number">0</span>]-mn[x][<span class="number">0</span>]),<span class="built_in">fabs</span>(ns[<span class="number">0</span>]-mx[x][<span class="number">0</span>]));</span><br><span class="line">	dis+=tmp*tmp;</span><br><span class="line">	tmp=<span class="built_in">max</span>(<span class="built_in">fabs</span>(ns[<span class="number">1</span>]-mn[x][<span class="number">1</span>]),<span class="built_in">fabs</span>(ns[<span class="number">1</span>]-mx[x][<span class="number">1</span>]));</span><br><span class="line">	dis+=tmp*tmp;</span><br><span class="line">	tmp=<span class="built_in">max</span>(<span class="built_in">fabs</span>(ns[<span class="number">2</span>]-mn[x][<span class="number">2</span>]),<span class="built_in">fabs</span>(ns[<span class="number">2</span>]-mx[x][<span class="number">2</span>]));</span><br><span class="line">	dis+=tmp*tmp;</span><br><span class="line">	<span class="keyword">if</span> (dis&lt;r-eps) &#123;<span class="keyword">return</span> <span class="number">-1</span>;&#125;</span><br><span class="line">	dis=<span class="number">0</span>;</span><br><span class="line">	tmp=<span class="built_in">max</span>(mn[x][<span class="number">0</span>]-ns[<span class="number">0</span>],ns[<span class="number">0</span>]-mx[x][<span class="number">0</span>]);</span><br><span class="line">	<span class="keyword">if</span> (tmp&gt;<span class="number">0</span>) &#123;dis+=tmp*tmp;&#125;</span><br><span class="line">	tmp=<span class="built_in">max</span>(mn[x][<span class="number">1</span>]-ns[<span class="number">1</span>],ns[<span class="number">1</span>]-mx[x][<span class="number">1</span>]);</span><br><span class="line">	<span class="keyword">if</span> (tmp&gt;<span class="number">0</span>) &#123;dis+=tmp*tmp;&#125;</span><br><span class="line">	tmp=<span class="built_in">max</span>(mn[x][<span class="number">2</span>]-ns[<span class="number">2</span>],ns[<span class="number">2</span>]-mx[x][<span class="number">2</span>]);</span><br><span class="line">	<span class="keyword">if</span> (tmp&gt;<span class="number">0</span>) &#123;dis+=tmp*tmp;&#125;</span><br><span class="line">	<span class="keyword">if</span> (dis&gt;r+eps) &#123;<span class="keyword">return</span> <span class="number">-1</span>;&#125;</span><br><span class="line">	dis=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">2</span>;i++) &#123;dis+=(s[x][i]-ns[i])*(s[x][i]-ns[i]);&#125;</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">fabs</span>(dis-r)&lt;eps) &#123;<span class="keyword">return</span> x;&#125;</span><br><span class="line">	<span class="type">int</span> res=<span class="built_in">query</span>(ch[x][<span class="number">0</span>]);</span><br><span class="line">	<span class="keyword">if</span> (res!=<span class="number">-1</span>) &#123;<span class="keyword">return</span> res;&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">query</span>(ch[x][<span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%lf%lf&quot;</span>,&amp;n,&amp;m,&amp;a,&amp;b);tot=n;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">0</span>;j&lt;=<span class="number">2</span>;j++) &#123;<span class="built_in">scanf</span>(<span class="string">&quot;%lf&quot;</span>,&amp;s[i][j]);mn[i][j]=mx[i][j]=s[i][j];&#125;</span><br><span class="line">		ava[i]=<span class="number">1</span>,c[i]=bel[i]=rev[i]=i;</span><br><span class="line">	&#125;</span><br><span class="line">	rt=<span class="built_in">buildt</span>(<span class="number">1</span>,n,<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;op);</span><br><span class="line">		<span class="keyword">if</span> (op==<span class="number">0</span>) &#123;</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%lf%lf%lf%lf&quot;</span>,&amp;u,&amp;ns[<span class="number">0</span>],&amp;ns[<span class="number">1</span>],&amp;ns[<span class="number">2</span>]);</span><br><span class="line">			ava[++tot]=<span class="number">1</span>;</span><br><span class="line">			<span class="type">int</span> v=(<span class="type">int</span>)(<span class="built_in">revf</span>(-n<span class="number">-1</span>,n+<span class="number">1</span>,u)+<span class="number">0.5</span>);</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">2</span>;i++) &#123;s[tot][i]=ns[i]=<span class="built_in">revf</span>(<span class="number">-100</span>,<span class="number">100</span>,ns[i]);&#125;</span><br><span class="line">			<span class="type">int</span> cur=bel[v],d=<span class="number">0</span>;ava[cur]=<span class="number">0</span>;</span><br><span class="line">			<span class="keyword">while</span> (cur) &#123;<span class="built_in">upd</span>(cur);cur=f[cur];&#125;</span><br><span class="line">			cur=rt,bel[v]=tot,rev[tot]=v;</span><br><span class="line">			<span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">				<span class="keyword">if</span> (ns[d]&lt;=s[cur][d]) &#123;</span><br><span class="line">					<span class="keyword">if</span> (!ch[cur][<span class="number">0</span>]) &#123;f[ch[cur][<span class="number">0</span>]=tot]=cur;<span class="keyword">break</span>;&#125;</span><br><span class="line">					cur=ch[cur][<span class="number">0</span>];</span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					<span class="keyword">if</span> (!ch[cur][<span class="number">1</span>]) &#123;f[ch[cur][<span class="number">1</span>]=tot]=cur;<span class="keyword">break</span>;&#125;</span><br><span class="line">					cur=ch[cur][<span class="number">1</span>];</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			cur=tot;</span><br><span class="line">			<span class="keyword">while</span> (cur) &#123;<span class="built_in">upd</span>(cur);cur=f[cur];&#125;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%lf%lf%lf%lf&quot;</span>,&amp;ns[<span class="number">0</span>],&amp;ns[<span class="number">1</span>],&amp;ns[<span class="number">2</span>],&amp;u);</span><br><span class="line">			r=<span class="built_in">revf</span>(<span class="number">0</span>,<span class="number">400</span>,u);</span><br><span class="line">			r=r*r;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">2</span>;i++) &#123;ns[i]=<span class="built_in">revf</span>(<span class="number">-100</span>,<span class="number">100</span>,ns[i]);&#125;</span><br><span class="line">			<span class="type">int</span> tmp=rev[<span class="built_in">query</span>(rt)];</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,tmp);</span><br><span class="line">			las=(db)tmp;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div>
<hr>
<h3 id="41-【清华集训2014】矩阵变换"><a href="#41-【清华集训2014】矩阵变换" class="headerlink" title="#41. 【清华集训2014】矩阵变换"></a><a target="_blank" rel="noopener" href="https://uoj.ac/problem/41">#41. 【清华集训2014】矩阵变换</a></h3><h4 id="题目大意：-40"><a href="#题目大意：-40" class="headerlink" title="题目大意："></a>题目大意：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题目大意
    </div>
    <div class='spoiler-content'>
        <p>有一个 $n\times m$ 矩阵，每行中 $1,\ldots,n$ 都出现了恰好一次，其余位置都为 $0$；每列中 $1,\ldots,n$ 每个数都出现了至多一次。</p>
<p>你需要在每行中选择一个数，然后将这一行这个数后面的所有数都修改为这个数，要求修改后仍满足每列中每个数出现至多一次。请输出一种方案，或报告无解。</p>
<p>本题单个测试数据包含 $T$ 组数据。</p>
<p>$1\leq T\leq 49, 1\leq n\leq 199, 1\leq m\leq 399$</p>

    </div>
</div>
<h4 id="题解：-40"><a href="#题解：-40" class="headerlink" title="题解："></a>题解：</h4><div class='spoiler collapsed'>
    <div class='spoiler-title'>
        题解
    </div>
    <div class='spoiler-content'>
        <p>显然每行选的数不同，因此数和行之间形成一个完美匹配。</p>
<p>考虑怎样的情况是不合法的：如果存在一个数 $x$ 和一行 $u$，设 $x$ 在第 $v$ 行被选，第 $u$ 行选的数是 $y$。如果第 $u$ 行中 $y$ 排在 $x$ 之后，并且 $x$ 在第 $v$ 行排在第 $u$ 行之前，那么在 $x$ 在第 $u$ 行那一列就会有两个 $x$，从而不合法。容易证明这个条件是充要条件。</p>
<p>这个条件可以改写成稳定婚姻条件：每一行都偏好这一行内排得靠前的数，而每个数都偏好其排得靠后的行，然后寻找一个稳定婚姻匹配即可。</p>
<p>时间复杂度：$O(nm)$</p>
<p><a target="_blank" rel="noopener" href="https://uoj.ac/submission/623802">https://uoj.ac/submission/623802</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">210</span>;</span><br><span class="line"><span class="type">int</span> t,n,m,ma[N][N],ls[N][N],b[N][N],mat[<span class="number">2</span>*N],cur[N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">read</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> res=<span class="number">0</span>;<span class="type">char</span> c=<span class="built_in">getchar</span>();</span><br><span class="line">	<span class="keyword">while</span> (c&lt;<span class="string">&#x27;0&#x27;</span>||c&gt;<span class="string">&#x27;9&#x27;</span>) &#123;c=<span class="built_in">getchar</span>();&#125;</span><br><span class="line">	<span class="keyword">while</span> (c&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;c&lt;=<span class="string">&#x27;9&#x27;</span>) &#123;res=res*<span class="number">10</span>-<span class="string">&#x27;0&#x27;</span>+c;c=<span class="built_in">getchar</span>();&#125;</span><br><span class="line">	<span class="keyword">return</span> res; </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	t=<span class="built_in">read</span>();</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> ii=<span class="number">1</span>;ii&lt;=t;ii++) &#123;</span><br><span class="line">		n=<span class="built_in">read</span>(),m=<span class="built_in">read</span>();</span><br><span class="line">		queue &lt;<span class="type">int</span>&gt; q;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">			<span class="type">int</span> cnt=<span class="number">0</span>;q.<span class="built_in">push</span>(i);mat[i]=cur[i]=mat[i+n]=<span class="number">0</span>;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">1</span>;j&lt;=m;j++) &#123;</span><br><span class="line">				<span class="keyword">if</span> (ma[i][j]=<span class="built_in">read</span>()) &#123;ls[i][++cnt]=ma[i][j];b[ma[i][j]][i]=j;&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">while</span> (q.<span class="built_in">size</span>()) &#123;</span><br><span class="line">			<span class="type">int</span> a=q.<span class="built_in">front</span>();q.<span class="built_in">pop</span>();</span><br><span class="line">			<span class="type">int</span> y=ls[a][++cur[a]];</span><br><span class="line">			<span class="keyword">if</span> (!mat[y+n]) &#123;mat[y+n]=a,mat[a]=y+n;&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="keyword">if</span> (b[y][mat[y+n]]&gt;b[y][a]) &#123;q.<span class="built_in">push</span>(a);&#125;</span><br><span class="line">				<span class="keyword">else</span> &#123;mat[mat[y+n]]=<span class="number">0</span>,mat[a]=y+n;q.<span class="built_in">push</span>(mat[y+n]);mat[y+n]=a;&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;<span class="built_in">printf</span>(<span class="string">&quot;%d%c&quot;</span>,mat[i]-n,<span class="string">&quot; \n&quot;</span>[i==n]);&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
</div><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>
    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/OI/" rel="tag"># OI</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2023/09/29/SHTSC%202020%20%E6%B8%B8%E8%AE%B0/" rel="prev" title="SHTSC 2020 游记">
                  <i class="fa fa-chevron-left"></i> SHTSC 2020 游记
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2023/09/29/XR-3/" rel="next" title="XR-3">
                  XR-3 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ix35</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  





  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.0/katex.min.css" integrity="sha256-uik/hNqHWZldXh/0K35nqOSCff9F61/ZOFReqNOBgB0=" crossorigin="anonymous">



</body>
</html>
